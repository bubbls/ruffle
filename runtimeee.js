var cr={plugins_:{},behaviors:{}};"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"==typeof"test".__proto__?function(t){return t.__proto__}:function(t){return t.constructor.prototype}),function(){function t(t,e){this.x=t,this.y=e,cr.seal(this)}function e(t,e,i,n){this.set(t,e,i,n),cr.seal(this)}function i(){this.tlx=0,this.tly=0,this.trx=0,this.try_=0,this.brx=0,this.bry=0,this.blx=0,this.bly=0,cr.seal(this)}cr.logexport=function(t){window.console&&window.console.log&&window.console.log(t)},cr.logerror=function(t){window.console&&window.console.error&&window.console.error(t)},cr.seal=function(t){return t},cr.freeze=function(t){return t},cr.is_undefined=function(t){return void 0===t},cr.is_number=function(t){return"number"==typeof t},cr.is_string=function(t){return"string"==typeof t},cr.isPOT=function(t){return 0<t&&0==(t-1&t)},cr.nextHighestPowerOfTwo=function(t){--t;for(var e=1;e<32;e<<=1)t|=t>>e;return t+1},cr.abs=function(t){return t<0?-t:t},cr.max=function(t,e){return e<t?t:e},cr.min=function(t,e){return t<e?t:e},cr.PI=Math.PI,cr.round=function(t){return t+.5|0},cr.floor=function(t){return 0<=t?0|t:(0|t)-1},cr.ceil=function(t){var e=0|t;return e===t?e:1+e},t.prototype.offset=function(t,e){return this.x+=t,this.y+=e,this},t.prototype.mul=function(t,e){return this.x*=t,this.y*=e,this},cr.vector2=t,cr.segments_intersect=function(t,e,i,n,r,s,o,a){var h,c,l=t<i?(p=t,i):(p=i,t),u=r<o?(h=r,o):(h=o,r);if(l<h||u<p)return!1;if(p=s<a?(c=s,a):(c=a,s),(e<n?(d=e,n):(d=n,e))<c||p<d)return!1;var p=r-t+o-i,d=s-e+a-n,t=i-t,e=n-e,r=o-r,a=a-s,s=cr.abs(e*r-a*t),a=r*d-a*p;if(cr.abs(a)>s)return!1;p=t*d-e*p;return cr.abs(p)<=s},e.prototype.set=function(t,e,i,n){this.left=t,this.top=e,this.right=i,this.bottom=n},e.prototype.copy=function(t){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom},e.prototype.width=function(){return this.right-this.left},e.prototype.height=function(){return this.bottom-this.top},e.prototype.offset=function(t,e){return this.left+=t,this.top+=e,this.right+=t,this.bottom+=e,this},e.prototype.normalize=function(){var t=0;this.left>this.right&&(t=this.left,this.left=this.right,this.right=t),this.top>this.bottom&&(t=this.top,this.top=this.bottom,this.bottom=t)},e.prototype.intersects_rect=function(t){return!(t.right<this.left||t.bottom<this.top||t.left>this.right||t.top>this.bottom)},e.prototype.intersects_rect_off=function(t,e,i){return!(t.right+e<this.left||t.bottom+i<this.top||t.left+e>this.right||t.top+i>this.bottom)},e.prototype.contains_pt=function(t,e){return t>=this.left&&t<=this.right&&e>=this.top&&e<=this.bottom},e.prototype.equals=function(t){return this.left===t.left&&this.top===t.top&&this.right===t.right&&this.bottom===t.bottom},cr.rect=e,i.prototype.set_from_rect=function(t){this.tlx=t.left,this.tly=t.top,this.trx=t.right,this.try_=t.top,this.brx=t.right,this.bry=t.bottom,this.blx=t.left,this.bly=t.bottom},i.prototype.set_from_rotated_rect=function(t,e){var i,n,r,s,o,a,h;0===e?this.set_from_rect(t):(a=Math.sin(e),h=Math.cos(e),i=t.left*a,n=t.top*a,r=t.right*a,s=t.bottom*a,o=t.left*h,e=t.top*h,a=t.right*h,h=t.bottom*h,this.tlx=o-n,this.tly=e+i,this.trx=a-n,this.try_=e+r,this.brx=a-s,this.bry=h+r,this.blx=o-s,this.bly=h+i)},i.prototype.offset=function(t,e){return this.tlx+=t,this.tly+=e,this.trx+=t,this.try_+=e,this.brx+=t,this.bry+=e,this.blx+=t,this.bly+=e,this};var r=0,s=0;function n(t,e,i,n){s=t<e?i<n?(r=t<i?t:i,n<e?e:n):(r=t<n?t:n,i<e?e:i):i<n?(r=e<i?e:i,n<t?t:n):(r=e<n?e:n,i<t?t:i)}i.prototype.bounding_box=function(t){n(this.tlx,this.trx,this.brx,this.blx),t.left=r,t.right=s,n(this.tly,this.try_,this.bry,this.bly),t.top=r,t.bottom=s},i.prototype.contains_pt=function(t,e){var i=this.tlx,n=this.tly,r=this.trx-i,s=this.try_-n,o=this.brx-i,a=this.bry-n,h=t-i,c=e-n,l=r*r+s*s,u=r*o+s*a,p=r*h+s*c,d=o*o+a*a,f=o*h+a*c,y=1/(l*d-u*u),t=(d*p-u*f)*y,e=(l*f-u*p)*y;if(0<=t&&0<e&&t+e<1)return!0;e=((l=(r=this.blx-i)*r+(s=this.bly-n)*s)*f-(u=r*o+s*a)*(p=r*h+s*c))*(y=1/(l*d-u*u));return 0<=(t=(d*p-u*f)*y)&&0<e&&t+e<1},i.prototype.at=function(t,e){if(e)switch(t){case 0:return this.tlx;case 1:return this.trx;case 2:return this.brx;case 3:return this.blx;case 4:default:return this.tlx}else switch(t){case 0:return this.tly;case 1:return this.try_;case 2:return this.bry;case 3:return this.bly;case 4:default:return this.tly}},i.prototype.midX=function(){return(this.tlx+this.trx+this.brx+this.blx)/4},i.prototype.midY=function(){return(this.tly+this.try_+this.bry+this.bly)/4},i.prototype.intersects_segment=function(t,e,i,n){if(this.contains_pt(t,e)||this.contains_pt(i,n))return!0;for(var r,s,o,a,h=0;h<4;h++)if(r=this.at(h,!0),s=this.at(h,!1),o=this.at(h+1,!0),a=this.at(h+1,!1),cr.segments_intersect(t,e,i,n,r,s,o,a))return!0;return!1},i.prototype.intersects_quad=function(t){var e,i,n,r,s,o,a,h,c,l,u=t.midX(),p=t.midY();if(this.contains_pt(u,p))return!0;if(u=this.midX(),p=this.midY(),t.contains_pt(u,p))return!0;for(c=0;c<4;c++)for(l=0;l<4;l++)if(e=this.at(c,!0),i=this.at(c,!1),n=this.at(c+1,!0),r=this.at(c+1,!1),s=t.at(l,!0),o=t.at(l,!1),a=t.at(l+1,!0),h=t.at(l+1,!1),cr.segments_intersect(e,i,n,r,s,o,a,h))return!0;return!1},cr.quad=i,cr.RGB=function(t,e,i){return Math.max(Math.min(t,255),0)|Math.max(Math.min(e,255),0)<<8|Math.max(Math.min(i,255),0)<<16},cr.GetRValue=function(t){return 255&t},cr.GetGValue=function(t){return(65280&t)>>8},cr.GetBValue=function(t){return(16711680&t)>>16},cr.shallowCopy=function(t,e,i){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},cr.arrayRemove=function(t,e){var i,n;if(!((e=cr.floor(e))<0||e>=t.length)){for(i=e,n=t.length-1;i<n;i++)t[i]=t[i+1];cr.truncateArray(t,n)}},cr.truncateArray=function(t,e){t.length=e},cr.clearArray=function(t){cr.truncateArray(t,0)},cr.shallowAssignArray=function(t,e){var i,n;for(cr.clearArray(t),i=0,n=e.length;i<n;++i)t[i]=e[i]},cr.appendArray=function(t,e){t.push.apply(t,e)},cr.fastIndexOf=function(t,e){for(var i=0,n=t.length;i<n;++i)if(t[i]===e)return i;return-1},cr.arrayFindRemove=function(t,e){e=cr.fastIndexOf(t,e);-1!==e&&cr.arrayRemove(t,e)},cr.clamp=function(t,e,i){return t<e?e:i<t?i:t},cr.to_radians=function(t){return t/(180/cr.PI)},cr.to_degrees=function(t){return t*(180/cr.PI)},cr.clamp_angle_degrees=function(t){return(t%=360)<0&&(t+=360),t},cr.clamp_angle=function(t){return(t%=2*cr.PI)<0&&(t+=2*cr.PI),t},cr.to_clamped_degrees=function(t){return cr.clamp_angle_degrees(cr.to_degrees(t))},cr.to_clamped_radians=function(t){return cr.clamp_angle(cr.to_radians(t))},cr.angleTo=function(t,e,i,n){t=i-t,e=n-e;return Math.atan2(e,t)},cr.angleDiff=function(t,e){if(t===e)return 0;var i=Math.sin(t),t=Math.cos(t),e=i*Math.sin(e)+t*Math.cos(e);return 1<=e?0:e<=-1?cr.PI:Math.acos(e)},cr.angleRotate=function(t,e,i){var n=Math.sin(t),r=Math.cos(t),s=Math.sin(e),o=Math.cos(e);return Math.acos(n*s+r*o)>i?0<r*s-n*o?cr.clamp_angle(t+i):cr.clamp_angle(t-i):cr.clamp_angle(e)},cr.angleClockwise=function(t,e){var i=Math.sin(t);return Math.cos(t)*Math.sin(e)-i*Math.cos(e)<=0},cr.rotatePtAround=function(t,e,i,n,r,s){if(0===i)return s?t:e;var o=Math.sin(i),a=Math.cos(i),i=(t-=n)*o;return t=t*a-(e-=r)*o,e=e*a+i,t+=n,e+=r,s?t:e},cr.distanceTo=function(t,e,i,n){t=i-t,e=n-e;return Math.sqrt(t*t+e*e)},cr.xor=function(t,e){return!t!=!e},cr.lerp=function(t,e,i){return t+(e-t)*i},cr.unlerp=function(t,e,i){return t===e?0:(i-t)/(e-t)},cr.anglelerp=function(t,e,i){var n=cr.angleDiff(t,e);return cr.angleClockwise(e,t)?t+n*i:t-n*i},cr.qarp=function(t,e,i,n){return cr.lerp(cr.lerp(t,e,n),cr.lerp(e,i,n),n)},cr.cubic=function(t,e,i,n,r){return cr.lerp(cr.qarp(t,e,i,r),cr.qarp(e,i,n,r),r)},cr.cosp=function(t,e,i){return(t+e+(t-e)*Math.cos(i*Math.PI))/2},cr.hasAnyOwnProperty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!0;return!1},cr.wipe=function(t){for(var e in t)t.hasOwnProperty(e)&&delete t[e]};var o=+new Date,a=!(cr.performance_now=function(){if(void 0!==window.performance){var t=window.performance;if(void 0!==t.now)return t.now();if(void 0!==t.webkitNow)return t.webkitNow();if(void 0!==t.mozNow)return t.mozNow();if(void 0!==t.msNow)return t.msNow()}return Date.now()-o}),h=!1,c=!1;"undefined"!=typeof window&&(a=!(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&/safari/i.test(navigator.userAgent),h=/(iphone|ipod|ipad)/i.test(navigator.userAgent),c=window.c2ejecta);var l=!a&&!c&&!h&&"undefined"!=typeof Set&&void 0!==Set.prototype.forEach;function u(){this.s=null,this.items=null,this.item_count=0,l&&(this.s=new Set),this.values_cache=[],this.cache_valid=!0,cr.seal(this)}u.prototype.contains=function(t){return!this.isEmpty()&&(l?this.s.has(t):this.items&&this.items.hasOwnProperty(t))},u.prototype.add=function(t){var e,i;l?this.s.has(t)||(this.s.add(t),this.cache_valid=!1):(e=t.toString(),(i=this.items)?i.hasOwnProperty(e)||(i[e]=t,this.item_count++,this.cache_valid=!1):(this.items={},this.items[e]=t,this.item_count=1,this.cache_valid=!1))},u.prototype.remove=function(t){var e;this.isEmpty()||(l?this.s.has(t)&&(this.s.delete(t),this.cache_valid=!1):this.items&&(e=t.toString(),(t=this.items).hasOwnProperty(e)&&(delete t[e],this.item_count--,this.cache_valid=!1)))},u.prototype.clear=function(){this.isEmpty()||(l?this.s.clear():(this.items=null,this.item_count=0),cr.clearArray(this.values_cache),this.cache_valid=!0)},u.prototype.isEmpty=function(){return 0===this.count()},u.prototype.count=function(){return l?this.s.size:this.item_count};var p=null,d=0;function f(t){p[d++]=t}u.prototype.update_cache=function(){if(!this.cache_valid){if(l)cr.clearArray(this.values_cache),p=this.values_cache,d=0,this.s.forEach(f),p=null,d=0;else{var t=this.values_cache;cr.clearArray(t);var e,i=0,n=this.items;if(n)for(e in n)n.hasOwnProperty(e)&&(t[i++]=n[e])}this.cache_valid=!0}},u.prototype.valuesRef=function(){return this.update_cache(),this.values_cache},cr.ObjectSet=u;var y=new cr.ObjectSet;function g(){this.c=0,this.y=0,this.t=0,this.sum=0,cr.seal(this)}function m(t){this.pts_cache=[],this.bboxLeft=0,this.bboxTop=0,this.bboxRight=0,this.bboxBottom=0,this.convexpolys=null,this.set_pts(t),cr.seal(this)}function _(t,e){this.cellwidth=t,this.cellheight=e,this.cells={}}function v(t,e){this.cellwidth=t,this.cellheight=e,this.cells={}}cr.removeArrayDuplicates=function(t){for(var e=0,i=t.length;e<i;++e)y.add(t[e]);cr.shallowAssignArray(t,y.valuesRef()),y.clear()},cr.arrayRemoveAllFromObjectSet=function(t,e){l?cr.arrayRemoveAll_set(t,e.s):cr.arrayRemoveAll_arr(t,e.valuesRef())},cr.arrayRemoveAll_set=function(t,e){for(var i,n=0,r=0,s=t.length;n<s;++n)i=t[n],e.has(i)||(t[r++]=i);cr.truncateArray(t,r)},cr.arrayRemoveAll_arr=function(t,e){for(var i,n=0,r=0,s=t.length;n<s;++n)i=t[n],-1===cr.fastIndexOf(e,i)&&(t[r++]=i);cr.truncateArray(t,r)},g.prototype.add=function(t){this.y=t-this.c,this.t=this.sum+this.y,this.c=this.t-this.sum-this.y,this.sum=this.t},g.prototype.reset=function(){this.c=0,this.y=0,this.t=0,this.sum=0},cr.KahanAdder=g,cr.regexp_escape=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},m.prototype.set_pts=function(t){this.pts_array=t,this.pts_count=t.length/2,this.pts_cache.length=t.length,this.cache_width=-1,this.cache_height=-1,this.cache_angle=0},m.prototype.is_empty=function(){return!this.pts_array.length},m.prototype.update_bbox=function(){for(var t,e,i=this.pts_cache,n=i[0],r=n,s=i[1],o=s,a=1,h=this.pts_count;a<h;++a)(t=i[e=2*a])<n&&(n=t),r<t&&(r=t),(e=i[1+e])<s&&(s=e),o<e&&(o=e);this.bboxLeft=n,this.bboxRight=r,this.bboxTop=s,this.bboxBottom=o},m.prototype.set_from_rect=function(t,e,i){this.pts_cache.length=8,this.pts_count=4;var n=this.pts_cache;n[0]=t.left-e,n[1]=t.top-i,n[2]=t.right-e,n[3]=t.top-i,n[4]=t.right-e,n[5]=t.bottom-i,n[6]=t.left-e,n[7]=t.bottom-i,this.cache_width=t.right-t.left,this.cache_height=t.bottom-t.top,this.update_bbox()},m.prototype.set_from_quad=function(t,e,i,n,r){this.pts_cache.length=8,this.pts_count=4;var s=this.pts_cache;s[0]=t.tlx-e,s[1]=t.tly-i,s[2]=t.trx-e,s[3]=t.try_-i,s[4]=t.brx-e,s[5]=t.bry-i,s[6]=t.blx-e,s[7]=t.bly-i,this.cache_width=n,this.cache_height=r,this.update_bbox()},m.prototype.set_from_poly=function(t){this.pts_count=t.pts_count,cr.shallowAssignArray(this.pts_cache,t.pts_cache),this.bboxLeft=t.bboxLeft,this.bboxTop,t.bboxTop,this.bboxRight=t.bboxRight,this.bboxBottom=t.bboxBottom},m.prototype.cache_poly=function(t,e,i){if(this.cache_width!==t||this.cache_height!==e||this.cache_angle!==i){var n,r,s,o,a,h;this.cache_width=t,this.cache_height=e,this.cache_angle=i;var c=0,l=1,u=this.pts_array,p=this.pts_cache;for(0!==i&&(c=Math.sin(i),l=Math.cos(i)),n=0,o=this.pts_count;n<o;n++)s=1+(r=2*n),a=u[r]*t,h=u[s]*e,p[r]=a*l-h*c,p[s]=h*l+a*c;this.update_bbox()}},m.prototype.contains_pt=function(t,e){var i=this.pts_cache;if(t===i[0]&&e===i[1])return!0;for(var n,r,s,o,a=this.pts_count,h=this.bboxLeft-110,c=this.bboxTop-101,l=this.bboxRight+131,u=this.bboxBottom+120,p=0,d=0,f=0;f<a;f++)o=(f+1)%a*2,n=i[s=2*f],r=i[1+s],s=i[o],o=i[1+o],cr.segments_intersect(h,c,t,e,n,r,s,o)&&p++,cr.segments_intersect(l,u,t,e,n,r,s,o)&&d++;return p%2==1||d%2==1},m.prototype.intersects_poly=function(t,e,i){var n,r,s,o,a,h,c,l,u,p,d,f,y,g,m=t.pts_cache,_=this.pts_cache;if(this.contains_pt(m[0]+e,m[1]+i))return!0;if(t.contains_pt(_[0]-e,_[1]-i))return!0;for(n=0,o=this.pts_count;n<o;n++)for(s=(n+1)%o*2,c=_[r=2*n],l=_[1+r],u=_[s],p=_[1+s],a=0,h=t.pts_count;a<h;a++)if(g=(a+1)%h*2,d=m[y=2*a]+e,f=m[1+y]+i,y=m[g]+e,g=m[1+g]+i,cr.segments_intersect(c,l,u,p,d,f,y,g))return!0;return!1},m.prototype.intersects_segment=function(t,e,i,n,r,s){var o,a,h,c,l,u,p=this.pts_cache;if(this.contains_pt(i-t,n-e))return!0;for(o=0,a=this.pts_count;o<a;o++)if(u=(o+1)%a*2,h=p[l=2*o]+t,c=p[1+l]+e,l=p[u]+t,u=p[1+u]+e,cr.segments_intersect(i,n,r,s,h,c,l,u))return!0;return!1},m.prototype.mirror=function(t){for(var e,i=0,n=this.pts_count;i<n;++i)e=2*i,this.pts_cache[e]=2*t-this.pts_cache[e]},m.prototype.flip=function(t){for(var e,i=0,n=this.pts_count;i<n;++i)e=2*i+1,this.pts_cache[e]=2*t-this.pts_cache[e]},m.prototype.diag=function(){for(var t,e,i,n=0,r=this.pts_count;n<r;++n)e=1+(t=2*n),i=this.pts_cache[t],this.pts_cache[t]=this.pts_cache[e],this.pts_cache[e]=i},cr.CollisionPoly=m,_.prototype.totalCellCount=0,_.prototype.getCell=function(t,e,i){var n,r=this.cells[t];return r?(n=r[e])||(i?(n=w(this,t,e),this.cells[t][e]=n):null):i?(n=w(this,t,e),this.cells[t]={},this.cells[t][e]=n):null},_.prototype.XToCell=function(t){return cr.floor(t/this.cellwidth)},_.prototype.YToCell=function(t){return cr.floor(t/this.cellheight)},_.prototype.update=function(t,e,i){var n,r,s,o,a;if(e)for(n=e.left,r=e.right;n<=r;++n)for(s=e.top,o=e.bottom;s<=o;++s)i&&i.contains_pt(n,s)||(a=this.getCell(n,s,!1))&&(a.remove(t),a.isEmpty()&&(a=a,_.prototype.totalCellCount--,a.objects.clear(),b.length<1e3&&b.push(a),this.cells[n][s]=null));if(i)for(n=i.left,r=i.right;n<=r;++n)for(s=i.top,o=i.bottom;s<=o;++s)e&&e.contains_pt(n,s)||this.getCell(n,s,!0).insert(t)},_.prototype.queryRange=function(t,e){for(var i,n,r=this.XToCell(t.left),s=this.YToCell(t.top),o=this.XToCell(t.right),a=this.YToCell(t.bottom);r<=o;++r)for(i=s;i<=a;++i)(n=this.getCell(r,i,!1))&&n.dump(e)},cr.SparseGrid=_,v.prototype.totalCellCount=0,v.prototype.getCell=function(t,e,i){var n,r=this.cells[t];return r?(n=r[e])||(i?(n=T(this,t,e),this.cells[t][e]=n):null):i?(n=T(this,t,e),this.cells[t]={},this.cells[t][e]=n):null},v.prototype.XToCell=function(t){return cr.floor(t/this.cellwidth)},v.prototype.YToCell=function(t){return cr.floor(t/this.cellheight)},v.prototype.update=function(t,e,i){var n,r,s,o,a;if(e)for(n=e.left,r=e.right;n<=r;++n)for(s=e.top,o=e.bottom;s<=o;++s)i&&i.contains_pt(n,s)||(a=this.getCell(n,s,!1))&&(a.remove(t),a.isEmpty()&&(a=a,v.prototype.totalCellCount--,a.reset(),S.length<1e3&&S.push(a),this.cells[n][s]=null));if(i)for(n=i.left,r=i.right;n<=r;++n)for(s=i.top,o=i.bottom;s<=o;++s)e&&e.contains_pt(n,s)||this.getCell(n,s,!0).insert(t)},v.prototype.queryRange=function(t,e,i,n,r){for(var s,o,a=this.XToCell(t),h=this.YToCell(e),c=this.XToCell(i),l=this.YToCell(n);a<=c;++a)for(s=h;s<=l;++s)(o=this.getCell(a,s,!1))&&o.dump(r)},v.prototype.markRangeChanged=function(t){for(var e,i,n=t.left,r=t.top,s=t.right,o=t.bottom;n<=s;++n)for(e=r;e<=o;++e)(i=this.getCell(n,e,!1))&&(i.is_sorted=!1)},cr.RenderGrid=v;var b=[];function w(t,e,i){var n;return _.prototype.totalCellCount++,b.length?((n=b.pop()).grid=t,n.x=e,n.y=i,n):new cr.GridCell(t,e,i)}function x(t,e,i){this.grid=t,this.x=e,this.y=i,this.objects=new cr.ObjectSet}x.prototype.isEmpty=function(){return this.objects.isEmpty()},x.prototype.insert=function(t){this.objects.add(t)},x.prototype.remove=function(t){this.objects.remove(t)},x.prototype.dump=function(t){cr.appendArray(t,this.objects.valuesRef())},cr.GridCell=x;var S=[];function T(t,e,i){var n;return v.prototype.totalCellCount++,S.length?((n=S.pop()).grid=t,n.x=e,n.y=i,n):new cr.RenderCell(t,e,i)}function A(t,e,i){this.grid=t,this.x=e,this.y=i,this.objects=[],this.is_sorted=!0,this.pending_removal=new cr.ObjectSet,this.any_pending_removal=!1}function C(t,e){return t.zindex-e.zindex}A.prototype.isEmpty=function(){return!this.objects.length||!(this.objects.length>this.pending_removal.count())&&(this.flush_pending(),!0)},A.prototype.insert=function(t){if(this.pending_removal.contains(t))return this.pending_removal.remove(t),void(this.pending_removal.isEmpty()&&(this.any_pending_removal=!1));this.objects.length?(this.objects[this.objects.length-1].get_zindex()>t.get_zindex()&&(this.is_sorted=!1),this.objects.push(t)):(this.objects.push(t),this.is_sorted=!0)},A.prototype.remove=function(t){this.pending_removal.add(t),this.any_pending_removal=!0,30<=this.pending_removal.count()&&this.flush_pending()},A.prototype.flush_pending=function(){this.any_pending_removal&&(this.pending_removal.count()!==this.objects.length?(cr.arrayRemoveAllFromObjectSet(this.objects,this.pending_removal),this.pending_removal.clear(),this.any_pending_removal=!1):this.reset())},A.prototype.ensure_sorted=function(){this.is_sorted||(this.objects.sort(C),this.is_sorted=!0)},A.prototype.reset=function(){cr.clearArray(this.objects),this.is_sorted=!0,this.pending_removal.clear(),this.any_pending_removal=!1},A.prototype.dump=function(t){this.flush_pending(),this.ensure_sorted(),this.objects.length&&t.push(this.objects)},cr.RenderCell=A;var k=["lighter","xor","copy","destination-over","source-in","destination-in","source-out","destination-out","source-atop","destination-atop"];cr.effectToCompositeOp=function(t){return t<=0||11<=t?"source-over":k[t-1]},cr.setGLBlend=function(t,e,i){if(i)switch(t.srcBlend=i.ONE,t.destBlend=i.ONE_MINUS_SRC_ALPHA,e){case 1:t.srcBlend=i.ONE,t.destBlend=i.ONE;break;case 2:break;case 3:t.srcBlend=i.ONE,t.destBlend=i.ZERO;break;case 4:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.ONE;break;case 5:t.srcBlend=i.DST_ALPHA,t.destBlend=i.ZERO;break;case 6:t.srcBlend=i.ZERO,t.destBlend=i.SRC_ALPHA;break;case 7:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.ZERO;break;case 8:t.srcBlend=i.ZERO,t.destBlend=i.ONE_MINUS_SRC_ALPHA;break;case 9:t.srcBlend=i.DST_ALPHA,t.destBlend=i.ONE_MINUS_SRC_ALPHA;break;case 10:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.SRC_ALPHA}},cr.round6dp=function(t){return Math.round(1e6*t)/1e6},cr.equals_nocase=function(t,e){return"string"==typeof t&&"string"==typeof e&&(t.length===e.length&&(t===e||t.toLowerCase()===e.toLowerCase()))},cr.isCanvasInputEvent=function(t){t=t.target;return!t||(t===document||t===window||(!(!document||!document.body||t!==document.body)||!!cr.equals_nocase(t.tagName,"canvas")))}}();var MatrixArray="undefined"!=typeof Float32Array?Float32Array:Array,glMatrixArrayType=MatrixArray,vec3={},mat3={},mat4={},quat4={};vec3.create=function(t){var e=new MatrixArray(3);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2]),e},vec3.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},vec3.add=function(t,e,i){return i&&t!==i?(i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t)},vec3.subtract=function(t,e,i){return i&&t!==i?(i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i):(t[0]-=e[0],t[1]-=e[1],t[2]-=e[2],t)},vec3.negate=function(t,e){return(e=e||t)[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},vec3.scale=function(t,e,i){return i&&t!==i?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i):(t[0]*=e,t[1]*=e,t[2]*=e,t)},vec3.normalize=function(t,e){e=e||t;var i=t[0],n=t[1],r=t[2],t=Math.sqrt(i*i+n*n+r*r);return t?1===t?(e[0]=i,e[1]=n,e[2]=r):(t=1/t,e[0]=i*t,e[1]=n*t,e[2]=r*t):(e[0]=0,e[1]=0,e[2]=0),e},vec3.cross=function(t,e,i){i=i||t;var n=t[0],r=t[1],t=t[2],s=e[0],o=e[1],e=e[2];return i[0]=r*e-t*o,i[1]=t*s-n*e,i[2]=n*o-r*s,i},vec3.length=function(t){var e=t[0],i=t[1],t=t[2];return Math.sqrt(e*e+i*i+t*t)},vec3.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},vec3.direction=function(t,e,i){i=i||t;var n=t[0]-e[0],r=t[1]-e[1],t=t[2]-e[2];return(e=Math.sqrt(n*n+r*r+t*t))?(e=1/e,i[0]=n*e,i[1]=r*e,i[2]=t*e):(i[0]=0,i[1]=0,i[2]=0),i},vec3.lerp=function(t,e,i,n){return(n=n||t)[0]=t[0]+i*(e[0]-t[0]),n[1]=t[1]+i*(e[1]-t[1]),n[2]=t[2]+i*(e[2]-t[2]),n},vec3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"},mat3.create=function(t){var e=new MatrixArray(9);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]),e},mat3.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},mat3.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mat3.transpose=function(t,e){if(e&&t!==e)return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e;var i=t[1],n=t[2],e=t[5];return t[1]=t[3],t[2]=t[6],t[3]=i,t[5]=t[7],t[6]=n,t[7]=e,t},mat3.toMat4=function(t,e){return(e=e||mat4.create())[15]=1,e[14]=0,e[13]=0,e[12]=0,e[11]=0,e[10]=t[8],e[9]=t[7],e[8]=t[6],e[7]=0,e[6]=t[5],e[5]=t[4],e[4]=t[3],e[3]=0,e[2]=t[2],e[1]=t[1],e[0]=t[0],e},mat3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+"]"},mat4.create=function(t){var e=new MatrixArray(16);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},mat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},mat4.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.transpose=function(t,e){if(e&&t!==e)return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e;var i=t[1],n=t[2],r=t[3],s=t[6],o=t[7],e=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=i,t[6]=t[9],t[7]=t[13],t[8]=n,t[9]=s,t[11]=t[14],t[12]=r,t[13]=o,t[14]=e,t},mat4.determinant=function(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],h=t[7],c=t[8],l=t[9],u=t[10],p=t[11],d=t[12],f=t[13],y=t[14];return d*l*a*r-c*f*a*r-d*o*u*r+s*f*u*r+c*o*y*r-s*l*y*r-d*l*n*h+c*f*n*h+d*i*u*h-e*f*u*h-c*i*y*h+e*l*y*h+d*o*n*p-s*f*n*p-d*i*a*p+e*f*a*p+s*i*y*p-e*o*y*p-c*o*n*(t=t[15])+s*l*n*t+c*i*a*t-e*l*a*t-s*i*u*t+e*o*u*t},mat4.inverse=function(t,e){e=e||t;var i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],h=t[6],c=t[7],l=t[8],u=t[9],p=t[10],d=t[11],f=t[12],y=t[13],g=t[14],m=t[15],_=i*a-n*o,v=i*h-r*o,b=i*c-s*o,w=n*h-r*a,x=n*c-s*a,S=r*c-s*h,T=l*y-u*f,A=l*g-p*f,C=l*m-d*f,k=u*g-p*y,O=u*m-d*y,P=p*m-d*g,t=1/(_*P-v*O+b*k+w*C-x*A+S*T);return e[0]=(a*P-h*O+c*k)*t,e[1]=(-n*P+r*O-s*k)*t,e[2]=(y*S-g*x+m*w)*t,e[3]=(-u*S+p*x-d*w)*t,e[4]=(-o*P+h*C-c*A)*t,e[5]=(i*P-r*C+s*A)*t,e[6]=(-f*S+g*b-m*v)*t,e[7]=(l*S-p*b+d*v)*t,e[8]=(o*O-a*C+c*T)*t,e[9]=(-i*O+n*C-s*T)*t,e[10]=(f*x-y*b+m*_)*t,e[11]=(-l*x+u*b-d*_)*t,e[12]=(-o*k+a*A-h*T)*t,e[13]=(i*k-n*A+r*T)*t,e[14]=(-f*w+y*v-g*_)*t,e[15]=(l*w-u*v+p*_)*t,e},mat4.toRotationMat=function(t,e){return(e=e||mat4.create())[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.toMat3=function(t,e){return(e=e||mat3.create())[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},mat4.toInverseMat3=function(t,e){var i=t[0],n=t[1],r=t[2],s=t[4],o=t[5],a=t[6],h=t[8],c=t[9],l=t[10],u=l*o-a*c,p=-l*s+a*h,d=c*s-o*h,t=i*u+n*p+r*d;return t?(t=1/t,(e=e||mat3.create())[0]=u*t,e[1]=(-l*n+r*c)*t,e[2]=(a*n-r*o)*t,e[3]=p*t,e[4]=(l*i-r*h)*t,e[5]=(-a*i+r*s)*t,e[6]=d*t,e[7]=(-c*i+n*h)*t,e[8]=(o*i-n*s)*t,e):null},mat4.multiply=function(t,e,i){i=i||t;var n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],h=t[5],c=t[6],l=t[7],u=t[8],p=t[9],d=t[10],f=t[11],y=t[12],g=t[13],m=t[14],t=t[15],_=e[0],v=e[1],b=e[2],w=e[3],x=e[4],S=e[5],T=e[6],A=e[7],C=e[8],k=e[9],O=e[10],P=e[11],I=e[12],E=e[13],R=e[14],e=e[15];return i[0]=_*n+v*a+b*u+w*y,i[1]=_*r+v*h+b*p+w*g,i[2]=_*s+v*c+b*d+w*m,i[3]=_*o+v*l+b*f+w*t,i[4]=x*n+S*a+T*u+A*y,i[5]=x*r+S*h+T*p+A*g,i[6]=x*s+S*c+T*d+A*m,i[7]=x*o+S*l+T*f+A*t,i[8]=C*n+k*a+O*u+P*y,i[9]=C*r+k*h+O*p+P*g,i[10]=C*s+k*c+O*d+P*m,i[11]=C*o+k*l+O*f+P*t,i[12]=I*n+E*a+R*u+e*y,i[13]=I*r+E*h+R*p+e*g,i[14]=I*s+E*c+R*d+e*m,i[15]=I*o+E*l+R*f+e*t,i},mat4.multiplyVec3=function(t,e,i){i=i||e;var n=e[0],r=e[1],e=e[2];return i[0]=t[0]*n+t[4]*r+t[8]*e+t[12],i[1]=t[1]*n+t[5]*r+t[9]*e+t[13],i[2]=t[2]*n+t[6]*r+t[10]*e+t[14],i},mat4.multiplyVec4=function(t,e,i){i=i||e;var n=e[0],r=e[1],s=e[2],e=e[3];return i[0]=t[0]*n+t[4]*r+t[8]*s+t[12]*e,i[1]=t[1]*n+t[5]*r+t[9]*s+t[13]*e,i[2]=t[2]*n+t[6]*r+t[10]*s+t[14]*e,i[3]=t[3]*n+t[7]*r+t[11]*s+t[15]*e,i},mat4.translate=function(t,e,i){var n,r,s,o,a,h,c,l,u,p,d,f,y=e[0],g=e[1],e=e[2];return i&&t!==i?(n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],h=t[5],c=t[6],l=t[7],u=t[8],p=t[9],d=t[10],f=t[11],i[0]=n,i[1]=r,i[2]=s,i[3]=o,i[4]=a,i[5]=h,i[6]=c,i[7]=l,i[8]=u,i[9]=p,i[10]=d,i[11]=f,i[12]=n*y+a*g+u*e+t[12],i[13]=r*y+h*g+p*e+t[13],i[14]=s*y+c*g+d*e+t[14],i[15]=o*y+l*g+f*e+t[15],i):(t[12]=t[0]*y+t[4]*g+t[8]*e+t[12],t[13]=t[1]*y+t[5]*g+t[9]*e+t[13],t[14]=t[2]*y+t[6]*g+t[10]*e+t[14],t[15]=t[3]*y+t[7]*g+t[11]*e+t[15],t)},mat4.scale=function(t,e,i){var n=e[0],r=e[1],e=e[2];return i&&t!==i?(i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=t[3]*n,i[4]=t[4]*r,i[5]=t[5]*r,i[6]=t[6]*r,i[7]=t[7]*r,i[8]=t[8]*e,i[9]=t[9]*e,i[10]=t[10]*e,i[11]=t[11]*e,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i):(t[0]*=n,t[1]*=n,t[2]*=n,t[3]*=n,t[4]*=r,t[5]*=r,t[6]*=r,t[7]*=r,t[8]*=e,t[9]*=e,t[10]*=e,t[11]*=e,t)},mat4.rotate=function(t,e,i,n){var r,s,o,a,h,c,l,u,p,d,f,y,g,m,_,v,b,w,x,S,T=i[0],A=i[1],i=i[2],C=Math.sqrt(T*T+A*A+i*i);return C?(1!==C&&(T*=C=1/C,A*=C,i*=C),r=Math.sin(e),o=1-(s=Math.cos(e)),e=t[0],C=t[1],a=t[2],h=t[3],c=t[4],l=t[5],u=t[6],p=t[7],d=t[8],f=t[9],y=t[10],g=t[11],m=T*T*o+s,_=A*T*o+i*r,v=i*T*o-A*r,b=T*A*o-i*r,w=A*A*o+s,x=i*A*o+T*r,S=T*i*o+A*r,T=A*i*o-T*r,A=i*i*o+s,n?t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=e*m+c*_+d*v,n[1]=C*m+l*_+f*v,n[2]=a*m+u*_+y*v,n[3]=h*m+p*_+g*v,n[4]=e*b+c*w+d*x,n[5]=C*b+l*w+f*x,n[6]=a*b+u*w+y*x,n[7]=h*b+p*w+g*x,n[8]=e*S+c*T+d*A,n[9]=C*S+l*T+f*A,n[10]=a*S+u*T+y*A,n[11]=h*S+p*T+g*A,n):null},mat4.rotateX=function(t,e,i){var n=Math.sin(e),e=Math.cos(e),r=t[4],s=t[5],o=t[6],a=t[7],h=t[8],c=t[9],l=t[10],u=t[11];return i?t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[4]=r*e+h*n,i[5]=s*e+c*n,i[6]=o*e+l*n,i[7]=a*e+u*n,i[8]=r*-n+h*e,i[9]=s*-n+c*e,i[10]=o*-n+l*e,i[11]=a*-n+u*e,i},mat4.rotateY=function(t,e,i){var n=Math.sin(e),e=Math.cos(e),r=t[0],s=t[1],o=t[2],a=t[3],h=t[8],c=t[9],l=t[10],u=t[11];return i?t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=r*e+h*-n,i[1]=s*e+c*-n,i[2]=o*e+l*-n,i[3]=a*e+u*-n,i[8]=r*n+h*e,i[9]=s*n+c*e,i[10]=o*n+l*e,i[11]=a*n+u*e,i},mat4.rotateZ=function(t,e,i){var n=Math.sin(e),e=Math.cos(e),r=t[0],s=t[1],o=t[2],a=t[3],h=t[4],c=t[5],l=t[6],u=t[7];return i?t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=r*e+h*n,i[1]=s*e+c*n,i[2]=o*e+l*n,i[3]=a*e+u*n,i[4]=r*-n+h*e,i[5]=s*-n+c*e,i[6]=o*-n+l*e,i[7]=a*-n+u*e,i},mat4.frustum=function(t,e,i,n,r,s,o){var a=e-t,h=n-i,c=s-r;return(o=o||mat4.create())[0]=2*r/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*r/h,o[6]=0,o[7]=0,o[8]=(e+t)/a,o[9]=(n+i)/h,o[10]=-(s+r)/c,o[11]=-1,o[12]=0,o[13]=0,o[14]=-s*r*2/c,o[15]=0,o},mat4.perspective=function(t,e,i,n,r){return e*=t=i*Math.tan(t*Math.PI/360),mat4.frustum(-e,e,-t,t,i,n,r)},mat4.ortho=function(t,e,i,n,r,s,o){var a=e-t,h=n-i,c=s-r;return(o=o||mat4.create())[0]=2/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/h,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/c,o[11]=0,o[12]=-(t+e)/a,o[13]=-(n+i)/h,o[14]=-(s+r)/c,o[15]=1,o},mat4.lookAt=function(t,e,i,n){n=n||mat4.create();var r,s,o,a,h,c=t[0],l=t[1],t=t[2],u=i[0],p=i[1],d=i[2];return i=e[1],o=e[2],c===e[0]&&l===i&&t===o?mat4.identity(n):(i=c-e[0],o=l-e[1],a=t-e[2],e=p*(a*=h=1/Math.sqrt(i*i+o*o+a*a))-d*(o*=h),d=d*(i*=h)-u*a,u=u*o-p*i,(h=Math.sqrt(e*e+d*d+u*u))?(e*=h=1/h,d*=h,u*=h):u=d=e=0,p=o*u-a*d,r=a*e-i*u,s=i*d-o*e,(h=Math.sqrt(p*p+r*r+s*s))?(p*=h=1/h,r*=h,s*=h):s=r=p=0,n[0]=e,n[1]=p,n[2]=i,n[3]=0,n[4]=d,n[5]=r,n[6]=o,n[7]=0,n[8]=u,n[9]=s,n[10]=a,n[11]=0,n[12]=-(e*c+d*l+u*t),n[13]=-(p*c+r*l+s*t),n[14]=-(i*c+o*l+a*t),n[15]=1,n)},mat4.fromRotationTranslation=function(t,e,i){i=i||mat4.create();var n=t[0],r=t[1],s=t[2],o=t[3],a=n+n,h=r+r,c=s+s,t=n*a,l=n*h;n*=c;var u=r*h;return r*=c,s*=c,a*=o,h*=o,o*=c,i[0]=1-(u+s),i[1]=l+o,i[2]=n-h,i[3]=0,i[4]=l-o,i[5]=1-(t+s),i[6]=r+a,i[7]=0,i[8]=n+h,i[9]=r-a,i[10]=1-(t+u),i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i},mat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"},quat4.create=function(t){var e=new MatrixArray(4);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e},quat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},quat4.calculateW=function(t,e){var i=t[0],n=t[1],r=t[2];return e&&t!==e?(e[0]=i,e[1]=n,e[2]=r,e[3]=-Math.sqrt(Math.abs(1-i*i-n*n-r*r)),e):(t[3]=-Math.sqrt(Math.abs(1-i*i-n*n-r*r)),t)},quat4.inverse=function(t,e){return e&&t!==e?(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},quat4.length=function(t){var e=t[0],i=t[1],n=t[2],t=t[3];return Math.sqrt(e*e+i*i+n*n+t*t)},quat4.normalize=function(t,e){e=e||t;var i=t[0],n=t[1],r=t[2],s=t[3],t=Math.sqrt(i*i+n*n+r*r+s*s);return 0===t?(e[0]=0,e[1]=0,e[2]=0,e[3]=0):(t=1/t,e[0]=i*t,e[1]=n*t,e[2]=r*t,e[3]=s*t),e},quat4.multiply=function(t,e,i){i=i||t;var n=t[0],r=t[1],s=t[2],t=t[3],o=e[0],a=e[1],h=e[2],e=e[3];return i[0]=n*e+t*o+r*h-s*a,i[1]=r*e+t*a+s*o-n*h,i[2]=s*e+t*h+n*a-r*o,i[3]=t*e-n*o-r*a-s*h,i},quat4.multiplyVec3=function(t,e,i){i=i||e;var n=e[0],r=e[1],s=e[2],e=t[0],o=t[1],a=t[2],h=(t=t[3])*n+o*s-a*r,c=t*r+a*n-e*s,l=t*s+e*r-o*n,n=-e*n-o*r-a*s;return i[0]=h*t+n*-e+c*-a-l*-o,i[1]=c*t+n*-o+l*-e-h*-a,i[2]=l*t+n*-a+h*-o-c*-e,i},quat4.toMat3=function(t,e){e=e||mat3.create();var i=t[0],n=t[1],r=t[2],s=t[3],o=i+i,a=n+n,h=r+r,c=i*o,l=i*a;i*=h;t=n*a;return n*=h,r*=h,o*=s,a*=s,s*=h,e[0]=1-(t+r),e[1]=l+s,e[2]=i-a,e[3]=l-s,e[4]=1-(c+r),e[5]=n+o,e[6]=i+a,e[7]=n-o,e[8]=1-(c+t),e},quat4.toMat4=function(t,e){e=e||mat4.create();var i=t[0],n=t[1],r=t[2],s=t[3],o=i+i,a=n+n,h=r+r,c=i*o,l=i*a;i*=h;t=n*a;return n*=h,r*=h,o*=s,a*=s,s*=h,e[0]=1-(t+r),e[1]=l+s,e[2]=i-a,e[3]=0,e[4]=l-s,e[5]=1-(c+r),e[6]=n+o,e[7]=0,e[8]=i+a,e[9]=n-o,e[10]=1-(c+t),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},quat4.slerp=function(t,e,i,n){n=n||t;var r,s,o=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3];return 1<=Math.abs(o)?(n!==t&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3]),n):(r=Math.acos(o),s=Math.sqrt(1-o*o),Math.abs(s)<.001?(n[0]=.5*t[0]+.5*e[0],n[1]=.5*t[1]+.5*e[1],n[2]=.5*t[2]+.5*e[2],n[3]=.5*t[3]+.5*e[3]):(o=Math.sin((1-i)*r)/s,i=Math.sin(i*r)/s,n[0]=t[0]*o+e[0]*i,n[1]=t[1]*o+e[1]*i,n[2]=t[2]*o+e[2]*i,n[3]=t[3]*o+e[3]*i),n)},quat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"},function(){var i=mat4.create();function t(t,e,i){this.isIE=/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent),this.width=0,this.height=0,this.enableFrontToBack=!!i,this.isEarlyZPass=!1,this.isBatchInEarlyZPass=!1,this.currentZ=0,this.zNear=1,this.zFar=1e3,this.zIncrement=(this.zFar-this.zNear)/32768,this.zA=this.zFar/(this.zFar-this.zNear),this.zB=this.zFar*this.zNear/(this.zNear-this.zFar),this.kzA=65536*this.zA,this.kzB=65536*this.zB,this.cam=vec3.create([0,0,100]),this.look=vec3.create([0,0,0]),this.up=vec3.create([0,1,0]),this.worldScale=vec3.create([1,1,1]),this.enable_mipmaps=!0,this.matP=mat4.create(),this.matMV=mat4.create(),this.lastMV=mat4.create(),this.currentMV=mat4.create(),this.gl=t,this.version=0===this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2")?2:1,this.initState()}function l(t,e,i){this.gl=t,this.shaderProgram=e,this.name=i,this.locAPos=t.getAttribLocation(e,"aPos"),this.locATex=t.getAttribLocation(e,"aTex"),this.locMatP=t.getUniformLocation(e,"matP"),this.locMatMV=t.getUniformLocation(e,"matMV"),this.locOpacity=t.getUniformLocation(e,"opacity"),this.locColorFill=t.getUniformLocation(e,"colorFill"),this.locSamplerFront=t.getUniformLocation(e,"samplerFront"),this.locSamplerBack=t.getUniformLocation(e,"samplerBack"),this.locDestStart=t.getUniformLocation(e,"destStart"),this.locDestEnd=t.getUniformLocation(e,"destEnd"),this.locSeconds=t.getUniformLocation(e,"seconds"),this.locPixelWidth=t.getUniformLocation(e,"pixelWidth"),this.locPixelHeight=t.getUniformLocation(e,"pixelHeight"),this.locLayerScale=t.getUniformLocation(e,"layerScale"),this.locLayerAngle=t.getUniformLocation(e,"layerAngle"),this.locViewOrigin=t.getUniformLocation(e,"viewOrigin"),this.locScrollPos=t.getUniformLocation(e,"scrollPos"),this.hasAnyOptionalUniforms=!!(this.locPixelWidth||this.locPixelHeight||this.locSeconds||this.locSamplerBack||this.locDestStart||this.locDestEnd||this.locLayerScale||this.locLayerAngle||this.locViewOrigin||this.locScrollPos),this.lpPixelWidth=-999,this.lpPixelHeight=-999,this.lpOpacity=1,this.lpDestStartX=0,this.lpDestStartY=0,this.lpDestEndX=1,this.lpDestEndY=1,this.lpLayerScale=1,this.lpLayerAngle=0,this.lpViewOriginX=0,this.lpViewOriginY=0,this.lpScrollPosX=0,this.lpScrollPosY=0,this.lpSeconds=0,this.lastCustomParams=[],this.lpMatMV=mat4.create(),this.locOpacity&&t.uniform1f(this.locOpacity,1),this.locColorFill&&t.uniform4f(this.locColorFill,1,1,1,1),this.locSamplerFront&&t.uniform1i(this.locSamplerFront,0),this.locSamplerBack&&t.uniform1i(this.locSamplerBack,1),this.locDestStart&&t.uniform2f(this.locDestStart,0,0),this.locDestEnd&&t.uniform2f(this.locDestEnd,1,1),this.locLayerScale&&t.uniform1f(this.locLayerScale,1),this.locLayerAngle&&t.uniform1f(this.locLayerAngle,0),this.locViewOrigin&&t.uniform2f(this.locViewOrigin,0,0),this.locScrollPos&&t.uniform2f(this.locScrollPos,0,0),this.locSeconds&&t.uniform1f(this.locSeconds,0),this.hasCurrentMatMV=!1}function e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function n(t,e){this.type=t,this.glwrap=e,this.gl=e.gl,this.opacityParam=0,this.startIndex=0,this.indexCount=0,this.texParam=null,this.mat4param=null,this.shaderParams=[],cr.seal(this)}t.prototype.initState=function(){var t=this.gl;for(this.lastOpacity=1,this.lastTexture0=null,this.lastTexture1=null,this.currentOpacity=1,t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.disable(t.CULL_FACE),t.disable(t.STENCIL_TEST),t.disable(t.DITHER),this.enableFrontToBack?(t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL)):t.disable(t.DEPTH_TEST),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.lastSrcBlend=t.ONE,this.lastDestBlend=t.ONE_MINUS_SRC_ALPHA,this.vertexData=new Float32Array(8e3*(this.enableFrontToBack?3:2)),this.texcoordData=new Float32Array(16e3),this.pointData=new Float32Array(32e3),this.pointBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.pointBuffer),t.bufferData(t.ARRAY_BUFFER,this.pointData.byteLength,t.DYNAMIC_DRAW),this.vertexBuffers=new Array(4),this.texcoordBuffers=new Array(4),r=0;r<4;r++)this.vertexBuffers[r]=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffers[r]),t.bufferData(t.ARRAY_BUFFER,this.vertexData.byteLength,t.DYNAMIC_DRAW),this.texcoordBuffers[r]=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.texcoordBuffers[r]),t.bufferData(t.ARRAY_BUFFER,this.texcoordData.byteLength,t.DYNAMIC_DRAW);this.curBuffer=0,this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);for(var e,i,n=new Uint16Array(12e3),r=0,s=0;r<12e3;)n[r++]=s,n[r++]=s+1,n[r++]=s+2,n[r++]=s,n[r++]=s+2,n[r++]=s+3,s+=4;t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW),this.vertexPtr=0,this.texPtr=0,this.pointPtr=0,this.shaderPrograms=[],e=["varying mediump vec2 vTex;","uniform lowp float opacity;","uniform lowp sampler2D samplerFront;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, vTex);","\tgl_FragColor *= opacity;","}"].join("\n"),i=(this.enableFrontToBack?["attribute highp vec3 aPos;","attribute mediump vec2 aTex;","varying mediump vec2 vTex;","uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, aPos.z, 1.0);","\tvTex = aTex;","}"]:["attribute highp vec2 aPos;","attribute mediump vec2 aTex;","varying mediump vec2 vTex;","uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);","\tvTex = aTex;","}"]).join("\n");var o=this.createShaderProgram({src:e},i,"<default>");this.shaderPrograms.push(o),e=["uniform mediump sampler2D samplerFront;","varying lowp float opacity;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, gl_PointCoord);","\tgl_FragColor *= opacity;","}"].join("\n");var a=["attribute vec4 aPos;","varying float opacity;","uniform mat4 matP;","uniform mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);","\tgl_PointSize = aPos.z;","\topacity = aPos.w;","}"].join("\n");o=this.createShaderProgram({src:e},a,"<point>"),this.shaderPrograms.push(o),e=["varying mediump vec2 vTex;","uniform lowp sampler2D samplerFront;","void main(void) {","\tif (texture2D(samplerFront, vTex).a < 1.0)","\t\tdiscard;","}"].join("\n");o=this.createShaderProgram({src:e},i,"<earlyz>");this.shaderPrograms.push(o),e=["uniform lowp vec4 colorFill;","void main(void) {","\tgl_FragColor = colorFill;","}"].join("\n");var h,o=this.createShaderProgram({src:e},i,"<fill>");for(h in this.shaderPrograms.push(o),cr.shaders)cr.shaders.hasOwnProperty(h)&&this.shaderPrograms.push(this.createShaderProgram(cr.shaders[h],i,h));t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,null),this.batch=[],this.batchPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.lastProgram=-1,this.currentProgram=-1,this.currentShader=null,this.fbo=t.createFramebuffer(),this.renderToTex=null,this.depthBuffer=null,this.attachedDepthBuffer=!1,this.enableFrontToBack&&(this.depthBuffer=t.createRenderbuffer()),this.tmpVec3=vec3.create([0,0,0]);o=t.getParameter(t.ALIASED_POINT_SIZE_RANGE);this.minPointSize=o[0],this.maxPointSize=o[1],2048<this.maxPointSize&&(this.maxPointSize=2048),this.switchProgram(0),cr.seal(this)},l.prototype.updateMatMV=function(t){e(this.lpMatMV,t)||(mat4.set(t,this.lpMatMV),this.gl.uniformMatrix4fv(this.locMatMV,!1,t))},t.prototype.createShaderProgram=function(t,e,i){var n=this.gl,r=n.createShader(n.FRAGMENT_SHADER);if(n.shaderSource(r,t.src),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS))return n.deleteShader(r),null;var s=n.createShader(n.VERTEX_SHADER);if(n.shaderSource(s,e),n.compileShader(s),!n.getShaderParameter(s,n.COMPILE_STATUS))return n.deleteShader(r),n.deleteShader(s),null;var o=n.createProgram();if(n.attachShader(o,r),n.attachShader(o,s),n.linkProgram(o),!n.getProgramParameter(o,n.LINK_STATUS))return n.deleteShader(r),n.deleteShader(s),n.deleteProgram(o),null;n.useProgram(o),n.deleteShader(r),n.deleteShader(s);var a,h,c=new l(n,o,i);for(c.extendBoxHorizontal=t.extendBoxHorizontal||0,c.extendBoxVertical=t.extendBoxVertical||0,c.crossSampling=!!t.crossSampling,c.preservesOpaqueness=!!t.preservesOpaqueness,c.animated=!!t.animated,c.parameters=t.parameters||[],a=0,h=c.parameters.length;a<h;a++)c.parameters[a][1]=n.getUniformLocation(o,c.parameters[a][0]),c.lastCustomParams.push(0),n.uniform1f(c.parameters[a][1],0);return cr.seal(c),c},t.prototype.getShaderIndex=function(t){for(var e=0,i=this.shaderPrograms.length;e<i;e++)if(this.shaderPrograms[e].name===t)return e;return-1},t.prototype.project=function(t,e,i){var n=this.matMV,r=this.matP,s=[0,0,0,0,0,0,0,0];s[0]=n[0]*t+n[4]*e+n[12],s[1]=n[1]*t+n[5]*e+n[13],s[2]=n[2]*t+n[6]*e+n[14],s[3]=n[3]*t+n[7]*e+n[15],s[4]=r[0]*s[0]+r[4]*s[1]+r[8]*s[2]+r[12]*s[3],s[5]=r[1]*s[0]+r[5]*s[1]+r[9]*s[2]+r[13]*s[3],s[6]=r[2]*s[0]+r[6]*s[1]+r[10]*s[2]+r[14]*s[3],s[7]=-s[2],0!==s[7]&&(s[7]=1/s[7],s[4]*=s[7],s[5]*=s[7],s[6]*=s[7],i[0]=(.5*s[4]+.5)*this.width,i[1]=(.5*s[5]+.5)*this.height)},t.prototype.setSize=function(t,e,i){if(this.width!==t||this.height!==e||i){this.endBatch();var n,r,s,o=this.gl;for(this.width=t,this.height=e,o.viewport(0,0,t,e),mat4.lookAt(this.cam,this.look,this.up,this.matMV),this.enableFrontToBack?(mat4.ortho(-t/2,t/2,e/2,-e/2,this.zNear,this.zFar,this.matP),this.worldScale[0]=1,this.worldScale[1]=1):(mat4.perspective(45,t/e,this.zNear,this.zFar,this.matP),t=[0,0],e=[0,0],this.project(0,0,t),this.project(1,1,e),this.worldScale[0]=1/(e[0]-t[0]),this.worldScale[1]=-1/(e[1]-t[1])),n=0,r=this.shaderPrograms.length;n<r;n++)(s=this.shaderPrograms[n]).hasCurrentMatMV=!1,s.locMatP&&(o.useProgram(s.shaderProgram),o.uniformMatrix4fv(s.locMatP,!1,this.matP));o.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram),o.bindTexture(o.TEXTURE_2D,null),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,null),o.activeTexture(o.TEXTURE0),this.lastTexture0=null,this.lastTexture1=null,this.depthBuffer&&(o.bindFramebuffer(o.FRAMEBUFFER,this.fbo),o.bindRenderbuffer(o.RENDERBUFFER,this.depthBuffer),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,this.width,this.height),this.attachedDepthBuffer||(o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,this.depthBuffer),this.attachedDepthBuffer=!0),o.bindRenderbuffer(o.RENDERBUFFER,null),o.bindFramebuffer(o.FRAMEBUFFER,null),this.renderToTex=null)}},t.prototype.resetModelView=function(){mat4.lookAt(this.cam,this.look,this.up,this.matMV),mat4.scale(this.matMV,this.worldScale)},t.prototype.translate=function(t,e){0===t&&0===e||(this.tmpVec3[0]=t,this.tmpVec3[1]=e,this.tmpVec3[2]=0,mat4.translate(this.matMV,this.tmpVec3))},t.prototype.scale=function(t,e){1===t&&1===e||(this.tmpVec3[0]=t,this.tmpVec3[1]=e,this.tmpVec3[2]=1,mat4.scale(this.matMV,this.tmpVec3))},t.prototype.rotateZ=function(t){0!==t&&mat4.rotateZ(this.matMV,t)},t.prototype.updateModelView=function(){var t;e(this.lastMV,this.matMV)||((t=this.pushBatch()).type=5,t.mat4param?mat4.set(this.matMV,t.mat4param):t.mat4param=mat4.create(this.matMV),mat4.set(this.matMV,this.lastMV),this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1)},t.prototype.setEarlyZIndex=function(t){this.enableFrontToBack&&(32760<t&&(t=32760),this.currentZ=this.cam[2]-this.zNear-t*this.zIncrement)},n.prototype.doSetEarlyZPass=function(){var t=this.gl,e=this.glwrap;0!==this.startIndex?(t.depthMask(!0),t.colorMask(!1,!1,!1,!1),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,e.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0),t.clear(t.DEPTH_BUFFER_BIT),t.bindFramebuffer(t.FRAMEBUFFER,null),e.isBatchInEarlyZPass=!0):(t.depthMask(!1),t.colorMask(!0,!0,!0,!0),t.enable(t.BLEND),e.isBatchInEarlyZPass=!1)},n.prototype.doSetTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texParam)},n.prototype.doSetTexture1=function(){var t=this.gl;t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.texParam),t.activeTexture(t.TEXTURE0)},n.prototype.doSetOpacity=function(){var t=this.opacityParam,e=this.glwrap;e.currentOpacity=t;e=e.currentShader;e.locOpacity&&e.lpOpacity!==t&&(e.lpOpacity=t,this.gl.uniform1f(e.locOpacity,t))},n.prototype.doQuad=function(){this.gl.drawElements(this.gl.TRIANGLES,this.indexCount,this.gl.UNSIGNED_SHORT,this.startIndex)},n.prototype.doSetBlend=function(){this.gl.blendFunc(this.startIndex,this.indexCount)},n.prototype.doUpdateModelView=function(){for(var t,e=this.glwrap.shaderPrograms,i=this.glwrap.currentProgram,n=0,r=e.length;n<r;n++)t=e[n],n===i&&t.locMatMV?(t.updateMatMV(this.mat4param),t.hasCurrentMatMV=!0):t.hasCurrentMatMV=!1;mat4.set(this.mat4param,this.glwrap.currentMV)},n.prototype.doRenderToTexture=function(){var t=this.gl,e=this.glwrap;this.texParam?(e.lastTexture1===this.texParam&&(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,null),e.lastTexture1=null,t.activeTexture(t.TEXTURE0)),t.bindFramebuffer(t.FRAMEBUFFER,e.fbo),e.isBatchInEarlyZPass||t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texParam,0)):(e.enableFrontToBack||t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0),t.bindFramebuffer(t.FRAMEBUFFER,null))},n.prototype.doClear=function(){var t=this.gl,e=this.startIndex;0===e?(t.clearColor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),t.clear(t.COLOR_BUFFER_BIT)):1===e?(t.enable(t.SCISSOR_TEST),t.scissor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.SCISSOR_TEST)):t.clear(t.DEPTH_BUFFER_BIT)},n.prototype.doSetDepthTestEnabled=function(){var t=this.gl;0!==this.startIndex?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)},n.prototype.doPoints=function(){var t=this.gl,e=this.glwrap;e.enableFrontToBack&&t.disable(t.DEPTH_TEST);var i=e.shaderPrograms[1];t.useProgram(i.shaderProgram),!i.hasCurrentMatMV&&i.locMatMV&&(i.updateMatMV(e.currentMV),i.hasCurrentMatMV=!0),t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.pointBuffer),t.vertexAttribPointer(i.locAPos,4,t.FLOAT,!1,0,0),t.drawArrays(t.POINTS,this.startIndex/4,this.indexCount),i=e.currentShader,t.useProgram(i.shaderProgram),0<=i.locAPos&&(t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.vertexBuffers[e.curBuffer]),t.vertexAttribPointer(i.locAPos,e.enableFrontToBack?3:2,t.FLOAT,!1,0,0)),0<=i.locATex&&(t.enableVertexAttribArray(i.locATex),t.bindBuffer(t.ARRAY_BUFFER,e.texcoordBuffers[e.curBuffer]),t.vertexAttribPointer(i.locATex,2,t.FLOAT,!1,0,0)),e.enableFrontToBack&&t.enable(t.DEPTH_TEST)},n.prototype.doSetProgram=function(){var t=this.gl,e=this.glwrap,i=e.shaderPrograms[this.startIndex];e.currentProgram=this.startIndex,e.currentShader=i,t.useProgram(i.shaderProgram),!i.hasCurrentMatMV&&i.locMatMV&&(i.updateMatMV(e.currentMV),i.hasCurrentMatMV=!0),i.locOpacity&&i.lpOpacity!==e.currentOpacity&&(i.lpOpacity=e.currentOpacity,t.uniform1f(i.locOpacity,e.currentOpacity)),0<=i.locAPos&&(t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.vertexBuffers[e.curBuffer]),t.vertexAttribPointer(i.locAPos,e.enableFrontToBack?3:2,t.FLOAT,!1,0,0)),0<=i.locATex&&(t.enableVertexAttribArray(i.locATex),t.bindBuffer(t.ARRAY_BUFFER,e.texcoordBuffers[e.curBuffer]),t.vertexAttribPointer(i.locATex,2,t.FLOAT,!1,0,0))},n.prototype.doSetColor=function(){var t=this.glwrap.currentShader,e=this.mat4param;this.gl.uniform4f(t.locColorFill,e[0],e[1],e[2],e[3])},n.prototype.doSetProgramParameters=function(){var t,e,i=this.glwrap.currentShader,n=this.gl,r=this.mat4param;i.locSamplerBack&&this.glwrap.lastTexture1!==this.texParam&&(n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,this.texParam),this.glwrap.lastTexture1=this.texParam,n.activeTexture(n.TEXTURE0));var s,o=r[0];if(i.locPixelWidth&&o!==i.lpPixelWidth&&(i.lpPixelWidth=o,n.uniform1f(i.locPixelWidth,o)),o=r[1],i.locPixelHeight&&o!==i.lpPixelHeight&&(i.lpPixelHeight=o,n.uniform1f(i.locPixelHeight,o)),o=r[2],s=r[3],!i.locDestStart||o===i.lpDestStartX&&s===i.lpDestStartY||(i.lpDestStartX=o,i.lpDestStartY=s,n.uniform2f(i.locDestStart,o,s)),o=r[4],s=r[5],!i.locDestEnd||o===i.lpDestEndX&&s===i.lpDestEndY||(i.lpDestEndX=o,i.lpDestEndY=s,n.uniform2f(i.locDestEnd,o,s)),o=r[6],i.locLayerScale&&o!==i.lpLayerScale&&(i.lpLayerScale=o,n.uniform1f(i.locLayerScale,o)),o=r[7],i.locLayerAngle&&o!==i.lpLayerAngle&&(i.lpLayerAngle=o,n.uniform1f(i.locLayerAngle,o)),o=r[8],s=r[9],!i.locViewOrigin||o===i.lpViewOriginX&&s===i.lpViewOriginY||(i.lpViewOriginX=o,i.lpViewOriginY=s,n.uniform2f(i.locViewOrigin,o,s)),o=r[10],s=r[11],!i.locScrollPos||o===i.lpScrollPosX&&s===i.lpScrollPosY||(i.lpScrollPosX=o,i.lpScrollPosY=s,n.uniform2f(i.locScrollPos,o,s)),o=r[12],i.locSeconds&&o!==i.lpSeconds&&(i.lpSeconds=o,n.uniform1f(i.locSeconds,o)),i.parameters.length)for(t=0,e=i.parameters.length;t<e;t++)(o=this.shaderParams[t])!==i.lastCustomParams[t]&&(i.lastCustomParams[t]=o,n.uniform1f(i.parameters[t][1],o))},t.prototype.pushBatch=function(){return this.batchPtr===this.batch.length&&this.batch.push(new n(0,this)),this.batch[this.batchPtr++]},t.prototype.endBatch=function(){if(0!==this.batchPtr&&!this.gl.isContextLost()){var t,e,i,n,r=this.gl;for(0<this.pointPtr&&(r.bindBuffer(r.ARRAY_BUFFER,this.pointBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,this.pointData.subarray(0,this.pointPtr)),t&&0<=t.locAPos&&"<point>"===t.name&&r.vertexAttribPointer(t.locAPos,4,r.FLOAT,!1,0,0)),0<this.vertexPtr&&(t=this.currentShader,r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffers[this.curBuffer]),r.bufferSubData(r.ARRAY_BUFFER,0,this.vertexData.subarray(0,this.vertexPtr)),t&&0<=t.locAPos&&"<point>"!==t.name&&r.vertexAttribPointer(t.locAPos,this.enableFrontToBack?3:2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.texcoordBuffers[this.curBuffer]),r.bufferSubData(r.ARRAY_BUFFER,0,this.texcoordData.subarray(0,this.texPtr)),t&&0<=t.locATex&&"<point>"!==t.name&&r.vertexAttribPointer(t.locATex,2,r.FLOAT,!1,0,0)),e=0,i=this.batchPtr;e<i;e++)switch((n=this.batch[e]).type){case 1:n.doQuad();break;case 2:n.doSetTexture();break;case 3:n.doSetOpacity();break;case 4:n.doSetBlend();break;case 5:n.doUpdateModelView();break;case 6:n.doRenderToTexture();break;case 7:n.doClear();break;case 8:n.doPoints();break;case 9:n.doSetProgram();break;case 10:n.doSetProgramParameters();break;case 11:n.doSetTexture1();break;case 12:n.doSetColor();break;case 13:n.doSetDepthTestEnabled();break;case 14:n.doSetEarlyZPass()}this.batchPtr=0,this.vertexPtr=0,this.texPtr=0,this.pointPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isBatchInEarlyZPass=!1,this.curBuffer++,4<=this.curBuffer&&(this.curBuffer=0)}},t.prototype.setOpacity=function(t){var e;t!==this.lastOpacity&&(this.isEarlyZPass||((e=this.pushBatch()).type=3,e.opacityParam=t,this.lastOpacity=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1))},t.prototype.setTexture=function(t){var e;t!==this.lastTexture0&&((e=this.pushBatch()).type=2,e.texParam=t,this.lastTexture0=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1)},t.prototype.setBlend=function(t,e){var i;t===this.lastSrcBlend&&e===this.lastDestBlend||this.isEarlyZPass||((i=this.pushBatch()).type=4,i.startIndex=t,i.indexCount=e,this.lastSrcBlend=t,this.lastDestBlend=e,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1)},t.prototype.isPremultipliedAlphaBlend=function(){return this.lastSrcBlend===this.gl.ONE&&this.lastDestBlend===this.gl.ONE_MINUS_SRC_ALPHA},t.prototype.setAlphaBlend=function(){this.setBlend(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)},t.prototype.setNoPremultiplyAlphaBlend=function(){this.setBlend(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)},t.prototype.quad=function(t,e,i,n,r,s,o,a){15992<=this.vertexPtr&&this.endBatch();var h,c=this.vertexPtr,l=this.texPtr,u=this.vertexData,p=this.texcoordData,d=this.currentZ;this.hasQuadBatchTop?this.batch[this.batchPtr-1].indexCount+=6:((h=this.pushBatch()).type=1,h.startIndex=this.enableFrontToBack?c:c/2*3,h.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1),this.enableFrontToBack?(u[c++]=t,u[c++]=e,u[c++]=d,u[c++]=i,u[c++]=n,u[c++]=d,u[c++]=r,u[c++]=s,u[c++]=d,u[c++]=o,u[c++]=a,u[c++]=d):(u[c++]=t,u[c++]=e,u[c++]=i,u[c++]=n,u[c++]=r,u[c++]=s,u[c++]=o,u[c++]=a),p[l++]=0,p[l++]=0,p[l++]=1,p[l++]=0,p[l++]=1,p[l++]=1,p[l++]=0,p[l++]=1,this.vertexPtr=c,this.texPtr=l},t.prototype.quadTex=function(t,e,i,n,r,s,o,a,h){15992<=this.vertexPtr&&this.endBatch();var c=this.vertexPtr,l=this.texPtr,u=this.vertexData,p=this.texcoordData,d=this.currentZ;this.hasQuadBatchTop?this.batch[this.batchPtr-1].indexCount+=6:((g=this.pushBatch()).type=1,g.startIndex=this.enableFrontToBack?c:c/2*3,g.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1);var f=h.left,y=h.top,g=h.right,h=h.bottom;this.enableFrontToBack?(u[c++]=t,u[c++]=e,u[c++]=d,u[c++]=i,u[c++]=n,u[c++]=d,u[c++]=r,u[c++]=s,u[c++]=d,u[c++]=o,u[c++]=a,u[c++]=d):(u[c++]=t,u[c++]=e,u[c++]=i,u[c++]=n,u[c++]=r,u[c++]=s,u[c++]=o,u[c++]=a),p[l++]=f,p[l++]=y,p[l++]=g,p[l++]=y,p[l++]=g,p[l++]=h,p[l++]=f,p[l++]=h,this.vertexPtr=c,this.texPtr=l},t.prototype.quadTexUV=function(t,e,i,n,r,s,o,a,h,c,l,u,p,d,f,y){15992<=this.vertexPtr&&this.endBatch();var g,m=this.vertexPtr,_=this.texPtr,v=this.vertexData,b=this.texcoordData,w=this.currentZ;this.hasQuadBatchTop?this.batch[this.batchPtr-1].indexCount+=6:((g=this.pushBatch()).type=1,g.startIndex=this.enableFrontToBack?m:m/2*3,g.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1),this.enableFrontToBack?(v[m++]=t,v[m++]=e,v[m++]=w,v[m++]=i,v[m++]=n,v[m++]=w,v[m++]=r,v[m++]=s,v[m++]=w,v[m++]=o,v[m++]=a,v[m++]=w):(v[m++]=t,v[m++]=e,v[m++]=i,v[m++]=n,v[m++]=r,v[m++]=s,v[m++]=o,v[m++]=a),b[_++]=h,b[_++]=c,b[_++]=l,b[_++]=u,b[_++]=p,b[_++]=d,b[_++]=f,b[_++]=y,this.vertexPtr=m,this.texPtr=_},t.prototype.convexPoly=function(t){for(var e,i,n,r,s,o,a=t.length/2-2,h=a-1,c=t[0],l=t[1],u=0;u<a;u+=2)e=t[2+(o=2*u)],i=t[3+o],n=t[4+o],r=t[5+o],u===h?this.quad(c,l,e,i,n,r,n,r):(s=t[6+o],o=t[7+o],this.quad(c,l,e,i,n,r,s,o))},t.prototype.point=function(t,e,i,n){7996<=this.pointPtr&&this.endBatch();var r,s=this.pointPtr,o=this.pointData;this.hasPointBatchTop?this.batch[this.batchPtr-1].indexCount++:((r=this.pushBatch()).type=8,r.startIndex=s,r.indexCount=1,this.hasPointBatchTop=!0,this.hasQuadBatchTop=!1),o[s++]=t,o[s++]=e,o[s++]=i,o[s++]=n,this.pointPtr=s},t.prototype.switchProgram=function(t){if(this.lastProgram!==t){var e=this.shaderPrograms[t];if(!e){if(0===this.lastProgram)return;t=0,e=this.shaderPrograms[0]}e=this.pushBatch();e.type=9,e.startIndex=t,this.lastProgram=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.programUsesDest=function(t){t=this.shaderPrograms[t];return!(!t.locDestStart&&!t.locDestEnd)},t.prototype.programUsesCrossSampling=function(t){t=this.shaderPrograms[t];return!!(t.locDestStart||t.locDestEnd||t.crossSampling)},t.prototype.programPreservesOpaqueness=function(t){return this.shaderPrograms[t].preservesOpaqueness},t.prototype.programExtendsBox=function(t){t=this.shaderPrograms[t];return 0!==t.extendBoxHorizontal||0!==t.extendBoxVertical},t.prototype.getProgramBoxExtendHorizontal=function(t){return this.shaderPrograms[t].extendBoxHorizontal},t.prototype.getProgramBoxExtendVertical=function(t){return this.shaderPrograms[t].extendBoxVertical},t.prototype.getProgramParameterType=function(t,e){return this.shaderPrograms[t].parameters[e][2]},t.prototype.programIsAnimated=function(t){return this.shaderPrograms[t].animated},t.prototype.setProgramParameters=function(t,e,i,n,r,s,o,a,h,c,l,u,p,d,f){var y,g,m,_,v,b=this.shaderPrograms[this.lastProgram];if(b.hasAnyOptionalUniforms||f.length){if((m=this.pushBatch()).type=10,m.mat4param?mat4.set(this.matMV,m.mat4param):m.mat4param=mat4.create(),(_=m.mat4param)[0]=e,_[1]=i,_[2]=n,_[3]=r,_[4]=s,_[5]=o,_[6]=a,_[7]=h,_[8]=c,_[9]=l,_[10]=u,_[11]=p,_[12]=d,b.locSamplerBack?m.texParam=t:m.texParam=null,f.length)for((v=m.shaderParams).length=f.length,y=0,g=f.length;y<g;y++)v[y]=f[y];this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.clear=function(t,e,i,n){var r=this.pushBatch();r.type=7,r.startIndex=0,r.mat4param||(r.mat4param=mat4.create()),r.mat4param[0]=t,r.mat4param[1]=e,r.mat4param[2]=i,r.mat4param[3]=n,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},t.prototype.clearRect=function(t,e,i,n){var r;i<0||n<0||((r=this.pushBatch()).type=7,r.startIndex=1,r.mat4param||(r.mat4param=mat4.create()),r.mat4param[0]=t,r.mat4param[1]=e,r.mat4param[2]=i,r.mat4param[3]=n,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1)},t.prototype.clearDepth=function(){var t=this.pushBatch();t.type=7,t.startIndex=2,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},t.prototype.setEarlyZPass=function(t){var e;this.enableFrontToBack&&(t=!!t,this.isEarlyZPass!==t&&((e=this.pushBatch()).type=14,e.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isEarlyZPass=t,this.renderToTex=null,this.isEarlyZPass?this.switchProgram(2):this.switchProgram(0)))},t.prototype.setDepthTestEnabled=function(t){var e;this.enableFrontToBack&&((e=this.pushBatch()).type=13,e.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1)},t.prototype.fullscreenQuad=function(){mat4.set(this.lastMV,i),this.resetModelView(),this.updateModelView();var t=this.width/2,e=this.height/2;this.quad(-t,e,t,e,t,-e,-t,-e),mat4.set(i,this.matMV),this.updateModelView()},t.prototype.setColorFillMode=function(t,e,i,n){this.switchProgram(3);var r=this.pushBatch();r.type=12,r.mat4param||(r.mat4param=mat4.create()),r.mat4param[0]=t,r.mat4param[1]=e,r.mat4param[2]=i,r.mat4param[3]=n,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},t.prototype.setTextureFillMode=function(){this.switchProgram(0)},t.prototype.restoreEarlyZMode=function(){this.switchProgram(2)},t.prototype.present=function(){this.endBatch(),this.gl.flush()};var f=[],y={};t.prototype.contextLost=function(){cr.clearArray(f),y={}},t.prototype.loadTexture=function(t,e,i,n,r,s){e=!!e,i=!!i;var o=t.src+","+e+","+i+(e?","+r:""),a=null;if(void 0!==t.src&&y.hasOwnProperty(o))return(a=y[o]).c2refcount++,a;this.endBatch();var h=this.gl,c=cr.isPOT(t.width)&&cr.isPOT(t.height),a=h.createTexture();h.bindTexture(h.TEXTURE_2D,a),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var l,u=h.RGBA,p=h.RGBA,d=h.UNSIGNED_BYTE;if(n&&!this.isIE)switch(n){case 1:u=h.RGB,p=h.RGB;break;case 2:d=h.UNSIGNED_SHORT_4_4_4_4;break;case 3:d=h.UNSIGNED_SHORT_5_5_5_1;break;case 4:u=h.RGB,p=h.RGB,d=h.UNSIGNED_SHORT_5_6_5}return 1===this.version&&!c&&e?((l=document.createElement("canvas")).width=cr.nextHighestPowerOfTwo(t.width),l.height=cr.nextHighestPowerOfTwo(t.height),void 0!==(n=l.getContext("2d")).imageSmoothingEnabled?n.imageSmoothingEnabled=i:(n.webkitImageSmoothingEnabled=i,n.mozImageSmoothingEnabled=i,n.msImageSmoothingEnabled=i),n.drawImage(t,0,0,t.width,t.height,0,0,l.width,l.height),h.texImage2D(h.TEXTURE_2D,0,u,p,d,l)):h.texImage2D(h.TEXTURE_2D,0,u,p,d,t),e?"repeat-x"===r?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE)):("repeat-y"===r?h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE):h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT)):(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE)),i?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),(c||2<=this.version)&&this.enable_mipmaps&&!s?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR_MIPMAP_LINEAR),h.generateMipmap(h.TEXTURE_2D)):h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR)):(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST)),h.bindTexture(h.TEXTURE_2D,null),this.lastTexture0=null,a.c2width=t.width,a.c2height=t.height,a.c2refcount=1,a.c2texkey=o,f.push(a),y[o]=a},t.prototype.createEmptyTexture=function(t,e,i,n,r){this.endBatch();var s=this.gl;this.isIE&&(n=!1);var o=s.createTexture();return s.bindTexture(s.TEXTURE_2D,o),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t,e,0,s.RGBA,n?s.UNSIGNED_SHORT_4_4_4_4:s.UNSIGNED_BYTE,null),r?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT)):(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE)),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,i?s.LINEAR:s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,i?s.LINEAR:s.NEAREST),s.bindTexture(s.TEXTURE_2D,null),this.lastTexture0=null,o.c2width=t,o.c2height=e,f.push(o),o},t.prototype.videoToTexture=function(t,e,i){this.endBatch();var n=this.gl;this.isIE&&(i=!1),n.bindTexture(n.TEXTURE_2D,e),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);try{n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,i?n.UNSIGNED_SHORT_4_4_4_4:n.UNSIGNED_BYTE,t)}catch(t){console&&console.error&&console.error("Error updating WebGL texture: ",t)}n.bindTexture(n.TEXTURE_2D,null),this.lastTexture0=null},t.prototype.deleteTexture=function(t){t&&(void 0!==t.c2refcount&&1<t.c2refcount?t.c2refcount--:(this.endBatch(),t===this.lastTexture0&&(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.lastTexture0=null),t===this.lastTexture1&&(this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.activeTexture(this.gl.TEXTURE0),this.lastTexture1=null),cr.arrayFindRemove(f,t),void 0!==t.c2texkey&&delete y[t.c2texkey],this.gl.deleteTexture(t)))},t.prototype.estimateVRAM=function(){for(var t,e=this.width*this.height*4*2,i=0,n=f.length;i<n;i++)e+=(t=f[i]).c2width*t.c2height*4;return e},t.prototype.textureCount=function(){return f.length},t.prototype.setRenderingToTexture=function(t){var e;t!==this.renderToTex&&((e=this.pushBatch()).type=6,e.texParam=t,this.renderToTex=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1)},cr.GLWrap=t}(),function(){var u=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;function i(t){var e;t&&(t.getContext||t.dc)&&(t.c2runtime||((e=t.c2runtime=this).isCrosswalk=/crosswalk/i.test(navigator.userAgent)||/xwalk/i.test(navigator.userAgent)||!(void 0===window.c2isCrosswalk||!window.c2isCrosswalk),this.isCordova=this.isCrosswalk||void 0!==window.device&&(void 0!==window.device.cordova||void 0!==window.device.phonegap)||void 0!==window.c2iscordova&&window.c2iscordova,this.isPhoneGap=this.isCordova,this.isDirectCanvas=!!t.dc,this.isAppMobi=void 0!==window.AppMobi||this.isDirectCanvas,this.isCocoonJs=!!window.c2cocoonjs,this.isEjecta=!!window.c2ejecta,this.isCocoonJs&&(CocoonJS.App.onSuspended.addEventListener(function(){e.setSuspended(!0)}),CocoonJS.App.onActivated.addEventListener(function(){e.setSuspended(!1)})),this.isEjecta&&(document.addEventListener("pagehide",function(){e.setSuspended(!0)}),document.addEventListener("pageshow",function(){e.setSuspended(!1)}),document.addEventListener("resize",function(){e.setSize(window.innerWidth,window.innerHeight)})),this.isDomFree=this.isDirectCanvas||this.isCocoonJs||this.isEjecta,this.isMicrosoftEdge=/edge\//i.test(navigator.userAgent),this.isIE=(/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)||/iemobile/i.test(navigator.userAgent))&&!this.isMicrosoftEdge,this.isTizen=/tizen/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)&&!this.isTizen&&!this.isIE&&!this.isMicrosoftEdge,this.isiPhone=(/iphone/i.test(navigator.userAgent)||/ipod/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isiPad=/ipad/i.test(navigator.userAgent),this.isiOS=this.isiPhone||this.isiPad||this.isEjecta,this.isiPhoneiOS6=this.isiPhone&&/os\s6/i.test(navigator.userAgent),this.isChrome=(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isAmazonWebApp=/amazonwebappplatform/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isSafari=/safari/i.test(navigator.userAgent)&&!this.isChrome&&!this.isIE&&!this.isMicrosoftEdge,this.isWindows=/windows/i.test(navigator.userAgent),this.isNWjs=void 0!==window.c2nodewebkit||void 0!==window.c2nwjs||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent),this.isNodeWebkit=this.isNWjs,this.isArcade=void 0!==window.is_scirra_arcade,this.isWindows8App=!(void 0===window.c2isWindows8||!window.c2isWindows8),this.isWindows8Capable=!(void 0===window.c2isWindows8Capable||!window.c2isWindows8Capable),this.isWindowsPhone8=!(void 0===window.c2isWindowsPhone8||!window.c2isWindowsPhone8),this.isWindowsPhone81=!(void 0===window.c2isWindowsPhone81||!window.c2isWindowsPhone81),this.isWindows10=!!window.cr_windows10,this.isWinJS=this.isWindows8App||this.isWindows8Capable||this.isWindowsPhone81||this.isWindows10,this.isBlackberry10=!(void 0===window.c2isBlackberry10||!window.c2isBlackberry10),this.isAndroidStockBrowser=this.isAndroid&&!this.isChrome&&!this.isCrosswalk&&!this.isFirefox&&!this.isAmazonWebApp&&!this.isDomFree,this.devicePixelRatio=1,this.isMobile=this.isCordova||this.isCrosswalk||this.isAppMobi||this.isCocoonJs||this.isAndroid||this.isiOS||this.isWindowsPhone8||this.isWindowsPhone81||this.isBlackberry10||this.isTizen||this.isEjecta,this.isMobile||(this.isMobile=/(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet|kindle|silk)/i.test(navigator.userAgent)),this.isWKWebView=!!(this.isiOS&&this.isCordova&&window.webkit),this.httpServer=null,this.httpServerUrl="",this.isWKWebView&&(this.httpServer=cordova&&cordova.plugins&&cordova.plugins.CorHttpd?cordova.plugins.CorHttpd:null),"undefined"==typeof cr_is_preview||this.isNWjs||"?nw"!==window.location.search&&!/nodewebkit/i.test(navigator.userAgent)&&!/nwjs/i.test(navigator.userAgent)||(this.isNWjs=!0),this.isDebug="undefined"!=typeof cr_is_preview&&-1<window.location.search.indexOf("debug"),this.canvas=t,this.canvasdiv=document.getElementById("c2canvasdiv"),this.gl=null,this.glwrap=null,this.glUnmaskedRenderer="(unavailable)",this.enableFrontToBack=!1,this.earlyz_index=0,this.ctx=null,this.firstInFullscreen=!1,this.oldWidth=0,this.oldHeight=0,this.canvas.oncontextmenu=function(t){return t.preventDefault&&t.preventDefault(),!1},this.canvas.onselectstart=function(t){return t.preventDefault&&t.preventDefault(),!1},this.isDirectCanvas&&(window.c2runtime=this),this.isNWjs&&(window.ondragover=function(t){return t.preventDefault(),!1},window.ondrop=function(t){return t.preventDefault(),!1},window.nwgui&&window.nwgui.App.clearCache&&window.nwgui.App.clearCache()),this.isAndroidStockBrowser&&"undefined"!=typeof jQuery&&jQuery("canvas").parents("*").css("overflow","visible"),this.width=t.width,this.height=t.height,this.draw_width=this.width,this.draw_height=this.height,this.cssWidth=this.width,this.cssHeight=this.height,this.lastWindowWidth=window.innerWidth,this.lastWindowHeight=window.innerHeight,this.forceCanvasAlpha=!1,this.redraw=!0,this.isSuspended=!1,Date.now||(Date.now=function(){return+new Date}),this.plugins=[],this.types={},this.types_by_index=[],this.behaviors=[],this.layouts={},this.layouts_by_index=[],this.eventsheets={},this.eventsheets_by_index=[],this.wait_for_textures=[],this.triggers_to_postinit=[],this.all_global_vars=[],this.all_local_vars=[],this.solidBehavior=null,this.jumpthruBehavior=null,this.shadowcasterBehavior=null,this.deathRow={},this.hasPendingInstances=!1,this.isInClearDeathRow=!1,this.isInOnDestroy=0,this.isRunningEvents=!1,this.isEndingLayout=!1,this.createRow=[],this.isLoadingState=!1,this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null,this.lastSaveJson="",this.signalledContinuousPreview=!1,this.suspendDrawing=!1,this.fireOnCreateAfterLoad=[],this.dt=0,this.dt1=0,this.minimumFramerate=30,this.logictime=0,this.cpuutilisation=0,this.timescale=1,this.kahanTime=new cr.KahanAdder,this.wallTime=new cr.KahanAdder,this.last_tick_time=0,this.fps=0,this.last_fps_time=0,this.tickcount=0,this.execcount=0,this.framecount=0,this.objectcount=0,this.changelayout=null,this.destroycallbacks=[],this.event_stack=[],this.event_stack_index=-1,this.localvar_stack=[[]],this.localvar_stack_index=0,this.trigger_depth=0,this.pushEventStack(null),this.loop_stack=[],this.loop_stack_index=-1,this.next_uid=0,this.next_puid=0,this.layout_first_tick=!0,this.family_count=0,this.suspend_events=[],this.raf_id=-1,this.timeout_id=-1,this.isloading=!0,this.loadingprogress=0,this.isNodeFullscreen=!1,this.stackLocalCount=0,this.audioInstance=null,this.had_a_click=!1,this.isInUserInputEvent=!1,this.objects_to_pretick=new cr.ObjectSet,this.objects_to_tick=new cr.ObjectSet,this.objects_to_tick2=new cr.ObjectSet,this.registered_collisions=[],this.temp_poly=new cr.CollisionPoly([]),this.temp_poly2=new cr.CollisionPoly([]),this.allGroups=[],this.groups_by_name={},this.cndsBySid={},this.actsBySid={},this.varsBySid={},this.blocksBySid={},this.running_layout=null,this.layer_canvas=null,this.layer_ctx=null,this.layer_tex=null,this.layout_tex=null,this.layout_canvas=null,this.layout_ctx=null,this.is_WebGL_context_lost=!1,this.uses_background_blending=!1,this.fx_tex=[null,null],this.fullscreen_scaling=0,this.files_subfolder="",this.objectsByUid={},this.loaderlogos=null,this.snapshotCanvas=null,this.snapshotData="",this.objectRefTable=[],this.requestProjectData()))}i.prototype.requestProjectData=function(){var e=this;if(this.isWKWebView){function i(){e.fetchLocalFileViaCordovaAsText("https://274539104-375910364482639571.preview.editmysite.com/uploads/b/139890129-908503369318119606/files/data.js",function(t){e.loadProject(JSON.parse(t))},function(t){alert("Error fetching data.js")})}this.httpServer?this.httpServer.startServer({port:0,localhost_only:!0},function(t){e.httpServerUrl=t,i()},function(t){console.log("Error starting local server: "+t+". Video playback will not work."),i()}):(console.log("Local server unavailable. Video playback will not work."),i())}else{var n=this.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest,r="https://274539104-375910364482639571.preview.editmysite.com/uploads/b/139890129-908503369318119606/files/data.js";(this.isWindows8App||this.isWindowsPhone8||this.isWindowsPhone81||this.isWindows10)&&(r="data.json"),n.open("GET",r,!0);var s=!1;if(!this.isDomFree&&"response"in n&&"responseType"in n)try{n.responseType="json",s="json"===n.responseType}catch(t){s=!1}if(!s&&"responseType"in n)try{n.responseType="text"}catch(t){}if("overrideMimeType"in n)try{n.overrideMimeType("application/json; charset=utf-8")}catch(t){}this.isWindowsPhone8?n.onreadystatechange=function(){4===n.readyState&&e.loadProject(JSON.parse(n.responseText))}:(n.onload=function(){var t;s?e.loadProject(n.response):e.isEjecta?(t=(t=n.responseText).substr(t.indexOf("{")),e.loadProject(JSON.parse(t))):e.loadProject(JSON.parse(n.responseText))},n.onerror=function(t){cr.logerror("Error requesting "+r+":"),cr.logerror(t)}),n.send()}},i.prototype.initRendererAndLoader=function(){var t,e,i,n,r,s,o,a,h,c,l,u=this;this.isRetina=(!this.isDomFree||this.isEjecta||this.isCordova)&&this.useHighDpi&&!this.isAndroidStockBrowser,0===this.fullscreen_mode&&this.isiOS&&(this.isRetina=!1),this.devicePixelRatio=this.isRetina&&(window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio||window.msDevicePixelRatio)||1,this.ClearDeathRow(),0<this.fullscreen_mode&&this.setSize(window.innerWidth,window.innerHeight,!0),this.canvas.addEventListener("webglcontextlost",function(t){t.preventDefault(),u.onContextLost(),cr.logexport("[Construct 2] WebGL context lost"),window.cr_setSuspended(!0)},!1),this.canvas.addEventListener("webglcontextrestored",function(t){u.glwrap.initState(),u.glwrap.setSize(u.glwrap.width,u.glwrap.height,!0),u.layer_tex=null,u.layout_tex=null,u.fx_tex[0]=null,u.fx_tex[1]=null,u.onContextRestored(),u.redraw=!0,cr.logexport("[Construct 2] WebGL context restored"),window.cr_setSuspended(!1)},!1);try{this.enableWebGL&&(this.isCocoonJs||this.isEjecta||!this.isDomFree)&&(l={alpha:!0,depth:!1,antialias:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0},this.gl=this.canvas.getContext("webgl2",l)||this.canvas.getContext("webgl",l)||this.canvas.getContext("experimental-webgl",l))}catch(t){}if(this.gl){this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2");var p,d=this.gl.getExtension("WEBGL_debug_renderer_info");for(d&&(p=this.gl.getParameter(d.UNMASKED_VENDOR_WEBGL),d=this.gl.getParameter(d.UNMASKED_RENDERER_WEBGL),this.glUnmaskedRenderer=d+" ["+p+"]"),this.enableFrontToBack&&(this.glUnmaskedRenderer+=" [front-to-back enabled]"),this.isDomFree||(this.overlay_canvas=document.createElement("canvas"),jQuery(this.overlay_canvas).appendTo(this.canvas.parentNode),this.overlay_canvas.oncontextmenu=function(t){return!1},this.overlay_canvas.onselectstart=function(t){return!1},this.overlay_canvas.width=Math.round(this.cssWidth*this.devicePixelRatio),this.overlay_canvas.height=Math.round(this.cssHeight*this.devicePixelRatio),jQuery(this.overlay_canvas).css({width:this.cssWidth+"px",height:this.cssHeight+"px"}),this.positionOverlayCanvas(),this.overlay_ctx=this.overlay_canvas.getContext("2d")),this.glwrap=new cr.GLWrap(this.gl,this.isMobile,this.enableFrontToBack),this.glwrap.setSize(this.canvas.width,this.canvas.height),this.glwrap.enable_mipmaps=0!==this.downscalingQuality,this.ctx=null,t=0,e=this.types_by_index.length;t<e;t++)for(i=0,n=(o=this.types_by_index[t]).effect_types.length;i<n;i++)(a=o.effect_types[i]).shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(a.shaderindex);for(t=0,e=this.layouts_by_index.length;t<e;t++){for(i=0,n=(h=this.layouts_by_index[t]).effect_types.length;i<n;i++)(a=h.effect_types[i]).shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex);for(h.updateActiveEffects(),i=0,n=h.layers.length;i<n;i++){for(r=0,s=(c=h.layers[i]).effect_types.length;r<s;r++)(a=c.effect_types[r]).shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(a.shaderindex);c.updateActiveEffects()}}}else{if(0<this.fullscreen_mode&&this.isDirectCanvas){this.canvas=null,document.oncontextmenu=function(t){return!1},document.onselectstart=function(t){return!1},this.ctx=AppMobi.canvas.getContext("2d");try{this.ctx.samplingMode=this.linearSampling?"smooth":"sharp",this.ctx.globalScale=1,this.ctx.HTML5CompatibilityMode=!0,this.ctx.imageSmoothingEnabled=this.linearSampling}catch(t){}0!==this.width&&0!==this.height&&(this.ctx.width=this.width,this.ctx.height=this.height)}this.ctx||(l=this.isCocoonJs?{antialias:!!this.linearSampling,alpha:!0}:{alpha:!0},this.ctx=this.canvas.getContext("2d",l),this.setCtxImageSmoothingEnabled(this.ctx,this.linearSampling)),this.overlay_canvas=null,this.overlay_ctx=null}this.tickFunc=function(t){u.tick(!1,t)},window==window.top||this.isDomFree||this.isWinJS||this.isWindowsPhone8||(document.addEventListener("mousedown",function(){window.focus()},!0),document.addEventListener("touchstart",function(){window.focus()},!0)),"undefined"!=typeof cr_is_preview&&(this.isCocoonJs&&console.log("[Construct 2] In preview-over-wifi via CocoonJS mode"),-1<window.location.search.indexOf("continuous")&&(cr.logexport("Reloading for continuous preview"),this.loadFromSlot="__c2_continuouspreview",this.suspendDrawing=!0),this.pauseOnBlur&&!this.isMobile&&(jQuery(window).focus(function(){u.setSuspended(!1)}),jQuery(window).blur(function(){var t=window.parent;t&&t.document.hasFocus()||u.setSuspended(!0)}))),window.addEventListener("blur",function(){u.onWindowBlur()}),this.isDomFree||(p=function(t){if(cr.isCanvasInputEvent(t)&&document.activeElement&&document.activeElement!==document.getElementsByTagName("body")[0]&&document.activeElement.blur)try{document.activeElement.blur()}catch(t){}},"undefined"!=typeof PointerEvent?document.addEventListener("pointerdown",p):window.navigator.msPointerEnabled?document.addEventListener("MSPointerDown",p):document.addEventListener("touchstart",p),document.addEventListener("mousedown",p)),0===this.fullscreen_mode&&this.isRetina&&1<this.devicePixelRatio&&this.setSize(this.original_width,this.original_height,!0),this.tryLockOrientation(),this.getready(),this.go(),this.extra={},cr.seal(this)},i.prototype.setSize=function(t,e,i){var n,r,s,o,a=0,h=0,c=0,l=0,u=0;this.lastWindowWidth===t&&this.lastWindowHeight===e&&!i||(this.lastWindowWidth=t,this.lastWindowHeight=e,n=this.fullscreen_mode,((o=(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.isNodeFullscreen)&&!this.isCordova)||0!==this.fullscreen_mode||i)&&(o&&0<this.fullscreen_scaling&&(n=this.fullscreen_scaling),o=this.devicePixelRatio,4<=n?(r=this.original_width/this.original_height)<(s=t/e)?(c=e*r,5===n?(1<(u=c*o/this.original_width)?u=Math.floor(u):u<1&&(u=1/Math.ceil(1/u)),a=(t-(c=this.original_width*u/o))/2,h=(e-(l=this.original_height*u/o))/2,t=c,e=l):(a=(t-c)/2,t=c)):(l=t/r,e=(5===n?(1<(u=l*o/this.original_height)?u=Math.floor(u):u<1&&(u=1/Math.ceil(1/u)),a=(t-(c=this.original_width*u/o))/2,h=(e-(l=this.original_height*u/o))/2,t=c):h=(e-l)/2,l)):this.isNWjs&&this.isNodeFullscreen&&0===this.fullscreen_mode_set&&(a=Math.floor((t-this.original_width)/2),h=Math.floor((e-this.original_height)/2),t=this.original_width,e=this.original_height),n<2&&(this.aspect_scale=o),this.cssWidth=Math.round(t),this.cssHeight=Math.round(e),this.width=Math.round(t*o),this.height=Math.round(e*o),this.redraw=!0,this.wantFullscreenScalingQuality||this.width<this.original_width&&this.height<this.original_height||1===n?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):(this.draw_width=this.original_width,this.draw_height=this.original_height,this.fullscreenScalingQuality=!1,2===n?(r=this.original_width/this.original_height,(s=this.lastWindowWidth/this.lastWindowHeight)<r?this.draw_width=this.draw_height*s:r<s&&(this.draw_height=this.draw_width/s)):3===n&&((r=this.original_width/this.original_height)<(s=this.lastWindowWidth/this.lastWindowHeight)?this.draw_width=this.draw_height*s:s<r&&(this.draw_height=this.draw_width/s))),this.canvasdiv&&!this.isDomFree&&(jQuery(this.canvasdiv).css({width:Math.round(t)+"px",height:Math.round(e)+"px","margin-left":Math.floor(a)+"px","margin-top":Math.floor(h)+"px"}),"undefined"!=typeof cr_is_preview&&jQuery("#borderwrap").css({width:Math.round(t)+"px",height:Math.round(e)+"px"})),this.canvas&&(this.canvas.width=Math.round(t*o),this.canvas.height=Math.round(e*o),this.isEjecta?(this.canvas.style.left=Math.floor(a)+"px",this.canvas.style.top=Math.floor(h)+"px",this.canvas.style.width=Math.round(t)+"px",this.canvas.style.height=Math.round(e)+"px"):this.isRetina&&!this.isDomFree&&(this.canvas.style.width=Math.round(t)+"px",this.canvas.style.height=Math.round(e)+"px")),this.overlay_canvas&&(this.overlay_canvas.width=Math.round(t*o),this.overlay_canvas.height=Math.round(e*o),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+"px"),this.glwrap&&this.glwrap.setSize(Math.round(t*o),Math.round(e*o)),this.isDirectCanvas&&this.ctx&&(this.ctx.width=Math.round(t),this.ctx.height=Math.round(e)),this.ctx&&this.setCtxImageSmoothingEnabled(this.ctx,this.linearSampling),this.tryLockOrientation(),this.isiPhone&&!this.isCordova&&window.scrollTo(0,0)))},i.prototype.tryLockOrientation=function(){if(this.autoLockOrientation&&0!==this.orientations){var t="portrait";2===this.orientations&&(t="landscape");try{screen.orientation&&screen.orientation.lock?screen.orientation.lock(t).catch(function(){}):screen.lockOrientation?screen.lockOrientation(t):screen.webkitLockOrientation?screen.webkitLockOrientation(t):screen.mozLockOrientation?screen.mozLockOrientation(t):screen.msLockOrientation&&screen.msLockOrientation(t)}catch(t){console&&console.warn&&console.warn("Failed to lock orientation: ",t)}}},i.prototype.onContextLost=function(){var t,e,i;for(this.glwrap.contextLost(),this.is_WebGL_context_lost=!0,t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onLostWebGLContext&&i.onLostWebGLContext()},i.prototype.onContextRestored=function(){var t,e,i;for(this.is_WebGL_context_lost=!1,t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onRestoreWebGLContext&&i.onRestoreWebGLContext()},i.prototype.positionOverlayCanvas=function(){var t;this.isDomFree||((t=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement||this.isNodeFullscreen)&&!this.isCordova?jQuery(this.canvas).offset():jQuery(this.canvas).position()).position="absolute",jQuery(this.overlay_canvas).css(t))};var n=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;i.prototype.setSuspended=function(t){var e,i;if(t&&!this.isSuspended)for(cr.logexport("[Construct 2] Suspending"),this.isSuspended=!0,-1!==this.raf_id&&n&&n(this.raf_id),-1!==this.timeout_id&&clearTimeout(this.timeout_id),e=0,i=this.suspend_events.length;e<i;e++)this.suspend_events[e](!0);else if(!t&&this.isSuspended){for(cr.logexport("[Construct 2] Resuming"),this.isSuspended=!1,this.last_tick_time=cr.performance_now(),this.last_fps_time=cr.performance_now(),this.framecount=0,e=this.logictime=0,i=this.suspend_events.length;e<i;e++)this.suspend_events[e](!1);this.tick(!1)}},i.prototype.addSuspendCallback=function(t){this.suspend_events.push(t)},i.prototype.GetObjectReference=function(t){return this.objectRefTable[t]};var f=!(i.prototype.loadProject=function(t){t&&t.project||cr.logerror("Project model unavailable");var e,i,n,r,s,o,a,h,c,l,u,p,d,f,y,g,m,_,v,b,w=t.project;for(this.name=w[0],this.first_layout=w[1],this.fullscreen_mode=w[12],this.fullscreen_mode_set=w[12],this.original_width=w[10],this.original_height=w[11],this.parallax_x_origin=this.original_width/2,this.parallax_y_origin=this.original_height/2,this.isDomFree&&!this.isEjecta&&(4<=w[12]||0===w[12])&&(cr.logexport("[Construct 2] Letterbox scale fullscreen modes are not supported on this platform - falling back to 'Scale outer'"),this.fullscreen_mode=3,this.fullscreen_mode_set=3),this.uses_loader_layout=w[18],this.loaderstyle=w[19],0===this.loaderstyle?((u=new Image).crossOrigin="anonymous",this.setImageSrc(u,"loading-logo.png"),this.loaderlogos={logo:u}):4===this.loaderstyle&&((e=new Image).src="",(i=new Image).src="",(n=new Image).src="",(r=new Image).src="",(s=new Image).src="",(o=new Image).src="",(a=new Image).src="",(h=new Image).src="",(c=new Image).src="",(l=new Image).src="",(t=new Image).src="",(u=new Image).src="",this.loaderlogos={logo:[e,i,n,r],powered:[s,o,a,h],website:[c,l,t,u]}),this.next_uid=w[21],this.objectRefTable=cr.getObjectRefTable(),this.system=new cr.system_object(this),p=0,d=w[2].length;p<d;p++)f=w[2][p],_=this.GetObjectReference(f[0]),cr.add_common_aces(f,_.prototype),(v=new _(this)).singleglobal=f[1],v.is_world=f[2],v.is_rotatable=f[5],v.must_predraw=f[9],v.onCreate&&v.onCreate(),cr.seal(v),this.plugins.push(v);for(this.objectRefTable=cr.getObjectRefTable(),p=0,d=w[3].length;p<d;p++){for(f=w[3][p],b=this.GetObjectReference(f[1]),v=null,R=0,B=this.plugins.length;R<B;R++)if(this.plugins[R]instanceof b){v=this.plugins[R];break}var x,S=new v.Type(v);for(S.name=f[0],S.is_family=f[2],S.instvar_sids=f[3].slice(0),S.vars_count=f[3].length,S.behs_count=f[4],S.fx_count=f[5],S.sid=f[11],S.is_family?(S.members=[],S.family_index=this.family_count++,S.families=null):(S.members=null,S.family_index=-1,S.families=[]),S.family_var_map=null,S.family_beh_map=null,S.family_fx_map=null,S.is_contained=!1,S.container=null,f[6]?(S.texture_file=f[6][0],S.texture_filesize=f[6][1],S.texture_pixelformat=f[6][2]):(S.texture_file=null,S.texture_filesize=0,S.texture_pixelformat=0),f[7]?S.animations=f[7]:S.animations=null,S.index=p,S.instances=[],S.deadCache=[],S.solstack=[new cr.selection(S)],S.cur_sol=0,S.default_instance=null,S.default_layerindex=0,S.stale_iids=!0,S.updateIIDs=cr.type_updateIIDs,S.getFirstPicked=cr.type_getFirstPicked,S.getPairedInstance=cr.type_getPairedInstance,S.getCurrentSol=cr.type_getCurrentSol,S.pushCleanSol=cr.type_pushCleanSol,S.pushCopySol=cr.type_pushCopySol,S.popSol=cr.type_popSol,S.getBehaviorByName=cr.type_getBehaviorByName,S.getBehaviorIndexByName=cr.type_getBehaviorIndexByName,S.getEffectIndexByName=cr.type_getEffectIndexByName,S.applySolToContainer=cr.type_applySolToContainer,S.getInstanceByIID=cr.type_getInstanceByIID,S.collision_grid=new cr.SparseGrid(this.original_width,this.original_height),S.any_cell_changed=!0,S.any_instance_parallaxed=!1,S.extra={},S.toString=cr.type_toString,S.behaviors=[],R=0,B=f[8].length;R<B;R++){y=f[8][R];for(var T=this.GetObjectReference(y[1]),A=null,C=0,k=this.behaviors.length;C<k;C++)if(this.behaviors[C]instanceof T){A=this.behaviors[C];break}A||((A=new T(this)).my_types=[],A.my_instances=new cr.ObjectSet,A.onCreate&&A.onCreate(),cr.seal(A),this.behaviors.push(A),cr.behaviors.solid&&A instanceof cr.behaviors.solid&&(this.solidBehavior=A),cr.behaviors.jumpthru&&A instanceof cr.behaviors.jumpthru&&(this.jumpthruBehavior=A),cr.behaviors.shadowcaster&&A instanceof cr.behaviors.shadowcaster&&(this.shadowcasterBehavior=A)),-1===A.my_types.indexOf(S)&&A.my_types.push(S);var O=new A.Type(A,S);O.name=y[0],O.sid=y[2],O.onCreate(),cr.seal(O),S.behaviors.push(O)}for(S.global=f[9],S.isOnLoaderLayout=f[10],S.effect_types=[],R=0,B=f[12].length;R<B;R++)S.effect_types.push({id:f[12][R][0],name:f[12][R][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:R});S.tile_poly_data=f[13],this.uses_loader_layout&&!S.is_family&&!S.isOnLoaderLayout&&v.is_world||(S.onCreate(),cr.seal(S)),S.name&&(this.types[S.name]=S),this.types_by_index.push(S),v.singleglobal&&((x=new v.Instance(S)).uid=this.next_uid++,x.puid=this.next_puid++,x.iid=0,x.get_iid=cr.inst_get_iid,x.toString=cr.inst_toString,x.properties=f[14],x.onCreate(),cr.seal(x),S.instances.push(x),this.objectsByUid[x.uid.toString()]=x)}for(p=0,d=w[4].length;p<d;p++)for(var P,I=w[4][p],E=this.types_by_index[I[0]],R=1,B=I.length;R<B;R++)(P=this.types_by_index[I[R]]).families.push(E),E.members.push(P);for(p=0,d=w[28].length;p<d;p++){var L=w[28][p],M=[];for(R=0,B=L.length;R<B;R++)M.push(this.types_by_index[L[R]]);for(R=0,B=M.length;R<B;R++)M[R].is_contained=!0,M[R].container=M}if(0<this.family_count)for(p=0,d=this.types_by_index.length;p<d;p++)if(!(g=this.types_by_index[p]).is_family&&g.families.length){g.family_var_map=new Array(this.family_count),g.family_beh_map=new Array(this.family_count),g.family_fx_map=new Array(this.family_count);var N=[],j=0,F=0,D=0;for(R=0,B=g.families.length;R<B;R++)for(m=g.families[R],g.family_var_map[m.family_index]=j,j+=m.vars_count,g.family_beh_map[m.family_index]=F,F+=m.behs_count,g.family_fx_map[m.family_index]=D,D+=m.fx_count,C=0,k=m.effect_types.length;C<k;C++)N.push(cr.shallowCopy({},m.effect_types[C]));for(g.effect_types=N.concat(g.effect_types),R=0,B=g.effect_types.length;R<B;R++)g.effect_types[R].index=R}for(p=0,d=w[5].length;p<d;p++){f=w[5][p];var V=new cr.layout(this,f);cr.seal(V),this.layouts[V.name]=V,this.layouts_by_index.push(V)}for(p=0,d=w[6].length;p<d;p++){f=w[6][p];var W=new cr.eventsheet(this,f);cr.seal(W),this.eventsheets[W.name]=W,this.eventsheets_by_index.push(W)}for(p=0,d=this.eventsheets_by_index.length;p<d;p++)this.eventsheets_by_index[p].postInit();for(p=0,d=this.eventsheets_by_index.length;p<d;p++)this.eventsheets_by_index[p].updateDeepIncludes();for(p=0,d=this.triggers_to_postinit.length;p<d;p++)this.triggers_to_postinit[p].postInit();cr.clearArray(this.triggers_to_postinit),this.audio_to_preload=w[7],this.files_subfolder=w[8],this.pixel_rounding=w[9],this.aspect_scale=1,this.enableWebGL=w[13],this.linearSampling=w[14],this.clearBackground=w[15],this.versionstr=w[16],this.useHighDpi=w[17],this.orientations=w[20],this.autoLockOrientation=0<this.orientations,this.pauseOnBlur=w[22],this.wantFullscreenScalingQuality=w[23],this.fullscreenScalingQuality=this.wantFullscreenScalingQuality,this.downscalingQuality=w[24],this.preloadSounds=w[25],this.projectName=w[26],this.enableFrontToBack=w[27]&&!this.isIE,this.start_time=Date.now(),cr.clearArray(this.objectRefTable),this.initRendererAndLoader()});i.prototype.waitForImageLoad=function(e,i){e.cocoonLazyLoad=!0,e.onerror=function(t){e.c2error=!0,f=!0,console&&console.error&&console.error("Error loading image '"+e.src+"': ",t)},this.isEjecta?e.src=i:e.src||("undefined"!=typeof XAPKReader?XAPKReader.get(i,function(t){e.src=t},function(t){e.c2error=!0,f=!0,console&&console.error&&console.error("Error extracting image '"+i+"' from expansion file: ",t)}):(e.crossOrigin="anonymous",this.setImageSrc(e,i))),this.wait_for_textures.push(e)};var h=0,c=!(i.prototype.findWaitingTexture=function(t){for(var e=0,i=this.wait_for_textures.length;e<i;e++)if(this.wait_for_textures[e].cr_src===t)return this.wait_for_textures[e];return null});i.prototype.getready=function(){this.audioInstance&&(h=this.audioInstance.setPreloadList(this.audio_to_preload))};var y=!(i.prototype.areAllTexturesAndSoundsLoaded=function(){for(var t,e,i=h,n=0,r=!0,s=0,o=this.wait_for_textures.length;s<o;s++){var a=(e=this.wait_for_textures[s]).cr_filesize;(!a||a<=0)&&(a=5e4),i+=a,e.src&&(e.complete||e.loaded)&&!e.c2error?n+=a:r=!1}return r&&this.preloadSounds&&this.audioInstance&&(c||(this.audioInstance.startPreloads(),c=!0),n+=t=this.audioInstance.getPreloadedSize(),t<h&&(r=!1)),this.progress=0==i?1:n/i,r});i.prototype.go=function(){if(this.ctx||this.glwrap){var t=this.ctx||this.overlay_ctx;this.overlay_canvas&&this.positionOverlayCanvas();var e=window.innerWidth,i=window.innerHeight;this.lastWindowWidth===e&&this.lastWindowHeight===i||this.setSize(e,i),this.progress=0,this.last_progress=-1;var n=this;if(this.areAllTexturesAndSoundsLoaded()&&(4!==this.loaderstyle||y))this.go_loading_finished();else{var r=Date.now()-this.start_time;if(t){var s=this.width,o=this.height,a=this.devicePixelRatio;if(this.loaderstyle<3&&(this.isCocoonJs||500<=r&&this.last_progress!=this.progress)){t.clearRect(0,0,s,o);var h=s/2,c=o/2,l=0===this.loaderstyle&&this.loaderlogos.logo.complete,e=40*a,i=0,r=80*a;l&&(e=(r=(s=this.loaderlogos.logo).width*a)/2,i=(o=s.height*a)/2,t.drawImage(s,cr.floor(h-e),cr.floor(c-i),r,o)),this.loaderstyle<=1?(c+=i+(l?12*a:0),h-=e,h=cr.floor(h)+.5,c=cr.floor(c)+.5,t.fillStyle=f?"red":"DodgerBlue",t.fillRect(h,c,Math.floor(r*this.progress),6*a),t.strokeStyle="black",t.strokeRect(h,c,r,6*a),t.strokeStyle="white",t.strokeRect(h-+a,c-+a,r+2*a,8*a)):2===this.loaderstyle&&(t.font=this.isEjecta?"12pt ArialMT":"12pt Arial",t.fillStyle=f?"#f00":"#999",t.textBaseLine="middle",r=Math.round(100*this.progress)+"%",a=(a=t.measureText?t.measureText(r):null)?a.width:0,t.fillText(r,h-a/2,c)),this.last_progress=this.progress}else if(4===this.loaderstyle)return this.draw_c2_splash_loader(t),void(u?u(function(){n.go()}):setTimeout(function(){n.go()},16))}setTimeout(function(){n.go()},this.isCocoonJs?10:100)}}};var g=-1,m="undefined"==typeof cr_is_preview?200:0,_=!0,v=!1,b=0,w=0,x="undefined"==typeof cr_is_preview?3e3:0,S=null,T=null,A=0;function C(t,e){return e<=128?t[3]:e<=256?t[2]:e<=512?t[1]:t[0]}i.prototype.draw_c2_splash_loader=function(t){if(!y){for(var e=Math.ceil(this.width),i=Math.ceil(this.height),n=(this.devicePixelRatio,this.loaderlogos.logo),r=this.loaderlogos.powered,s=this.loaderlogos.website,o=0;o<4;++o)if(!n[o].complete||!r[o].complete||!s[o].complete)return;0===A&&(g=Date.now());var a,h,c,l,u=Date.now(),p=!1,d=t;_||v?(t.clearRect(0,0,e,i),c=e,l=i,S&&S.width===c&&S.height===l||((S=document.createElement("canvas")).width=c,S.height=l,T=S.getContext("2d")),d=T,p=!0,_&&1===A&&(g=Date.now())):t.globalAlpha=1,d.fillStyle="#333333",d.fillRect(0,0,e,i),256<this.cssHeight?(h=.25*(a=cr.clamp(.22*i,105,.6*e)),d.drawImage(C(r,a),.5*e-a/2,.2*i-h/2,a,h),h=a=Math.min(.395*i,.95*e),d.drawImage(C(n,a),.5*e-a/2,.485*i-h/2,a,h),h=.25*(a=cr.clamp(.22*i,105,.6*e)),d.drawImage(C(s,a),.5*e-a/2,.868*i-h/2,a,h),d.fillStyle="#3C3C3C",a=e,h=Math.max(.005*i,2),d.fillRect(0,.8*i-h/2,a,h),d.fillStyle=f?"red":"#E0FF65",a=e*this.progress,d.fillRect(.5*e-a/2,.8*i-h/2,a,h)):(h=a=.55*i,d.drawImage(C(n,a),.5*e-a/2,.45*i-h/2,a,h),d.fillStyle="#3C3C3C",a=e,h=Math.max(.005*i,2),d.fillRect(0,.85*i-h/2,a,h),d.fillStyle=f?"red":"#E0FF65",a=e*this.progress,d.fillRect(.5*e-a/2,.85*i-h/2,a,h)),p&&(_?t.globalAlpha=0===A?0:Math.min((u-g)/300,1):v&&(t.globalAlpha=Math.max(1-(u-w)/300,0)),t.drawImage(S,0,0,e,i)),_&&300<=u-g&&2<=A&&(_=!1,b=u),!_&&x<=u-b&&!v&&1<=this.progress&&(v=!0,w=u),(v&&300+m<=u-w||"undefined"!=typeof cr_is_preview&&1<=this.progress&&Date.now()-g<500)&&(v=_=!(y=!0),T=S=null,this.loaderlogos=null),++A}},i.prototype.go_loading_finished=function(){var t,e,i,n,r;if(this.overlay_canvas&&(this.canvas.parentNode.removeChild(this.overlay_canvas),this.overlay_ctx=null,this.overlay_canvas=null),this.start_time=Date.now(),this.last_fps_time=cr.performance_now(),this.uses_loader_layout)for(t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).is_family||i.isOnLoaderLayout||!i.plugin.is_world||(i.onCreate(),cr.seal(i));else this.isloading=!1;for(t=0,e=this.layouts_by_index.length;t<e;t++)this.layouts_by_index[t].createGlobalNonWorlds();for(2<=this.fullscreen_mode&&(n=this.original_width/this.original_height,r=this.width/this.height,2!==this.fullscreen_mode&&n<r||2===this.fullscreen_mode&&r<n?this.aspect_scale=this.height/this.original_height:this.aspect_scale=this.width/this.original_width),(this.first_layout?this.layouts[this.first_layout]:this.layouts_by_index[0]).startRunning(),this.uses_loader_layout||(this.loadingprogress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C2_RegisterSW&&window.C2_RegisterSW()),navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide(),t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onAppBegin&&i.onAppBegin();document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):this.tick(!1),this.isDirectCanvas&&AppMobi.webview.execute("onGameReady();")},i.prototype.tick=function(t,e,i){var n,r,s;this.running_layout&&(n=s=cr.performance_now(),!i&&this.isSuspended&&!t||(t||(u?this.raf_id=u(this.tickFunc):this.timeout_id=setTimeout(this.tickFunc,this.isMobile?1:16)),r=e||s,i=this.fullscreen_mode,((e=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova)||this.isNodeFullscreen)&&0<this.fullscreen_scaling&&(i=this.fullscreen_scaling),0<i&&(s=window.innerWidth,i=window.innerHeight,this.lastWindowWidth===s&&this.lastWindowHeight===i||this.setSize(s,i)),this.isDomFree||(e?this.firstInFullscreen||(this.firstInFullscreen=!0):this.firstInFullscreen?(this.firstInFullscreen=!1,0===this.fullscreen_mode&&this.setSize(Math.round(this.oldWidth/this.devicePixelRatio),Math.round(this.oldHeight/this.devicePixelRatio),!0)):(this.oldWidth=this.width,this.oldHeight=this.height)),this.isloading&&(e=this.areAllTexturesAndSoundsLoaded(),this.loadingprogress=this.progress,e&&(this.isloading=!1,this.progress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C2_RegisterSW&&window.C2_RegisterSW())),this.logic(r),!this.redraw&&!this.isCocoonJs||this.is_WebGL_context_lost||this.suspendDrawing||t||(this.redraw=!1,this.glwrap?this.drawGL():this.draw(),this.snapshotCanvas&&(this.canvas&&this.canvas.toDataURL&&(this.snapshotData=this.canvas.toDataURL(this.snapshotCanvas[0],this.snapshotCanvas[1]),window.cr_onSnapshot&&window.cr_onSnapshot(this.snapshotData),this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot,null)),this.snapshotCanvas=null)),this.hit_breakpoint||(this.tickcount++,this.execcount++,this.framecount++),this.logictime+=cr.performance_now()-n))},i.prototype.logic=function(t){var e,i,n,r;1e3<=t-this.last_fps_time&&(this.last_fps_time+=1e3,1e3<=t-this.last_fps_time&&(this.last_fps_time=t),this.fps=this.framecount,this.framecount=0,this.cpuutilisation=this.logictime,this.logictime=0);var s=0;0!==this.last_tick_time&&((o=t-this.last_tick_time)<0&&(o=0),s=o/1e3,this.dt1=s,.5<this.dt1?this.dt1=0:this.dt1>1/this.minimumFramerate&&(this.dt1=1/this.minimumFramerate)),this.last_tick_time=t,this.dt=this.dt1*this.timescale,this.kahanTime.add(this.dt),this.wallTime.add(s);var o,a=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement||this.isNodeFullscreen)&&!this.isCordova;2<=this.fullscreen_mode||a&&0<this.fullscreen_scaling?(o=this.original_width/this.original_height,t=this.width/this.height,s=this.fullscreen_mode,a&&0<this.fullscreen_scaling&&(s=this.fullscreen_scaling),this.aspect_scale=2!==s&&o<t||2===s&&t<o?this.height/this.original_height:this.width/this.original_width,this.running_layout&&(this.running_layout.scrollToX(this.running_layout.scrollX),this.running_layout.scrollToY(this.running_layout.scrollY))):this.aspect_scale=this.isRetina?this.devicePixelRatio:1,this.ClearDeathRow(),this.isInOnDestroy++,this.system.runWaits(),this.isInOnDestroy--,this.ClearDeathRow(),this.isInOnDestroy++;for(var h=this.objects_to_pretick.valuesRef(),c=0,l=h.length;c<l;c++)h[c].pretick();for(c=0,l=this.types_by_index.length;c<l;c++)if(!(n=this.types_by_index[c]).is_family&&(n.behaviors.length||n.families.length))for(e=0,i=n.instances.length;e<i;e++)for(p=0,d=(u=n.instances[e]).behavior_insts.length;p<d;p++)u.behavior_insts[p].tick();for(c=0,l=this.types_by_index.length;c<l;c++)if(!(n=this.types_by_index[c]).is_family&&(n.behaviors.length||n.families.length))for(e=0,i=n.instances.length;e<i;e++)for(p=0,d=(u=n.instances[e]).behavior_insts.length;p<d;p++)(r=u.behavior_insts[p]).posttick&&r.posttick();for(c=0,l=(h=this.objects_to_tick.valuesRef()).length;c<l;c++)h[c].tick();for(this.isInOnDestroy--,this.handleSaveLoad(),c=0;this.changelayout&&c++<10;)this.doChangeLayout(this.changelayout);for(c=0,l=this.eventsheets_by_index.length;c<l;c++)this.eventsheets_by_index[c].hasRun=!1;for(this.running_layout.event_sheet&&this.running_layout.event_sheet.run(),cr.clearArray(this.registered_collisions),this.layout_first_tick=!1,this.isInOnDestroy++,c=0,l=this.types_by_index.length;c<l;c++)if(!(n=this.types_by_index[c]).is_family&&(n.behaviors.length||n.families.length))for(e=0,i=n.instances.length;e<i;e++)for(var u,p=0,d=(u=n.instances[e]).behavior_insts.length;p<d;p++)(r=u.behavior_insts[p]).tick2&&r.tick2();for(c=0,l=(h=this.objects_to_tick2.valuesRef()).length;c<l;c++)h[c].tick2();this.isInOnDestroy--},i.prototype.onWindowBlur=function(){for(var t,e,i,n,r,s,o,a=0,h=this.types_by_index.length;a<h;a++)if(!(r=this.types_by_index[a]).is_family)for(t=0,e=r.instances.length;t<e;t++)if((s=r.instances[t]).onWindowBlur&&s.onWindowBlur(),s.behavior_insts)for(i=0,n=s.behavior_insts.length;i<n;i++)(o=s.behavior_insts[i]).onWindowBlur&&o.onWindowBlur()},i.prototype.doChangeLayout=function(t){var e,i,n,r=this.running_layout;if(this.running_layout.stopRunning(),this.glwrap)for(e=0,i=this.types_by_index.length;e<i;e++)(n=this.types_by_index[e]).is_family||!n.unloadTextures||n.global&&0!==n.instances.length||-1!==t.initial_types.indexOf(n)||n.unloadTextures();r==t&&cr.clearArray(this.system.waits),cr.clearArray(this.registered_collisions),this.runLayoutChangeMethods(!0),t.startRunning(),this.runLayoutChangeMethods(!1),this.redraw=!0,this.layout_first_tick=!0,this.ClearDeathRow()},i.prototype.runLayoutChangeMethods=function(t){for(var e,i,n,r,s,o,a,h,c=0,l=this.behaviors.length;c<l;c++)e=this.behaviors[c],t?e.onBeforeLayoutChange&&e.onBeforeLayoutChange():e.onLayoutChange&&e.onLayoutChange();for(c=0,l=this.types_by_index.length;c<l;c++)if((i=this.types_by_index[c]).global||i.plugin.singleglobal)for(n=0,r=i.instances.length;n<r;n++)if(s=i.instances[n],t?s.onBeforeLayoutChange&&s.onBeforeLayoutChange():s.onLayoutChange&&s.onLayoutChange(),s.behavior_insts)for(o=0,a=s.behavior_insts.length;o<a;o++)h=s.behavior_insts[o],t?h.onBeforeLayoutChange&&h.onBeforeLayoutChange():h.onLayoutChange&&h.onLayoutChange()},i.prototype.pretickMe=function(t){this.objects_to_pretick.add(t)},i.prototype.unpretickMe=function(t){this.objects_to_pretick.remove(t)},i.prototype.tickMe=function(t){this.objects_to_tick.add(t)},i.prototype.untickMe=function(t){this.objects_to_tick.remove(t)},i.prototype.tick2Me=function(t){this.objects_to_tick2.add(t)},i.prototype.untick2Me=function(t){this.objects_to_tick2.remove(t)},i.prototype.getDt=function(t){return t&&-1!==t.my_timescale?this.dt1*t.my_timescale:this.dt},i.prototype.draw=function(){this.running_layout.draw(this.ctx),this.isDirectCanvas&&this.ctx.present()},i.prototype.drawGL=function(){this.enableFrontToBack&&(this.earlyz_index=1,this.running_layout.drawGL_earlyZPass(this.glwrap)),this.running_layout.drawGL(this.glwrap),this.glwrap.present()},i.prototype.addDestroyCallback=function(t){t&&this.destroycallbacks.push(t)},i.prototype.removeDestroyCallback=function(t){cr.arrayFindRemove(this.destroycallbacks,t)},i.prototype.getObjectByUID=function(t){t=t.toString();return this.objectsByUid.hasOwnProperty(t)?this.objectsByUid[t]:null};var d=[];i.prototype.DestroyInstance=function(t){var e,i,n=t.type.name,r=null;if(this.deathRow.hasOwnProperty(n)){if((r=this.deathRow[n]).contains(t))return}else r=d.length?d.pop():new cr.ObjectSet,this.deathRow[n]=r;if(r.add(t),this.hasPendingInstances=!0,t.is_contained)for(e=0,i=t.siblings.length;e<i;e++)this.DestroyInstance(t.siblings[e]);this.isInClearDeathRow&&r.values_cache.push(t),this.isEndingLayout||(this.isInOnDestroy++,this.trigger(Object.getPrototypeOf(t.type.plugin).cnds.OnDestroyed,t),this.isInOnDestroy--)},i.prototype.ClearDeathRow=function(){if(this.hasPendingInstances){var t,e,i,n,r,s;for(this.isInClearDeathRow=!0,i=0,r=this.createRow.length;i<r;++i)for((e=(t=this.createRow[i]).type).instances.push(t),n=0,s=e.families.length;n<s;++n)e.families[n].instances.push(t),e.families[n].stale_iids=!0;cr.clearArray(this.createRow),this.IterateDeathRow(),cr.wipe(this.deathRow),this.isInClearDeathRow=!1,this.hasPendingInstances=!1}},i.prototype.IterateDeathRow=function(){for(var t in this.deathRow)this.deathRow.hasOwnProperty(t)&&this.ClearDeathRowForType(this.deathRow[t])},i.prototype.ClearDeathRowForType=function(t){var e,i,n,r,s,o,a,h,c=t.valuesRef(),l=c[0].type;for(cr.arrayRemoveAllFromObjectSet(l.instances,t),l.stale_iids=!0,0===l.instances.length&&(l.any_instance_parallaxed=!1),e=0,i=l.families.length;e<i;++e)o=l.families[e],cr.arrayRemoveAllFromObjectSet(o.instances,t),o.stale_iids=!0;for(e=0,i=this.system.waits.length;e<i;++e)if((s=this.system.waits[e]).sols.hasOwnProperty(l.index)&&cr.arrayRemoveAllFromObjectSet(s.sols[l.index].insts,t),!l.is_family)for(n=0,r=l.families.length;n<r;++n)o=l.families[n],s.sols.hasOwnProperty(o.index)&&cr.arrayRemoveAllFromObjectSet(s.sols[o.index].insts,t);var u,p=c[0].layer;if(p){if(p.useRenderCells)for(e=0,i=(a=p.instances).length;e<i;++e)h=a[e],t.contains(h)&&(h.update_bbox(),p.render_grid.update(h,h.rendercells,null),h.rendercells.set(0,0,-1,-1));cr.arrayRemoveAllFromObjectSet(p.instances,t),p.setZIndicesStaleFrom(0)}for(e=0;e<c.length;++e)this.ClearDeathRowForSingleInstance(c[e],l);(u=t).clear(),d.push(u),this.redraw=!0},i.prototype.ClearDeathRowForSingleInstance=function(t,e){for(var i,n=0,r=this.destroycallbacks.length;n<r;++n)this.destroycallbacks[n](t);t.collcells&&e.collision_grid.update(t,t.collcells,null);var s=t.layer;if(s&&s.removeFromInstanceList(t,!0),t.behavior_insts)for(n=0,r=t.behavior_insts.length;n<r;++n)(i=t.behavior_insts[n]).onDestroy&&i.onDestroy(),i.behavior.my_instances.remove(t);this.objects_to_pretick.remove(t),this.objects_to_tick.remove(t),this.objects_to_tick2.remove(t),t.onDestroy&&t.onDestroy(),this.objectsByUid.hasOwnProperty(t.uid.toString())&&delete this.objectsByUid[t.uid.toString()],this.objectcount--,e.deadCache.length<100&&e.deadCache.push(t)},i.prototype.createInstance=function(t,e,i,n){if(t.is_family){var r=cr.floor(Math.random()*t.members.length);return this.createInstance(t.members[r],e,i,n)}return t.default_instance?this.createInstanceFromInit(t.default_instance,e,!1,i,n,!1):null};var k=[];i.prototype.createInstanceFromInit=function(t,e,i,n,r,s){var o,a,h,c,l;if(!t)return null;var u=this.types_by_index[t[1]],p=u.plugin.is_world;if(this.isloading&&p&&!u.isOnLoaderLayout)return null;if(p&&!this.glwrap&&11===t[0][11])return null;var d,f=e;for(p||(e=null),u.deadCache.length?((d=u.deadCache.pop()).recycled=!0,u.plugin.Instance.call(d,u)):(d=new u.plugin.Instance(u)).recycled=!1,!i||s||this.objectsByUid.hasOwnProperty(t[2].toString())?d.uid=this.next_uid++:d.uid=t[2],(this.objectsByUid[d.uid.toString()]=d).puid=this.next_puid++,d.iid=u.instances.length,o=0,a=this.createRow.length;o<a;++o)this.createRow[o].type===u&&d.iid++;d.get_iid=cr.inst_get_iid,d.toString=cr.inst_toString;var y,g,m=t[3];if(d.recycled)cr.wipe(d.extra);else{if(d.extra={},"undefined"!=typeof cr_is_preview)for(d.instance_var_names=[],d.instance_var_names.length=m.length,o=0,a=m.length;o<a;o++)d.instance_var_names[o]=m[o][1];d.instance_vars=[],d.instance_vars.length=m.length}for(o=0,a=m.length;o<a;o++)d.instance_vars[o]=m[o][0];if(p){var _=t[0];if(d.x=cr.is_undefined(n)?_[0]:n,d.y=cr.is_undefined(r)?_[1]:r,d.z=_[2],d.width=_[3],d.height=_[4],d.depth=_[5],d.angle=_[6],d.opacity=_[7],d.hotspotX=_[8],d.hotspotY=_[9],d.blend_mode=_[10],l=_[11],!this.glwrap&&u.effect_types.length&&(d.blend_mode=l),d.compositeOp=cr.effectToCompositeOp(d.blend_mode),this.gl&&cr.setGLBlend(d,d.blend_mode,this.gl),d.recycled){for(o=0,a=_[12].length;o<a;o++)for(h=0,c=_[12][o].length;h<c;h++)d.effect_params[o][h]=_[12][o][h];d.bbox.set(0,0,0,0),d.collcells.set(0,0,-1,-1),d.rendercells.set(0,0,-1,-1),d.bquad.set_from_rect(d.bbox),cr.clearArray(d.bbox_changed_callbacks)}else{for(d.effect_params=_[12].slice(0),o=0,a=d.effect_params.length;o<a;o++)d.effect_params[o]=_[12][o].slice(0);d.active_effect_types=[],d.active_effect_flags=[],d.active_effect_flags.length=u.effect_types.length,d.bbox=new cr.rect(0,0,0,0),d.collcells=new cr.rect(0,0,-1,-1),d.rendercells=new cr.rect(0,0,-1,-1),d.bquad=new cr.quad,d.bbox_changed_callbacks=[],d.set_bbox_changed=cr.set_bbox_changed,d.add_bbox_changed_callback=cr.add_bbox_changed_callback,d.contains_pt=cr.inst_contains_pt,d.update_bbox=cr.update_bbox,d.update_render_cell=cr.update_render_cell,d.update_collision_cell=cr.update_collision_cell,d.get_zindex=cr.inst_get_zindex}for(d.tilemap_exists=!1,d.tilemap_width=0,d.tilemap_height=0,d.tilemap_data=null,14===_.length&&(d.tilemap_exists=!0,d.tilemap_width=_[13][0],d.tilemap_height=_[13][1],d.tilemap_data=_[13][2]),o=0,a=u.effect_types.length;o<a;o++)d.active_effect_flags[o]=!0;d.shaders_preserve_opaqueness=!0,d.updateActiveEffects=cr.inst_updateActiveEffects,d.updateActiveEffects(),d.uses_shaders=!!d.active_effect_types.length,d.bbox_changed=!0,d.cell_changed=!0,u.any_cell_changed=!0,d.visible=!0,d.my_timescale=-1,d.layer=e,d.zindex=e.instances.length,void(d.earlyz_index=0)===d.collision_poly&&(d.collision_poly=null),d.collisionsEnabled=!0,this.redraw=!0}for(cr.clearArray(k),o=0,a=u.families.length;o<a;o++)k.push.apply(k,u.families[o].behaviors);if(k.push.apply(k,u.behaviors),d.recycled)for(o=0,a=k.length;o<a;o++){var v=k[o];for((g=d.behavior_insts[o]).recycled=!0,v.behavior.Instance.call(g,v,d),h=0,c=(y=t[4][o]).length;h<c;h++)g.properties[h]=y[h];g.onCreate(),v.behavior.my_instances.add(d)}else for(d.behavior_insts=[],o=0,a=k.length;o<a;o++)(g=new(v=k[o]).behavior.Instance(v,d)).recycled=!1,g.properties=t[4][o].slice(0),g.onCreate(),cr.seal(g),d.behavior_insts.push(g),v.behavior.my_instances.add(d);if(y=t[5],d.recycled)for(o=0,a=y.length;o<a;o++)d.properties[o]=y[o];else d.properties=y.slice(0);if(this.createRow.push(d),this.hasPendingInstances=!0,e&&(e.appendToInstanceList(d,!0),1===e.parallaxX&&1===e.parallaxY||(u.any_instance_parallaxed=!0)),this.objectcount++,u.is_contained){if(d.is_contained=!0,d.recycled?cr.clearArray(d.siblings):d.siblings=[],!i&&!s){for(o=0,a=u.container.length;o<a;o++)if(u.container[o]!==u){if(!u.container[o].default_instance)return null;d.siblings.push(this.createInstanceFromInit(u.container[o].default_instance,f,!1,p?d.x:n,p?d.y:r,!0))}for(o=0,a=d.siblings.length;o<a;o++)for(d.siblings[o].siblings.push(d),h=0;h<a;h++)o!==h&&d.siblings[o].siblings.push(d.siblings[h])}}else d.is_contained=!1,d.siblings=null;for(d.onCreate(),d.recycled||cr.seal(d),o=0,a=d.behavior_insts.length;o<a;o++)d.behavior_insts[o].postCreate&&d.behavior_insts[o].postCreate();return d},i.prototype.getLayerByName=function(t){for(var e=0,i=this.running_layout.layers.length;e<i;e++){var n=this.running_layout.layers[e];if(cr.equals_nocase(n.name,t))return n}return null},i.prototype.getLayerByNumber=function(t){return(t=cr.floor(t))<0&&(t=0),t>=this.running_layout.layers.length&&(t=this.running_layout.layers.length-1),this.running_layout.layers[t]},i.prototype.getLayer=function(t){return cr.is_number(t)?this.getLayerByNumber(t):this.getLayerByName(t.toString())},i.prototype.clearSol=function(t){for(var e=0,i=t.length;e<i;e++)t[e].getCurrentSol().select_all=!0},i.prototype.pushCleanSol=function(t){for(var e=0,i=t.length;e<i;e++)t[e].pushCleanSol()},i.prototype.pushCopySol=function(t){for(var e=0,i=t.length;e<i;e++)t[e].pushCopySol()},i.prototype.popSol=function(t){for(var e=0,i=t.length;e<i;e++)t[e].popSol()},i.prototype.updateAllCells=function(t){if(t.any_cell_changed){for(var e=t.instances,i=0,n=e.length;i<n;++i)e[i].update_collision_cell();var r=this.createRow;for(i=0,n=r.length;i<n;++i)r[i].type===t&&r[i].update_collision_cell();t.any_cell_changed=!1}},i.prototype.getCollisionCandidates=function(t,e,i,n){var r,s,o,a=!!t&&(1!==t.parallaxX||1!==t.parallaxY);if(e.is_family)for(r=0,s=e.members.length;r<s;++r)o=e.members[r],a||o.any_instance_parallaxed?cr.appendArray(n,o.instances):(this.updateAllCells(o),o.collision_grid.queryRange(i,n));else a||e.any_instance_parallaxed?cr.appendArray(n,e.instances):(this.updateAllCells(e),e.collision_grid.queryRange(i,n))},i.prototype.getTypesCollisionCandidates=function(t,e,i,n){for(var r=0,s=e.length;r<s;++r)this.getCollisionCandidates(t,e[r],i,n)},i.prototype.getSolidCollisionCandidates=function(t,e,i){var n=this.getSolidBehavior();if(!n)return null;this.getTypesCollisionCandidates(t,n.my_types,e,i)},i.prototype.getJumpthruCollisionCandidates=function(t,e,i){var n=this.getJumpthruBehavior();if(!n)return null;this.getTypesCollisionCandidates(t,n.my_types,e,i)},i.prototype.testAndSelectCanvasPointOverlap=function(t,e,i,n){var r,s,o,a,h,c,l,u=t.getCurrentSol(),p=this.getCurrentEventStack().current_event.orblock;if(u.select_all)for(n||(u.select_all=!1,cr.clearArray(u.instances)),r=0,a=t.instances.length;r<a;r++)if((o=t.instances[r]).update_bbox(),h=o.layer.canvasToLayer(e,i,!0),c=o.layer.canvasToLayer(e,i,!1),o.contains_pt(h,c)){if(n)return!1;u.instances.push(o)}else p&&u.else_instances.push(o);else{for(r=s=0,a=(l=p?u.else_instances:u.instances).length;r<a;r++)if((o=l[r]).update_bbox(),h=o.layer.canvasToLayer(e,i,!0),c=o.layer.canvasToLayer(e,i,!1),o.contains_pt(h,c)){if(n)return!1;p?u.instances.push(o):(u.instances[s]=u.instances[r],s++)}n||(l.length=s)}return t.applySolToContainer(),!!n||u.hasObjects()},i.prototype.testOverlap=function(t,e){if(!(t&&e&&t!==e&&t.collisionsEnabled&&e.collisionsEnabled))return!1;t.update_bbox(),e.update_bbox();var i,n,r,s,o,a,h,c,l,u,p=t.layer,d=e.layer;if(p===d||p.parallaxX===d.parallaxX&&d.parallaxY==d.parallaxY&&p.scale===d.scale&&p.angle===d.angle&&p.zoomRate===d.zoomRate)return!!t.bbox.intersects_rect(e.bbox)&&(!!t.bquad.intersects_quad(e.bquad)&&((!t.tilemap_exists||!e.tilemap_exists)&&(t.tilemap_exists?this.testTilemapOverlap(t,e):e.tilemap_exists?this.testTilemapOverlap(e,t):(h=t.collision_poly&&!t.collision_poly.is_empty(),c=e.collision_poly&&!e.collision_poly.is_empty(),!h&&!c||(l=h?(t.collision_poly.cache_poly(t.width,t.height,t.angle),t.collision_poly):(this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),this.temp_poly),u=c?(e.collision_poly.cache_poly(e.width,e.height,e.angle),e.collision_poly):(this.temp_poly.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),this.temp_poly),l.intersects_poly(u,e.x-t.x,e.y-t.y))))));for(h=t.collision_poly&&!t.collision_poly.is_empty(),c=e.collision_poly&&!e.collision_poly.is_empty(),h?(t.collision_poly.cache_poly(t.width,t.height,t.angle),this.temp_poly.set_from_poly(t.collision_poly)):this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),l=this.temp_poly,c?(e.collision_poly.cache_poly(e.width,e.height,e.angle),this.temp_poly2.set_from_poly(e.collision_poly)):this.temp_poly2.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),u=this.temp_poly2,i=0,n=l.pts_count;i<n;i++)s=(r=2*i)+1,o=l.pts_cache[r],a=l.pts_cache[s],l.pts_cache[r]=p.layerToCanvas(o+t.x,a+t.y,!0),l.pts_cache[s]=p.layerToCanvas(o+t.x,a+t.y,!1);for(l.update_bbox(),i=0,n=u.pts_count;i<n;i++)s=(r=2*i)+1,o=u.pts_cache[r],a=u.pts_cache[s],u.pts_cache[r]=d.layerToCanvas(o+e.x,a+e.y,!0),u.pts_cache[s]=d.layerToCanvas(o+e.x,a+e.y,!1);return u.update_bbox(),l.intersects_poly(u,0,0)};var p=new cr.quad,O=new cr.rect(0,0,0,0),P=[];i.prototype.testTilemapOverlap=function(t,e){var i,n,r=e.bbox,s=t.x,o=t.y;t.getCollisionRectCandidates(r,P);for(var a=P,h=e.collision_poly&&!e.collision_poly.is_empty(),c=0,l=a.length;c<l;++c)if(i=a[c],n=i.rc,r.intersects_rect_off(n,s,o)&&(p.set_from_rect(n),p.offset(s,o),p.intersects_quad(e.bquad)))if(h){if(e.collision_poly.cache_poly(e.width,e.height,e.angle),i.poly){if(i.poly.intersects_poly(e.collision_poly,e.x-(s+n.left),e.y-(o+n.top)))return cr.clearArray(P),!0}else if(this.temp_poly.set_from_quad(p,0,0,n.right-n.left,n.bottom-n.top),this.temp_poly.intersects_poly(e.collision_poly,e.x,e.y))return cr.clearArray(P),!0}else{if(!i.poly)return cr.clearArray(P),!0;if(this.temp_poly.set_from_quad(e.bquad,0,0,e.width,e.height),i.poly.intersects_poly(this.temp_poly,-(s+n.left),-(o+n.top)))return cr.clearArray(P),!0}return cr.clearArray(P),!1},i.prototype.testRectOverlap=function(t,e){if(!e||!e.collisionsEnabled)return!1;e.update_bbox();e.layer;if(!e.bbox.intersects_rect(t))return!1;if(e.tilemap_exists){e.getCollisionRectCandidates(t,P);for(var i,n,r=P,s=e.x,o=e.y,a=0,h=r.length;a<h;++a)if(n=(i=r[a]).rc,t.intersects_rect_off(n,s,o)){if(!i.poly)return cr.clearArray(P),!0;if(this.temp_poly.set_from_rect(t,0,0),i.poly.intersects_poly(this.temp_poly,-(s+n.left),-(o+n.top)))return cr.clearArray(P),!0}return cr.clearArray(P),!1}return p.set_from_rect(t),!!e.bquad.intersects_quad(p)&&(!(e.collision_poly&&!e.collision_poly.is_empty())||(e.collision_poly.cache_poly(e.width,e.height,e.angle),p.offset(-t.left,-t.top),this.temp_poly.set_from_quad(p,0,0,1,1),e.collision_poly.intersects_poly(this.temp_poly,t.left-e.x,t.top-e.y)))},i.prototype.testSegmentOverlap=function(t,e,i,n,r){if(!r||!r.collisionsEnabled)return!1;r.update_bbox();r.layer;if(O.set(cr.min(t,i),cr.min(e,n),cr.max(t,i),cr.max(e,n)),!r.bbox.intersects_rect(O))return!1;if(r.tilemap_exists){r.getCollisionRectCandidates(O,P);for(var s,o,a=P,h=r.x,c=r.y,l=0,u=a.length;l<u;++l)if(s=a[l],o=s.rc,O.intersects_rect_off(o,h,c)&&(p.set_from_rect(o),p.offset(h,c),p.intersects_segment(t,e,i,n))){if(!s.poly)return cr.clearArray(P),!0;if(s.poly.intersects_segment(h+o.left,c+o.top,t,e,i,n))return cr.clearArray(P),!0}return cr.clearArray(P),!1}return!!r.bquad.intersects_segment(t,e,i,n)&&(!(r.collision_poly&&!r.collision_poly.is_empty())||(r.collision_poly.cache_poly(r.width,r.height,r.angle),r.collision_poly.intersects_segment(r.x,r.y,t,e,i,n)))},i.prototype.typeHasBehavior=function(t,e){if(!e)return!1;for(var i,n,r,s=0,o=t.behaviors.length;s<o;s++)if(t.behaviors[s].behavior instanceof e)return!0;if(!t.is_family)for(s=0,o=t.families.length;s<o;s++)for(i=0,n=(r=t.families[s]).behaviors.length;i<n;i++)if(r.behaviors[i].behavior instanceof e)return!0;return!1},i.prototype.typeHasNoSaveBehavior=function(t){return this.typeHasBehavior(t,cr.behaviors.NoSave)},i.prototype.typeHasPersistBehavior=function(t){return this.typeHasBehavior(t,cr.behaviors.Persist)},i.prototype.getSolidBehavior=function(){return this.solidBehavior},i.prototype.getJumpthruBehavior=function(){return this.jumpthruBehavior};var o=[];i.prototype.testOverlapSolid=function(t){var e,i,n;for(t.update_bbox(),this.getSolidCollisionCandidates(t.layer,t.bbox,o),e=0,i=o.length;e<i;++e)if(n=o[e],n.extra.solidEnabled&&this.testOverlap(t,n))return cr.clearArray(o),n;return cr.clearArray(o),null},i.prototype.testRectOverlapSolid=function(t){var e,i,n;for(this.getSolidCollisionCandidates(null,t,o),e=0,i=o.length;e<i;++e)if(n=o[e],n.extra.solidEnabled&&this.testRectOverlap(t,n))return cr.clearArray(o),n;return cr.clearArray(o),null};var a=[];i.prototype.testOverlapJumpThru=function(t,e){var i,n,r,s=null;for(e&&(s=a,cr.clearArray(s)),t.update_bbox(),this.getJumpthruCollisionCandidates(t.layer,t.bbox,o),i=0,n=o.length;i<n;++i)if(r=o[i],r.extra.jumpthruEnabled&&this.testOverlap(t,r)){if(!e)return cr.clearArray(o),r;s.push(r)}return cr.clearArray(o),s},i.prototype.pushOutSolid=function(t,e,i,n,r,s){for(var o=n||50,a=t.x,h=t.y,c=null,l=null,u=0;u<o;u++)if(t.x=a+e*u,t.y=h+i*u,t.set_bbox_changed(),!this.testOverlap(t,c)&&(c=this.testOverlapSolid(t),c&&(l=c),!c&&(r&&(c=s?this.testOverlap(t,s)?s:null:this.testOverlapJumpThru(t))&&(l=c),!c)))return l&&this.pushInFractional(t,e,i,l,16),!0;return t.x=a,t.y=h,t.set_bbox_changed(),!1},i.prototype.pushOut=function(t,e,i,n,r){for(var s=n||50,o=t.x,a=t.y,h=0;h<s;h++)if(t.x=o+e*h,t.y=a+i*h,t.set_bbox_changed(),!this.testOverlap(t,r))return!0;return t.x=o,t.y=a,t.set_bbox_changed(),!1},i.prototype.pushInFractional=function(t,e,i,n,r){for(var s,o=2,a=!1,h=!1,c=t.x,l=t.y;o<=r;)s=1/o,o*=2,t.x+=e*s*(a?1:-1),t.y+=i*s*(a?1:-1),t.set_bbox_changed(),this.testOverlap(t,n)?h=a=!0:(h=a=!1,c=t.x,l=t.y);h&&(t.x=c,t.y=l,t.set_bbox_changed())},i.prototype.pushOutSolidNearest=function(t,e){var i=cr.is_undefined(e)?100:e,n=0,r=t.x,s=t.y,o=0,a=0,h=0,c=this.testOverlapSolid(t);if(!c)return!0;for(;n<=i;){switch(o){case 0:a=0,h=-1,n++;break;case 1:h=-(a=1);break;case 2:a=1,h=0;break;case 3:h=a=1;break;case 4:a=0,h=1;break;case 5:a=-1,h=1;break;case 6:a=-1,h=0;break;case 7:h=a=-1}if(o=(o+1)%8,t.x=cr.floor(r+a*n),t.y=cr.floor(s+h*n),t.set_bbox_changed(),!this.testOverlap(t,c)&&!(c=this.testOverlapSolid(t)))return!0}return t.x=r,t.y=s,t.set_bbox_changed(),!1},i.prototype.registerCollision=function(t,e){t.collisionsEnabled&&e.collisionsEnabled&&this.registered_collisions.push([t,e])},i.prototype.checkRegisteredCollision=function(t,e){for(var i,n=0,r=this.registered_collisions.length;n<r;n++)if((i=this.registered_collisions[n])[0]==t&&i[1]==e||i[0]==e&&i[1]==t)return!0;return!1},i.prototype.calculateSolidBounceAngle=function(t,e,i,n){var r=t.x,s=t.y,o=cr.max(10,cr.distanceTo(e,i,r,s)),a=cr.angleTo(e,i,r,s),h=n||this.testOverlapSolid(t);if(!h)return cr.clamp_angle(a+cr.PI);for(var c,l,u,p=h,d=cr.to_radians(5),f=1;f<36;f++)if(c=a-f*d,t.x=e+Math.cos(c)*o,t.y=i+Math.sin(c)*o,t.set_bbox_changed(),!this.testOverlap(t,p)&&!(p=n?null:this.testOverlapSolid(t))){l=c;break}36===f&&(l=cr.clamp_angle(a+cr.PI));p=h;for(f=1;f<36;f++)if(c=a+f*d,t.x=e+Math.cos(c)*o,t.y=i+Math.sin(c)*o,t.set_bbox_changed(),!this.testOverlap(t,p)&&!(p=n?null:this.testOverlapSolid(t))){u=c;break}if(36===f&&(u=cr.clamp_angle(a+cr.PI)),t.x=r,t.y=s,t.set_bbox_changed(),u===l)return u;var y=cr.angleDiff(u,l)/2,g=cr.angleClockwise(u,l)?cr.clamp_angle(l+y+cr.PI):cr.clamp_angle(u+y),h=Math.cos(a),r=Math.sin(a),s=Math.cos(g),y=Math.sin(g),g=h*s+r*y,s=h-2*g*s,y=r-2*g*y;return cr.angleTo(0,0,s,y)};var I=-1;function s(){try{return window.indexedDB}catch(t){return}}function l(t){t.target.result.createObjectStore("saves",{keyPath:"slot"})}function E(){cr.logexport("Reloading for continuous preview"),window.c2cocoonjs?CocoonJS.App.reload():-1<window.location.search.indexOf("continuous")?window.location.reload(!0):window.location=window.location+"?continuous"}function R(t){var e,i={};for(e in t)t.hasOwnProperty(e)&&(t[e]instanceof cr.ObjectSet||t[e]&&void 0!==t[e].c2userdata||"spriteCreatedDestroyCallback"!==e&&(i[e]=t[e]));return i}i.prototype.trigger=function(t,e,i){if(!this.running_layout)return!1;var n=this.running_layout.event_sheet;if(!n)return!1;var r,s=!1;I++;for(var o=n.deep_includes,a=0,h=o.length;a<h;++a)r=this.triggerOnSheet(t,e,o[a],i),s=s||r;return r=this.triggerOnSheet(t,e,n,i),I--,s=s||r},i.prototype.triggerOnSheet=function(t,e,i,n){var r,s,o,a,h=!1;if(e)for(o=this.triggerOnSheetForTypeName(t,e,e.type.name,i,n),h=h||o,r=0,s=(a=e.type.families).length;r<s;++r)o=this.triggerOnSheetForTypeName(t,e,a[r].name,i,n),h=h||o;else o=this.triggerOnSheetForTypeName(t,e,"system",i,n),h=h||o;return h},i.prototype.triggerOnSheetForTypeName=function(t,e,i,n,r){var s,o,a,h=!1,c=void 0!==r,l=(c?n.fasttriggers:n.triggers)[i];if(!l)return h;for(var u,p=null,d=0,f=l.length;d<f;++d)if(l[d].method==t){p=l[d].evs;break}if(!p)return h;if(!(u=c?p[r]:p))return null;for(d=0,f=u.length;d<f;d++)o=u[d][0],a=u[d][1],s=this.executeSingleTrigger(e,i,o,a),h=h||s;return h},i.prototype.executeSingleTrigger=function(t,e,i,n){var r,s,o=!1;this.trigger_depth++;var a=this.getCurrentEventStack().current_event;a&&this.pushCleanSol(a.solModifiersIncludingParents);var h=1<this.trigger_depth;this.pushCleanSol(i.solModifiersIncludingParents),h&&this.pushLocalVarStack();var c,l=this.pushEventStack(i);l.current_event=i,t&&((c=this.types[e].getCurrentSol()).select_all=!1,cr.clearArray(c.instances),c.instances[0]=t,this.types[e].applySolToContainer());var u=!0;if(i.parent){for(var p=l.temp_parents_arr,d=i.parent;d;)p.push(d),d=d.parent;for(p.reverse(),r=0,s=p.length;r<s;r++)if(!p[r].run_pretrigger()){u=!1;break}}return u&&(this.execcount++,i.orblock?i.run_orblocktrigger(n):i.run(),o=o||l.last_event_true),this.popEventStack(),h&&this.popLocalVarStack(),this.popSol(i.solModifiersIncludingParents),a&&this.popSol(a.solModifiersIncludingParents),this.hasPendingInstances&&0===this.isInOnDestroy&&0===I&&!this.isRunningEvents&&this.ClearDeathRow(),this.trigger_depth--,o},i.prototype.getCurrentCondition=function(){var t=this.getCurrentEventStack();return t.current_event.conditions[t.cndindex]},i.prototype.getCurrentConditionObjectType=function(){return this.getCurrentCondition().type},i.prototype.isCurrentConditionFirst=function(){return 0===this.getCurrentEventStack().cndindex},i.prototype.getCurrentAction=function(){var t=this.getCurrentEventStack();return t.current_event.actions[t.actindex]},i.prototype.pushLocalVarStack=function(){this.localvar_stack_index++,this.localvar_stack_index>=this.localvar_stack.length&&this.localvar_stack.push([])},i.prototype.popLocalVarStack=function(){this.localvar_stack_index--},i.prototype.getCurrentLocalVarStack=function(){return this.localvar_stack[this.localvar_stack_index]},i.prototype.pushEventStack=function(t){this.event_stack_index++,this.event_stack_index>=this.event_stack.length&&this.event_stack.push(new cr.eventStackFrame);var e=this.getCurrentEventStack();return e.reset(t),e},i.prototype.popEventStack=function(){this.event_stack_index--},i.prototype.getCurrentEventStack=function(){return this.event_stack[this.event_stack_index]},i.prototype.pushLoopStack=function(t){this.loop_stack_index++,this.loop_stack_index>=this.loop_stack.length&&this.loop_stack.push(cr.seal({name:t,index:0,stopped:!1}));var e=this.getCurrentLoop();return e.name=t,e.index=0,e.stopped=!1,e},i.prototype.popLoopStack=function(){this.loop_stack_index--},i.prototype.getCurrentLoop=function(){return this.loop_stack[this.loop_stack_index]},i.prototype.getEventVariableByName=function(t,e){for(var i,n,r,s,o,a;e;){for(i=0,n=e.subevents.length;i<n;i++)if((a=e.subevents[i])instanceof cr.eventvariable&&cr.equals_nocase(t,a.name))return a;e=e.parent}for(i=0,n=this.eventsheets_by_index.length;i<n;i++)for(r=0,s=(o=this.eventsheets_by_index[i]).events.length;r<s;r++)if((a=o.events[r])instanceof cr.eventvariable&&cr.equals_nocase(t,a.name))return a;return null},i.prototype.getLayoutBySid=function(t){for(var e=0,i=this.layouts_by_index.length;e<i;e++)if(this.layouts_by_index[e].sid===t)return this.layouts_by_index[e];return null},i.prototype.getObjectTypeBySid=function(t){for(var e=0,i=this.types_by_index.length;e<i;e++)if(this.types_by_index[e].sid===t)return this.types_by_index[e];return null},i.prototype.getGroupBySid=function(t){for(var e=0,i=this.allGroups.length;e<i;e++)if(this.allGroups[e].sid===t)return this.allGroups[e];return null},i.prototype.doCanvasSnapshot=function(t,e){this.snapshotCanvas=[t,e],this.redraw=!0},i.prototype.signalContinuousPreview=function(){this.signalledContinuousPreview=!0},i.prototype.handleSaveLoad=function(){var i=this,t=this.saveToSlot,n=this.lastSaveJson,e=this.loadFromSlot,r=!1;if(this.signalledContinuousPreview&&(r=!0,t="__c2_continuouspreview",this.signalledContinuousPreview=!1),t.length){if(this.ClearDeathRow(),n=this.saveToJSONString(),s()&&!this.isCocoonJs)!function(e,i,n,r){try{var t=indexedDB.open("_C2SaveStates");t.onupgradeneeded=l,t.onerror=r,t.onsuccess=function(t){t=t.target.result;t.onerror=r,t.transaction(["saves"],"readwrite").objectStore("saves").put({slot:e,data:i}).onsuccess=n}}catch(t){r(t)}}(t,n,function(){cr.logexport("Saved state to IndexedDB storage ("+n.length+" bytes)"),i.lastSaveJson=n,i.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),i.lastSaveJson="",r&&E()},function(e){try{localStorage.setItem("__c2save_"+t,n),cr.logexport("Saved state to WebStorage ("+n.length+" bytes)"),i.lastSaveJson=n,i.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),i.lastSaveJson="",r&&E()}catch(t){cr.logexport("Failed to save game state: "+e+"; "+t),i.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}});else try{localStorage.setItem("__c2save_"+t,n),cr.logexport("Saved state to WebStorage ("+n.length+" bytes)"),i.lastSaveJson=n,this.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),i.lastSaveJson="",r&&E()}catch(t){cr.logexport("Error saving to WebStorage: "+t),i.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null}if(e.length){if(s()&&!this.isCocoonJs)!function(i,n,r){try{var t=indexedDB.open("_C2SaveStates");t.onupgradeneeded=l,t.onerror=r,t.onsuccess=function(t){t=t.target.result;t.onerror=r;var e=t.transaction(["saves"]).objectStore("saves").get(i);e.onsuccess=function(t){e.result?n(e.result.data):n(null)}}}catch(t){r(t)}}(e,function(t){t?(i.loadFromJson=t,cr.logexport("Loaded state from IndexedDB storage ("+i.loadFromJson.length+" bytes)")):(i.loadFromJson=localStorage.getItem("__c2save_"+e)||"",cr.logexport("Loaded state from WebStorage ("+i.loadFromJson.length+" bytes)")),i.suspendDrawing=!1,i.loadFromJson||(i.loadFromJson=null,i.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))},function(t){i.loadFromJson=localStorage.getItem("__c2save_"+e)||"",cr.logexport("Loaded state from WebStorage ("+i.loadFromJson.length+" bytes)"),i.suspendDrawing=!1,i.loadFromJson||(i.loadFromJson=null,i.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))});else{try{this.loadFromJson=localStorage.getItem("__c2save_"+e)||"",cr.logexport("Loaded state from WebStorage ("+this.loadFromJson.length+" bytes)")}catch(t){this.loadFromJson=null}this.suspendDrawing=!1,i.loadFromJson||(i.loadFromJson=null,i.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}this.loadFromSlot="",this.saveToSlot=""}null!==this.loadFromJson&&(this.ClearDeathRow(),this.loadFromJSONString(this.loadFromJson)?(this.lastSaveJson=this.loadFromJson,this.trigger(cr.system_object.prototype.cnds.OnLoadComplete,null),this.lastSaveJson=""):i.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null),this.loadFromJson=null)},i.prototype.saveToJSONString=function(){for(var t,e,i,n,r,s,o,a,h,c,l={c2save:!0,version:1,rt:{time:this.kahanTime.sum,walltime:this.wallTime.sum,timescale:this.timescale,tickcount:this.tickcount,execcount:this.execcount,next_uid:this.next_uid,running_layout:this.running_layout.sid,start_time_offset:Date.now()-this.start_time},types:{},layouts:{},events:{groups:{},cnds:{},acts:{},vars:{}}},u=0,p=this.types_by_index.length;u<p;u++)if(!(i=this.types_by_index[u]).is_family&&!this.typeHasNoSaveBehavior(i)){for(r={instances:[]},cr.hasAnyOwnProperty(i.extra)&&(r.ex=R(i.extra)),t=0,e=i.instances.length;t<e;t++)r.instances.push(this.saveInstanceToJSON(i.instances[t]));l.types[i.sid.toString()]=r}for(u=0,p=this.layouts_by_index.length;u<p;u++)n=this.layouts_by_index[u],l.layouts[n.sid.toString()]=n.saveToJSON();var d=l.events.groups;for(u=0,p=this.allGroups.length;u<p;u++)d[(s=this.allGroups[u]).sid.toString()]=this.groups_by_name[s.group_name].group_active;var f=l.events.cnds;for(c in this.cndsBySid)this.cndsBySid.hasOwnProperty(c)&&(o=this.cndsBySid[c],cr.hasAnyOwnProperty(o.extra)&&(f[c]={ex:R(o.extra)}));var y=l.events.acts;for(c in this.actsBySid)this.actsBySid.hasOwnProperty(c)&&(a=this.actsBySid[c],cr.hasAnyOwnProperty(a.extra)&&(y[c]={ex:R(a.extra)}));var g=l.events.vars;for(c in this.varsBySid)this.varsBySid.hasOwnProperty(c)&&((h=this.varsBySid[c]).is_constant||h.parent&&!h.is_static||(g[c]=h.data));return l.system=this.system.saveToJSON(),JSON.stringify(l)},i.prototype.refreshUidMap=function(){var t,e,i,n,r,s;for(this.objectsByUid={},t=0,e=this.types_by_index.length;t<e;t++)if(!(i=this.types_by_index[t]).is_family)for(n=0,r=i.instances.length;n<r;n++)s=i.instances[n],this.objectsByUid[s.uid.toString()]=s},i.prototype.loadFromJSONString=function(t){var e;try{e=JSON.parse(t)}catch(t){return!1}if(!e.c2save)return!1;if(1<e.version)return!1;this.isLoadingState=!0;var i=e.rt;this.kahanTime.reset(),this.kahanTime.sum=i.time,this.wallTime.reset(),this.wallTime.sum=i.walltime||0,this.timescale=i.timescale,this.tickcount=i.tickcount,this.execcount=i.execcount,this.start_time=Date.now()-i.start_time_offset;var n,r,s,o,a,h,c,l,u,p,d,f,y,g,m,_,v,b=i.running_layout;if(b!==this.running_layout.sid){b=this.getLayoutBySid(b);if(!b)return;this.doChangeLayout(b)}var w=e.types;for(c in w)if(w.hasOwnProperty(c)&&(l=this.getObjectTypeBySid(parseInt(c,10)))&&!l.is_family&&!this.typeHasNoSaveBehavior(l)){for(w[c].ex?l.extra=w[c].ex:cr.wipe(l.extra),u=l.instances,p=w[c].instances,n=0,r=cr.min(u.length,p.length);n<r;n++)this.loadInstanceFromJSON(u[n],p[n]);for(n=p.length,r=u.length;n<r;n++)this.DestroyInstance(u[n]);for(n=u.length,r=p.length;n<r;n++)g=null,l.plugin.is_world&&!(g=this.running_layout.getLayerBySid(p[n].w.l))||(d=this.createInstanceFromInit(l.default_instance,g,!1,0,0,!0),this.loadInstanceFromJSON(d,p[n]));l.stale_iids=!0}this.ClearDeathRow(),this.refreshUidMap();var x=e.layouts;for(c in x)x.hasOwnProperty(c)&&(y=this.getLayoutBySid(parseInt(c,10)))&&y.loadFromJSON(x[c]);var S=e.events.groups;for(c in S)S.hasOwnProperty(c)&&(m=this.getGroupBySid(parseInt(c,10)))&&this.groups_by_name[m.group_name]&&this.groups_by_name[m.group_name].setGroupActive(S[c]);var T=e.events.cnds;for(c in this.cndsBySid)this.cndsBySid.hasOwnProperty(c)&&(T.hasOwnProperty(c)?this.cndsBySid[c].extra=T[c].ex:this.cndsBySid[c].extra={});var A=e.events.acts;for(c in this.actsBySid)this.actsBySid.hasOwnProperty(c)&&(A.hasOwnProperty(c)?this.actsBySid[c].extra=A[c].ex:this.actsBySid[c].extra={});var C=e.events.vars;for(c in C)C.hasOwnProperty(c)&&this.varsBySid.hasOwnProperty(c)&&(this.varsBySid[c].data=C[c]);for(this.next_uid=i.next_uid,this.isLoadingState=!1,n=0,r=this.fireOnCreateAfterLoad.length;n<r;++n)d=this.fireOnCreateAfterLoad[n],this.trigger(Object.getPrototypeOf(d.type.plugin).cnds.OnCreated,d);for(cr.clearArray(this.fireOnCreateAfterLoad),this.system.loadFromJSON(e.system),n=0,r=this.types_by_index.length;n<r;n++)if(!(l=this.types_by_index[n]).is_family&&!this.typeHasNoSaveBehavior(l))for(s=0,o=l.instances.length;s<o;s++){if(d=l.instances[s],l.is_contained)for(_=d.get_iid(),cr.clearArray(d.siblings),a=0,h=l.container.length;a<h;a++)l!==(v=l.container[a])&&d.siblings.push(v.instances[_]);if(d.afterLoad&&d.afterLoad(),d.behavior_insts)for(a=0,h=d.behavior_insts.length;a<h;a++)(f=d.behavior_insts[a]).afterLoad&&f.afterLoad()}return this.redraw=!0},i.prototype.saveInstanceToJSON=function(t,e){var i,n,r,s,o,a=t.type,h=a.plugin,c={};if(e?c.c2=!0:c.uid=t.uid,cr.hasAnyOwnProperty(t.extra)&&(c.ex=R(t.extra)),t.instance_vars&&t.instance_vars.length)for(c.ivs={},i=0,n=t.instance_vars.length;i<n;i++)c.ivs[t.type.instvar_sids[i].toString()]=t.instance_vars[i];if(h.is_world){if(r={x:t.x,y:t.y,w:t.width,h:t.height,l:t.layer.sid,zi:t.get_zindex()},0!==t.angle&&(r.a=t.angle),1!==t.opacity&&(r.o=t.opacity),.5!==t.hotspotX&&(r.hX=t.hotspotX),.5!==t.hotspotY&&(r.hY=t.hotspotY),0!==t.blend_mode&&(r.bm=t.blend_mode),t.visible||(r.v=t.visible),t.collisionsEnabled||(r.ce=t.collisionsEnabled),-1!==t.my_timescale&&(r.mts=t.my_timescale),a.effect_types.length)for(r.fx=[],i=0,n=a.effect_types.length;i<n;i++)o=a.effect_types[i],r.fx.push({name:o.name,active:t.active_effect_flags[o.index],params:t.effect_params[o.index]});c.w=r}if(t.behavior_insts&&t.behavior_insts.length)for(c.behs={},i=0,n=t.behavior_insts.length;i<n;i++)(s=t.behavior_insts[i]).saveToJSON&&(c.behs[s.type.sid.toString()]=s.saveToJSON());return t.saveToJSON&&(c.data=t.saveToJSON()),c},i.prototype.getInstanceVarIndexBySid=function(t,e){for(var i=0,n=t.instvar_sids.length;i<n;i++)if(t.instvar_sids[i]===e)return i;return-1},i.prototype.getBehaviorIndexBySid=function(t,e){for(var i=0,n=t.behavior_insts.length;i<n;i++)if(t.behavior_insts[i].type.sid===e)return i;return-1},i.prototype.loadInstanceFromJSON=function(t,e,i){var n,r,s,o,a,h,c,l,u,p=t.type,d=p.plugin;if(i){if(!e.c2)return}else t.uid=e.uid;if(e.ex?t.extra=e.ex:cr.wipe(t.extra),a=e.ivs)for(n in a)a.hasOwnProperty(n)&&((o=this.getInstanceVarIndexBySid(p,parseInt(n,10)))<0||o>=t.instance_vars.length||(t.instance_vars[o]=a[n]));if(d.is_world){if(h=e.w,t.layer.sid!==h.l&&(d=t.layer,t.layer=this.running_layout.getLayerBySid(h.l),t.layer?(d.removeFromInstanceList(t,!0),t.layer.appendToInstanceList(t,!0),t.set_bbox_changed(),t.layer.setZIndicesStaleFrom(0)):(t.layer=d,i||this.DestroyInstance(t))),t.x=h.x,t.y=h.y,t.width=h.w,t.height=h.h,t.zindex=h.zi,t.angle=h.hasOwnProperty("a")?h.a:0,t.opacity=h.hasOwnProperty("o")?h.o:1,t.hotspotX=h.hasOwnProperty("hX")?h.hX:.5,t.hotspotY=h.hasOwnProperty("hY")?h.hY:.5,t.visible=!h.hasOwnProperty("v")||h.v,t.collisionsEnabled=!h.hasOwnProperty("ce")||h.ce,t.my_timescale=h.hasOwnProperty("mts")?h.mts:-1,t.blend_mode=h.hasOwnProperty("bm")?h.bm:0,t.compositeOp=cr.effectToCompositeOp(t.blend_mode),this.gl&&cr.setGLBlend(t,t.blend_mode,this.gl),t.set_bbox_changed(),h.hasOwnProperty("fx"))for(r=0,s=h.fx.length;r<s;r++)(c=p.getEffectIndexByName(h.fx[r].name))<0||(t.active_effect_flags[c]=h.fx[r].active,t.effect_params[c]=h.fx[r].params);t.updateActiveEffects()}if(l=e.behs)for(n in l)l.hasOwnProperty(n)&&((u=this.getBehaviorIndexBySid(t,parseInt(n,10)))<0||t.behavior_insts[u].loadFromJSON(l[n]));e.data&&t.loadFromJSON(e.data)},i.prototype.fetchLocalFileViaCordova=function(t,e,i){t=cordova.file.applicationDirectory+"www/"+t;window.resolveLocalFileSystemURL(t,function(t){t.file(e,i)},i)},i.prototype.fetchLocalFileViaCordovaAsText=function(t,i,n){this.fetchLocalFileViaCordova(t,function(t){var e=new FileReader;e.onload=function(t){i(t.target.result)},e.onerror=n,e.readAsText(t)},n)};var r=[],B=0;i.prototype.maybeStartNextArrayBufferRead=function(){var t;r.length&&(8<=B||(B++,t=r.shift(),this.doFetchLocalFileViaCordovaAsArrayBuffer(t.filename,t.successCallback,t.errorCallback)))},i.prototype.fetchLocalFileViaCordovaAsArrayBuffer=function(t,e,i){var n=this;r.push({filename:t,successCallback:function(t){B--,n.maybeStartNextArrayBufferRead(),e(t)},errorCallback:function(t){B--,n.maybeStartNextArrayBufferRead(),i(t)}}),this.maybeStartNextArrayBufferRead()},i.prototype.doFetchLocalFileViaCordovaAsArrayBuffer=function(t,i,e){this.fetchLocalFileViaCordova(t,function(t){var e=new FileReader;e.onload=function(t){i(t.target.result)},e.readAsArrayBuffer(t)},e)},i.prototype.fetchLocalFileViaCordovaAsURL=function(t,e,i){this.fetchLocalFileViaCordovaAsArrayBuffer(t,function(t){t=new Blob([t]),t=URL.createObjectURL(t);e(t)},i)},i.prototype.isAbsoluteUrl=function(t){return/^(?:[a-z]+:)?\/\//.test(t)||"data:"===t.substr(0,5)||"blob:"===t.substr(0,5)},i.prototype.setImageSrc=function(e,t){this.isWKWebView&&!this.isAbsoluteUrl(t)?this.fetchLocalFileViaCordovaAsURL(t,function(t){e.src=t},function(t){alert("Failed to load image: "+t)}):e.src=t},i.prototype.setCtxImageSmoothingEnabled=function(t,e){void 0!==t.imageSmoothingEnabled?t.imageSmoothingEnabled=e:(t.webkitImageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e)},cr.runtime=i,cr.createRuntime=function(t){return new i(document.getElementById(t))},cr.createDCRuntime=function(t,e){return new i({dc:!0,width:t,height:e})},window.cr_createRuntime=cr.createRuntime,window.cr_createDCRuntime=cr.createDCRuntime,window.createCocoonJSRuntime=function(){window.c2cocoonjs=!0;var t=document.createElement("screencanvas")||document.createElement("canvas");t.screencanvas=!0,document.body.appendChild(t);t=new i(t);return window.c2runtime=t,window.addEventListener("orientationchange",function(){window.c2runtime.setSize(window.innerWidth,window.innerHeight)}),window.c2runtime.setSize(window.innerWidth,window.innerHeight),t},window.createEjectaRuntime=function(){var t=new i(document.getElementById("canvas"));return window.c2runtime=t,window.c2runtime.setSize(window.innerWidth,window.innerHeight),t}}(),window.cr_getC2Runtime=function(){var t=document.getElementById("c2canvas");return t?t.c2runtime:window.c2runtime||null},window.cr_getSnapshot=function(t,e){var i=window.cr_getC2Runtime();i&&i.doCanvasSnapshot(t,e)},window.cr_sizeCanvas=function(t,e){var i;0===t||0===e||(i=window.cr_getC2Runtime())&&i.setSize(t,e)},window.cr_setSuspended=function(t){var e=window.cr_getC2Runtime();e&&e.setSuspended(t)},function(){function t(t,e){this.runtime=t,this.event_sheet=null,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,this.scale=1,this.angle=0,this.first_visit=!0,this.name=e[0],this.originalWidth=e[1],this.originalHeight=e[2],this.width=e[1],this.height=e[2],this.unbounded_scrolling=e[3],this.sheetname=e[4],this.sid=e[5];var i,n,r=e[6];for(this.layers=[],this.initial_types=[],i=0,n=r.length;i<n;i++){var s=new cr.layer(this,r[i]);s.number=i,cr.seal(s),this.layers.push(s)}var o=e[7];for(this.initial_nonworld=[],i=0,n=o.length;i<n;i++){var a=o[i],h=this.runtime.types_by_index[a[1]];h.default_instance||(h.default_instance=a),this.initial_nonworld.push(a),-1===this.initial_types.indexOf(h)&&this.initial_types.push(h)}for(this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],i=0,n=e[8].length;i<n;i++)this.effect_types.push({id:e[8][i][0],name:e[8][i][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:i}),this.effect_params.push(e[8][i][2].slice(0));this.updateActiveEffects(),this.rcTex=new cr.rect(0,0,1,1),this.rcTex2=new cr.rect(0,0,1,1),this.persist_data={}}t.prototype.saveObjectToPersist=function(t){var e=t.type.sid.toString();this.persist_data.hasOwnProperty(e)||(this.persist_data[e]=[]),this.persist_data[e].push(this.runtime.saveInstanceToJSON(t))},t.prototype.hasOpaqueBottomLayer=function(){var t=this.layers[0];return!t.transparent&&1===t.opacity&&!t.forceOwnTexture&&t.visible},t.prototype.updateActiveEffects=function(){var t,e,i;for(cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0,t=0,e=this.effect_types.length;t<e;t++)(i=this.effect_types[t]).active&&(this.active_effect_types.push(i),i.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))},t.prototype.getEffectByName=function(t){for(var e,i=0,n=this.effect_types.length;i<n;i++)if((e=this.effect_types[i]).name===t)return e;return null};var g=[];function m(t,e){return t.zindex-e.zindex}var _=!0;t.prototype.startRunning=function(){var t,e,i,n,r,s,o,a,h,c,l,u,p,d,f;for(this.sheetname&&(this.event_sheet=this.runtime.eventsheets[this.sheetname],this.event_sheet.updateDeepIncludes()),(this.runtime.running_layout=this).width=this.originalWidth,this.height=this.originalHeight,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,t=0,i=this.runtime.types_by_index.length;t<i;t++)if(!(r=this.runtime.types_by_index[t]).is_family)for(e=0,n=(s=r.instances).length;e<n;e++)(d=s[e]).layer&&((p=d.layer.number)>=this.layers.length&&(p=this.layers.length-1),d.layer=this.layers[p],-1===d.layer.instances.indexOf(d)&&d.layer.instances.push(d),d.layer.zindices_stale=!0);if(!_)for(t=0,i=this.layers.length;t<i;++t)this.layers[t].instances.sort(m);for(cr.clearArray(g),this.boundScrolling(),t=0,i=this.layers.length;t<i;t++)(f=this.layers[t]).createInitialInstances(),f.updateViewport(null);var y=!1;if(!this.first_visit){for(l in this.persist_data)if(this.persist_data.hasOwnProperty(l)&&(r=this.runtime.getObjectTypeBySid(parseInt(l,10)))&&!r.is_family&&this.runtime.typeHasPersistBehavior(r)){for(t=0,i=(u=this.persist_data[l]).length;t<i;t++)f=null,r.plugin.is_world&&!(f=this.getLayerBySid(u[t].w.l))||(d=this.runtime.createInstanceFromInit(r.default_instance,f,!1,0,0,!0),this.runtime.loadInstanceFromJSON(d,u[t]),y=!0,g.push(d));cr.clearArray(u)}for(t=0,i=this.layers.length;t<i;t++)this.layers[t].instances.sort(m),this.layers[t].zindices_stale=!0}for(y&&(this.runtime.ClearDeathRow(),this.runtime.refreshUidMap()),t=0;t<g.length;t++)if((d=g[t]).type.is_contained)for(a=d.get_iid(),e=0,n=d.type.container.length;e<n;e++)h=d.type.container[e],d.type!==h&&(h.instances.length>a?d.siblings.push(h.instances[a]):h.default_instance&&(c=this.runtime.createInstanceFromInit(h.default_instance,d.layer,!0,d.x,d.y,!0),this.runtime.ClearDeathRow(),h.updateIIDs(),d.siblings.push(c),g.push(c)));for(t=0,i=this.initial_nonworld.length;t<i;t++)o=this.initial_nonworld[t],(r=this.runtime.types_by_index[o[1]]).is_contained||(d=this.runtime.createInstanceFromInit(this.initial_nonworld[t],null,!0));if(this.runtime.changelayout=null,this.runtime.ClearDeathRow(),this.runtime.ctx&&!this.runtime.isDomFree)for(t=0,i=this.runtime.types_by_index.length;t<i;t++)!(h=this.runtime.types_by_index[t]).is_family&&h.instances.length&&h.preloadCanvas2D&&h.preloadCanvas2D(this.runtime.ctx);if(this.runtime.isLoadingState)cr.shallowAssignArray(this.runtime.fireOnCreateAfterLoad,g);else for(t=0,i=g.length;t<i;t++)d=g[t],this.runtime.trigger(Object.getPrototypeOf(d.type.plugin).cnds.OnCreated,d);cr.clearArray(g),this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart,null),this.first_visit=!1},t.prototype.createGlobalNonWorlds=function(){for(var t,e,i=0,n=0,r=this.initial_nonworld.length;i<r;i++)t=this.initial_nonworld[i],(e=this.runtime.types_by_index[t[1]]).global?e.is_contained||this.runtime.createInstanceFromInit(t,null,!0):(this.initial_nonworld[n]=t,n++);cr.truncateArray(this.initial_nonworld,n)},t.prototype.stopRunning=function(){var t,e,i,n,r,s,o;if(this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd,null),this.runtime.isEndingLayout=!0,cr.clearArray(this.runtime.system.waits),!this.first_visit)for(t=0,e=this.layers.length;t<e;t++)for(this.layers[t].updateZIndices(),i=0,n=(r=this.layers[t].instances).length;i<n;i++)(s=r[i]).type.global||this.runtime.typeHasPersistBehavior(s.type)&&this.saveObjectToPersist(s);for(t=0,e=this.layers.length;t<e;t++){for(i=0,n=(r=this.layers[t].instances).length;i<n;i++)(s=r[i]).type.global||this.runtime.DestroyInstance(s);this.runtime.ClearDeathRow(),cr.clearArray(r),this.layers[t].zindices_stale=!0}for(t=0,e=this.runtime.types_by_index.length;t<e;t++)if(!((o=this.runtime.types_by_index[t]).global||o.plugin.is_world||o.plugin.singleglobal||o.is_family)){for(i=0,n=o.instances.length;i<n;i++)this.runtime.DestroyInstance(o.instances[i]);this.runtime.ClearDeathRow()}_=!1,this.runtime.isEndingLayout=!1};var a=new cr.rect(0,0,0,0);function e(t,e){this.layout=t,this.runtime=t.runtime,this.instances=[],this.scale=1,this.angle=0,this.disableAngle=!1,this.tmprect=new cr.rect(0,0,0,0),this.tmpquad=new cr.quad,this.viewLeft=0,this.viewRight=0,this.viewTop=0,this.viewBottom=0,this.zindices_stale=!1,this.zindices_stale_from=-1,this.clear_earlyz_index=0,this.name=e[0],this.index=e[1],this.sid=e[2],this.visible=e[3],this.background_color=e[4],this.transparent=e[5],this.parallaxX=e[6],this.parallaxY=e[7],this.opacity=e[8],this.forceOwnTexture=e[9],this.useRenderCells=e[10],this.zoomRate=e[11],this.blend_mode=e[12],this.effect_fallback=e[13],this.compositeOp="source-over",this.srcBlend=0,this.destBlend=0,this.render_grid=null,this.last_render_list=h(),this.render_list_stale=!0,this.last_render_cells=new cr.rect(0,0,-1,-1),this.cur_render_cells=new cr.rect(0,0,-1,-1),this.useRenderCells&&(this.render_grid=new cr.RenderGrid(this.runtime.original_width,this.runtime.original_height)),this.render_offscreen=!1;var i,n,r=e[14];for(this.startup_initial_instances=[],this.initial_instances=[],this.created_globals=[],i=0,n=r.length;i<n;i++){var s=r[i],o=this.runtime.types_by_index[s[1]];o.default_instance||(o.default_instance=s,o.default_layerindex=this.index),this.initial_instances.push(s),-1===this.layout.initial_types.indexOf(o)&&this.layout.initial_types.push(o)}for(cr.shallowAssignArray(this.startup_initial_instances,this.initial_instances),this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],i=0,n=e[15].length;i<n;i++)this.effect_types.push({id:e[15][i][0],name:e[15][i][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:i}),this.effect_params.push(e[15][i][2].slice(0));this.updateActiveEffects(),this.rcTex=new cr.rect(0,0,1,1),this.rcTex2=new cr.rect(0,0,1,1)}t.prototype.recreateInitialObjects=function(t,e,i,n,r){var s,o;for(a.set(e,i,n,r),s=0,o=this.layers.length;s<o;s++)this.layers[s].recreateInitialObjects(t,a)},t.prototype.draw=function(t){var e,i,n,r,s=t,o=!1,a=!this.runtime.fullscreenScalingQuality;for(a&&(this.runtime.layout_canvas||(this.runtime.layout_canvas=document.createElement("canvas"),(e=this.runtime.layout_canvas).width=this.runtime.draw_width,e.height=this.runtime.draw_height,this.runtime.layout_ctx=e.getContext("2d"),o=!0),e=this.runtime.layout_canvas,s=this.runtime.layout_ctx,e.width!==this.runtime.draw_width&&(e.width=this.runtime.draw_width,o=!0),e.height!==this.runtime.draw_height&&(e.height=this.runtime.draw_height,o=!0),o&&this.runtime.setCtxImageSmoothingEnabled(s,this.runtime.linearSampling)),s.globalAlpha=1,s.globalCompositeOperation="source-over",this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&s.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height),i=0,n=this.layers.length;i<n;i++)(r=this.layers[i]).visible&&0<r.opacity&&11!==r.blend_mode&&(r.instances.length||!r.transparent)?r.draw(s):r.updateViewport(null);a&&t.drawImage(e,0,0,this.runtime.width,this.runtime.height)},t.prototype.drawGL_earlyZPass=function(t){var e,i;for(t.setEarlyZPass(!0),this.runtime.layout_tex||(this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layout_tex.c2width===this.runtime.draw_width&&this.runtime.layout_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.draw_width,this.runtime.draw_height),e=this.layers.length-1;0<=e;--e)(i=this.layers[e]).visible&&1===i.opacity&&i.shaders_preserve_opaqueness&&0===i.blend_mode&&(i.instances.length||!i.transparent)?i.drawGL_earlyZPass(t):i.updateViewport(null);t.setEarlyZPass(!1)},t.prototype.drawGL=function(t){var e,i,n,r,s=0<this.active_effect_types.length||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack;for(s?(this.runtime.layout_tex||(this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layout_tex.c2width===this.runtime.draw_width&&this.runtime.layout_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.draw_width,this.runtime.draw_height)):this.runtime.layout_tex&&(t.setRenderingToTexture(null),t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=null),this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&t.clear(0,0,0,0),e=0,i=this.layers.length;e<i;e++)(n=this.layers[e]).visible&&0<n.opacity&&(n.instances.length||!n.transparent)?n.drawGL(t):n.updateViewport(null);s&&(0===this.active_effect_types.length||1===this.active_effect_types.length&&this.runtime.fullscreenScalingQuality?(1===this.active_effect_types.length?(r=this.active_effect_types[0].index,t.switchProgram(this.active_effect_types[0].shaderindex),t.setProgramParameters(null,1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,this.scale,this.angle,0,0,this.runtime.draw_width/2,this.runtime.draw_height/2,this.runtime.kahanTime.sum,this.effect_params[r]),t.programIsAnimated(this.active_effect_types[0].shaderindex)&&(this.runtime.redraw=!0)):t.switchProgram(0),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.width,this.runtime.height),t.setRenderingToTexture(null),t.setDepthTestEnabled(!1),t.setOpacity(1),t.setTexture(this.runtime.layout_tex),t.setAlphaBlend(),t.resetModelView(),t.updateModelView(),s=this.runtime.width/2,r=this.runtime.height/2,t.quad(-s,r,s,r,s,-r,-s,-r),t.setTexture(null),t.setDepthTestEnabled(!0)):this.renderEffectChain(t,null,null,null))},t.prototype.getRenderTarget=function(){return 0<this.active_effect_types.length||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack?this.runtime.layout_tex:null},t.prototype.getMinLayerScale=function(){for(var t,e=this.layers[0].getScale(),i=1,n=this.layers.length;i<n;i++)0===(t=this.layers[i]).parallaxX&&0===t.parallaxY||t.getScale()<e&&(e=t.getScale());return e},t.prototype.scrollToX=function(t){var e;this.unbounded_scrolling||(e=this.runtime.draw_width*(1/this.getMinLayerScale())/2,t>this.width-e&&(t=this.width-e),t<e&&(t=e)),this.scrollX!==t&&(this.scrollX=t,this.runtime.redraw=!0)},t.prototype.scrollToY=function(t){var e;this.unbounded_scrolling||(e=this.runtime.draw_height*(1/this.getMinLayerScale())/2,t>this.height-e&&(t=this.height-e),t<e&&(t=e)),this.scrollY!==t&&(this.scrollY=t,this.runtime.redraw=!0)},t.prototype.boundScrolling=function(){this.scrollToX(this.scrollX),this.scrollToY(this.scrollY)},t.prototype.renderEffectChain=function(t,e,i,n){var r=(i||e||this).active_effect_types,s=1,o=0,a=0,h=0,c=this.runtime.draw_width,l=this.runtime.draw_height;i?(s=i.layer.getScale(),o=i.layer.getAngle(),a=i.layer.viewLeft,h=i.layer.viewTop,c=i.layer.viewRight,l=i.layer.viewBottom):e&&(s=e.getScale(),o=e.getAngle(),a=e.viewLeft,h=e.viewTop,c=e.viewRight,l=e.viewBottom);var u,p,d=this.runtime.fx_tex,f=0,y=1,g=this.runtime.draw_width,m=this.runtime.draw_height,_=g/2,v=m/2,b=(e||this).rcTex,w=(e||this).rcTex2,x=0,S=0,T=0,A=0,C=g,k=g,O=m,P=m,I=0,E=0,R=i?i.layer.getAngle():0;if(i){for(U=0,G=r.length;U<G;U++)I+=t.getProgramBoxExtendHorizontal(r[U].shaderindex),E+=t.getProgramBoxExtendVertical(r[U].shaderindex);var B,L,M,N=i.bbox;x=e.layerToCanvas(N.left,N.top,!0,!0),T=e.layerToCanvas(N.left,N.top,!1,!0),C=e.layerToCanvas(N.right,N.bottom,!0,!0),O=e.layerToCanvas(N.right,N.bottom,!1,!0),0!==R&&(B=e.layerToCanvas(N.right,N.top,!0,!0),L=e.layerToCanvas(N.right,N.top,!1,!0),R=e.layerToCanvas(N.left,N.bottom,!0,!0),N=e.layerToCanvas(N.left,N.bottom,!1,!0),M=Math.min(x,C,B,R),C=Math.max(x,C,B,R),x=M,M=Math.min(T,O,L,N),O=Math.max(T,O,L,N),T=M),x-=I,T-=E,C+=I,O+=E,w.left=x/g,w.top=1-T/m,w.right=C/g,w.bottom=1-O/m,S=x=cr.floor(x),A=T=cr.floor(T),k=C=cr.ceil(C),P=O=cr.ceil(O),x<0&&(x=0),T<0&&(T=0),g<C&&(C=g),m<O&&(O=m),(S-=I)<0&&(S=0),(A-=E)<0&&(A=0),g<(k+=I)&&(k=g),m<(P+=E)&&(P=m),b.left=x/g,b.top=1-T/m,b.right=C/g,b.bottom=1-O/m}else b.left=w.left=0,b.top=w.top=0,b.right=w.right=1,b.bottom=w.bottom=1;var j=i&&(t.programUsesDest(r[0].shaderindex)||0!==I||0!==E||1!==i.opacity||i.type.plugin.must_predraw)||e&&!i&&1!==e.opacity;t.setAlphaBlend(),j&&(d[f]||(d[f]=t.createEmptyTexture(g,m,this.runtime.linearSampling)),d[f].c2width===g&&d[f].c2height===m||(t.deleteTexture(d[f]),d[f]=t.createEmptyTexture(g,m,this.runtime.linearSampling)),t.switchProgram(0),t.setRenderingToTexture(d[f]),u=m-A-(p=P-A),t.clearRect(S,u,k-S,p),i?i.drawGL(t):(t.setTexture(this.runtime.layer_tex),t.setOpacity(e.opacity),t.resetModelView(),t.translate(-_,-v),t.updateModelView(),t.quadTex(x,O,C,O,C,T,x,T,b)),w.left=w.top=0,w.right=w.bottom=1,i&&(M=b.top,b.top=b.bottom,b.bottom=M),f=1,y=0),t.setOpacity(1);for(var F,D,V,W=r.length-1,z=t.programUsesCrossSampling(r[W].shaderindex)||!e&&!i&&!this.runtime.fullscreenScalingQuality,U=0,G=r.length;U<G;U++)d[f]||(d[f]=t.createEmptyTexture(g,m,this.runtime.linearSampling)),d[f].c2width===g&&d[f].c2height===m||(t.deleteTexture(d[f]),d[f]=t.createEmptyTexture(g,m,this.runtime.linearSampling)),t.switchProgram(r[U].shaderindex),F=r[U].index,t.programIsAnimated(r[U].shaderindex)&&(this.runtime.redraw=!0),0!=U||j?(t.setProgramParameters(n,1/g,1/m,w.left,w.top,w.right,w.bottom,s,o,a,h,(a+c)/2,(h+l)/2,this.runtime.kahanTime.sum,(i||e||this).effect_params[F]),t.setTexture(null),U!==W||z?(t.setRenderingToTexture(d[f]),u=m-A-(p=P-A),t.clearRect(S,u,k-S,p)):(i?t.setBlend(i.srcBlend,i.destBlend):e&&t.setBlend(e.srcBlend,e.destBlend),t.setRenderingToTexture(n)),t.setTexture(d[y]),t.resetModelView(),t.translate(-_,-v),t.updateModelView(),t.quadTex(x,O,C,O,C,T,x,T,b),U!==W||z||t.setTexture(null)):(t.setRenderingToTexture(d[f]),u=m-A-(p=P-A),t.clearRect(S,u,k-S,p),i?(V=i.curFrame&&i.curFrame.texture_img?(D=1/(V=i.curFrame.texture_img).width,1/V.height):(D=1/i.width,1/i.height),t.setProgramParameters(n,D,V,w.left,w.top,w.right,w.bottom,s,o,a,h,(a+c)/2,(h+l)/2,this.runtime.kahanTime.sum,i.effect_params[F]),i.drawGL(t)):(t.setProgramParameters(n,1/g,1/m,0,0,1,1,s,o,a,h,(a+c)/2,(h+l)/2,this.runtime.kahanTime.sum,(e||this).effect_params[F]),t.setTexture(e?this.runtime.layer_tex:this.runtime.layout_tex),t.resetModelView(),t.translate(-_,-v),t.updateModelView(),t.quadTex(x,O,C,O,C,T,x,T,b)),w.left=w.top=0,w.right=w.bottom=1,i&&!z&&(M=O,O=T,T=M)),y=0===(f=0===f?1:0)?1:0;z&&(t.switchProgram(0),i?t.setBlend(i.srcBlend,i.destBlend):e?t.setBlend(e.srcBlend,e.destBlend):this.runtime.fullscreenScalingQuality||(t.setSize(this.runtime.width,this.runtime.height),_=this.runtime.width/2,v=this.runtime.height/2,T=x=0,C=this.runtime.width,O=this.runtime.height),t.setRenderingToTexture(n),t.setTexture(d[y]),t.resetModelView(),t.translate(-_,-v),t.updateModelView(),i&&1===r.length&&!j?t.quadTex(x,T,C,T,C,O,x,O,b):t.quadTex(x,O,C,O,C,T,x,T,b),t.setTexture(null))},t.prototype.getLayerBySid=function(t){for(var e=0,i=this.layers.length;e<i;e++)if(this.layers[e].sid===t)return this.layers[e];return null},t.prototype.saveToJSON=function(){for(var t,e,i={sx:this.scrollX,sy:this.scrollY,s:this.scale,a:this.angle,w:this.width,h:this.height,fv:this.first_visit,persist:this.persist_data,fx:[],layers:{}},n=0,r=this.effect_types.length;n<r;n++)e=this.effect_types[n],i.fx.push({name:e.name,active:e.active,params:this.effect_params[e.index]});for(n=0,r=this.layers.length;n<r;n++)t=this.layers[n],i.layers[t.sid.toString()]=t.saveToJSON();return i},t.prototype.loadFromJSON=function(t){var e,i,n;this.scrollX=t.sx,this.scrollY=t.sy,this.scale=t.s,this.angle=t.a,this.width=t.w,this.height=t.h,this.persist_data=t.persist,void 0!==t.fv&&(this.first_visit=t.fv);for(var r=t.fx,s=0,o=r.length;s<o;s++)(e=this.getEffectByName(r[s].name))&&(e.active=r[s].active,this.effect_params[e.index]=r[s].params);this.updateActiveEffects();var a=t.layers;for(i in a)a.hasOwnProperty(i)&&(n=this.getLayerBySid(parseInt(i,10)))&&n.loadFromJSON(a[i])},cr.layout=t,e.prototype.updateActiveEffects=function(){var t,e,i;for(cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0,t=0,e=this.effect_types.length;t<e;t++)(i=this.effect_types[t]).active&&(this.active_effect_types.push(i),i.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))},e.prototype.getEffectByName=function(t){for(var e,i=0,n=this.effect_types.length;i<n;i++)if((e=this.effect_types[i]).name===t)return e;return null},e.prototype.createInitialInstances=function(){for(var t,e,i,n=0,r=0,s=this.initial_instances.length;n<s;n++){if(t=this.initial_instances[n],e=this.runtime.types_by_index[t[1]],i=!0,!this.runtime.typeHasPersistBehavior(e)||this.layout.first_visit){if(!(t=this.runtime.createInstanceFromInit(t,this,!0)))continue;g.push(t),t.type.global&&(i=!1,this.created_globals.push(t.uid))}i&&(this.initial_instances[r]=this.initial_instances[n],r++)}this.initial_instances.length=r,this.runtime.ClearDeathRow(),!this.runtime.glwrap&&this.effect_types.length&&(this.blend_mode=this.effect_fallback),this.compositeOp=cr.effectToCompositeOp(this.blend_mode),this.runtime.gl&&cr.setGLBlend(this,this.blend_mode,this.runtime.gl),this.render_list_stale=!0},e.prototype.recreateInitialObjects=function(t,e){for(var i,n,r,s,o,a,h,c=this.runtime.types_by_index,l=t.is_family,u=t.members,p=0,d=this.initial_instances.length;p<d;++p)if(n=(r=(i=this.initial_instances[p])[0])[0],r=r[1],e.contains_pt(n,r)){if((r=c[i[1]])!==t){if(!l)continue;if(u.indexOf(r)<0)continue}if(s=this.runtime.createInstanceFromInit(i,this,!1),this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(r.plugin).cnds.OnCreated,s),s.is_contained)for(o=0,a=s.siblings.length;o<a;o++)h=s.siblings[p],this.runtime.trigger(Object.getPrototypeOf(h.type.plugin).cnds.OnCreated,h);this.runtime.isInOnDestroy--}},e.prototype.removeFromInstanceList=function(t,e){var i=cr.fastIndexOf(this.instances,t);i<0||(e&&this.useRenderCells&&t.rendercells&&t.rendercells.right>=t.rendercells.left&&(t.update_bbox(),this.render_grid.update(t,t.rendercells,null),t.rendercells.set(0,0,-1,-1)),i===this.instances.length-1?this.instances.pop():(cr.arrayRemove(this.instances,i),this.setZIndicesStaleFrom(i)),this.render_list_stale=!0)},e.prototype.appendToInstanceList=function(t,e){t.zindex=this.instances.length,this.instances.push(t),e&&this.useRenderCells&&t.rendercells&&t.set_bbox_changed(),this.render_list_stale=!0},e.prototype.prependToInstanceList=function(t,e){this.instances.unshift(t),this.setZIndicesStaleFrom(0),e&&this.useRenderCells&&t.rendercells&&t.set_bbox_changed()},e.prototype.moveInstanceAdjacent=function(t,e,i){var n=t.get_zindex(),e=e.get_zindex();cr.arrayRemove(this.instances,n),n<e&&e--,i&&e++,e===this.instances.length?this.instances.push(t):this.instances.splice(e,0,t),this.setZIndicesStaleFrom(n<e?n:e)},e.prototype.setZIndicesStaleFrom=function(t){(-1===this.zindices_stale_from||t<this.zindices_stale_from)&&(this.zindices_stale_from=t),this.zindices_stale=!0,this.render_list_stale=!0},e.prototype.updateZIndices=function(){if(this.zindices_stale){var t,e,i;if(-1===this.zindices_stale_from&&(this.zindices_stale_from=0),this.useRenderCells)for(t=this.zindices_stale_from,e=this.instances.length;t<e;++t)(i=this.instances[t]).zindex=t,this.render_grid.markRangeChanged(i.rendercells);else for(t=this.zindices_stale_from,e=this.instances.length;t<e;++t)this.instances[t].zindex=t;this.zindices_stale=!1,this.zindices_stale_from=-1}},e.prototype.getScale=function(t){return this.getNormalScale()*(this.runtime.fullscreenScalingQuality||t?this.runtime.aspect_scale:1)},e.prototype.getNormalScale=function(){return(this.scale*this.layout.scale-1)*this.zoomRate+1},e.prototype.getAngle=function(){return this.disableAngle?0:cr.clamp_angle(this.layout.angle+this.angle)};var i=[];function h(){return i.length?i.pop():[]}function u(t){cr.clearArray(t),i.push(t)}var c=[];function n(t,e){for(var i,n,r,s=0,o=t.length;s<o-1;s+=2)(function(t,e,i){var n,r,s=0,o=0,a=0,h=t.length,c=e.length;for(i.length=h+c;s<h&&o<c;++a)n=t[s],r=e[o],n.zindex<r.zindex?(i[a]=n,++s):(i[a]=r,++o);for(;s<h;++s,++a)i[a]=t[s];for(;o<c;++o,++a)i[a]=e[o]})(i=t[s],n=t[s+1],r=h()),e||(u(i),u(n)),c.push(r);o%2==1&&(e?(i=h(),cr.shallowAssignArray(i,t[o-1]),c.push(i)):c.push(t[o-1])),cr.shallowAssignArray(t,c),cr.clearArray(c)}var r=[];e.prototype.getRenderCellInstancesToDraw=function(){if(this.updateZIndices(),this.render_grid.queryRange(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,r),!r.length)return h();if(1===r.length){var t=h();return cr.shallowAssignArray(t,r[0]),cr.clearArray(r),t}t=function(t){for(var e=!0;1<t.length;)n(t,e),e=!1;return t[0]}(r);return cr.clearArray(r),t},e.prototype.draw=function(t){this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0!==this.blend_mode;var e=this.runtime.canvas,i=t,n=!1;this.render_offscreen&&(this.runtime.layer_canvas||(this.runtime.layer_canvas=document.createElement("canvas"),(e=this.runtime.layer_canvas).width=this.runtime.draw_width,e.height=this.runtime.draw_height,this.runtime.layer_ctx=e.getContext("2d"),n=!0),e=this.runtime.layer_canvas,i=this.runtime.layer_ctx,e.width!==this.runtime.draw_width&&(e.width=this.runtime.draw_width,n=!0),e.height!==this.runtime.draw_height&&(e.height=this.runtime.draw_height,n=!0),n&&this.runtime.setCtxImageSmoothingEnabled(i,this.runtime.linearSampling),this.transparent&&i.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),i.globalAlpha=1,i.globalCompositeOperation="source-over",this.transparent||(i.fillStyle="rgb("+this.background_color[0]+","+this.background_color[1]+","+this.background_color[2]+")",i.fillRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),i.save(),this.disableAngle=!0;var r=this.canvasToLayer(0,0,!0,!0),s=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(r=Math.round(r),s=Math.round(s)),this.rotateViewport(r,s,i);var o,n=this.getScale();i.scale(n,n),i.translate(-r,-s),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(u(this.last_render_list),o=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):o=this.last_render_list):o=this.instances;for(var a,h=null,c=0,l=o.length;c<l;++c)(a=o[c])!==h&&(this.drawInstance(a,i),h=a);this.useRenderCells&&(this.last_render_list=o),i.restore(),this.render_offscreen&&(t.globalCompositeOperation=this.compositeOp,t.globalAlpha=this.opacity,t.drawImage(e,0,0))},e.prototype.drawInstance=function(t,e){var i;t.visible&&0!==t.width&&0!==t.height&&(t.update_bbox(),(i=t.bbox).right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(e.globalCompositeOperation=t.compositeOp,t.draw(e)))},e.prototype.updateViewport=function(t){this.disableAngle=!0;var e=this.canvasToLayer(0,0,!0,!0),i=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i)),this.rotateViewport(e,i,t)},e.prototype.rotateViewport=function(t,e,i){var n=this.getScale();this.viewLeft=t,this.viewTop=e,this.viewRight=t+this.runtime.draw_width*(1/n),this.viewBottom=e+this.runtime.draw_height*(1/n),this.viewLeft>this.viewRight&&(r=this.viewLeft,this.viewLeft=this.viewRight,this.viewRight=r),this.viewTop>this.viewBottom&&(r=this.viewTop,this.viewTop=this.viewBottom,this.viewBottom=r);var r=this.getAngle();0!==r&&(i&&(i.translate(this.runtime.draw_width/2,this.runtime.draw_height/2),i.rotate(-r),i.translate(this.runtime.draw_width/-2,this.runtime.draw_height/-2)),this.tmprect.set(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom),this.tmprect.offset((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),this.tmpquad.set_from_rotated_rect(this.tmprect,r),this.tmpquad.bounding_box(this.tmprect),this.tmprect.offset((this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2),this.viewLeft=this.tmprect.left,this.viewTop=this.tmprect.top,this.viewRight=this.tmprect.right,this.viewBottom=this.tmprect.bottom)},e.prototype.drawGL_earlyZPass=function(t){this.runtime.draw_width,this.runtime.draw_height;this.render_offscreen=this.forceOwnTexture,this.render_offscreen&&(this.runtime.layer_tex||(this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layer_tex.c2width===this.runtime.draw_width&&this.runtime.layer_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layer_tex)),this.disableAngle=!0;var e=this.canvasToLayer(0,0,!0,!0),i=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i)),this.rotateViewport(e,i,null);var n,i=this.getScale();t.resetModelView(),t.scale(i,i),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView(),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(u(this.last_render_list),n=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):n=this.last_render_list):n=this.instances;for(var r,s=null,o=n.length-1;0<=o;--o)(r=n[o])!==s&&(this.drawInstanceGL_earlyZPass(n[o],t),s=r);this.useRenderCells&&(this.last_render_list=n),this.transparent||(this.clear_earlyz_index=this.runtime.earlyz_index++,t.setEarlyZIndex(this.clear_earlyz_index),t.setColorFillMode(1,1,1,1),t.fullscreenQuad(),t.restoreEarlyZMode())},e.prototype.drawGL=function(t){this.runtime.draw_width,this.runtime.draw_height;var e=0,i=0;this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0<this.active_effect_types.length||0!==this.blend_mode,this.render_offscreen&&(this.runtime.layer_tex||(this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layer_tex.c2width===this.runtime.draw_width&&this.runtime.layer_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layer_tex),this.transparent&&t.clear(0,0,0,0)),this.transparent||(this.runtime.enableFrontToBack?(t.setEarlyZIndex(this.clear_earlyz_index),t.setColorFillMode(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1),t.fullscreenQuad(),t.setTextureFillMode()):t.clear(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1)),this.disableAngle=!0;var n=this.canvasToLayer(0,0,!0,!0),r=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(n=Math.round(n),r=Math.round(r)),this.rotateViewport(n,r,null);var s,r=this.getScale();t.resetModelView(),t.scale(r,r),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView(),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(u(this.last_render_list),s=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):s=this.last_render_list):s=this.instances;for(var o,a=null,h=0,c=s.length;h<c;++h)(o=s[h])!==a&&(this.drawInstanceGL(s[h],t),a=o);this.useRenderCells&&(this.last_render_list=s),this.render_offscreen&&(e=this.active_effect_types.length?this.active_effect_types[0].shaderindex:0,i=this.active_effect_types.length?this.active_effect_types[0].index:0,0===this.active_effect_types.length||1===this.active_effect_types.length&&!t.programUsesCrossSampling(e)&&1===this.opacity?(1===this.active_effect_types.length?(t.switchProgram(e),t.setProgramParameters(this.layout.getRenderTarget(),1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,r,this.getAngle(),this.viewLeft,this.viewTop,(this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2,this.runtime.kahanTime.sum,this.effect_params[i]),t.programIsAnimated(e)&&(this.runtime.redraw=!0)):t.switchProgram(0),t.setRenderingToTexture(this.layout.getRenderTarget()),t.setOpacity(this.opacity),t.setTexture(this.runtime.layer_tex),t.setBlend(this.srcBlend,this.destBlend),t.resetModelView(),t.updateModelView(),i=this.runtime.draw_width/2,e=this.runtime.draw_height/2,t.quad(-i,e,i,e,i,-e,-i,-e),t.setTexture(null)):this.layout.renderEffectChain(t,this,null,this.layout.getRenderTarget()))},e.prototype.drawInstanceGL=function(t,e){var i;t.visible&&0!==t.width&&0!==t.height&&(t.update_bbox(),(i=t.bbox).right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(e.setEarlyZIndex(t.earlyz_index),t.uses_shaders?this.drawInstanceWithShadersGL(t,e):(e.switchProgram(0),e.setBlend(t.srcBlend,t.destBlend),t.drawGL(e))))},e.prototype.drawInstanceGL_earlyZPass=function(t,e){var i;t.visible&&0!==t.width&&0!==t.height&&(t.update_bbox(),(i=t.bbox).right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(t.earlyz_index=this.runtime.earlyz_index++,0===t.blend_mode&&1===t.opacity&&t.shaders_preserve_opaqueness&&t.drawGL_earlyZPass&&(e.setEarlyZIndex(t.earlyz_index),t.drawGL_earlyZPass(e))))},e.prototype.drawInstanceWithShadersGL=function(t,e){var i,n,r,s,o,a,h,c,l,u=t.active_effect_types[0].shaderindex,p=t.active_effect_types[0].index,d=this.getScale();1!==t.active_effect_types.length||e.programUsesCrossSampling(u)||e.programExtendsBox(u)||(t.angle||t.layer.getAngle())&&e.programUsesDest(u)||1!==t.opacity||t.type.plugin.must_predraw?(this.layout.renderEffectChain(e,this,t,this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget()),e.resetModelView(),e.scale(d,d),e.rotateZ(-this.getAngle()),e.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),e.updateModelView()):(e.switchProgram(u),e.setBlend(t.srcBlend,t.destBlend),e.programIsAnimated(u)&&(this.runtime.redraw=!0),h=a=o=s=0,e.programUsesDest(u)&&(r=t.bbox,i=this.layerToCanvas(r.left,r.top,!0,!0),n=this.layerToCanvas(r.left,r.top,!1,!0),u=this.layerToCanvas(r.right,r.bottom,!0,!0),r=this.layerToCanvas(r.right,r.bottom,!1,!0),s=i/windowWidth,o=1-n/windowHeight,a=u/windowWidth,h=1-r/windowHeight),l=t.curFrame&&t.curFrame.texture_img?(c=1/(l=t.curFrame.texture_img).width,1/l.height):(c=1/t.width,1/t.height),e.setProgramParameters(this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget(),c,l,s,o,a,h,d,this.getAngle(),this.viewLeft,this.viewTop,(this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2,this.runtime.kahanTime.sum,t.effect_params[p]),t.drawGL(e))},e.prototype.canvasToLayer=function(t,e,i,n){var r=this.runtime.devicePixelRatio;this.runtime.isRetina&&(t*=r,e*=r);var s=this.runtime.parallax_x_origin,o=this.runtime.parallax_y_origin,a=(this.layout.scrollX-s)*this.parallaxX+s,h=(this.layout.scrollY-o)*this.parallaxY+o,r=a,s=h,o=1/this.getScale(!n);n?(r-=this.runtime.draw_width*o/2,s-=this.runtime.draw_height*o/2):(r-=this.runtime.width*o/2,s-=this.runtime.height*o/2),r+=t*o,s+=e*o;t=this.getAngle();return 0!==t&&(s-=h,t=(r-=a)*(e=Math.cos(t))-s*(o=Math.sin(t)),s=s*e+r*o,r=t,r+=a,s+=h),i?r:s},e.prototype.layerToCanvas=function(t,e,i,n){var r=this.runtime.parallax_x_origin,s=this.runtime.parallax_y_origin,o=(this.layout.scrollX-r)*this.parallaxX+r,a=(this.layout.scrollY-s)*this.parallaxY+s,h=o,c=a,l=this.getAngle();0!==l&&(e-=a,l=(t-=o)*(r=Math.cos(-l))-e*(s=Math.sin(-l)),e=e*r+t*s,t=l,t+=o,e+=a);a=1/this.getScale(!n);n?(h-=this.runtime.draw_width*a/2,c-=this.runtime.draw_height*a/2):(h-=this.runtime.width*a/2,c-=this.runtime.height*a/2),h=(t-h)/a,c=(e-c)/a;a=this.runtime.devicePixelRatio;return this.runtime.isRetina&&!n&&(h/=a,c/=a),i?h:c},e.prototype.rotatePt=function(t,e,i){if(0===this.getAngle())return i?t:e;var n=this.layerToCanvas(t,e,!0),t=this.layerToCanvas(t,e,!1);this.disableAngle=!0;e=this.canvasToLayer(n,t,!0),t=this.canvasToLayer(n,t,!0);return this.disableAngle=!1,i?e:t},e.prototype.saveToJSON=function(){for(var t,e={s:this.scale,a:this.angle,vl:this.viewLeft,vt:this.viewTop,vr:this.viewRight,vb:this.viewBottom,v:this.visible,bc:this.background_color,t:this.transparent,px:this.parallaxX,py:this.parallaxY,o:this.opacity,zr:this.zoomRate,fx:[],cg:this.created_globals,instances:[]},i=0,n=this.effect_types.length;i<n;i++)t=this.effect_types[i],e.fx.push({name:t.name,active:t.active,params:this.effect_params[t.index]});return e},e.prototype.loadFromJSON=function(t){var e,i;this.scale=t.s,this.angle=t.a,this.viewLeft=t.vl,this.viewTop=t.vt,this.viewRight=t.vr,this.viewBottom=t.vb,this.visible=t.v,this.background_color=t.bc,this.transparent=t.t,this.parallaxX=t.px,this.parallaxY=t.py,this.opacity=t.o,this.zoomRate=t.zr,this.created_globals=t.cg||[],cr.shallowAssignArray(this.initial_instances,this.startup_initial_instances);for(var n=new cr.ObjectSet,r=0,s=this.created_globals.length;r<s;++r)n.add(this.created_globals[r]);for(e=r=0,s=this.initial_instances.length;r<s;++r)n.contains(this.initial_instances[r][2])||(this.initial_instances[e]=this.initial_instances[r],++e);cr.truncateArray(this.initial_instances,e);var o=t.fx;for(r=0,s=o.length;r<s;r++)(i=this.getEffectByName(o[r].name))&&(i.active=o[r].active,this.effect_params[i.index]=o[r].params);this.updateActiveEffects(),this.instances.sort(m),this.zindices_stale=!0},cr.layer=e}(),function(){var o=[];function a(t,e){return t.index-e.index}function r(t){var e,i,n,r,s;for(2===t.length?t[0].index>t[1].index&&(r=t[0],t[0]=t[1],t[1]=r):2<t.length&&t.sort(a),t.length>=o.length&&(o.length=t.length+1),o[t.length]||(o[t.length]=[]),e=0,i=(s=o[t.length]).length;e<i;e++)if(function(t,e){var i,n=t.length;switch(n){case 0:return 1;case 1:return t[0]===e[0];case 2:return t[0]===e[0]&&t[1]===e[1];default:for(i=0;i<n;i++)if(t[i]!==e[i])return;return 1}}(t,n=s[e]))return n;return s.push(t),t}function t(t,e){this.runtime=t,this.triggers={},this.fasttriggers={},this.hasRun=!1,this.includes=new cr.ObjectSet,this.deep_includes=[],this.already_included_sheets=[],this.name=e[0];var i,n,r=e[1];for(this.events=[],i=0,n=r.length;i<n;i++)this.init_event(r[i],null,this.events)}function e(t){this.type=t,this.instances=[],this.else_instances=[],this.select_all=!0}function i(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.solModifiersIncludingParents=[],this.solWriterAfterCnds=!1,this.group=!1,this.initially_activated=!1,this.toplevelevent=!1,this.toplevelgroup=!1,this.has_else_block=!1,this.conditions=[],this.actions=[],this.subevents=[],this.group_name="",this.group=!1,this.initially_activated=!1,this.group_active=!1,this.contained_includes=null,i[1]&&(this.group_name=i[1][1].toLowerCase(),this.group=!0,this.initially_activated=!!i[1][0],this.contained_includes=[],this.group_active=this.initially_activated,this.runtime.allGroups.push(this),this.runtime.groups_by_name[this.group_name]=this),this.orblock=i[2],this.sid=i[4],this.group||(this.runtime.blocksBySid[this.sid.toString()]=this);var n=i[5];for(h=0,c=n.length;h<c;h++){var r=new cr.condition(this,n[h]);r.index=h,cr.seal(r),this.conditions.push(r),this.addSolModifier(r.type)}var s=i[6];for(h=0,c=s.length;h<c;h++){var o=new cr.action(this,s[h]);o.index=h,cr.seal(o),this.actions.push(o)}if(8===i.length)for(var a=i[7],h=0,c=a.length;h<c;h++)this.sheet.init_event(a[h],this,this.subevents);this.is_else_block=!1,this.conditions.length&&(this.is_else_block=null==this.conditions[0].type&&this.conditions[0].func==cr.system_object.prototype.cnds.Else)}function n(t,e){var i,n,r;if(t&&(-1===e.indexOf(t)&&e.push(t),t.is_contained))for(i=0,n=t.container.length;i<n;i++)t!==(r=t.container[i])&&-1===e.indexOf(r)&&e.push(r)}function s(t,e){if(this.block=t,this.sheet=t.sheet,this.runtime=t.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(e[1]),this.trigger=0<e[3],this.fasttrigger=2===e[3],this.looping=e[4],this.inverted=e[5],this.isstatic=e[6],this.sid=e[7],this.runtime.cndsBySid[this.sid.toString()]=this,-1===e[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[e[0]],this.isstatic?this.run=this.run_static:this.run=this.run_object,e[2]?(this.behaviortype=this.type.getBehaviorByName(e[2]),this.beh_index=this.type.getBehaviorIndexByName(e[2])):(this.behaviortype=null,this.beh_index=-1),this.block.parent&&this.block.parent.setSolWriterAfterCnds()),this.fasttrigger&&(this.run=this.run_true),10===e.length){for(var i=e[9],n=0,r=i.length;n<r;n++){var s=new cr.parameter(this,i[n]);cr.seal(s),this.parameters.push(s)}this.results.length=i.length}}function h(t,e){if(this.block=t,this.sheet=t.sheet,this.runtime=t.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(e[1]),-1===e[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[e[0]],this.run=this.run_object,e[2]?(this.behaviortype=this.type.getBehaviorByName(e[2]),this.beh_index=this.type.getBehaviorIndexByName(e[2])):(this.behaviortype=null,this.beh_index=-1)),this.sid=e[3],this.runtime.actsBySid[this.sid.toString()]=this,6===e.length){for(var i=e[5],n=0,r=i.length;n<r;n++){var s=new cr.parameter(this,i[n]);cr.seal(s),this.parameters.push(s)}this.results.length=i.length}}t.prototype.toString=function(){return this.name},t.prototype.init_event=function(t,e,i){switch(t[0]){case 0:var n,r,s=new cr.eventblock(this,e,t);if(cr.seal(s),s.orblock)for(i.push(s),n=0,r=s.conditions.length;n<r;n++)s.conditions[n].trigger&&this.init_trigger(s,n);else s.is_trigger()?this.init_trigger(s,0):i.push(s);break;case 1:var o=new cr.eventvariable(this,e,t);cr.seal(o),i.push(o);break;case 2:o=new cr.eventinclude(this,e,t);cr.seal(o),i.push(o)}},t.prototype.postInit=function(){for(var t=0,e=this.events.length;t<e;t++)this.events[t].postInit(t<e-1&&this.events[t+1].is_else_block)},t.prototype.updateDeepIncludes=function(){cr.clearArray(this.deep_includes),cr.clearArray(this.already_included_sheets),this.addDeepIncludes(this),cr.clearArray(this.already_included_sheets)},t.prototype.addDeepIncludes=function(t){for(var e,i,n=t.deep_includes,r=t.already_included_sheets,s=this.includes.valuesRef(),o=0,a=s.length;o<a;++o)i=(e=s[o]).include_sheet,!e.isActive()||t===i||-1<r.indexOf(i)||(r.push(i),i.addDeepIncludes(t),n.push(i))},t.prototype.run=function(t){var e,i;for(this.runtime.resuming_breakpoint||(this.hasRun=!0,t||(this.runtime.isRunningEvents=!0)),e=0,i=this.events.length;e<i;e++){var n=this.events[e];n.run(),this.runtime.clearSol(n.solModifiers),this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()}t||(this.runtime.isRunningEvents=!1)},t.prototype.init_trigger=function(t,e){t.orblock||this.runtime.triggers_to_postinit.push(t);var i=t.conditions[e],n=i.type?i.type.name:"system",r=i.fasttrigger,s=r?this.fasttriggers:this.triggers;s[n]||(s[n]=[]);var o=s[n],a=i.func;if(r){if(i.parameters.length){var h=i.parameters[0];if(1===h.type&&2===h.expression.type){var c,l,u,p=h.expression.value.toLowerCase();for(l=0,u=o.length;l<u;l++)if(o[l].method==a)return void((c=o[l].evs)[p]?c[p].push([t,e]):c[p]=[[t,e]]);(c={})[p]=[[t,e]],o.push({method:a,evs:c})}}}else{for(l=0,u=o.length;l<u;l++)if(o[l].method==a)return void o[l].evs.push([t,e]);h=a,cr.plugins_.Sprite&&h===cr.plugins_.Sprite.prototype.cnds.OnFrameChanged?o.unshift({method:a,evs:[[t,e]]}):o.push({method:a,evs:[[t,e]]})}},cr.eventsheet=t,e.prototype.hasObjects=function(){return(this.select_all?this.type:this).instances.length},e.prototype.getObjects=function(){return(this.select_all?this.type:this).instances},e.prototype.pick_one=function(t){var e;t&&(t.runtime.getCurrentEventStack().current_event.orblock?(this.select_all&&(cr.clearArray(this.instances),cr.shallowAssignArray(this.else_instances,t.type.instances),this.select_all=!1),-1!==(e=this.else_instances.indexOf(t))&&(this.instances.push(this.else_instances[e]),this.else_instances.splice(e,1))):(this.select_all=!1,cr.clearArray(this.instances),this.instances[0]=t))},cr.selection=e,window._c2hh_="2CE071C534BC5102B1D01F3D5F4A21C6CC06248A",i.prototype.postInit=function(t){var e,i,n=this.parent;if(this.group)for(this.toplevelgroup=!0;n;){if(!n.group){this.toplevelgroup=!1;break}n=n.parent}for(this.toplevelevent=!this.is_trigger()&&(!this.parent||this.parent.group&&this.parent.toplevelgroup),this.has_else_block=!!t,this.solModifiersIncludingParents=this.solModifiers.slice(0),n=this.parent;n;){for(e=0,i=n.solModifiers.length;e<i;e++)this.addParentSolModifier(n.solModifiers[e]);n=n.parent}for(this.solModifiers=r(this.solModifiers),this.solModifiersIncludingParents=r(this.solModifiersIncludingParents),e=0,i=this.conditions.length;e<i;e++)this.conditions[e].postInit();for(e=0,i=this.actions.length;e<i;e++)this.actions[e].postInit();for(e=0,i=this.subevents.length;e<i;e++)this.subevents[e].postInit(e<i-1&&this.subevents[e+1].is_else_block)},i.prototype.setGroupActive=function(t){if(this.group_active!==!!t){var e,i;for(this.group_active=!!t,e=0,i=this.contained_includes.length;e<i;++e)this.contained_includes[e].updateActive();0<i&&this.runtime.running_layout.event_sheet&&this.runtime.running_layout.event_sheet.updateDeepIncludes()}},i.prototype.addSolModifier=function(t){n(t,this.solModifiers)},i.prototype.addParentSolModifier=function(t){n(t,this.solModifiersIncludingParents)},i.prototype.setSolWriterAfterCnds=function(){this.solWriterAfterCnds=!0,this.parent&&this.parent.setSolWriterAfterCnds()},i.prototype.is_trigger=function(){return!!this.conditions.length&&this.conditions[0].trigger},i.prototype.run=function(){var t,e,i=!1,n=this.runtime,r=this.runtime.getCurrentEventStack(),s=(r.current_event=this).conditions;if(this.is_else_block||(r.else_branch_ran=!1),this.orblock){for(0===s.length&&(i=!0),r.cndindex=0,t=s.length;r.cndindex<t;r.cndindex++)(e=s[r.cndindex]).trigger||e.run()&&(i=!0);(r.last_event_true=i)&&this.run_actions_and_subevents()}else{for(r.cndindex=0,t=s.length;r.cndindex<t;r.cndindex++)if(!s[r.cndindex].run())return r.last_event_true=!1,void(this.toplevelevent&&n.hasPendingInstances&&n.ClearDeathRow());r.last_event_true=!0,this.run_actions_and_subevents()}this.end_run(r)},i.prototype.end_run=function(t){t.last_event_true&&this.has_else_block&&(t.else_branch_ran=!0),this.toplevelevent&&this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()},i.prototype.run_orblocktrigger=function(t){(this.runtime.getCurrentEventStack().current_event=this).conditions[t].run()&&(this.run_actions_and_subevents(),this.runtime.getCurrentEventStack().last_event_true=!0)},i.prototype.run_actions_and_subevents=function(){var t,e=this.runtime.getCurrentEventStack();for(e.actindex=0,t=this.actions.length;e.actindex<t;e.actindex++)if(this.actions[e.actindex].run())return;this.run_subevents()},i.prototype.resume_actions_and_subevents=function(){for(var t=this.runtime.getCurrentEventStack(),e=this.actions.length;t.actindex<e;t.actindex++)if(this.actions[t.actindex].run())return;this.run_subevents()},i.prototype.run_subevents=function(){if(this.subevents.length){var t,e,i,n,r=this.subevents.length-1;if(this.runtime.pushEventStack(this),this.solWriterAfterCnds)for(t=0,e=this.subevents.length;t<e;t++)i=this.subevents[t],(n=!this.toplevelgroup||!this.group&&t<r)&&this.runtime.pushCopySol(i.solModifiers),i.run(),n?this.runtime.popSol(i.solModifiers):this.runtime.clearSol(i.solModifiers);else for(t=0,e=this.subevents.length;t<e;t++)this.subevents[t].run();this.runtime.popEventStack()}},i.prototype.run_pretrigger=function(){var t=this.runtime.getCurrentEventStack();t.current_event=this;var e,i=!1;for(t.cndindex=0,e=this.conditions.length;t.cndindex<e;t.cndindex++)if(this.conditions[t.cndindex].run())i=!0;else if(!this.orblock)return!1;return!this.orblock||i},i.prototype.retrigger=function(){this.runtime.execcount++;var t,e=this.runtime.getCurrentEventStack().cndindex,i=this.runtime.pushEventStack(this);if(!this.orblock)for(i.cndindex=e+1,t=this.conditions.length;i.cndindex<t;i.cndindex++)if(!this.conditions[i.cndindex].run())return this.runtime.popEventStack(),!1;return this.run_actions_and_subevents(),this.runtime.popEventStack(),!0},i.prototype.isFirstConditionOfType=function(t){var e=t.index;if(0===e)return!0;for(--e;0<=e;--e)if(this.conditions[e].type===t.type)return!1;return!0},cr.eventblock=i,s.prototype.postInit=function(){for(var t,e=0,i=this.parameters.length;e<i;e++)(t=this.parameters[e]).postInit(),t.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},s.prototype.run_true=function(){return!0},s.prototype.run_system=function(){for(var t=0,e=this.parameters.length;t<e;t++)this.results[t]=this.parameters[t].get();return cr.xor(this.func.apply(this.runtime.system,this.results),this.inverted)},s.prototype.run_static=function(){for(var t=0,e=this.parameters.length;t<e;t++)this.results[t]=this.parameters[t].get();var i=this.func.apply(this.behaviortype||this.type,this.results);return this.type.applySolToContainer(),i},s.prototype.run_object=function(){var t,e,i,n,r,s,o,a,h,c=this.type,l=c.getCurrentSol(),u=this.block.orblock&&!this.trigger,p=0,d=c.is_contained,f=c.is_family,y=c.family_index,g=this.beh_index,m=-1<g,_=this.anyParamVariesPerInstance,v=this.parameters,b=this.results,w=this.inverted,x=this.func;if(_)for(t=0,i=v.length;t<i;++t)(n=v[t]).variesPerInstance||(b[t]=n.get(0));else for(t=0,i=v.length;t<i;++t)b[t]=v[t].get(0);if(l.select_all){for(cr.clearArray(l.instances),cr.clearArray(l.else_instances),C=0,k=(S=c.instances).length;C<k;++C){if(s=S[C],_)for(t=0,i=v.length;t<i;++t)(n=v[t]).variesPerInstance&&(b[t]=n.get(C));r=m?(p=0,f&&(p=s.type.family_beh_map[y]),x.apply(s.behavior_insts[g+p],b)):x.apply(s,b),cr.xor(r,w)?l.instances.push(s):u&&l.else_instances.push(s)}return c.finish&&c.finish(!0),l.select_all=!1,c.applySolToContainer(),l.hasObjects()}e=0;for(var S,T=u&&!this.block.isFirstConditionOfType(this),A=!1,C=0,k=(S=T?l.else_instances:l.instances).length;C<k;++C){if(s=S[C],_)for(t=0,i=v.length;t<i;++t)(n=v[t]).variesPerInstance&&(b[t]=n.get(C));if(r=m?(p=0,f&&(p=s.type.family_beh_map[y]),x.apply(s.behavior_insts[g+p],b)):x.apply(s,b),cr.xor(r,w))if(A=!0,T){if(l.instances.push(s),d)for(t=0,i=s.siblings.length;t<i;t++)(o=s.siblings[t]).type.getCurrentSol().instances.push(o)}else{if(S[e]=s,d)for(t=0,i=s.siblings.length;t<i;t++)(o=s.siblings[t]).type.getCurrentSol().instances[e]=o;e++}else if(T){if(S[e]=s,d)for(t=0,i=s.siblings.length;t<i;t++)(o=s.siblings[t]).type.getCurrentSol().else_instances[e]=o;e++}else if(u&&(l.else_instances.push(s),d))for(t=0,i=s.siblings.length;t<i;t++)(o=s.siblings[t]).type.getCurrentSol().else_instances.push(o)}if(cr.truncateArray(S,e),d)for(C=0,k=(h=c.container).length;C<k;C++)a=h[C].getCurrentSol(),T?cr.truncateArray(a.else_instances,e):cr.truncateArray(a.instances,e);var O=A;if(T&&!A)for(C=0,k=l.instances.length;C<k;C++){if(s=l.instances[C],_)for(t=0,i=v.length;t<i;t++)(n=v[t]).variesPerInstance&&(b[t]=n.get(C));if(r=m?x.apply(s.behavior_insts[g],b):x.apply(s,b),cr.xor(r,w)){A=!0;break}}return c.finish&&c.finish(O||u),u?A:l.hasObjects()},cr.condition=s,h.prototype.postInit=function(){for(var t,e=0,i=this.parameters.length;e<i;e++)(t=this.parameters[e]).postInit(),t.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},h.prototype.run_system=function(){for(var t=this.runtime,e=this.parameters,i=this.results,n=0,r=e.length;n<r;++n)i[n]=e[n].get();return this.func.apply(t.system,i)},h.prototype.run_object=function(){var t,e,i,n,r,s,o,a=this.type,h=this.beh_index,c=a.family_index,l=this.anyParamVariesPerInstance,u=this.parameters,p=this.results,d=this.func,f=a.getCurrentSol().getObjects(),y=a.is_family,g=-1<h;if(l)for(e=0,n=u.length;e<n;++e)(r=u[e]).variesPerInstance||(p[e]=r.get(0));else for(e=0,n=u.length;e<n;++e)p[e]=u[e].get(0);for(t=0,i=f.length;t<i;++t){if(s=f[t],l)for(e=0,n=u.length;e<n;++e)(r=u[e]).variesPerInstance&&(p[e]=r.get(t));g?(o=0,y&&(o=s.type.family_beh_map[c]),d.apply(s.behavior_insts[h+o],p)):d.apply(s,p)}return!1},cr.action=h;var c=[],l=-1;function u(){return l++,c.length===l&&c.push(new cr.expvalue),c[l]}function p(){l--}function d(t,e){var i,n,r;switch(this.owner=t,this.block=t.block,this.sheet=t.sheet,this.runtime=t.runtime,this.type=e[0],this.expression=null,this.solindex=0,this.get=null,this.combosel=0,this.layout=null,this.key=0,this.object=null,this.index=0,this.varname=null,this.eventvar=null,this.fileinfo=null,this.subparams=null,this.variadicret=null,this.subparams=null,this.variadicret=null,this.variesPerInstance=!1,e[0]){case 0:case 7:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_exp;break;case 1:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_exp_str;break;case 5:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_layer;break;case 3:case 8:this.combosel=e[1],this.get=this.get_combosel;break;case 6:this.layout=this.runtime.layouts[e[1]],this.get=this.get_layout;break;case 9:this.key=e[1],this.get=this.get_key;break;case 4:this.object=this.runtime.types_by_index[e[1]],this.get=this.get_object,this.block.addSolModifier(this.object),this.owner instanceof cr.action?this.block.setSolWriterAfterCnds():this.block.parent&&this.block.parent.setSolWriterAfterCnds();break;case 10:this.index=e[1],t.type&&t.type.is_family?(this.get=this.get_familyvar,this.variesPerInstance=!0):this.get=this.get_instvar;break;case 11:this.varname=e[1],this.eventvar=null,this.get=this.get_eventvar;break;case 2:case 12:this.fileinfo=e[1],this.get=this.get_audiofile;break;case 13:for(this.get=this.get_variadic,this.subparams=[],this.variadicret=[],i=1,n=e.length;i<n;i++)r=new cr.parameter(this.owner,e[i]),cr.seal(r),this.subparams.push(r),this.variadicret.push(0)}}function f(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.name=i[1],this.vartype=i[2],this.initial=i[3],this.is_static=!!i[4],this.is_constant=!!i[5],this.sid=i[6],(this.runtime.varsBySid[this.sid.toString()]=this).data=this.initial,this.parent?(this.is_static||this.is_constant?this.localIndex=-1:this.localIndex=this.runtime.stackLocalCount++,this.runtime.all_local_vars.push(this)):(this.localIndex=-1,this.runtime.all_global_vars.push(this))}function y(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.include_sheet=null,this.include_sheet_name=i[1],this.active=!0}function g(){this.temp_parents_arr=[],this.reset(null),cr.seal(this)}d.prototype.postInit=function(){var t,e;if(11===this.type)this.eventvar=this.runtime.getEventVariableByName(this.varname,this.block.parent);else if(13===this.type)for(t=0,e=this.subparams.length;t<e;t++)this.subparams[t].postInit();this.expression&&this.expression.postInit()},d.prototype.maybeVaryForType=function(t){this.variesPerInstance||t&&(t.plugin.singleglobal||(this.variesPerInstance=!0))},d.prototype.setVaries=function(){this.variesPerInstance=!0},d.prototype.get_exp=function(t){this.solindex=t||0;t=u();return this.expression.get(t),p(),t.data},d.prototype.get_exp_str=function(t){this.solindex=t||0;t=u();return this.expression.get(t),p(),cr.is_string(t.data)?t.data:""},d.prototype.get_object=function(){return this.object},d.prototype.get_combosel=function(){return this.combosel},d.prototype.get_layer=function(t){this.solindex=t||0;t=u();return this.expression.get(t),p(),t.is_number()?this.runtime.getLayerByNumber(t.data):this.runtime.getLayerByName(t.data)},d.prototype.get_layout=function(){return this.layout},d.prototype.get_key=function(){return this.key},d.prototype.get_instvar=function(){return this.index},d.prototype.get_familyvar=function(t){var e=t||0,i=this.owner.type,n=null,r=i.getCurrentSol(),t=r.getObjects();if(t.length)n=t[e%t.length].type;else if(r.else_instances.length)n=r.else_instances[e%r.else_instances.length].type;else{if(!i.instances.length)return 0;n=i.instances[e%i.instances.length].type}return this.index+n.family_var_map[i.family_index]},d.prototype.get_eventvar=function(){return this.eventvar},d.prototype.get_audiofile=function(){return this.fileinfo},d.prototype.get_variadic=function(){for(var t=0,e=this.subparams.length;t<e;t++)this.variadicret[t]=this.subparams[t].get();return this.variadicret},cr.parameter=d,f.prototype.postInit=function(){this.solModifiers=r(this.solModifiers)},f.prototype.setValue=function(t){var e=this.runtime.getCurrentLocalVarStack();this.parent&&!this.is_static&&e?(this.localIndex>=e.length&&(e.length=this.localIndex+1),e[this.localIndex]=t):this.data=t},f.prototype.getValue=function(){var t=this.runtime.getCurrentLocalVarStack();return!this.parent||this.is_static||!t||this.is_constant?this.data:this.localIndex>=t.length||void 0===t[this.localIndex]?this.initial:t[this.localIndex]},f.prototype.run=function(){!this.parent||this.is_static||this.is_constant||this.setValue(this.initial)},cr.eventvariable=f,y.prototype.toString=function(){return"include:"+this.include_sheet.toString()},y.prototype.postInit=function(){this.include_sheet=this.runtime.eventsheets[this.include_sheet_name],this.sheet.includes.add(this),this.solModifiers=r(this.solModifiers);for(var t=this.parent;t;)t.group&&t.contained_includes.push(this),t=t.parent;this.updateActive()},y.prototype.run=function(){this.parent&&this.runtime.pushCleanSol(this.runtime.types_by_index),this.include_sheet.hasRun||this.include_sheet.run(!0),this.parent&&this.runtime.popSol(this.runtime.types_by_index)},y.prototype.updateActive=function(){for(var t=this.parent;t;){if(t.group&&!t.group_active)return void(this.active=!1);t=t.parent}this.active=!0},y.prototype.isActive=function(){return this.active},cr.eventinclude=y,g.prototype.reset=function(t){this.current_event=t,this.cndindex=0,this.actindex=0,cr.clearArray(this.temp_parents_arr),this.last_event_true=!1,this.else_branch_ran=!1,this.any_true_state=!1},g.prototype.isModifierAfterCnds=function(){return!!this.current_event.solWriterAfterCnds||this.cndindex<this.current_event.conditions.length-1&&!!this.current_event.solModifiers.length},cr.eventStackFrame=g}(),function(){function t(t,e){this.owner=t,this.runtime=t.runtime,this.type=e[0],this.get=[this.eval_int,this.eval_float,this.eval_string,this.eval_unaryminus,this.eval_add,this.eval_subtract,this.eval_multiply,this.eval_divide,this.eval_mod,this.eval_power,this.eval_and,this.eval_or,this.eval_equal,this.eval_notequal,this.eval_less,this.eval_lessequal,this.eval_greater,this.eval_greaterequal,this.eval_conditional,this.eval_system_exp,this.eval_object_exp,this.eval_instvar_exp,this.eval_behavior_exp,this.eval_eventvar_exp][this.type];var i=null;switch(this.value=null,this.first=null,this.second=null,this.third=null,this.func=null,this.results=null,this.parameters=null,this.object_type=null,this.beh_index=-1,this.instance_expr=null,this.varindex=-1,this.behavior_type=null,this.varname=null,this.eventvar=null,this.return_string=!1,this.type){case 0:case 1:case 2:this.value=e[1];break;case 3:this.first=new cr.expNode(t,e[1]);break;case 18:this.first=new cr.expNode(t,e[1]),this.second=new cr.expNode(t,e[2]),this.third=new cr.expNode(t,e[3]);break;case 19:this.func=this.runtime.GetObjectReference(e[1]),this.func!==cr.system_object.prototype.exps.random&&this.func!==cr.system_object.prototype.exps.choose||this.owner.setVaries(),this.results=[],this.parameters=[],3===e.length?(i=e[2],this.results.length=i.length+1):this.results.length=1;break;case 20:this.object_type=this.runtime.types_by_index[e[1]],this.beh_index=-1,this.func=this.runtime.GetObjectReference(e[2]),this.return_string=e[3],cr.plugins_.Function&&this.func===cr.plugins_.Function.prototype.exps.Call&&this.owner.setVaries(),e[4]?this.instance_expr=new cr.expNode(t,e[4]):this.instance_expr=null,this.results=[],this.parameters=[],6===e.length?(i=e[5],this.results.length=i.length+1):this.results.length=1;break;case 21:this.object_type=this.runtime.types_by_index[e[1]],this.return_string=e[2],e[3]?this.instance_expr=new cr.expNode(t,e[3]):this.instance_expr=null,this.varindex=e[4];break;case 22:this.object_type=this.runtime.types_by_index[e[1]],this.behavior_type=this.object_type.getBehaviorByName(e[2]),this.beh_index=this.object_type.getBehaviorIndexByName(e[2]),this.func=this.runtime.GetObjectReference(e[3]),this.return_string=e[4],e[5]?this.instance_expr=new cr.expNode(t,e[5]):this.instance_expr=null,this.results=[],this.parameters=[],7===e.length?(i=e[6],this.results.length=i.length+1):this.results.length=1;break;case 23:this.varname=e[1],this.eventvar=null}if(this.owner.maybeVaryForType(this.object_type),4<=this.type&&this.type<=17&&(this.first=new cr.expNode(t,e[1]),this.second=new cr.expNode(t,e[2])),i)for(var n=0,r=i.length;n<r;n++)this.parameters.push(new cr.expNode(t,i[n]));cr.seal(this)}t.prototype.postInit=function(){if(23===this.type&&(this.eventvar=this.owner.runtime.getEventVariableByName(this.varname,this.owner.block.parent)),this.first&&this.first.postInit(),this.second&&this.second.postInit(),this.third&&this.third.postInit(),this.instance_expr&&this.instance_expr.postInit(),this.parameters)for(var t=0,e=this.parameters.length;t<e;t++)this.parameters[t].postInit()};var e=[],i=-1;function l(){return++i,e.length===i&&e.push(new cr.expvalue),e[i]}function u(){--i}function p(t,e,i){for(var n=0,r=t.length;n<r;++n)t[n].get(i),e[n+1]=i.data}function n(t,e){this.type=t||cr.exptype.Integer,this.data=e||0,this.object_class=null,this.type==cr.exptype.Integer&&(this.data=Math.floor(this.data)),cr.seal(this)}t.prototype.eval_system_exp=function(t){var e=this.parameters,i=this.results;i[0]=t,p(e,i,l()),u(),this.func.apply(this.runtime.system,i)},t.prototype.eval_object_exp=function(t){var e=this.object_type,i=this.results,n=this.parameters,r=this.instance_expr,s=this.func,o=this.owner.solindex,a=e.getCurrentSol(),h=a.getObjects();if(!h.length){if(!a.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));h=a.else_instances}(i[0]=t).object_class=e;t=l();p(n,i,t),r&&(r.get(t),t.is_number()&&(o=t.data,h=e.instances)),u();e=h.length;(e<=o||o<=-e)&&(o%=e),o<0&&(o+=e);s.apply(h[o],i)},t.prototype.eval_behavior_exp=function(t){var e=this.object_type,i=this.results,n=this.parameters,r=this.instance_expr,s=this.beh_index,o=this.func,a=this.owner.solindex,h=e.getCurrentSol(),c=h.getObjects();if(!c.length){if(!h.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));c=h.else_instances}(i[0]=t).object_class=e;t=l();p(n,i,t),r&&(r.get(t),t.is_number()&&(a=t.data,c=e.instances)),u();t=c.length;(t<=a||a<=-t)&&(a%=t),a<0&&(a+=t);c=c[a],a=0;e.is_family&&(a=c.type.family_beh_map[e.family_index]);o.apply(c.behavior_insts[s+a],i)},t.prototype.eval_instvar_exp=function(t){var e,i=this.instance_expr,n=this.object_type,r=this.varindex,s=this.owner.solindex,o=n.getCurrentSol(),a=o.getObjects();if(!a.length){if(!o.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));a=o.else_instances}if(i){o=l();if(i.get(o),o.is_number()){s=o.data;var h=n.instances;0!==h.length&&(s%=h.length)<0&&(s+=h.length);var c=(e=n.getInstanceByIID(s)).instance_vars[r];return cr.is_string(c)?t.set_string(c):t.set_float(c),void u()}u()}h=a.length;(h<=s||s<=-h)&&(s%=h),s<0&&(s+=h),e=a[s];s=0;n.is_family&&(s=e.type.family_var_map[n.family_index]);c=e.instance_vars[r+s];cr.is_string(c)?t.set_string(c):t.set_float(c)},t.prototype.eval_int=function(t){t.type=cr.exptype.Integer,t.data=this.value},t.prototype.eval_float=function(t){t.type=cr.exptype.Float,t.data=this.value},t.prototype.eval_string=function(t){t.type=cr.exptype.String,t.data=this.value},t.prototype.eval_unaryminus=function(t){this.first.get(t),t.is_number()&&(t.data=-t.data)},t.prototype.eval_add=function(t){this.first.get(t);var e=l();this.second.get(e),t.is_number()&&e.is_number()&&(t.data+=e.data,e.is_float()&&t.make_float()),u()},t.prototype.eval_subtract=function(t){this.first.get(t);var e=l();this.second.get(e),t.is_number()&&e.is_number()&&(t.data-=e.data,e.is_float()&&t.make_float()),u()},t.prototype.eval_multiply=function(t){this.first.get(t);var e=l();this.second.get(e),t.is_number()&&e.is_number()&&(t.data*=e.data,e.is_float()&&t.make_float()),u()},t.prototype.eval_divide=function(t){this.first.get(t);var e=l();this.second.get(e),t.is_number()&&e.is_number()&&(t.data/=e.data,t.make_float()),u()},t.prototype.eval_mod=function(t){this.first.get(t);var e=l();this.second.get(e),t.is_number()&&e.is_number()&&(t.data%=e.data,e.is_float()&&t.make_float()),u()},t.prototype.eval_power=function(t){this.first.get(t);var e=l();this.second.get(e),t.is_number()&&e.is_number()&&(t.data=Math.pow(t.data,e.data),e.is_float()&&t.make_float()),u()},t.prototype.eval_and=function(t){this.first.get(t);var e=l();this.second.get(e),e.is_string()||t.is_string()?this.eval_and_stringconcat(t,e):this.eval_and_logical(t,e),u()},t.prototype.eval_and_stringconcat=function(t,e){t.is_string()&&e.is_string()?this.eval_and_stringconcat_str_str(t,e):this.eval_and_stringconcat_num(t,e)},t.prototype.eval_and_stringconcat_str_str=function(t,e){t.data+=e.data},t.prototype.eval_and_stringconcat_num=function(t,e){t.is_string()?t.data+=(Math.round(1e10*e.data)/1e10).toString():t.set_string(t.data.toString()+e.data)},t.prototype.eval_and_logical=function(t,e){t.set_int(t.data&&e.data?1:0)},t.prototype.eval_or=function(t){this.first.get(t);var e=l();this.second.get(e),t.is_number()&&e.is_number()&&(t.data||e.data?t.set_int(1):t.set_int(0)),u()},t.prototype.eval_conditional=function(t){this.first.get(t),(t.data?this.second:this.third).get(t)},t.prototype.eval_equal=function(t){this.first.get(t);var e=l();this.second.get(e),t.set_int(t.data===e.data?1:0),u()},t.prototype.eval_notequal=function(t){this.first.get(t);var e=l();this.second.get(e),t.set_int(t.data!==e.data?1:0),u()},t.prototype.eval_less=function(t){this.first.get(t);var e=l();this.second.get(e),t.set_int(t.data<e.data?1:0),u()},t.prototype.eval_lessequal=function(t){this.first.get(t);var e=l();this.second.get(e),t.set_int(t.data<=e.data?1:0),u()},t.prototype.eval_greater=function(t){this.first.get(t);var e=l();this.second.get(e),t.set_int(t.data>e.data?1:0),u()},t.prototype.eval_greaterequal=function(t){this.first.get(t);var e=l();this.second.get(e),t.set_int(t.data>=e.data?1:0),u()},t.prototype.eval_eventvar_exp=function(t){var e=this.eventvar.getValue();cr.is_number(e)?t.set_float(e):t.set_string(e)},cr.expNode=t,n.prototype.is_int=function(){return this.type===cr.exptype.Integer},n.prototype.is_float=function(){return this.type===cr.exptype.Float},n.prototype.is_number=function(){return this.type===cr.exptype.Integer||this.type===cr.exptype.Float},n.prototype.is_string=function(){return this.type===cr.exptype.String},n.prototype.make_int=function(){this.is_int()||(this.is_float()?this.data=Math.floor(this.data):this.is_string()&&(this.data=parseInt(this.data,10)),this.type=cr.exptype.Integer)},n.prototype.make_float=function(){this.is_float()||(this.is_string()&&(this.data=parseFloat(this.data)),this.type=cr.exptype.Float)},n.prototype.make_string=function(){this.is_string()||(this.data=this.data.toString(),this.type=cr.exptype.String)},n.prototype.set_int=function(t){this.type=cr.exptype.Integer,this.data=Math.floor(t)},n.prototype.set_float=function(t){this.type=cr.exptype.Float,this.data=t},n.prototype.set_string=function(t){this.type=cr.exptype.String,this.data=t},n.prototype.set_any=function(t){cr.is_number(t)?(this.type=cr.exptype.Float,this.data=t):cr.is_string(t)?(this.type=cr.exptype.String,this.data=t.toString()):(this.type=cr.exptype.Integer,this.data=0)},cr.expvalue=n,cr.exptype={Integer:0,Float:1,String:2}}(),cr.system_object=function(t){this.runtime=t,this.waits=[]},cr.system_object.prototype.saveToJSON=function(){for(var t,e,i,n,r,s,o,a={waits:[]},h=a.waits,c=0,l=this.waits.length;c<l;c++){for(o={t:(n=this.waits[c]).time,st:n.signaltag,s:n.signalled,ev:n.ev.sid,sm:[],sols:{}},n.ev.actions[n.actindex]&&(o.act=n.ev.actions[n.actindex].sid),t=0,e=n.solModifiers.length;t<e;t++)o.sm.push(n.solModifiers[t].sid);for(i in n.sols)if(n.sols.hasOwnProperty(i)){for(r=this.runtime.types_by_index[parseInt(i,10)],s={sa:n.sols[i].sa,insts:[]},t=0,e=n.sols[i].insts.length;t<e;t++)s.insts.push(n.sols[i].insts[t].uid);o.sols[r.sid.toString()]=s}h.push(o)}return a},cr.system_object.prototype.loadFromJSON=function(t){var e,i,n,r,s,o,a,h,c,l,u,p,d,f=t.waits;for(cr.clearArray(this.waits),e=0,i=f.length;e<i;e++)if(o=f[e],h=this.runtime.blocksBySid[o.ev.toString()]){for(c=-1,n=0,r=h.actions.length;n<r;n++)if(h.actions[n].sid===o.act){c=n;break}if(-1!==c){for((a={sols:{},solModifiers:[],deleteme:!1}).time=o.t,a.signaltag=o.st||"",a.signalled=!!o.s,a.ev=h,a.actindex=c,n=0,r=o.sm.length;n<r;n++)(l=this.runtime.getObjectTypeBySid(o.sm[n]))&&a.solModifiers.push(l);for(s in o.sols)if(o.sols.hasOwnProperty(s)&&(l=this.runtime.getObjectTypeBySid(parseInt(s,10)))){for(p={sa:(u=o.sols[s]).sa,insts:[]},n=0,r=u.insts.length;n<r;n++)(d=this.runtime.getObjectByUID(u.insts[n]))&&p.insts.push(d);a.sols[l.index.toString()]=p}this.waits.push(a)}}},function(){var t=cr.system_object.prototype;function e(){}e.prototype.EveryTick=function(){return!0},e.prototype.OnLayoutStart=function(){return!0},e.prototype.OnLayoutEnd=function(){return!0},e.prototype.Compare=function(t,e,i){return cr.do_cmp(t,e,i)},e.prototype.CompareTime=function(t,e){var i=this.runtime.kahanTime.sum;if(0!==t)return cr.do_cmp(i,t,e);t=this.runtime.getCurrentCondition();return!t.extra.CompareTime_executed&&e<=i&&(t.extra.CompareTime_executed=!0)},e.prototype.LayerVisible=function(t){return!!t&&t.visible},e.prototype.LayerEmpty=function(t){return!!t&&!t.instances.length},e.prototype.LayerCmpOpacity=function(t,e,i){return!!t&&cr.do_cmp(100*t.opacity,e,i)},e.prototype.Repeat=function(t){var e,i=this.runtime.getCurrentEventStack(),n=i.current_event,i=i.isModifierAfterCnds(),r=this.runtime.pushLoopStack();if(i)for(e=0;e<t&&!r.stopped;e++)this.runtime.pushCopySol(n.solModifiers),r.index=e,n.retrigger(),this.runtime.popSol(n.solModifiers);else for(e=0;e<t&&!r.stopped;e++)r.index=e,n.retrigger();return this.runtime.popLoopStack(),!1},e.prototype.While=function(t){var e,i=this.runtime.getCurrentEventStack(),n=i.current_event,i=i.isModifierAfterCnds(),r=this.runtime.pushLoopStack();if(i)for(e=0;!r.stopped;e++)this.runtime.pushCopySol(n.solModifiers),r.index=e,n.retrigger()||(r.stopped=!0),this.runtime.popSol(n.solModifiers);else for(e=0;!r.stopped;e++)r.index=e,n.retrigger()||(r.stopped=!0);return this.runtime.popLoopStack(),!1},e.prototype.For=function(t,e,i){var n,r=this.runtime.getCurrentEventStack(),s=r.current_event,r=r.isModifierAfterCnds(),o=this.runtime.pushLoopStack(t);if(i<e)if(r)for(n=e;i<=n&&!o.stopped;--n)this.runtime.pushCopySol(s.solModifiers),o.index=n,s.retrigger(),this.runtime.popSol(s.solModifiers);else for(n=e;i<=n&&!o.stopped;--n)o.index=n,s.retrigger();else if(r)for(n=e;n<=i&&!o.stopped;++n)this.runtime.pushCopySol(s.solModifiers),o.index=n,s.retrigger(),this.runtime.popSol(s.solModifiers);else for(n=e;n<=i&&!o.stopped;++n)o.index=n,s.retrigger();return this.runtime.popLoopStack(),!1};var m=[],_=-1;function v(t,e){t=t.extra.c2_feo_val,e=e.extra.c2_feo_val;return cr.is_number(t)&&cr.is_number(e)?t-e:(t=""+t)<(e=""+e)?-1:e<t?1:0}e.prototype.ForEach=function(t){var e=t.getCurrentSol();_++,m.length===_&&m.push([]);var i=m[_];cr.shallowAssignArray(i,e.getObjects());var n,r,s,o,a,h,c,l=this.runtime.getCurrentEventStack(),u=l.current_event,l=l.isModifierAfterCnds(),p=this.runtime.pushLoopStack(),d=t.is_contained;if(l)for(n=0,r=i.length;n<r&&!p.stopped;n++){if(this.runtime.pushCopySol(u.solModifiers),a=i[n],(e=t.getCurrentSol()).select_all=!1,cr.clearArray(e.instances),e.instances[0]=a,d)for(s=0,o=a.siblings.length;s<o;s++)(c=(h=a.siblings[s]).type.getCurrentSol()).select_all=!1,cr.clearArray(c.instances),c.instances[0]=h;p.index=n,u.retrigger(),this.runtime.popSol(u.solModifiers)}else for(e.select_all=!1,cr.clearArray(e.instances),n=0,r=i.length;n<r&&!p.stopped;n++){if(a=i[n],e.instances[0]=a,d)for(s=0,o=a.siblings.length;s<o;s++)(c=(h=a.siblings[s]).type.getCurrentSol()).select_all=!1,cr.clearArray(c.instances),c.instances[0]=h;p.index=n,u.retrigger()}return cr.clearArray(i),this.runtime.popLoopStack(),_--,!1},e.prototype.ForEachOrdered=function(t,e,i){var n=t.getCurrentSol();_++,m.length===_&&m.push([]);var r=m[_];cr.shallowAssignArray(r,n.getObjects());for(var s,o,a,h,c,l=this.runtime.getCurrentEventStack(),u=l.current_event,p=this.runtime.getCurrentCondition(),l=l.isModifierAfterCnds(),d=this.runtime.pushLoopStack(),f=0,y=r.length;f<y;f++)r[f].extra.c2_feo_val=p.parameters[1].get(f);r.sort(v),1===i&&r.reverse();var g=t.is_contained;if(l)for(f=0,y=r.length;f<y&&!d.stopped;f++){if(this.runtime.pushCopySol(u.solModifiers),a=r[f],(n=t.getCurrentSol()).select_all=!1,cr.clearArray(n.instances),n.instances[0]=a,g)for(s=0,o=a.siblings.length;s<o;s++)(c=(h=a.siblings[s]).type.getCurrentSol()).select_all=!1,cr.clearArray(c.instances),c.instances[0]=h;d.index=f,u.retrigger(),this.runtime.popSol(u.solModifiers)}else for(n.select_all=!1,cr.clearArray(n.instances),f=0,y=r.length;f<y&&!d.stopped;f++){if(a=r[f],n.instances[0]=a,g)for(s=0,o=a.siblings.length;s<o;s++)(c=(h=a.siblings[s]).type.getCurrentSol()).select_all=!1,cr.clearArray(c.instances),c.instances[0]=h;d.index=f,u.retrigger()}return cr.clearArray(r),this.runtime.popLoopStack(),_--,!1},e.prototype.PickByComparison=function(t,e,i,n){var r;if(t){_++,m.length===_&&m.push([]);var s=m[_],o=t.getCurrentSol();cr.shallowAssignArray(s,o.getObjects()),o.select_all&&cr.clearArray(o.else_instances);for(var a=this.runtime.getCurrentCondition(),h=0,c=0,l=s.length;h<l;h++)r=s[h],s[c]=r,e=a.parameters[1].get(h),n=a.parameters[3].get(h),cr.do_cmp(e,i,n)?c++:o.else_instances.push(r);return cr.truncateArray(s,c),o.select_all=!1,cr.shallowAssignArray(o.instances,s),cr.clearArray(s),_--,t.applySolToContainer(),!!o.instances.length}},e.prototype.PickByEvaluate=function(t,e){var i;if(t){_++,m.length===_&&m.push([]);var n=m[_],r=t.getCurrentSol();cr.shallowAssignArray(n,r.getObjects()),r.select_all&&cr.clearArray(r.else_instances);for(var s=this.runtime.getCurrentCondition(),o=0,a=0,h=n.length;o<h;o++)i=n[o],n[a]=i,s.parameters[1].get(o)?a++:r.else_instances.push(i);return cr.truncateArray(n,a),r.select_all=!1,cr.shallowAssignArray(r.instances,n),cr.clearArray(n),_--,t.applySolToContainer(),!!r.instances.length}},e.prototype.TriggerOnce=function(){var t=this.runtime.getCurrentCondition().extra;void 0===t.TriggerOnce_lastTick&&(t.TriggerOnce_lastTick=-1);var e=t.TriggerOnce_lastTick,i=this.runtime.tickcount;return t.TriggerOnce_lastTick=i,this.runtime.layout_first_tick||e!==i-1},e.prototype.Every=function(t){var e=this.runtime.getCurrentCondition(),i=e.extra.Every_lastTime||0,n=this.runtime.kahanTime.sum;void 0===e.extra.Every_seconds&&(e.extra.Every_seconds=t);var r=e.extra.Every_seconds;return i+r<=n?(e.extra.Every_lastTime=i+r,n>=e.extra.Every_lastTime+.04&&(e.extra.Every_lastTime=n),e.extra.Every_seconds=t,!0):(n<i-.1&&(e.extra.Every_lastTime=n),!1)},e.prototype.PickNth=function(t,e){if(!t)return!1;var i=t.getCurrentSol(),n=i.getObjects();if((e=cr.floor(e))<0||e>=n.length)return!1;e=n[e];return i.pick_one(e),t.applySolToContainer(),!0},e.prototype.PickRandom=function(t){if(!t)return!1;var e=t.getCurrentSol(),i=e.getObjects(),n=cr.floor(Math.random()*i.length);if(n>=i.length)return!1;n=i[n];return e.pick_one(n),t.applySolToContainer(),!0},e.prototype.CompareVar=function(t,e,i){return cr.do_cmp(t.getValue(),e,i)},e.prototype.IsGroupActive=function(t){t=this.runtime.groups_by_name[t.toLowerCase()];return t&&t.group_active},e.prototype.IsPreview=function(){return"undefined"!=typeof cr_is_preview},e.prototype.PickAll=function(t){return!!t&&(!!t.instances.length&&(t.getCurrentSol().select_all=!0,t.applySolToContainer(),!0))},e.prototype.IsMobile=function(){return this.runtime.isMobile},e.prototype.CompareBetween=function(t,e,i){return e<=t&&t<=i},e.prototype.Else=function(){var t=this.runtime.getCurrentEventStack();return!t.else_branch_ran&&!t.last_event_true},e.prototype.OnLoadFinished=function(){return!0},e.prototype.OnCanvasSnapshot=function(){return!0},e.prototype.EffectsSupported=function(){return!!this.runtime.glwrap},e.prototype.OnSaveComplete=function(){return!0},e.prototype.OnSaveFailed=function(){return!0},e.prototype.OnLoadComplete=function(){return!0},e.prototype.OnLoadFailed=function(){return!0},e.prototype.ObjectUIDExists=function(t){return!!this.runtime.getObjectByUID(t)},e.prototype.IsOnPlatform=function(t){var e=this.runtime;switch(t){case 0:return!(e.isDomFree||e.isNodeWebkit||e.isCordova||e.isWinJS||e.isWindowsPhone8||e.isBlackberry10||e.isAmazonWebApp);case 1:return e.isiOS;case 2:return e.isAndroid;case 3:return e.isWindows8App;case 4:return e.isWindowsPhone8;case 5:return e.isBlackberry10;case 6:return e.isTizen;case 7:return e.isCocoonJs;case 8:return e.isCordova;case 9:return e.isArcade;case 10:return e.isNodeWebkit;case 11:return e.isCrosswalk;case 12:return e.isAmazonWebApp;case 13:return e.isWindows10;default:return!1}};var i=null,n="",r="";function s(t,e){return i&&t===n&&e===r||(i=new RegExp(t,e),n=t,r=e),i.lastIndex=0,i}e.prototype.RegexTest=function(t,e,i){return s(e,i).test(t)};var l=[];function o(){}e.prototype.PickOverlappingPoint=function(t,e,i){if(!t)return!1;var n,r,s,o=t.getCurrentSol(),a=o.getObjects(),h=this.runtime.getCurrentEventStack().current_event.orblock,c=this.runtime.getCurrentCondition();for(o.select_all?(cr.shallowAssignArray(l,a),cr.clearArray(o.else_instances),o.select_all=!1,cr.clearArray(o.instances)):h?(cr.shallowAssignArray(l,o.else_instances),cr.clearArray(o.else_instances)):(cr.shallowAssignArray(l,a),cr.clearArray(o.instances)),n=0,r=l.length;n<r;++n)(s=l[n]).update_bbox(),(cr.xor(s.contains_pt(e,i),c.inverted)?o.instances:o.else_instances).push(s);return t.applySolToContainer(),cr.xor(!!o.instances.length,c.inverted)},e.prototype.IsNaN=function(t){return!!isNaN(t)},e.prototype.AngleWithin=function(t,e,i){return cr.angleDiff(cr.to_radians(t),cr.to_radians(i))<=cr.to_radians(e)},e.prototype.IsClockwiseFrom=function(t,e){return cr.angleClockwise(cr.to_radians(t),cr.to_radians(e))},e.prototype.IsBetweenAngles=function(t,e,i){t=cr.to_clamped_radians(t),e=cr.to_clamped_radians(e),i=cr.to_clamped_radians(i);return!cr.angleClockwise(i,e)?!(!cr.angleClockwise(t,e)&&cr.angleClockwise(t,i)):cr.angleClockwise(t,e)&&!cr.angleClockwise(t,i)},e.prototype.IsValueType=function(t,e){return"number"==typeof t?0===e:1===e},t.cnds=new e,o.prototype.GoToLayout=function(t){this.runtime.isloading||this.runtime.changelayout||(this.runtime.changelayout=t)},o.prototype.NextPrevLayout=function(t){var e;this.runtime.isloading||this.runtime.changelayout||(e=this.runtime.layouts_by_index.indexOf(this.runtime.running_layout),t&&0===e||!t&&e===this.runtime.layouts_by_index.length-1||(t=this.runtime.layouts_by_index[e+(t?-1:1)],this.runtime.changelayout=t))},o.prototype.CreateObject=function(t,e,i,n){if(e&&t){var r,s,o,a=this.runtime.createInstance(t,e,i,n);if(a){if(this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(t.plugin).cnds.OnCreated,a),a.is_contained)for(r=0,s=a.siblings.length;r<s;r++)o=a.siblings[r],this.runtime.trigger(Object.getPrototypeOf(o.type.plugin).cnds.OnCreated,o);this.runtime.isInOnDestroy--;var h=t.getCurrentSol();if(h.select_all=!1,cr.clearArray(h.instances),(h.instances[0]=a).is_contained)for(r=0,s=a.siblings.length;r<s;r++)(h=(o=a.siblings[r]).type.getCurrentSol()).select_all=!1,cr.clearArray(h.instances),h.instances[0]=o}}},o.prototype.SetLayerVisible=function(t,e){t&&t.visible!==e&&(t.visible=e,this.runtime.redraw=!0)},o.prototype.SetLayerOpacity=function(t,e){t&&(e=cr.clamp(e/100,0,1),t.opacity!==e&&(t.opacity=e,this.runtime.redraw=!0))},o.prototype.SetLayerScaleRate=function(t,e){t&&t.zoomRate!==e&&(t.zoomRate=e,this.runtime.redraw=!0)},o.prototype.SetLayerForceOwnTexture=function(t,e){t&&(e=!!e,t.forceOwnTexture!==e&&(t.forceOwnTexture=e,this.runtime.redraw=!0))},o.prototype.SetLayoutScale=function(t){this.runtime.running_layout&&this.runtime.running_layout.scale!==t&&(this.runtime.running_layout.scale=t,this.runtime.running_layout.boundScrolling(),this.runtime.redraw=!0)},o.prototype.ScrollX=function(t){this.runtime.running_layout.scrollToX(t)},o.prototype.ScrollY=function(t){this.runtime.running_layout.scrollToY(t)},o.prototype.Scroll=function(t,e){this.runtime.running_layout.scrollToX(t),this.runtime.running_layout.scrollToY(e)},o.prototype.ScrollToObject=function(t){t=t.getFirstPicked();t&&(this.runtime.running_layout.scrollToX(t.x),this.runtime.running_layout.scrollToY(t.y))},o.prototype.SetVar=function(t,e){0===t.vartype?cr.is_number(e)?t.setValue(e):t.setValue(parseFloat(e)):1===t.vartype&&t.setValue(e.toString())},o.prototype.AddVar=function(t,e){0===t.vartype?cr.is_number(e)?t.setValue(t.getValue()+e):t.setValue(t.getValue()+parseFloat(e)):1===t.vartype&&t.setValue(t.getValue()+e.toString())},o.prototype.SubVar=function(t,e){0===t.vartype&&(cr.is_number(e)?t.setValue(t.getValue()-e):t.setValue(t.getValue()-parseFloat(e)))},o.prototype.SetGroupActive=function(t,e){var i=this.runtime.groups_by_name[t.toLowerCase()];if(i)switch(e){case 0:i.setGroupActive(!1);break;case 1:i.setGroupActive(!0);break;case 2:i.setGroupActive(!i.group_active)}},o.prototype.SetTimescale=function(t){t<0&&(t=0),this.runtime.timescale=t},o.prototype.SetObjectTimescale=function(t,e){var i=e;if(i<0&&(i=0),t)for(var n=t.getCurrentSol().getObjects(),r=0,s=n.length;r<s;r++)n[r].my_timescale=i},o.prototype.RestoreObjectTimescale=function(t){if(!t)return!1;for(var e=t.getCurrentSol().getObjects(),i=0,n=e.length;i<n;i++)e[i].my_timescale=-1};var c=[];function a(){var t=c.length?c.pop():{sols:{},solModifiers:[]};return t.deleteme=!1,t}var u=[];function h(){var t=u.length?u.pop():{insts:[]};return t.sa=!1,t}function f(t,e){var i=t[0]-e[0];return 0!=i?i:t[1]-e[1]}function y(t,e){return t[1]-e[1]}function p(){}o.prototype.Wait=function(t){if(!(t<0)){var e,i,n,r,s=this.runtime.getCurrentEventStack(),o=a();for(o.time=this.runtime.kahanTime.sum+t,o.signaltag="",o.signalled=!1,o.ev=s.current_event,o.actindex=s.actindex+1,e=0,i=this.runtime.types_by_index.length;e<i;e++)(n=(r=this.runtime.types_by_index[e]).getCurrentSol()).select_all&&-1===s.current_event.solModifiers.indexOf(r)||(o.solModifiers.push(r),(r=h()).sa=n.select_all,cr.shallowAssignArray(r.insts,n.instances),o.sols[e.toString()]=r);return this.waits.push(o),!0}},o.prototype.WaitForSignal=function(t){var e,i,n,r,s=this.runtime.getCurrentEventStack(),o=a();for(o.time=-1,o.signaltag=t.toLowerCase(),o.signalled=!1,o.ev=s.current_event,o.actindex=s.actindex+1,e=0,i=this.runtime.types_by_index.length;e<i;e++)(n=(r=this.runtime.types_by_index[e]).getCurrentSol()).select_all&&-1===s.current_event.solModifiers.indexOf(r)||(o.solModifiers.push(r),(r=h()).sa=n.select_all,cr.shallowAssignArray(r.insts,n.instances),o.sols[e.toString()]=r);return this.waits.push(o),!0},o.prototype.Signal=function(t){for(var e,i=t.toLowerCase(),n=0,r=this.waits.length;n<r;++n)-1===(e=this.waits[n]).time&&e.signaltag===i&&(e.signalled=!0)},o.prototype.SetLayerScale=function(t,e){t&&t.scale!==e&&(t.scale=e,this.runtime.redraw=!0)},o.prototype.ResetGlobals=function(){for(var t,e=0,i=this.runtime.all_global_vars.length;e<i;e++)(t=this.runtime.all_global_vars[e]).data=t.initial},o.prototype.SetLayoutAngle=function(t){t=cr.to_radians(t),t=cr.clamp_angle(t),this.runtime.running_layout&&this.runtime.running_layout.angle!==t&&(this.runtime.running_layout.angle=t,this.runtime.redraw=!0)},o.prototype.SetLayerAngle=function(t,e){t&&(e=cr.to_radians(e),e=cr.clamp_angle(e),t.angle!==e&&(t.angle=e,this.runtime.redraw=!0))},o.prototype.SetLayerParallax=function(t,e,i){if(t&&(t.parallaxX!==e/100||t.parallaxY!==i/100)){if(t.parallaxX=e/100,t.parallaxY=i/100,1!==t.parallaxX||1!==t.parallaxY)for(var n=t.instances,r=0,s=n.length;r<s;++r)n[r].type.any_instance_parallaxed=!0;this.runtime.redraw=!0}},o.prototype.SetLayerBackground=function(t,e){var i,n;t&&(i=cr.GetRValue(e),n=cr.GetGValue(e),e=cr.GetBValue(e),t.background_color[0]===i&&t.background_color[1]===n&&t.background_color[2]===e||(t.background_color[0]=i,t.background_color[1]=n,t.background_color[2]=e,this.runtime.redraw=!0))},o.prototype.SetLayerTransparent=function(t,e){t&&!!e!=!!t.transparent&&(t.transparent=!!e,this.runtime.redraw=!0)},o.prototype.SetLayerBlendMode=function(t,e){t&&t.blend_mode!==e&&(t.blend_mode=e,t.compositeOp=cr.effectToCompositeOp(t.blend_mode),this.runtime.gl&&cr.setGLBlend(t,t.blend_mode,this.runtime.gl),this.runtime.redraw=!0)},o.prototype.StopLoop=function(){this.runtime.loop_stack_index<0||(this.runtime.getCurrentLoop().stopped=!0)},o.prototype.GoToLayoutByName=function(t){if(!this.runtime.isloading&&!this.runtime.changelayout)for(var e in this.runtime.layouts)if(this.runtime.layouts.hasOwnProperty(e)&&cr.equals_nocase(e,t))return void(this.runtime.changelayout=this.runtime.layouts[e])},o.prototype.RestartLayout=function(t){var e,i,n;if(!this.runtime.isloading&&(!this.runtime.changelayout&&this.runtime.running_layout))for(this.runtime.changelayout=this.runtime.running_layout,e=0,i=this.runtime.allGroups.length;e<i;e++)(n=this.runtime.allGroups[e]).setGroupActive(n.initially_activated)},o.prototype.SnapshotCanvas=function(t,e){this.runtime.doCanvasSnapshot(0===t?"image/png":"image/jpeg",e/100)},o.prototype.SetCanvasSize=function(t,e){var i;t<=0||e<=0||(i=this.runtime.fullscreen_mode,(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.runtime.isNodeFullscreen)&&0<this.runtime.fullscreen_scaling&&(i=this.runtime.fullscreen_scaling),0===i?this.runtime.setSize(t,e,!0):(this.runtime.original_width=t,this.runtime.original_height=e,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0)))},o.prototype.SetLayoutEffectEnabled=function(t,e){this.runtime.running_layout&&this.runtime.glwrap&&((e=this.runtime.running_layout.getEffectByName(e))&&(t=1===t,e.active!=t&&(e.active=t,this.runtime.running_layout.updateActiveEffects(),this.runtime.redraw=!0)))},o.prototype.SetLayerEffectEnabled=function(t,e,i){t&&this.runtime.glwrap&&((i=t.getEffectByName(i))&&(e=1===e,i.active!=e&&(i.active=e,t.updateActiveEffects(),this.runtime.redraw=!0)))},o.prototype.SetLayoutEffectParam=function(t,e,i){var n;this.runtime.running_layout&&this.runtime.glwrap&&((n=this.runtime.running_layout.getEffectByName(t))&&(t=this.runtime.running_layout.effect_params[n.index],(e=Math.floor(e))<0||e>=t.length||(1===this.runtime.glwrap.getProgramParameterType(n.shaderindex,e)&&(i/=100),t[e]!==i&&(t[e]=i,n.active&&(this.runtime.redraw=!0)))))},o.prototype.SetLayerEffectParam=function(t,e,i,n){t&&this.runtime.glwrap&&((e=t.getEffectByName(e))&&(t=t.effect_params[e.index],(i=Math.floor(i))<0||i>=t.length||(1===this.runtime.glwrap.getProgramParameterType(e.shaderindex,i)&&(n/=100),t[i]!==n&&(t[i]=n,e.active&&(this.runtime.redraw=!0)))))},o.prototype.SaveState=function(t){this.runtime.saveToSlot=t},o.prototype.LoadState=function(t){this.runtime.loadFromSlot=t},o.prototype.LoadStateJSON=function(t){this.runtime.loadFromJson=t},o.prototype.SetHalfFramerateMode=function(t){this.runtime.halfFramerateMode=0!==t},o.prototype.SetFullscreenQuality=function(t){(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.isNodeFullscreen||0!==this.runtime.fullscreen_mode)&&(this.runtime.wantFullscreenScalingQuality=0!==t,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))},o.prototype.ResetPersisted=function(){for(var t=0,e=this.runtime.layouts_by_index.length;t<e;++t)this.runtime.layouts_by_index[t].persist_data={},this.runtime.layouts_by_index[t].first_visit=!0},o.prototype.RecreateInitialObjects=function(t,e,i,n,r){t&&this.runtime.running_layout.recreateInitialObjects(t,e,i,n,r)},o.prototype.SetPixelRounding=function(t){this.runtime.pixel_rounding=0!==t,this.runtime.redraw=!0},o.prototype.SetMinimumFramerate=function(t){t<1&&(t=1),120<t&&(t=120),this.runtime.minimumFramerate=t},o.prototype.SortZOrderByInstVar=function(t,e){if(t){for(var i,n,r,s,o=t.getCurrentSol().getObjects(),a=[],h=[],c=this.runtime.running_layout,l=t.is_family,u=t.family_index,p=0,d=o.length;p<d;++p)(i=o[p]).layer&&(n=l?i.instance_vars[e+i.type.family_var_map[u]]:i.instance_vars[e],a.push([i.layer.index,i.get_zindex()]),h.push([i,n]));if(a.length)for(a.sort(f),h.sort(y),p=0,d=a.length;p<d;++p)i=h[p][0],r=c.layers[a[p][0]],s=a[p][1],r.instances[s]!==i&&((r.instances[s]=i).layer=r).setZIndicesStaleFrom(s)}},t.acts=new o,p.prototype.int=function(t,e){cr.is_string(e)?(t.set_int(parseInt(e,10)),isNaN(t.data)&&(t.data=0)):t.set_int(e)},p.prototype.float=function(t,e){cr.is_string(e)?(t.set_float(parseFloat(e)),isNaN(t.data)&&(t.data=0)):t.set_float(e)},p.prototype.str=function(t,e){cr.is_string(e)?t.set_string(e):t.set_string(e.toString())},p.prototype.len=function(t,e){t.set_int(e.length||0)},p.prototype.random=function(t,e,i){void 0===i?t.set_float(Math.random()*e):t.set_float(Math.random()*(i-e)+e)},p.prototype.sqrt=function(t,e){t.set_float(Math.sqrt(e))},p.prototype.abs=function(t,e){t.set_float(Math.abs(e))},p.prototype.round=function(t,e){t.set_int(Math.round(e))},p.prototype.floor=function(t,e){t.set_int(Math.floor(e))},p.prototype.ceil=function(t,e){t.set_int(Math.ceil(e))},p.prototype.sin=function(t,e){t.set_float(Math.sin(cr.to_radians(e)))},p.prototype.cos=function(t,e){t.set_float(Math.cos(cr.to_radians(e)))},p.prototype.tan=function(t,e){t.set_float(Math.tan(cr.to_radians(e)))},p.prototype.asin=function(t,e){t.set_float(cr.to_degrees(Math.asin(e)))},p.prototype.acos=function(t,e){t.set_float(cr.to_degrees(Math.acos(e)))},p.prototype.atan=function(t,e){t.set_float(cr.to_degrees(Math.atan(e)))},p.prototype.exp=function(t,e){t.set_float(Math.exp(e))},p.prototype.ln=function(t,e){t.set_float(Math.log(e))},p.prototype.log10=function(t,e){t.set_float(Math.log(e)/Math.LN10)},p.prototype.max=function(t){var e,i,n,r=arguments[1];for("number"!=typeof r&&(r=0),e=2,i=arguments.length;e<i;e++)"number"==typeof(n=arguments[e])&&r<n&&(r=n);t.set_float(r)},p.prototype.min=function(t){var e,i,n,r=arguments[1];for("number"!=typeof r&&(r=0),e=2,i=arguments.length;e<i;e++)"number"==typeof(n=arguments[e])&&n<r&&(r=n);t.set_float(r)},p.prototype.dt=function(t){t.set_float(this.runtime.dt)},p.prototype.timescale=function(t){t.set_float(this.runtime.timescale)},p.prototype.wallclocktime=function(t){t.set_float((Date.now()-this.runtime.start_time)/1e3)},p.prototype.time=function(t){t.set_float(this.runtime.kahanTime.sum)},p.prototype.tickcount=function(t){t.set_int(this.runtime.tickcount)},p.prototype.objectcount=function(t){t.set_int(this.runtime.objectcount)},p.prototype.fps=function(t){t.set_int(this.runtime.fps)},p.prototype.loopindex=function(t,e){var i,n;if(this.runtime.loop_stack.length)if(e){for(n=this.runtime.loop_stack_index;0<=n;--n)if((i=this.runtime.loop_stack[n]).name===e)return void t.set_int(i.index);t.set_int(0)}else i=this.runtime.getCurrentLoop(),t.set_int(i?i.index:-1);else t.set_int(0)},p.prototype.distance=function(t,e,i,n,r){t.set_float(cr.distanceTo(e,i,n,r))},p.prototype.angle=function(t,e,i,n,r){t.set_float(cr.to_degrees(cr.angleTo(e,i,n,r)))},p.prototype.scrollx=function(t){t.set_float(this.runtime.running_layout.scrollX)},p.prototype.scrolly=function(t){t.set_float(this.runtime.running_layout.scrollY)},p.prototype.newline=function(t){t.set_string("\n")},p.prototype.lerp=function(t,e,i,n){t.set_float(cr.lerp(e,i,n))},p.prototype.qarp=function(t,e,i,n,r){t.set_float(cr.qarp(e,i,n,r))},p.prototype.cubic=function(t,e,i,n,r,s){t.set_float(cr.cubic(e,i,n,r,s))},p.prototype.cosp=function(t,e,i,n){t.set_float(cr.cosp(e,i,n))},p.prototype.windowwidth=function(t){t.set_int(this.runtime.width)},p.prototype.windowheight=function(t){t.set_int(this.runtime.height)},p.prototype.uppercase=function(t,e){t.set_string(cr.is_string(e)?e.toUpperCase():"")},p.prototype.lowercase=function(t,e){t.set_string(cr.is_string(e)?e.toLowerCase():"")},p.prototype.clamp=function(t,e,i,n){e<i?t.set_float(i):n<e?t.set_float(n):t.set_float(e)},p.prototype.layerscale=function(t,e){e=this.runtime.getLayer(e);e?t.set_float(e.scale):t.set_float(0)},p.prototype.layeropacity=function(t,e){e=this.runtime.getLayer(e);e?t.set_float(100*e.opacity):t.set_float(0)},p.prototype.layerscalerate=function(t,e){e=this.runtime.getLayer(e);e?t.set_float(e.zoomRate):t.set_float(0)},p.prototype.layerparallaxx=function(t,e){e=this.runtime.getLayer(e);e?t.set_float(100*e.parallaxX):t.set_float(0)},p.prototype.layerparallaxy=function(t,e){e=this.runtime.getLayer(e);e?t.set_float(100*e.parallaxY):t.set_float(0)},p.prototype.layerindex=function(t,e){e=this.runtime.getLayer(e);e?t.set_int(e.index):t.set_int(-1)},p.prototype.layoutscale=function(t){this.runtime.running_layout?t.set_float(this.runtime.running_layout.scale):t.set_float(0)},p.prototype.layoutangle=function(t){t.set_float(cr.to_degrees(this.runtime.running_layout.angle))},p.prototype.layerangle=function(t,e){e=this.runtime.getLayer(e);e?t.set_float(cr.to_degrees(e.angle)):t.set_float(0)},p.prototype.layoutwidth=function(t){t.set_int(this.runtime.running_layout.width)},p.prototype.layoutheight=function(t){t.set_int(this.runtime.running_layout.height)},p.prototype.find=function(t,e,i){cr.is_string(e)&&cr.is_string(i)?t.set_int(e.search(new RegExp(cr.regexp_escape(i),"i"))):t.set_int(-1)},p.prototype.findcase=function(t,e,i){cr.is_string(e)&&cr.is_string(i)?t.set_int(e.search(new RegExp(cr.regexp_escape(i),""))):t.set_int(-1)},p.prototype.left=function(t,e,i){t.set_string(cr.is_string(e)?e.substr(0,i):"")},p.prototype.right=function(t,e,i){t.set_string(cr.is_string(e)?e.substr(e.length-i):"")},p.prototype.mid=function(t,e,i,n){t.set_string(cr.is_string(e)?e.substr(i,n):"")},p.prototype.tokenat=function(t,e,i,n){cr.is_string(e)&&cr.is_string(n)?(n=e.split(n),(i=cr.floor(i))<0||i>=n.length?t.set_string(""):t.set_string(n[i])):t.set_string("")},p.prototype.tokencount=function(t,e,i){cr.is_string(e)&&e.length?t.set_int(e.split(i).length):t.set_int(0)},p.prototype.replace=function(t,e,i,n){cr.is_string(e)&&cr.is_string(i)&&cr.is_string(n)?t.set_string(e.replace(new RegExp(cr.regexp_escape(i),"gi"),n)):t.set_string(cr.is_string(e)?e:"")},p.prototype.trim=function(t,e){t.set_string(cr.is_string(e)?e.trim():"")},p.prototype.pi=function(t){t.set_float(cr.PI)},p.prototype.layoutname=function(t){this.runtime.running_layout?t.set_string(this.runtime.running_layout.name):t.set_string("")},p.prototype.renderer=function(t){t.set_string(this.runtime.gl?"webgl":"canvas2d")},p.prototype.rendererdetail=function(t){t.set_string(this.runtime.glUnmaskedRenderer)},p.prototype.anglediff=function(t,e,i){t.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(e),cr.to_radians(i))))},p.prototype.choose=function(t){var e=cr.floor(Math.random()*(arguments.length-1));t.set_any(arguments[e+1])},p.prototype.rgb=function(t,e,i,n){t.set_int(cr.RGB(e,i,n))},p.prototype.projectversion=function(t){t.set_string(this.runtime.versionstr)},p.prototype.projectname=function(t){t.set_string(this.runtime.projectName)},p.prototype.anglelerp=function(t,e,i,n){e=cr.to_radians(e),i=cr.to_radians(i);var r=cr.angleDiff(e,i);cr.angleClockwise(i,e)?t.set_float(cr.to_clamped_degrees(e+r*n)):t.set_float(cr.to_clamped_degrees(e-r*n))},p.prototype.anglerotate=function(t,e,i,n){e=cr.to_radians(e),i=cr.to_radians(i),n=cr.to_radians(n),t.set_float(cr.to_clamped_degrees(cr.angleRotate(e,i,n)))},p.prototype.zeropad=function(t,e,i){var n=e<0?"-":"";e<0&&(e=-e);for(var r=i-e.toString().length,s=0;s<r;s++)n+="0";t.set_string(n+e.toString())},p.prototype.cpuutilisation=function(t){t.set_float(this.runtime.cpuutilisation/1e3)},p.prototype.viewportleft=function(t,e){e=this.runtime.getLayer(e);t.set_float(e?e.viewLeft:0)},p.prototype.viewporttop=function(t,e){e=this.runtime.getLayer(e);t.set_float(e?e.viewTop:0)},p.prototype.viewportright=function(t,e){e=this.runtime.getLayer(e);t.set_float(e?e.viewRight:0)},p.prototype.viewportbottom=function(t,e){e=this.runtime.getLayer(e);t.set_float(e?e.viewBottom:0)},p.prototype.loadingprogress=function(t){t.set_float(this.runtime.loadingprogress)},p.prototype.unlerp=function(t,e,i,n){t.set_float(cr.unlerp(e,i,n))},p.prototype.canvassnapshot=function(t){t.set_string(this.runtime.snapshotData)},p.prototype.urlencode=function(t,e){t.set_string(encodeURIComponent(e))},p.prototype.urldecode=function(t,e){t.set_string(decodeURIComponent(e))},p.prototype.canvastolayerx=function(t,e,i,n){e=this.runtime.getLayer(e);t.set_float(e?e.canvasToLayer(i,n,!0):0)},p.prototype.canvastolayery=function(t,e,i,n){e=this.runtime.getLayer(e);t.set_float(e?e.canvasToLayer(i,n,!1):0)},p.prototype.layertocanvasx=function(t,e,i,n){e=this.runtime.getLayer(e);t.set_float(e?e.layerToCanvas(i,n,!0):0)},p.prototype.layertocanvasy=function(t,e,i,n){e=this.runtime.getLayer(e);t.set_float(e?e.layerToCanvas(i,n,!1):0)},p.prototype.savestatejson=function(t){t.set_string(this.runtime.lastSaveJson)},p.prototype.imagememoryusage=function(t){this.runtime.glwrap?t.set_float(Math.round(100*this.runtime.glwrap.estimateVRAM()/1048576)/100):t.set_float(0)},p.prototype.regexsearch=function(t,e,i,n){n=s(i,n);t.set_int(e?e.search(n):-1)},p.prototype.regexreplace=function(t,e,i,n,r){n=s(i,n);t.set_string(e?e.replace(n,r):"")};var d=[],g="",b="",w="";function x(t,e,i){var n;t===g&&e===b&&i===w||(n=s(e,i),d=t.match(n),g=t,b=e,w=i)}p.prototype.regexmatchcount=function(t,e,i,n){s(i,n);x(e,i,n),t.set_int(d?d.length:0)},p.prototype.regexmatchat=function(t,e,i,n,r){r=Math.floor(r);s(i,n);x(e,i,n),!d||r<0||r>=d.length?t.set_string(""):t.set_string(d[r])},p.prototype.infinity=function(t){t.set_float(1/0)},p.prototype.setbit=function(t,e,i,n){e|=0,i|=0,n=0!==n?1:0,t.set_int(e&~(1<<i)|n<<i)},p.prototype.togglebit=function(t,e,i){e|=0,i|=0,t.set_int(e^1<<i)},p.prototype.getbit=function(t,e,i){e|=0,i|=0,t.set_int(e&1<<i?1:0)},p.prototype.originalwindowwidth=function(t){t.set_int(this.runtime.original_width)},p.prototype.originalwindowheight=function(t){t.set_int(this.runtime.original_height)},t.exps=new p,t.runWaits=function(){for(var t,e,i,n,r,s,o=this.runtime.getCurrentEventStack(),a=0,h=this.waits.length;a<h;a++){if(-1===(e=this.waits[a]).time){if(!e.signalled)continue}else if(e.time>this.runtime.kahanTime.sum)continue;for(i in o.current_event=e.ev,o.actindex=e.actindex,o.cndindex=0,e.sols)e.sols.hasOwnProperty(i)&&(n=this.runtime.types_by_index[parseInt(i,10)].getCurrentSol(),r=e.sols[i],n.select_all=r.sa,cr.shallowAssignArray(n.instances,r.insts),r=r,cr.clearArray(r.insts),u.push(r));e.ev.resume_actions_and_subevents(),this.runtime.clearSol(e.solModifiers),e.deleteme=!0}for(t=a=0,h=this.waits.length;a<h;a++)e=this.waits[a],(this.waits[t]=e).deleteme?(s=e,cr.wipe(s.sols),cr.clearArray(s.solModifiers),c.push(s)):t++;cr.truncateArray(this.waits,t)}}(),function(){cr.add_common_aces=function(t,e){var i=t[1],n=t[3],r=t[4],s=t[5],o=t[6],a=t[7],h=t[8];e.cnds||(e.cnds={}),e.acts||(e.acts={}),e.exps||(e.exps={});var c=e.cnds,t=e.acts,e=e.exps;n&&(c.CompareX=function(t,e){return cr.do_cmp(this.x,t,e)},c.CompareY=function(t,e){return cr.do_cmp(this.y,t,e)},c.IsOnScreen=function(){var t=this.layer;this.update_bbox();var e=this.bbox;return!(e.right<t.viewLeft||e.bottom<t.viewTop||e.left>t.viewRight||e.top>t.viewBottom)},c.IsOutsideLayout=function(){this.update_bbox();var t=this.bbox,e=this.runtime.running_layout;return t.right<0||t.bottom<0||t.left>e.width||t.top>e.height},c.PickDistance=function(t,e,i){var n=this.getCurrentSol(),r=n.getObjects();if(!r.length)return!1;for(var s,o=r[0],a=o,h=cr.distanceTo(o.x,o.y,e,i),c=1,l=r.length;c<l;c++)o=r[c],s=cr.distanceTo(o.x,o.y,e,i),(0===t&&s<h||1===t&&h<s)&&(h=s,a=o);return n.pick_one(a),!0},t.SetX=function(t){this.x!==t&&(this.x=t,this.set_bbox_changed())},t.SetY=function(t){this.y!==t&&(this.y=t,this.set_bbox_changed())},t.SetPos=function(t,e){this.x===t&&this.y===e||(this.x=t,this.y=e,this.set_bbox_changed())},t.SetPosToObject=function(t,e){var i,t=t.getPairedInstance(this);t&&(t=t.getImagePoint?(i=t.getImagePoint(e,!0),t.getImagePoint(e,!1)):(i=t.x,t.y),this.x===i&&this.y===t||(this.x=i,this.y=t,this.set_bbox_changed()))},t.MoveForward=function(t){0!==t&&(this.x+=Math.cos(this.angle)*t,this.y+=Math.sin(this.angle)*t,this.set_bbox_changed())},t.MoveAtAngle=function(t,e){0!==e&&(this.x+=Math.cos(cr.to_radians(t))*e,this.y+=Math.sin(cr.to_radians(t))*e,this.set_bbox_changed())},e.X=function(t){t.set_float(this.x)},e.Y=function(t){t.set_float(this.y)},e.dt=function(t){t.set_float(this.runtime.getDt(this))}),r&&(c.CompareWidth=function(t,e){return cr.do_cmp(this.width,t,e)},c.CompareHeight=function(t,e){return cr.do_cmp(this.height,t,e)},t.SetWidth=function(t){this.width!==t&&(this.width=t,this.set_bbox_changed())},t.SetHeight=function(t){this.height!==t&&(this.height=t,this.set_bbox_changed())},t.SetSize=function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.set_bbox_changed())},e.Width=function(t){t.set_float(this.width)},e.Height=function(t){t.set_float(this.height)},e.BBoxLeft=function(t){this.update_bbox(),t.set_float(this.bbox.left)},e.BBoxTop=function(t){this.update_bbox(),t.set_float(this.bbox.top)},e.BBoxRight=function(t){this.update_bbox(),t.set_float(this.bbox.right)},e.BBoxBottom=function(t){this.update_bbox(),t.set_float(this.bbox.bottom)}),s&&(c.AngleWithin=function(t,e){return cr.angleDiff(this.angle,cr.to_radians(e))<=cr.to_radians(t)},c.IsClockwiseFrom=function(t){return cr.angleClockwise(this.angle,cr.to_radians(t))},c.IsBetweenAngles=function(t,e){var i=cr.to_clamped_radians(t),t=cr.to_clamped_radians(e),e=cr.clamp_angle(this.angle);return!cr.angleClockwise(t,i)?!(!cr.angleClockwise(e,i)&&cr.angleClockwise(e,t)):cr.angleClockwise(e,i)&&!cr.angleClockwise(e,t)},t.SetAngle=function(t){t=cr.to_radians(cr.clamp_angle_degrees(t));isNaN(t)||this.angle!==t&&(this.angle=t,this.set_bbox_changed())},t.RotateClockwise=function(t){0===t||isNaN(t)||(this.angle+=cr.to_radians(t),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},t.RotateCounterclockwise=function(t){0===t||isNaN(t)||(this.angle-=cr.to_radians(t),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},t.RotateTowardAngle=function(t,e){t=cr.angleRotate(this.angle,cr.to_radians(e),cr.to_radians(t));isNaN(t)||this.angle!==t&&(this.angle=t,this.set_bbox_changed())},t.RotateTowardPosition=function(t,e,i){e-=this.x,i-=this.y,e=Math.atan2(i,e),t=cr.angleRotate(this.angle,e,cr.to_radians(t));isNaN(t)||this.angle!==t&&(this.angle=t,this.set_bbox_changed())},t.SetTowardPosition=function(t,e){t-=this.x,e-=this.y,t=Math.atan2(e,t);isNaN(t)||this.angle!==t&&(this.angle=t,this.set_bbox_changed())},e.Angle=function(t){t.set_float(cr.to_clamped_degrees(this.angle))}),i||(c.CompareInstanceVar=function(t,e,i){return cr.do_cmp(this.instance_vars[t],e,i)},c.IsBoolInstanceVarSet=function(t){return this.instance_vars[t]},c.PickInstVarHiLow=function(t,e){var i=this.getCurrentSol(),n=i.getObjects();if(!n.length)return!1;for(var r,s=n[0],o=s,a=s.instance_vars[e],h=1,c=n.length;h<c;h++)r=(s=n[h]).instance_vars[e],(0===t&&r<a||1===t&&a<r)&&(a=r,o=s);return i.pick_one(o),!0},c.PickByUID=function(t){var e,i,n,r,s,o,a;if(this.runtime.getCurrentCondition().inverted){if((a=this.getCurrentSol()).select_all){for(a.select_all=!1,cr.clearArray(a.instances),cr.clearArray(a.else_instances),e=0,i=(o=this.instances).length;e<i;e++)((r=o[e]).uid===t?a.else_instances:a.instances).push(r);return this.applySolToContainer(),!!a.instances.length}for(n=e=0,i=a.instances.length;e<i;e++)r=a.instances[e],(a.instances[n]=r).uid===t?a.else_instances.push(r):n++;return cr.truncateArray(a.instances,n),this.applySolToContainer(),!!a.instances.length}if(!(r=this.runtime.getObjectByUID(t)))return!1;if(!(a=this.getCurrentSol()).select_all&&-1===a.instances.indexOf(r))return!1;if(this.is_family){for(e=0,i=(s=r.type.families).length;e<i;e++)if(s[e]===this)return a.pick_one(r),this.applySolToContainer(),!0}else if(r.type===this)return a.pick_one(r),this.applySolToContainer(),!0;return!1},c.OnCreated=function(){return!0},c.OnDestroyed=function(){return!0},t.SetInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])?cr.is_number(e)?i[t]=e:i[t]=parseFloat(e):cr.is_string(i[t])&&(cr.is_string(e)?i[t]=e:i[t]=e.toString())},t.AddInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])?cr.is_number(e)?i[t]+=e:i[t]+=parseFloat(e):cr.is_string(i[t])&&(cr.is_string(e)?i[t]+=e:i[t]+=e.toString())},t.SubInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])&&(cr.is_number(e)?i[t]-=e:i[t]-=parseFloat(e))},t.SetBoolInstanceVar=function(t,e){this.instance_vars[t]=e?1:0},t.ToggleBoolInstanceVar=function(t){this.instance_vars[t]=1-this.instance_vars[t]},t.Destroy=function(){this.runtime.DestroyInstance(this)},t.LoadFromJsonString||(t.LoadFromJsonString=function(t){var e,i,n,r;try{e=JSON.parse(t)}catch(t){return}if(this.runtime.loadInstanceFromJSON(this,e,!0),this.afterLoad&&this.afterLoad(),this.behavior_insts)for(i=0,n=this.behavior_insts.length;i<n;++i)(r=this.behavior_insts[i]).afterLoad&&r.afterLoad()}),e.Count=function(t){for(var e,i=t.object_class.instances.length,n=0,r=this.runtime.createRow.length;n<r;n++)e=this.runtime.createRow[n],t.object_class.is_family?0<=e.type.families.indexOf(t.object_class)&&i++:e.type===t.object_class&&i++;t.set_int(i)},e.PickedCount=function(t){t.set_int(t.object_class.getCurrentSol().getObjects().length)},e.UID=function(t){t.set_int(this.uid)},e.IID=function(t){t.set_int(this.get_iid())},e.AsJSON||(e.AsJSON=function(t){t.set_string(JSON.stringify(this.runtime.saveInstanceToJSON(this,!0)))})),o&&(c.IsVisible=function(){return this.visible},t.SetVisible=function(t){!t!=!this.visible&&(this.visible=!!t,this.runtime.redraw=!0)},c.CompareOpacity=function(t,e){return cr.do_cmp(cr.round6dp(100*this.opacity),t,e)},t.SetOpacity=function(t){t/=100;t<0?t=0:1<t&&(t=1),t!==this.opacity&&(this.opacity=t,this.runtime.redraw=!0)},e.Opacity=function(t){t.set_float(cr.round6dp(100*this.opacity))}),a&&(c.IsOnLayer=function(t){return!!t&&this.layer===t},c.PickTopBottom=function(t){var e=this.getCurrentSol(),i=e.getObjects();if(!i.length)return!1;for(var n=i[0],r=n,s=1,o=i.length;s<o;s++)n=i[s],0===t?(n.layer.index>r.layer.index||n.layer.index===r.layer.index&&n.get_zindex()>r.get_zindex())&&(r=n):(n.layer.index<r.layer.index||n.layer.index===r.layer.index&&n.get_zindex()<r.get_zindex())&&(r=n);return e.pick_one(r),!0},t.MoveToTop=function(){var t=this.layer,e=t.instances;e.length&&e[e.length-1]===this||(t.removeFromInstanceList(this,!1),t.appendToInstanceList(this,!1),this.runtime.redraw=!0)},t.MoveToBottom=function(){var t=this.layer,e=t.instances;e.length&&e[0]===this||(t.removeFromInstanceList(this,!1),t.prependToInstanceList(this,!1),this.runtime.redraw=!0)},t.MoveToLayer=function(t){t&&t!=this.layer&&(this.layer.removeFromInstanceList(this,!0),(this.layer=t).appendToInstanceList(this,!0),this.runtime.redraw=!0)},t.ZMoveToObject=function(t,e){t=0===t;!e||(e=e.getFirstPicked(this))&&e.uid!==this.uid&&(this.layer.index!==e.layer.index&&(this.layer.removeFromInstanceList(this,!0),this.layer=e.layer,e.layer.appendToInstanceList(this,!0)),this.layer.moveInstanceAdjacent(this,e,t),this.runtime.redraw=!0)},e.LayerNumber=function(t){t.set_int(this.layer.number)},e.LayerName=function(t){t.set_string(this.layer.name)},e.ZIndex=function(t){t.set_int(this.get_zindex())}),h&&(t.SetEffectEnabled=function(t,e){this.runtime.glwrap&&((e=this.type.getEffectIndexByName(e))<0||(t=1===t,this.active_effect_flags[e]!==t&&(this.active_effect_flags[e]=t,this.updateActiveEffects(),this.runtime.redraw=!0)))},t.SetEffectParam=function(t,e,i){var n;this.runtime.glwrap&&((n=this.type.getEffectIndexByName(t))<0||(t=this.type.effect_types[n],n=this.effect_params[n],(e=Math.floor(e))<0||e>=n.length||(1===this.runtime.glwrap.getProgramParameterType(t.shaderindex,e)&&(i/=100),n[e]!==i&&(n[e]=i,t.active&&(this.runtime.redraw=!0)))))})},cr.set_bbox_changed=function(){this.bbox_changed=!0,this.cell_changed=!0,this.type.any_cell_changed=!0,this.runtime.redraw=!0;for(var t=this.bbox_changed_callbacks,e=0,i=t.length;e<i;++e)t[e](this);this.layer.useRenderCells&&this.update_bbox()},cr.add_bbox_changed_callback=function(t){t&&this.bbox_changed_callbacks.push(t)},cr.update_bbox=function(){var t,e;this.bbox_changed&&(t=this.bbox,e=this.bquad,t.set(this.x,this.y,this.x+this.width,this.y+this.height),t.offset(-this.hotspotX*this.width,-this.hotspotY*this.height),this.angle?(t.offset(-this.x,-this.y),e.set_from_rotated_rect(t,this.angle),e.offset(this.x,this.y),e.bounding_box(t)):e.set_from_rect(t),t.normalize(),this.bbox_changed=!1,this.update_render_cell())};var i=new cr.rect(0,0,0,0);cr.update_render_cell=function(){var t,e;this.layer.useRenderCells&&(t=this.layer.render_grid,e=this.bbox,i.set(t.XToCell(e.left),t.YToCell(e.top),t.XToCell(e.right),t.YToCell(e.bottom)),this.rendercells.equals(i)||(this.rendercells.right<this.rendercells.left?t.update(this,null,i):t.update(this,this.rendercells,i),this.rendercells.copy(i),this.layer.render_list_stale=!0))},cr.update_collision_cell=function(){var t,e;this.cell_changed&&this.collisionsEnabled&&(this.update_bbox(),t=this.type.collision_grid,e=this.bbox,i.set(t.XToCell(e.left),t.YToCell(e.top),t.XToCell(e.right),t.YToCell(e.bottom)),this.collcells.equals(i)||(this.collcells.right<this.collcells.left?t.update(this,null,i):t.update(this,this.collcells,i),this.collcells.copy(i),this.cell_changed=!1))},cr.inst_contains_pt=function(t,e){return!!this.bbox.contains_pt(t,e)&&(!!this.bquad.contains_pt(t,e)&&(this.tilemap_exists?this.testPointOverlapTile(t,e):!(this.collision_poly&&!this.collision_poly.is_empty())||(this.collision_poly.cache_poly(this.width,this.height,this.angle),this.collision_poly.contains_pt(t-this.x,e-this.y))))},cr.inst_get_iid=function(){return this.type.updateIIDs(),this.iid},cr.inst_get_zindex=function(){return this.layer.updateZIndices(),this.zindex},cr.inst_updateActiveEffects=function(){var t;cr.clearArray(this.active_effect_types);for(var e=!0,i=0,n=this.active_effect_flags.length;i<n;i++)this.active_effect_flags[i]&&(t=this.type.effect_types[i],this.active_effect_types.push(t),t.preservesOpaqueness||(e=!1));this.uses_shaders=!!this.active_effect_types.length,this.shaders_preserve_opaqueness=e},cr.inst_toString=function(){return"Inst"+this.puid},cr.type_getFirstPicked=function(t){if(t&&t.is_contained&&t.type!=this)for(var e,i=0,n=t.siblings.length;i<n;i++)if((e=t.siblings[i]).type==this)return e;var r=this.getCurrentSol().getObjects();return r.length?r[0]:null},cr.type_getPairedInstance=function(t){var e=this.getCurrentSol().getObjects();return e.length?e[t.get_iid()%e.length]:null},cr.type_updateIIDs=function(){if(this.stale_iids&&!this.is_family){for(var t=0,e=this.instances.length;t<e;t++)this.instances[t].iid=t;var i=t,n=this.runtime.createRow;for(t=0,e=n.length;t<e;++t)n[t].type===this&&(n[t].iid=i++);this.stale_iids=!1}},cr.type_getInstanceByIID=function(t){if(t<this.instances.length)return this.instances[t];t-=this.instances.length;for(var e=this.runtime.createRow,i=0,n=e.length;i<n;++i)if(e[i].type===this){if(0===t)return e[i];--t}return null},cr.type_getCurrentSol=function(){return this.solstack[this.cur_sol]},cr.type_pushCleanSol=function(){this.cur_sol++,this.cur_sol===this.solstack.length?this.solstack.push(new cr.selection(this)):(this.solstack[this.cur_sol].select_all=!0,cr.clearArray(this.solstack[this.cur_sol].else_instances))},cr.type_pushCopySol=function(){this.cur_sol++,this.cur_sol===this.solstack.length&&this.solstack.push(new cr.selection(this));var t=this.solstack[this.cur_sol],e=this.solstack[this.cur_sol-1];e.select_all?(t.select_all=!0,cr.clearArray(t.else_instances)):(t.select_all=!1,cr.shallowAssignArray(t.instances,e.instances),cr.shallowAssignArray(t.else_instances,e.else_instances))},cr.type_popSol=function(){this.cur_sol--},cr.type_getBehaviorByName=function(t){var e,i,n,r,s,o=0;if(!this.is_family)for(e=0,i=this.families.length;e<i;e++)for(n=0,r=(s=this.families[e]).behaviors.length;n<r;n++){if(t===s.behaviors[n].name)return this.extra.lastBehIndex=o,s.behaviors[n];o++}for(e=0,i=this.behaviors.length;e<i;e++){if(t===this.behaviors[e].name)return this.extra.lastBehIndex=o,this.behaviors[e];o++}return null},cr.type_getBehaviorIndexByName=function(t){return this.getBehaviorByName(t)?this.extra.lastBehIndex:-1},cr.type_getEffectIndexByName=function(t){for(var e=0,i=this.effect_types.length;e<i;e++)if(this.effect_types[e].name===t)return e;return-1},cr.type_applySolToContainer=function(){if(this.is_contained&&!this.is_family){var t,e,i,n,r;this.updateIIDs();for(var s=(n=this.getCurrentSol()).select_all,o=this.runtime.getCurrentEventStack(),a=o&&o.current_event&&o.current_event.orblock,h=0,c=this.container.length;h<c;h++)if(i=this.container[h],i!==this&&(i.updateIIDs(),!((r=i.getCurrentSol()).select_all=s))){for(cr.clearArray(r.instances),t=0,e=n.instances.length;t<e;++t)r.instances[t]=i.getInstanceByIID(n.instances[t].iid);if(a)for(cr.clearArray(r.else_instances),t=0,e=n.else_instances.length;t<e;++t)r.else_instances[t]=i.getInstanceByIID(n.else_instances[t].iid)}}},cr.type_toString=function(){return"Type"+this.sid},cr.do_cmp=function(t,e,i){if(void 0===t||void 0===i)return!1;switch(e){case 0:return t===i;case 1:return t!==i;case 2:return t<i;case 3:return t<=i;case 4:return i<t;case 5:return i<=t;default:return!1}}}(),cr.shaders={},cr.shaders.inverse={src:["varying mediump vec2 vTex;","uniform lowp sampler2D samplerFront;","uniform lowp float intensity;","void main(void)","{","lowp vec4 front = texture2D(samplerFront, vTex);","lowp vec3 inverse = vec3(front.a - front.rgb);","gl_FragColor = vec4(mix(front.rgb, inverse, intensity), front.a);","}"].join("\n"),extendBoxHorizontal:0,extendBoxVertical:0,crossSampling:!1,preservesOpaqueness:!0,animated:!1,parameters:[["intensity",0,1]]},cr.plugins_.Arr=function(t){this.runtime=t},function(){var t=cr.plugins_.Arr.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var e=t.Instance.prototype,n=[];function a(){return n.length?n.pop():[]}function s(t){for(var e=0,i=t.length;e<i;e++)Array.isArray(t[e])&&s(t[e]);cr.clearArray(t),n.push(t)}function i(){}function r(){}function o(t,e){if(cr.is_number(t)&&cr.is_number(e))return t-e;t=""+t,e=""+e;return t<e?-1:e<t?1:0}function h(){}Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),e.onCreate=function(){this.cx=this.properties[0],this.cy=this.properties[1],this.cz=this.properties[2],this.recycled||(this.arr=a());var t,e,i,n=this.arr;for(n.length=this.cx,t=0;t<this.cx;t++)for(n[t]||(n[t]=a()),n[t].length=this.cy,e=0;e<this.cy;e++)for(n[t][e]||(n[t][e]=a()),n[t][e].length=this.cz,i=0;i<this.cz;i++)n[t][e][i]=0;this.forX=[],this.forY=[],this.forZ=[],this.forDepth=-1},e.onDestroy=function(){for(var t=0;t<this.cx;t++)s(this.arr[t]);cr.clearArray(this.arr)},e.at=function(t,e,i){return t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),isNaN(t)||t<0||t>this.cx-1||isNaN(e)||e<0||e>this.cy-1||isNaN(i)||i<0||i>this.cz-1?0:this.arr[t][e][i]},e.set=function(t,e,i,n){t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),isNaN(t)||t<0||t>this.cx-1||isNaN(e)||e<0||e>this.cy-1||isNaN(i)||i<0||i>this.cz-1||(this.arr[t][e][i]=n)},e.getAsJSON=function(){return JSON.stringify({c2array:!0,size:[this.cx,this.cy,this.cz],data:this.arr})},e.saveToJSON=function(){return{size:[this.cx,this.cy,this.cz],data:this.arr}},e.loadFromJSON=function(t){var e=t.size;this.cx=e[0],this.cy=e[1],this.cz=e[2],this.arr=t.data},e.setSize=function(t,e,i){if(t<0&&(t=0),e<0&&(e=0),i<0&&(i=0),this.cx!==t||this.cy!==e||this.cz!==i){var n,r,s;this.cx=t,this.cy=e,this.cz=i;var o=this.arr;for(o.length=t,n=0;n<this.cx;n++)for(cr.is_undefined(o[n])&&(o[n]=a()),o[n].length=e,r=0;r<this.cy;r++)for(cr.is_undefined(o[n][r])&&(o[n][r]=a()),o[n][r].length=i,s=0;s<this.cz;s++)cr.is_undefined(o[n][r][s])&&(o[n][r][s]=0)}},e.getForX=function(){return 0<=this.forDepth&&this.forDepth<this.forX.length?this.forX[this.forDepth]:0},e.getForY=function(){return 0<=this.forDepth&&this.forDepth<this.forY.length?this.forY[this.forDepth]:0},e.getForZ=function(){return 0<=this.forDepth&&this.forDepth<this.forZ.length?this.forZ[this.forDepth]:0},i.prototype.CompareX=function(t,e,i){return cr.do_cmp(this.at(t,0,0),e,i)},i.prototype.CompareXY=function(t,e,i,n){return cr.do_cmp(this.at(t,e,0),i,n)},i.prototype.CompareXYZ=function(t,e,i,n,r){return cr.do_cmp(this.at(t,e,i),n,r)},e.doForEachTrigger=function(t){this.runtime.pushCopySol(t.solModifiers),t.retrigger(),this.runtime.popSol(t.solModifiers)},i.prototype.ArrForEach=function(t){var e=this.runtime.getCurrentEventStack().current_event;this.forDepth++;var i=this.forDepth;switch(i===this.forX.length?(this.forX.push(0),this.forY.push(0),this.forZ.push(0)):(this.forX[i]=0,this.forY[i]=0,this.forZ[i]=0),t){case 0:for(this.forX[i]=0;this.forX[i]<this.cx;this.forX[i]++)for(this.forY[i]=0;this.forY[i]<this.cy;this.forY[i]++)for(this.forZ[i]=0;this.forZ[i]<this.cz;this.forZ[i]++)this.doForEachTrigger(e);break;case 1:for(this.forX[i]=0;this.forX[i]<this.cx;this.forX[i]++)for(this.forY[i]=0;this.forY[i]<this.cy;this.forY[i]++)this.doForEachTrigger(e);break;case 2:for(this.forX[i]=0;this.forX[i]<this.cx;this.forX[i]++)this.doForEachTrigger(e)}return this.forDepth--,!1},i.prototype.CompareCurrent=function(t,e){return cr.do_cmp(this.at(this.getForX(),this.getForY(),this.getForZ()),t,e)},i.prototype.Contains=function(t){for(var e,i,n=0;n<this.cx;n++)for(e=0;e<this.cy;e++)for(i=0;i<this.cz;i++)if(this.arr[n][e][i]===t)return!0;return!1},i.prototype.IsEmpty=function(){return 0===this.cx||0===this.cy||0===this.cz},i.prototype.CompareSize=function(t,e,i){var n=0;switch(t){case 0:n=this.cx;break;case 1:n=this.cy;break;case 2:n=this.cz}return cr.do_cmp(n,e,i)},t.cnds=new i,r.prototype.Clear=function(){for(var t,e,i=0;i<this.cx;i++)for(t=0;t<this.cy;t++)for(e=0;e<this.cz;e++)this.arr[i][t][e]=0},r.prototype.SetSize=function(t,e,i){this.setSize(t,e,i)},r.prototype.SetX=function(t,e){this.set(t,0,0,e)},r.prototype.SetXY=function(t,e,i){this.set(t,e,0,i)},r.prototype.SetXYZ=function(t,e,i,n){this.set(t,e,i,n)},r.prototype.Push=function(t,e,i){var n=0,r=0,s=0,o=this.arr;switch(i){case 0:for(0===t?(n=o.length,o.push(a())):(n=0,o.unshift(a())),o[n].length=this.cy;r<this.cy;r++)for(o[n][r]=a(),o[n][r].length=this.cz,s=0;s<this.cz;s++)o[n][r][s]=e;this.cx++;break;case 1:for(;n<this.cx;n++)for(0===t?(r=o[n].length,o[n].push(a())):(r=0,o[n].unshift(a())),o[n][r].length=this.cz,s=0;s<this.cz;s++)o[n][r][s]=e;this.cy++;break;case 2:for(;n<this.cx;n++)for(r=0;r<this.cy;r++)0===t?o[n][r].push(e):o[n][r].unshift(e);this.cz++}},r.prototype.Pop=function(t,e){var i=0,n=0,r=this.arr;switch(e){case 0:if(0===this.cx)break;s(0===t?r.pop():r.shift()),this.cx--;break;case 1:if(0===this.cy)break;for(;i<this.cx;i++)s(0===t?r[i].pop():r[i].shift());this.cy--;break;case 2:if(0===this.cz)break;for(;i<this.cx;i++)for(n=0;n<this.cy;n++)0===t?r[i][n].pop():r[i][n].shift();this.cz--}},r.prototype.Reverse=function(t){var e=0,i=0,n=this.arr;if(0!==this.cx&&0!==this.cy&&0!==this.cz)switch(t){case 0:n.reverse();break;case 1:for(;e<this.cx;e++)n[e].reverse();break;case 2:for(;e<this.cx;e++)for(i=0;i<this.cy;i++)n[e][i].reverse();this.cz--}},r.prototype.Sort=function(t){var e=0,i=0,n=this.arr;if(0!==this.cx&&0!==this.cy&&0!==this.cz)switch(t){case 0:n.sort(function(t,e){return o(t[0][0],e[0][0])});break;case 1:for(;e<this.cx;e++)n[e].sort(function(t,e){return o(t[0],e[0])});break;case 2:for(;e<this.cx;e++)for(i=0;i<this.cy;i++)n[e][i].sort(o)}},r.prototype.Delete=function(t,e){var i=0,n=0;t=Math.floor(t);var r=this.arr;if(!(t<0))switch(e){case 0:if(t>=this.cx)break;s(r[t]),r.splice(t,1),this.cx--;break;case 1:if(t>=this.cy)break;for(;i<this.cx;i++)s(r[i][t]),r[i].splice(t,1);this.cy--;break;case 2:if(t>=this.cz)break;for(;i<this.cx;i++)for(n=0;n<this.cy;n++)r[i][n].splice(t,1);this.cz--}},r.prototype.Insert=function(t,e,i){var n=0,r=0,s=0;e=Math.floor(e);var o=this.arr;if(!(e<0))switch(i){case 0:if(e>this.cx)return;for(n=e,o.splice(n,0,a()),o[n].length=this.cy;r<this.cy;r++)for(o[n][r]=a(),o[n][r].length=this.cz,s=0;s<this.cz;s++)o[n][r][s]=t;this.cx++;break;case 1:if(e>this.cy)return;for(;n<this.cx;n++)for(r=e,o[n].splice(r,0,a()),o[n][r].length=this.cz,s=0;s<this.cz;s++)o[n][r][s]=t;this.cy++;break;case 2:if(e>this.cz)return;for(;n<this.cx;n++)for(r=0;r<this.cy;r++)o[n][r].splice(e,0,t);this.cz++}},r.prototype.JSONLoad=function(t){var e,i;try{e=JSON.parse(t)}catch(t){return}e.c2array&&(i=e.size,this.cx=i[0],this.cy=i[1],this.cz=i[2],this.arr=e.data)},r.prototype.JSONDownload=function(t){var e,i=document.createElement("a");void 0===i.download?(e="data:text/html,"+encodeURIComponent("<p><a download='"+t+"' href=\"data:application/json,"+encodeURIComponent(this.getAsJSON())+'">Download link</a></p>'),window.open(e)):(e=document.getElementsByTagName("body")[0],i.textContent=t,i.href="data:application/json,"+encodeURIComponent(this.getAsJSON()),i.download=t,e.appendChild(i),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(t),e.removeChild(i))},t.acts=new r,h.prototype.At=function(t,e,i,n){i=i||0,n=n||0;t.set_any(this.at(e,i,n))},h.prototype.Width=function(t){t.set_int(this.cx)},h.prototype.Height=function(t){t.set_int(this.cy)},h.prototype.Depth=function(t){t.set_int(this.cz)},h.prototype.CurX=function(t){t.set_int(this.getForX())},h.prototype.CurY=function(t){t.set_int(this.getForY())},h.prototype.CurZ=function(t){t.set_int(this.getForZ())},h.prototype.CurValue=function(t){t.set_any(this.at(this.getForX(),this.getForY(),this.getForZ()))},h.prototype.Front=function(t){t.set_any(this.at(0,0,0))},h.prototype.Back=function(t){t.set_any(this.at(this.cx-1,0,0))},h.prototype.IndexOf=function(t,e){for(var i=0;i<this.cx;i++)if(this.arr[i][0][0]===e)return void t.set_int(i);t.set_int(-1)},h.prototype.LastIndexOf=function(t,e){for(var i=this.cx-1;0<=i;i--)if(this.arr[i][0][0]===e)return void t.set_int(i);t.set_int(-1)},h.prototype.AsJSON=function(t){t.set_string(this.getAsJSON())},t.exps=new h}(),cr.plugins_.Audio=function(t){this.runtime=t},function(){var t=cr.plugins_.Audio.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){};var c=null,r=null,s="",o="",a=0,h=1,l=2,u=3,p=a,d=null,f=[],x=[],y=null,g=!1,m=0,S=!1,T=1,_=0,v=0,n=!1,b=1,w=1,A=10,C=1e4,k=1,O=null,P="",I=!1,E=[],R=!1;function B(t){t=M(t);return isFinite(t)||(t=0),t<0&&(t=0),1<t&&(t=1),t}function L(t){return t<0&&(t=0),1<t&&(t=1),t=t,Math.log(t)/Math.log(10)*20}function M(t){return Math.pow(10,t/20)}var N={};function j(t){return t=t.toLowerCase(),N.hasOwnProperty(t)&&N[t].length?N[t][0].getInputNode():d.destination}function F(){return d.createGain?d.createGain():d.createGainNode()}function D(t){return d.createDelay?d.createDelay(t):d.createDelayNode(t)}function V(t,e){t.start?t.start(e||0):t.noteOn(e||0)}function W(t,e,i,n){t.start?t.start(n||0,e):t.noteGrainOn(n||0,e,i-e)}function e(t){try{t.stop?t.stop(0):t.noteOff(0)}catch(t){}}function z(t,e,i,n){if(t)if(t.cancelScheduledValues(0),0!==n){var r=d.currentTime;switch(n+=r,i){case 0:t.setValueAtTime(e,n);break;case 1:t.setValueAtTime(t.value,r),t.linearRampToValueAtTime(e,n);break;case 2:t.setValueAtTime(t.value,r),t.exponentialRampToValueAtTime(e,n)}}else t.value=e}var U=["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"];function G(t,e,i,n,r,s){this.type="filter",this.params=[t,e,i,n,r,s],this.inputNode=F(),this.wetNode=F(),this.wetNode.gain.value=s,this.dryNode=F(),this.dryNode.gain.value=1-s,this.filterNode=d.createBiquadFilter(),"number"==typeof this.filterNode.type?this.filterNode.type=t:this.filterNode.type=U[t],this.filterNode.frequency.value=e,this.filterNode.detune&&(this.filterNode.detune.value=i),this.filterNode.Q.value=n,this.filterNode.gain.value=r,this.inputNode.connect(this.filterNode),this.inputNode.connect(this.dryNode),this.filterNode.connect(this.wetNode)}function q(t,e,i){this.type="delay",this.params=[t,e,i],this.inputNode=F(),this.wetNode=F(),this.wetNode.gain.value=i,this.dryNode=F(),this.dryNode.gain.value=1-i,this.mainNode=F(),this.delayNode=D(t),this.delayNode.delayTime.value=t,this.delayGainNode=F(),this.delayGainNode.gain.value=e,this.inputNode.connect(this.mainNode),this.inputNode.connect(this.dryNode),this.mainNode.connect(this.wetNode),this.mainNode.connect(this.delayNode),this.delayNode.connect(this.delayGainNode),this.delayGainNode.connect(this.mainNode)}function X(t,e,i,n){this.type="convolve",this.params=[e,i,n],this.inputNode=F(),this.wetNode=F(),this.wetNode.gain.value=i,this.dryNode=F(),this.dryNode.gain.value=1-i,this.convolveNode=d.createConvolver(),t&&(this.convolveNode.normalize=e,this.convolveNode.buffer=t),this.inputNode.connect(this.convolveNode),this.inputNode.connect(this.dryNode),this.convolveNode.connect(this.wetNode)}function H(t,e,i,n,r){this.type="flanger",this.params=[t,e,i,n,r],this.inputNode=F(),this.dryNode=F(),this.dryNode.gain.value=1-r/2,this.wetNode=F(),this.wetNode.gain.value=r/2,this.feedbackNode=F(),this.feedbackNode.gain.value=n,this.delayNode=D(t+e),this.delayNode.delayTime.value=t,this.oscNode=d.createOscillator(),this.oscNode.frequency.value=i,this.oscGainNode=F(),this.oscGainNode.gain.value=e,this.inputNode.connect(this.delayNode),this.inputNode.connect(this.dryNode),this.delayNode.connect(this.wetNode),this.delayNode.connect(this.feedbackNode),this.feedbackNode.connect(this.delayNode),this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.delayNode.delayTime),V(this.oscNode)}function Y(t,e,i,n,r,s){this.type="phaser",this.params=[t,e,i,n,r,s],this.inputNode=F(),this.dryNode=F(),this.dryNode.gain.value=1-s/2,this.wetNode=F(),this.wetNode.gain.value=s/2,this.filterNode=d.createBiquadFilter(),"number"==typeof this.filterNode.type?this.filterNode.type=7:this.filterNode.type="allpass",this.filterNode.frequency.value=t,this.filterNode.detune&&(this.filterNode.detune.value=e),this.filterNode.Q.value=i,this.oscNode=d.createOscillator(),this.oscNode.frequency.value=r,this.oscGainNode=F(),this.oscGainNode.gain.value=n,this.inputNode.connect(this.filterNode),this.inputNode.connect(this.dryNode),this.filterNode.connect(this.wetNode),this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.filterNode.frequency),V(this.oscNode)}function J(t){this.type="gain",this.params=[t],this.node=F(),this.node.gain.value=t}function Q(t,e){this.type="tremolo",this.params=[t,e],this.node=F(),this.node.gain.value=1-e/2,this.oscNode=d.createOscillator(),this.oscNode.frequency.value=t,this.oscGainNode=F(),this.oscGainNode.gain.value=e/2,this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.node.gain),V(this.oscNode)}function K(t,e){this.type="ringmod",this.params=[t,e],this.inputNode=F(),this.wetNode=F(),this.wetNode.gain.value=e,this.dryNode=F(),this.dryNode.gain.value=1-e,this.ringNode=F(),this.ringNode.gain.value=0,this.oscNode=d.createOscillator(),this.oscNode.frequency.value=t,this.oscNode.connect(this.ringNode.gain),V(this.oscNode),this.inputNode.connect(this.ringNode),this.inputNode.connect(this.dryNode),this.ringNode.connect(this.wetNode)}function Z(t,e,i,n,r){this.type="distortion",this.params=[t,e,i,n,r],this.inputNode=F(),this.preGain=F(),this.postGain=F(),this.setDrive(i,M(n)),this.wetNode=F(),this.wetNode.gain.value=r,this.dryNode=F(),this.dryNode.gain.value=1-r,this.waveShaper=d.createWaveShaper(),this.curve=new Float32Array(65536),this.generateColortouchCurve(t,e),this.waveShaper.curve=this.curve,this.inputNode.connect(this.preGain),this.inputNode.connect(this.dryNode),this.preGain.connect(this.waveShaper),this.waveShaper.connect(this.postGain),this.postGain.connect(this.wetNode)}function $(t,e,i,n,r){this.type="compressor",this.params=[t,e,i,n,r],this.node=d.createDynamicsCompressor();try{this.node.threshold.value=t,this.node.knee.value=e,this.node.ratio.value=i,this.node.attack.value=n,this.node.release.value=r}catch(t){}}function tt(t,e){this.type="analyser",this.params=[t,e],this.node=d.createAnalyser(),this.node.fftSize=t,this.node.smoothingTimeConstant=e,this.freqBins=new Float32Array(this.node.frequencyBinCount),this.signal=new Uint8Array(t),this.peak=0,this.rms=0}function et(){this.obj=null,this.loadUid=0}G.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},G.prototype.remove=function(){this.inputNode.disconnect(),this.filterNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},G.prototype.getInputNode=function(){return this.inputNode},G.prototype.setParam=function(t,e,i,n){switch(t){case 0:(e/=100)<0&&(e=0),1<e&&(e=1),this.params[5]=e,z(this.wetNode.gain,e,i,n),z(this.dryNode.gain,1-e,i,n);break;case 1:this.params[1]=e,z(this.filterNode.frequency,e,i,n);break;case 2:this.params[2]=e,z(this.filterNode.detune,e,i,n);break;case 3:this.params[3]=e,z(this.filterNode.Q,e,i,n);break;case 4:this.params[4]=e,z(this.filterNode.gain,e,i,n)}},q.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},q.prototype.remove=function(){this.inputNode.disconnect(),this.mainNode.disconnect(),this.delayNode.disconnect(),this.delayGainNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},q.prototype.getInputNode=function(){return this.inputNode},q.prototype.setParam=function(t,e,i,n){switch(t){case 0:(e/=100)<0&&(e=0),1<e&&(e=1),this.params[2]=e,z(this.wetNode.gain,e,i,n),z(this.dryNode.gain,1-e,i,n);break;case 4:this.params[1]=B(e),z(this.delayGainNode.gain,B(e),i,n);break;case 5:this.params[0]=e,z(this.delayNode.delayTime,e,i,n)}},X.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},X.prototype.remove=function(){this.inputNode.disconnect(),this.convolveNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},X.prototype.getInputNode=function(){return this.inputNode},X.prototype.setParam=function(t,e,i,n){0===t&&((e/=100)<0&&(e=0),1<e&&(e=1),this.params[1]=e,z(this.wetNode.gain,e,i,n),z(this.dryNode.gain,1-e,i,n))},H.prototype.connectTo=function(t){this.dryNode.disconnect(),this.dryNode.connect(t),this.wetNode.disconnect(),this.wetNode.connect(t)},H.prototype.remove=function(){this.inputNode.disconnect(),this.delayNode.disconnect(),this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.dryNode.disconnect(),this.wetNode.disconnect(),this.feedbackNode.disconnect()},H.prototype.getInputNode=function(){return this.inputNode},H.prototype.setParam=function(t,e,i,n){switch(t){case 0:(e/=100)<0&&(e=0),1<e&&(e=1),this.params[4]=e,z(this.wetNode.gain,e/2,i,n),z(this.dryNode.gain,1-e/2,i,n);break;case 6:this.params[1]=e/1e3,z(this.oscGainNode.gain,e/1e3,i,n);break;case 7:this.params[2]=e,z(this.oscNode.frequency,e,i,n);break;case 8:this.params[3]=e/100,z(this.feedbackNode.gain,e/100,i,n)}},Y.prototype.connectTo=function(t){this.dryNode.disconnect(),this.dryNode.connect(t),this.wetNode.disconnect(),this.wetNode.connect(t)},Y.prototype.remove=function(){this.inputNode.disconnect(),this.filterNode.disconnect(),this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.dryNode.disconnect(),this.wetNode.disconnect()},Y.prototype.getInputNode=function(){return this.inputNode},Y.prototype.setParam=function(t,e,i,n){switch(t){case 0:(e/=100)<0&&(e=0),1<e&&(e=1),this.params[5]=e,z(this.wetNode.gain,e/2,i,n),z(this.dryNode.gain,1-e/2,i,n);break;case 1:this.params[0]=e,z(this.filterNode.frequency,e,i,n);break;case 2:this.params[1]=e,z(this.filterNode.detune,e,i,n);break;case 3:this.params[2]=e,z(this.filterNode.Q,e,i,n);break;case 6:this.params[3]=e,z(this.oscGainNode.gain,e,i,n);break;case 7:this.params[4]=e,z(this.oscNode.frequency,e,i,n)}},J.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},J.prototype.remove=function(){this.node.disconnect()},J.prototype.getInputNode=function(){return this.node},J.prototype.setParam=function(t,e,i,n){4===t&&(this.params[0]=B(e),z(this.node.gain,B(e),i,n))},Q.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},Q.prototype.remove=function(){this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.node.disconnect()},Q.prototype.getInputNode=function(){return this.node},Q.prototype.setParam=function(t,e,i,n){switch(t){case 0:(e/=100)<0&&(e=0),1<e&&(e=1),this.params[1]=e,z(this.node.gain.value,1-e/2,i,n),z(this.oscGainNode.gain.value,e/2,i,n);break;case 7:this.params[0]=e,z(this.oscNode.frequency,e,i,n)}},K.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},K.prototype.remove=function(){this.oscNode.disconnect(),this.ringNode.disconnect(),this.inputNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},K.prototype.getInputNode=function(){return this.inputNode},K.prototype.setParam=function(t,e,i,n){switch(t){case 0:(e/=100)<0&&(e=0),1<e&&(e=1),this.params[1]=e,z(this.wetNode.gain,e,i,n),z(this.dryNode.gain,1-e,i,n);break;case 7:this.params[0]=e,z(this.oscNode.frequency,e,i,n)}},Z.prototype.setDrive=function(t,e){t<.01&&(t=.01),this.preGain.gain.value=t,this.postGain.gain.value=Math.pow(1/t,.6)*e},Z.prototype.shape=function(t,e,i){var n,r=1.05*i*e-e,i=t<0?-1:1,t=t<0?-t:t,n=t<e?t:e+r*(n=t-e,r=1/r,1-Math.exp(-r*n));return n*=i},Z.prototype.generateColortouchCurve=function(t,e){for(var i,n=M(t),r=M(e),s=0;s<32768;++s)i=s/32768,i=this.shape(i,n,r),this.curve[32768+s]=i,this.curve[32768-s-1]=-i},Z.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},Z.prototype.remove=function(){this.inputNode.disconnect(),this.preGain.disconnect(),this.waveShaper.disconnect(),this.postGain.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},Z.prototype.getInputNode=function(){return this.inputNode},Z.prototype.setParam=function(t,e,i,n){0===t&&((e/=100)<0&&(e=0),1<e&&(e=1),this.params[4]=e,z(this.wetNode.gain,e,i,n),z(this.dryNode.gain,1-e,i,n))},$.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},$.prototype.remove=function(){this.node.disconnect()},$.prototype.getInputNode=function(){return this.node},$.prototype.setParam=function(t,e,i,n){},tt.prototype.tick=function(){this.node.getFloatFrequencyData(this.freqBins),this.node.getByteTimeDomainData(this.signal);for(var t=this.node.fftSize,e=0,i=this.peak=0,n=0;e<t;e++)(n=(this.signal[e]-128)/128)<0&&(n=-n),this.peak<n&&(this.peak=n),i+=n*n;this.peak=L(this.peak),this.rms=L(Math.sqrt(i/t))},tt.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},tt.prototype.remove=function(){this.node.disconnect()},tt.prototype.getInputNode=function(){return this.node},tt.prototype.setParam=function(t,e,i,n){},et.prototype.setObject=function(t){this.obj=t},et.prototype.hasObject=function(){return!!this.obj};var i=!(et.prototype.tick=function(t){});function it(t,e){this.src=t,this.myapi=p,this.is_music=e,this.added_end_listener=!1;var i,n=this;switch(this.outNode=null,this.mediaSourceNode=null,this.panWhenReady=[],this.seekWhenReady=0,this.pauseWhenReady=!1,this.supportWebAudioAPI=!1,this.failedToLoad=!1,this.wasEverReady=!1,p===h&&e&&!R&&(this.myapi=a,this.outNode=F()),this.bufferObject=null,this.audioData=null,this.myapi){case a:this.bufferObject=new Audio,this.bufferObject.crossOrigin="anonymous",this.bufferObject.addEventListener("canplaythrough",function(){n.wasEverReady=!0}),p===h&&d.createMediaElementSource&&!/wiiu/i.test(navigator.userAgent)&&(this.supportWebAudioAPI=!0,this.bufferObject.addEventListener("canplay",function(){n.mediaSourceNode||(n.mediaSourceNode=d.createMediaElementSource(n.bufferObject),n.mediaSourceNode.connect(n.outNode))})),this.bufferObject.autoplay=!1,this.bufferObject.preload="auto",this.bufferObject.src=t;break;case h:c.isWKWebView?c.fetchLocalFileViaCordovaAsArrayBuffer(t,function(t){n.audioData=t,n.decodeAudioBuffer()},function(t){n.failedToLoad=!0}):((i=new XMLHttpRequest).open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){n.audioData=i.response,n.decodeAudioBuffer()},i.onerror=function(){n.failedToLoad=!0},i.send());break;case l:case u:this.bufferObject=!0}}function nt(t,e){var i=this;this.tag=e,this.fresh=!0,this.stopped=!0,this.src=t.src,this.buffer=t,this.myapi=p,this.is_music=t.is_music,this.playbackRate=1,this.hasPlaybackEnded=!0,this.resume_me=!1,this.is_paused=!1,this.resume_position=0,this.looping=!1,this.is_muted=!1,this.is_silent=!1,this.volume=1,this.onended_handler=function(t){i.is_paused||i.resume_me||(this||t.target)===i.active_buffer&&(i.hasPlaybackEnded=!0,i.stopped=!0,s=i.tag,c.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,r))},this.active_buffer=null,this.isTimescaled=1===m&&!this.is_music||2===m,this.mutevol=1,this.startTime=(this.isTimescaled?c.kahanTime:c.wallTime).sum,this.gainNode=null,this.pannerNode=null,this.pannerEnabled=!1,this.objectTracker=null,this.panX=0,this.panY=0,this.panAngle=0,this.panConeInner=0,this.panConeOuter=0,this.panConeOuterGain=0,this.instanceObject=null;var n=!1;switch(this.myapi!==h||this.buffer.myapi!==a||this.buffer.supportWebAudioAPI||(this.myapi=a),this.myapi){case a:this.is_music?(this.instanceObject=t.bufferObject,n=!t.added_end_listener,t.added_end_listener=!0):(this.instanceObject=new Audio,this.instanceObject.crossOrigin="anonymous",this.instanceObject.autoplay=!1,this.instanceObject.src=t.bufferObject.src,n=!0),n&&this.instanceObject.addEventListener("ended",function(){s=i.tag,i.stopped=!0,c.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,r)});break;case h:this.gainNode=F(),this.gainNode.connect(j(e)),this.buffer.myapi===h?t.bufferObject&&(this.instanceObject=d.createBufferSource(),this.instanceObject.buffer=t.bufferObject,this.instanceObject.connect(this.gainNode)):(this.instanceObject=this.buffer.bufferObject,this.buffer.outNode.connect(this.gainNode),this.buffer.added_end_listener||(this.buffer.added_end_listener=!0,this.buffer.bufferObject.addEventListener("ended",function(){s=i.tag,i.stopped=!0,c.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,r)})));break;case l:this.instanceObject=new window.Media(o+this.src,null,null,function(t){t===window.Media.MEDIA_STOPPED&&(i.hasPlaybackEnded=!0,i.stopped=!0,s=i.tag,c.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,r))});break;case u:this.instanceObject=!0}}it.prototype.release=function(){for(var t,e=0,i=0,n=x.length;e<n;++e)t=x[e],(x[i]=t).buffer===this?t.stop():++i;x.length=i,this.bufferObject=null,this.audioData=null},it.prototype.decodeAudioBuffer=function(){var h,t;!this.bufferObject&&this.audioData&&(h=this,d.decodeAudioData?d.decodeAudioData(this.audioData,function(t){var e,i,n,r;if(h.bufferObject=t,h.audioData=null,cr.is_undefined(h.playTagWhenReady)||S)cr.is_undefined(h.convolveWhenReady)||((r=h.convolveWhenReady.convolveNode).normalize=h.normalizeWhenReady,r.buffer=t);else if(h.panWhenReady.length){for(e=0,i=h.panWhenReady.length;e<i;e++){var s,o,a=h.panWhenReady[e];(n=new nt(h,a.thistag)).setPannerEnabled(!0),void 0!==a.objUid&&(a.obj=c.getObjectByUID(a.objUid),!a.obj)||(a.obj?(s=cr.rotatePtAround(a.obj.x,a.obj.y,-a.obj.layer.getAngle(),_,v,!0),o=cr.rotatePtAround(a.obj.x,a.obj.y,-a.obj.layer.getAngle(),_,v,!1),n.setPan(s,o,cr.to_degrees(a.obj.angle-a.obj.layer.getAngle()),a.ia,a.oa,a.og),n.setObject(a.obj)):n.setPan(a.x,a.y,a.a,a.ia,a.oa,a.og),n.play(h.loopWhenReady,h.volumeWhenReady,h.seekWhenReady),h.pauseWhenReady&&n.pause(),x.push(n))}cr.clearArray(h.panWhenReady)}else(n=new nt(h,h.playTagWhenReady||"")).play(h.loopWhenReady,h.volumeWhenReady,h.seekWhenReady),h.pauseWhenReady&&n.pause(),x.push(n)},function(t){h.failedToLoad=!0}):(this.bufferObject=d.createBuffer(this.audioData,!1),this.audioData=null,cr.is_undefined(this.playTagWhenReady)||S?cr.is_undefined(this.convolveWhenReady)||((t=this.convolveWhenReady.convolveNode).normalize=this.normalizeWhenReady,t.buffer=this.bufferObject):((t=new nt(this,this.playTagWhenReady)).play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady),this.pauseWhenReady&&t.pause(),x.push(t))))},it.prototype.isLoaded=function(){switch(this.myapi){case a:var t=4<=this.bufferObject.readyState;return t&&(this.wasEverReady=!0),t||this.wasEverReady;case h:return!!this.audioData||!!this.bufferObject;case l:case u:return!0}return!1},it.prototype.isLoadedAndDecoded=function(){switch(this.myapi){case a:return this.isLoaded();case h:return!!this.bufferObject;case l:case u:return!0}return!1},it.prototype.hasFailedToLoad=function(){switch(this.myapi){case a:return!!this.bufferObject.error;case h:return this.failedToLoad}return!1},nt.prototype.hasEnded=function(){switch(this.myapi){case a:return this.instanceObject.ended;case h:return this.buffer.myapi===h?!(!this.fresh&&!this.stopped&&this.instanceObject.loop)&&(!this.is_paused&&this.hasPlaybackEnded):this.instanceObject.ended;case l:return this.hasPlaybackEnded}return!0},nt.prototype.canBeRecycled=function(){return!(!this.fresh&&!this.stopped)||this.hasEnded()},nt.prototype.setPannerEnabled=function(t){p===h&&(!this.pannerEnabled&&t?this.gainNode&&(this.pannerNode||(this.pannerNode=d.createPanner(),"number"==typeof this.pannerNode.panningModel?this.pannerNode.panningModel=b:this.pannerNode.panningModel=["equalpower","HRTF","soundfield"][b],"number"==typeof this.pannerNode.distanceModel?this.pannerNode.distanceModel=w:this.pannerNode.distanceModel=["linear","inverse","exponential"][w],this.pannerNode.refDistance=A,this.pannerNode.maxDistance=C,this.pannerNode.rolloffFactor=k),this.gainNode.disconnect(),this.gainNode.connect(this.pannerNode),this.pannerNode.connect(j(this.tag)),this.pannerEnabled=!0):this.pannerEnabled&&!t&&this.gainNode&&(this.pannerNode.disconnect(),this.gainNode.disconnect(),this.gainNode.connect(j(this.tag)),this.pannerEnabled=!1))},nt.prototype.setPan=function(t,e,i,n,r,s){this.pannerEnabled&&p===h&&(this.pannerNode.setPosition(t,e,0),this.pannerNode.setOrientation(Math.cos(cr.to_radians(i)),Math.sin(cr.to_radians(i)),0),this.pannerNode.coneInnerAngle=n,this.pannerNode.coneOuterAngle=r,this.pannerNode.coneOuterGain=s,this.panX=t,this.panY=e,this.panAngle=i,this.panConeInner=n,this.panConeOuter=r,this.panConeOuterGain=s)},nt.prototype.setObject=function(t){this.pannerEnabled&&p===h&&(this.objectTracker||(this.objectTracker=new et),this.objectTracker.setObject(t))},nt.prototype.tick=function(t){var e,i;this.pannerEnabled&&p===h&&this.objectTracker&&this.objectTracker.hasObject()&&this.isPlaying()&&(this.objectTracker.tick(t),e=this.objectTracker.obj,i=cr.rotatePtAround(e.x,e.y,-e.layer.getAngle(),_,v,!0),t=cr.rotatePtAround(e.x,e.y,-e.layer.getAngle(),_,v,!1),this.pannerNode.setPosition(i,t,0),void(t=0)!==this.objectTracker.obj.angle&&(t=e.angle-e.layer.getAngle(),this.pannerNode.setOrientation(Math.cos(t),Math.sin(t),0)))},nt.prototype.play=function(t,e,i,n){var r=this.instanceObject;this.looping=t,this.volume=e;var s=i||0;switch(n=n||0,this.myapi){case a:if(1!==r.playbackRate&&(r.playbackRate=1),r.volume!==e*T&&(r.volume=e*T),r.loop!==t&&(r.loop=t),r.muted&&(r.muted=!1),r.currentTime!==s)try{r.currentTime=s}catch(t){}if(this.is_music&&I&&!c.isInUserInputEvent)E.push(this);else try{this.instanceObject.play()}catch(t){console&&console.log&&console.log("[C2] WARNING: exception trying to play audio '"+this.buffer.src+"': ",t)}break;case h:if(this.muted=!1,this.mutevol=1,this.buffer.myapi===h)this.gainNode.gain.value=e*T,this.fresh||(this.instanceObject=d.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode)),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=t,this.hasPlaybackEnded=!1,0===s?V(this.instanceObject,n):W(this.instanceObject,s,this.getDuration(),n);else{if(1!==r.playbackRate&&(r.playbackRate=1),r.loop!==t&&(r.loop=t),r.volume=e*T,r.currentTime!==s)try{r.currentTime=s}catch(t){}this.is_music&&I&&!c.isInUserInputEvent?E.push(this):r.play()}break;case l:(!this.fresh&&this.stopped||0!==s)&&r.seekTo(s),r.play(),this.hasPlaybackEnded=!1;break;case u:(c.isDirectCanvas?AppMobi.context:AppMobi.player).playSound(this.src,t)}this.playbackRate=1,this.startTime=(this.isTimescaled?c.kahanTime:c.wallTime).sum-s,this.fresh=!1,this.stopped=!1,this.is_paused=!1},nt.prototype.stop=function(){switch(this.myapi){case a:this.instanceObject.paused||this.instanceObject.pause();break;case h:this.buffer.myapi===h?e(this.instanceObject):this.instanceObject.paused||this.instanceObject.pause();break;case l:this.instanceObject.stop();break;case u:c.isDirectCanvas&&AppMobi.context.stopSound(this.src)}this.stopped=!0,this.is_paused=!1},nt.prototype.pause=function(){if(!(this.fresh||this.stopped||this.hasEnded()||this.is_paused)){switch(this.myapi){case a:this.instanceObject.paused||this.instanceObject.pause();break;case h:this.buffer.myapi===h?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position=this.resume_position%this.getDuration()),this.is_paused=!0,e(this.instanceObject)):this.instanceObject.paused||this.instanceObject.pause();break;case l:this.instanceObject.pause();break;case u:c.isDirectCanvas&&AppMobi.context.stopSound(this.src)}this.is_paused=!0}},nt.prototype.resume=function(){if(!(this.fresh||this.stopped||this.hasEnded())&&this.is_paused){switch(this.myapi){case a:this.instanceObject.play();break;case h:this.buffer.myapi===h?(this.instanceObject=d.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=T*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?c.kahanTime:c.wallTime).sum-this.resume_position/(this.playbackRate||.001),W(this.instanceObject,this.resume_position,this.getDuration())):this.instanceObject.play();break;case l:this.instanceObject.play();break;case u:c.isDirectCanvas&&AppMobi.context.resumeSound(this.src)}this.is_paused=!1}},nt.prototype.seek=function(t){if(!(this.fresh||this.stopped||this.hasEnded()))switch(this.myapi){case a:try{this.instanceObject.currentTime=t}catch(t){}break;case h:if(this.buffer.myapi===h)this.is_paused?this.resume_position=t:(this.pause(),this.resume_position=t,this.resume());else try{this.instanceObject.currentTime=t}catch(t){}break;case l:break;case u:c.isDirectCanvas&&AppMobi.context.seekSound(this.src,t)}},nt.prototype.reconnect=function(t){this.myapi===h&&(this.pannerEnabled?(this.pannerNode.disconnect(),this.pannerNode.connect(t)):(this.gainNode.disconnect(),this.gainNode.connect(t)))},nt.prototype.getDuration=function(t){var e=0;switch(this.myapi){case a:void 0!==this.instanceObject.duration&&(e=this.instanceObject.duration);break;case h:e=this.buffer.bufferObject.duration;break;case l:e=this.instanceObject.getDuration();break;case u:c.isDirectCanvas&&(e=AppMobi.context.getDurationSound(this.src))}return t&&(e/=this.playbackRate||.001),e},nt.prototype.getPlaybackTime=function(t){var e=this.getDuration(),i=0;switch(this.myapi){case a:void 0!==this.instanceObject.currentTime&&(i=this.instanceObject.currentTime);break;case h:if(this.buffer.myapi===h){if(this.is_paused)return this.resume_position;i=(this.isTimescaled?c.kahanTime:c.wallTime).sum-this.startTime}else void 0!==this.instanceObject.currentTime&&(i=this.instanceObject.currentTime);break;case l:break;case u:c.isDirectCanvas&&(i=AppMobi.context.getPlaybackTimeSound(this.src))}return t&&(i*=this.playbackRate),!this.looping&&e<i&&(i=e),i},nt.prototype.isPlaying=function(){return!(this.is_paused||this.fresh||this.stopped||this.hasEnded())},nt.prototype.shouldSave=function(){return!this.fresh&&!this.stopped&&!this.hasEnded()},nt.prototype.setVolume=function(t){this.volume=t,this.updateVolume()},nt.prototype.updateVolume=function(){var t=this.volume*T;switch(isFinite(t)||(t=0),this.myapi){case a:void 0!==this.instanceObject.volume&&this.instanceObject.volume!==t&&(this.instanceObject.volume=t);break;case h:this.buffer.myapi===h?this.gainNode.gain.value=t*this.mutevol:void 0!==this.instanceObject.volume&&this.instanceObject.volume!==t&&(this.instanceObject.volume=t)}},nt.prototype.getVolume=function(){return this.volume},nt.prototype.doSetMuted=function(t){switch(this.myapi){case a:this.instanceObject.muted!==!!t&&(this.instanceObject.muted=!!t);break;case h:this.buffer.myapi===h?(this.mutevol=t?0:1,this.gainNode.gain.value=T*this.volume*this.mutevol):this.instanceObject.muted!==!!t&&(this.instanceObject.muted=!!t)}},nt.prototype.setMuted=function(t){this.is_muted=!!t,this.doSetMuted(this.is_muted||this.is_silent)},nt.prototype.setSilent=function(t){this.is_silent=!!t,this.doSetMuted(this.is_muted||this.is_silent)},nt.prototype.setLooping=function(t){switch(this.looping=t,this.myapi){case a:case h:this.instanceObject.loop!==!!t&&(this.instanceObject.loop=!!t);break;case l:break;case u:c.isDirectCanvas&&AppMobi.context.setLoopingSound(this.src,t)}},nt.prototype.setPlaybackRate=function(t){this.playbackRate=t,this.updatePlaybackRate()},nt.prototype.updatePlaybackRate=function(){var t=this.playbackRate;switch(this.isTimescaled&&(t*=c.timescale),this.myapi){case a:this.instanceObject.playbackRate!==t&&(this.instanceObject.playbackRate=t);break;case h:this.buffer.myapi===h?this.instanceObject.playbackRate.value!==t&&(this.instanceObject.playbackRate.value=t):this.instanceObject.playbackRate!==t&&(this.instanceObject.playbackRate=t)}},nt.prototype.setSuspended=function(t){switch(this.myapi){case a:t?this.isPlaying()?(this.resume_me=!0,this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.instanceObject.play(),this.resume_me=!1);break;case h:t?this.isPlaying()?(this.resume_me=!0,this.buffer.myapi===h?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position=this.resume_position%this.getDuration()),e(this.instanceObject)):this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.buffer.myapi===h?(this.instanceObject=d.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=T*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?c.kahanTime:c.wallTime).sum-this.resume_position/(this.playbackRate||.001),W(this.instanceObject,this.resume_position,this.getDuration())):this.instanceObject.play(),this.resume_me=!1);break;case l:t?this.isPlaying()?(this.instanceObject.pause(),this.resume_me=!0):this.resume_me=!1:this.resume_me&&(this.resume_me=!1,this.instanceObject.play())}},t.Instance=function(t){this.type=t,this.runtime=t.runtime,c=this.runtime,(r=this).listenerTracker=null,this.listenerZ=-600,this.runtime.isWKWebView&&(R=!0),!(this.runtime.isiOS||this.runtime.isAndroid&&(this.runtime.isChrome||this.runtime.isAndroidStockBrowser))||this.runtime.isCrosswalk||this.runtime.isDomFree||this.runtime.isAmazonWebApp||R||(I=!0),d=null,"undefined"!=typeof AudioContext?(p=h,d=new AudioContext):"undefined"!=typeof webkitAudioContext&&(p=h,d=new webkitAudioContext),this.runtime.isiOS&&d&&(d.close&&d.close(),"undefined"!=typeof AudioContext?d=new AudioContext:"undefined"!=typeof webkitAudioContext&&(d=new webkitAudioContext));function e(){var t,e;!n&&d.createBuffer&&(t=d.createBuffer(1,220,22050),(e=d.createBufferSource()).buffer=t,e.connect(d.destination),V(e))}this.runtime.isAndroid;if(I?document.addEventListener("touchend",function(){!i&&d&&(e(),i=!0),function(){var t,e,i;if(I){if(!S)for(t=0,e=E.length;t<e;++t)(i=E[t]).stopped||i.is_paused||i.instanceObject.play();cr.clearArray(E)}}()},!0):R&&document.addEventListener("touchend",function(){!i&&d&&(e(),i=!0)},!0),p!==h&&(this.runtime.isCordova&&void 0!==window.Media?p=l:this.runtime.isAppMobi&&(p=u)),p===l&&(-1<(t=(o=location.href).lastIndexOf("/"))&&(o=o.substr(0,t+1)),o=o.replace("file://","")),this.runtime.isSafari&&this.runtime.isWindows&&"undefined"==typeof Audio)alert("It looks like you're using Safari for Windows without Quicktime.  Audio cannot be played until Quicktime is installed."),this.runtime.DestroyInstance(this);else{if(this.runtime.isDirectCanvas)g=this.runtime.isAndroid;else try{g=!!(new Audio).canPlayType('audio/ogg; codecs="vorbis"')}catch(t){g=!1}p,this.runtime.tickMe(this)}};var rt=t.Instance.prototype;rt.onCreate=function(){this.runtime.audioInstance=this,m=this.properties[0],this.saveload=this.properties[1],this.playinbackground=0!==this.properties[2],this.nextPlayTime=0,b=this.properties[3],w=this.properties[4],this.listenerZ=-this.properties[5],A=this.properties[6],C=this.properties[7],k=this.properties[8],this.listenerTracker=new et;var t=this.runtime.draw_width||this.runtime.width,e=this.runtime.draw_height||this.runtime.height;p===h&&(d.listener.setPosition(t/2,e/2,this.listenerZ),d.listener.setOrientation(0,0,1,0,-1,0),window.c2OnAudioMicStream=function(t,e){O&&O.disconnect(),P=e.toLowerCase(),(O=d.createMediaStreamSource(t)).connect(j(P))}),this.runtime.addSuspendCallback(function(t){r.onSuspend(t)});var i=this;this.runtime.addDestroyCallback(function(t){i.onInstanceDestroyed(t)})},rt.onInstanceDestroyed=function(t){for(var e,i=0,n=x.length;i<n;i++)(e=x[i]).objectTracker&&e.objectTracker.obj===t&&(e.objectTracker.obj=null,e.pannerEnabled&&e.isPlaying()&&e.looping&&e.stop());this.listenerTracker.obj===t&&(this.listenerTracker.obj=null)},rt.saveToJSON=function(){for(var t,e,i,n,r={silent:S,masterVolume:T,listenerZ:this.listenerZ,listenerUid:this.listenerTracker.hasObject()?this.listenerTracker.obj.uid:-1,playing:[],effects:{}},s=r.playing,o=0,a=x.length;o<a;o++)(t=x[o]).shouldSave()&&3!==this.saveload&&(t.is_music&&1===this.saveload||!t.is_music&&2===this.saveload||(n=t.getPlaybackTime(),t.looping&&(n%=t.getDuration()),e={tag:t.tag,buffersrc:t.buffer.src,is_music:t.is_music,playbackTime:n,volume:t.volume,looping:t.looping,muted:t.is_muted,playbackRate:t.playbackRate,paused:t.is_paused,resume_position:t.resume_position},t.pannerEnabled&&(e.pan={},n=e.pan,t.objectTracker&&t.objectTracker.hasObject()?n.objUid=t.objectTracker.obj.uid:(n.x=t.panX,n.y=t.panY,n.a=t.panAngle),n.ia=t.panConeInner,n.oa=t.panConeOuter,n.og=t.panConeOuterGain),s.push(e)));var h,c=r.effects;for(i in N)if(N.hasOwnProperty(i)){for(h=[],o=0,a=N[i].length;o<a;o++)h.push({type:N[i][o].type,params:N[i][o].params});c[i]=h}return r};var st=[];rt.loadFromJSON=function(t){var e=t.silent;T=t.masterVolume,this.listenerZ=t.listenerZ,this.listenerTracker.setObject(null);var i=t.listenerUid;-1!==i&&(this.listenerTracker.loadUid=i,st.push(this.listenerTracker));var n,r,s,o,a,h,c,l,u,p,d,f,y,g,m,_,v,b,w=t.playing;if(3!==this.saveload)for(n=0,r=x.length;n<r;n++)(d=x[n]).is_music&&1===this.saveload||!d.is_music&&2===this.saveload||d.stop();for(f in N)if(N.hasOwnProperty(f))for(n=0,r=N[f].length;n<r;n++)N[f][n].remove();for(f in cr.wipe(N),t.effects)if(t.effects.hasOwnProperty(f))for(n=0,r=(m=t.effects[f]).length;n<r;n++)switch(_=m[n].type,v=m[n].params,_){case"filter":ut(f,new G(v[0],v[1],v[2],v[3],v[4],v[5]));break;case"delay":ut(f,new q(v[0],v[1],v[2]));break;case"convolve":o=v[2],(p=this.getAudioBuffer(o,!1)).bufferObject?b=new X(p.bufferObject,v[0],v[1],o):(b=new X(null,v[0],v[1],o),p.normalizeWhenReady=v[0],p.convolveWhenReady=b),ut(f,b);break;case"flanger":ut(f,new H(v[0],v[1],v[2],v[3],v[4]));break;case"phaser":ut(f,new Y(v[0],v[1],v[2],v[3],v[4],v[5]));break;case"gain":ut(f,new J(v[0]));break;case"tremolo":ut(f,new Q(v[0],v[1]));break;case"ringmod":ut(f,new K(v[0],v[1]));break;case"distortion":ut(f,new Z(v[0],v[1],v[2],v[3],v[4]));break;case"compressor":ut(f,new $(v[0],v[1],v[2],v[3],v[4]));break;case"analyser":ut(f,new tt(v[0],v[1]))}for(n=0,r=w.length;n<r;n++)3!==this.saveload&&(o=(s=w[n]).buffersrc,a=s.is_music,h=s.tag,c=s.playbackTime,l=s.looping,u=s.volume,g=(y=s.pan)&&y.hasOwnProperty("objUid")?y.objUid:-1,a&&1===this.saveload||!a&&2===this.saveload||((d=this.getAudioInstance(o,h,a,l,u))?(d.resume_position=s.resume_position,d.setPannerEnabled(!!y),d.play(l,u,c),d.updatePlaybackRate(),d.updateVolume(),d.doSetMuted(d.is_muted||d.is_silent),s.paused&&d.pause(),s.muted&&d.setMuted(!0),d.doSetMuted(d.is_muted||d.is_silent),y&&(-1!==g?(d.objectTracker=d.objectTracker||new et,d.objectTracker.loadUid=g,st.push(d.objectTracker)):d.setPan(y.x,y.y,y.a,y.ia,y.oa,y.og))):((p=this.getAudioBuffer(o,a)).seekWhenReady=c,p.pauseWhenReady=s.paused,y&&(-1!==g?p.panWhenReady.push({objUid:g,ia:y.ia,oa:y.oa,og:y.og,thistag:h}):p.panWhenReady.push({x:y.x,y:y.y,a:y.a,ia:y.ia,oa:y.oa,og:y.og,thistag:h})))));if(e&&!S){for(n=0,r=x.length;n<r;n++)x[n].setSilent(!0);S=!0}else if(!e&&S){for(n=0,r=x.length;n<r;n++)x[n].setSilent(!1);S=!1}},rt.afterLoad=function(){for(var t,e,i=0,n=st.length;i<n;i++)t=st[i],e=this.runtime.getObjectByUID(t.loadUid),t.setObject(e),t.loadUid=-1,e&&(_=e.x,v=e.y);cr.clearArray(st)},rt.onSuspend=function(t){if(!this.playinbackground){var e,i;for(!t&&d&&d.resume&&(d.resume(),n=!1),e=0,i=x.length;e<i;e++)x[e].setSuspended(t);t&&d&&d.suspend&&(d.suspend(),n=!0)}},rt.tick=function(){for(var t,e,i,n,r=this.runtime.dt,s=0,o=x.length;s<o;s++)(t=x[s]).tick(r),0!==m&&t.updatePlaybackRate();for(e in N)if(N.hasOwnProperty(e))for(s=0,o=(i=N[e]).length;s<o;s++)(n=i[s]).tick&&n.tick();p===h&&this.listenerTracker.hasObject()&&(this.listenerTracker.tick(r),_=this.listenerTracker.obj.x,v=this.listenerTracker.obj.y,d.listener.setPosition(this.listenerTracker.obj.x,this.listenerTracker.obj.y,this.listenerZ))};var ot=[];rt.setPreloadList=function(t){for(var e,i,n,r=0,s=0,o=t.length;s<o;++s)e=(n=t[s])[0],i=2*n[1],((n=4<e.length&&".ogg"===e.substr(e.length-4))&&g||!n&&!g)&&(ot.push({filename:e,size:i,obj:null}),r+=i);return r},rt.startPreloads=function(){for(var t,e,i=0,n=ot.length;i<n;++i)t=ot[i],e=this.runtime.files_subfolder+t.filename,t.obj=this.getAudioBuffer(e,!1)},rt.getPreloadedSize=function(){for(var t,e=0,i=0,n=ot.length;i<n;++i)(t=ot[i]).obj.isLoadedAndDecoded()||t.obj.hasFailedToLoad()||this.runtime.isDomFree||this.runtime.isAndroidStockBrowser?e+=t.size:t.obj.isLoaded()&&(e+=Math.floor(t.size/2));return e},rt.releaseAllMusicBuffers=function(){for(var t,e=0,i=0,n=f.length;e<n;++e)t=f[e],(f[i]=t).is_music?t.release():++i;f.length=i},rt.getAudioBuffer=function(t,e,i){for(var n,r=null,s=0,o=f.length;s<o;s++)if((n=f[s]).src===t){r=n;break}return r||i||(R&&e&&this.releaseAllMusicBuffers(),r=new it(t,e),f.push(r)),r},rt.getAudioInstance=function(t,e,i,n,r){for(var s,o=0,a=x.length;o<a;o++)if((s=x[o]).src===t&&(s.canBeRecycled()||i))return s.tag=e,s;var h=this.getAudioBuffer(t,i);return h.bufferObject?(s=new nt(h,e),x.push(s),s):("<preload>"!==e&&(h.playTagWhenReady=e,h.loopWhenReady=n,h.volumeWhenReady=r),null)};var at=[];function ht(t,e){t=t.isPlaying()?1:0,e=e.isPlaying()?1:0;return t==e?0:t<e?1:-1}function ct(t,e){if(cr.clearArray(at),!t.length)return y&&!y.hasEnded()&&(cr.clearArray(at),void(at[0]=y));for(var i,n=0,r=x.length;n<r;n++)i=x[n],cr.equals_nocase(t,i.tag)&&at.push(i);e&&at.sort(ht)}function lt(t){var e,i,n,r,s=d.destination;if(N.hasOwnProperty(t)&&(n=N[t]).length)for(s=n[0].getInputNode(),e=0,i=n.length;e<i;e++)r=n[e],e+1===i?r.connectTo(d.destination):r.connectTo(n[e+1].getInputNode());for(ct(t),e=0,i=at.length;e<i;e++)at[e].reconnect(s);O&&P===t&&(O.disconnect(),O.connect(s))}function ut(t,e){N.hasOwnProperty(t)?N[t].push(e):N[t]=[e],lt(t)}function pt(){}function dt(){}function ft(){}function yt(t,e){var i=null;return N.hasOwnProperty(t)&&(i=N[t]),i&&0<=e&&e<i.length&&i[e].freqBins?i[e]:null}pt.prototype.OnEnded=function(t){return cr.equals_nocase(s,t)},pt.prototype.PreloadsComplete=function(){for(var t=0,e=f.length;t<e;t++)if(!f[t].isLoadedAndDecoded()&&!f[t].hasFailedToLoad())return!1;return!0},pt.prototype.AdvancedAudioSupported=function(){return p===h},pt.prototype.IsSilent=function(){return S},pt.prototype.IsAnyPlaying=function(){for(var t=0,e=x.length;t<e;t++)if(x[t].isPlaying())return!0;return!1},pt.prototype.IsTagPlaying=function(t){var e,i;for(ct(t),e=0,i=at.length;e<i;e++)if(at[e].isPlaying())return!0;return!1},t.cnds=new pt,dt.prototype.Play=function(t,e,i,n){var r;S||(r=B(i),i=t[1],t=this.runtime.files_subfolder+t[0]+(g?".ogg":".m4a"),(y=this.getAudioInstance(t,n,i,0!==e,r))&&(y.setPannerEnabled(!1),y.play(0!==e,r,0,this.nextPlayTime),this.nextPlayTime=0))},dt.prototype.PlayAtPosition=function(t,e,i,n,r,s,o,a,h,c){var l;S||(l=B(i),i=t[1],t=this.runtime.files_subfolder+t[0]+(g?".ogg":".m4a"),(y=this.getAudioInstance(t,c,i,0!==e,l))?(y.setPannerEnabled(!0),y.setPan(n,r,s,o,a,B(h)),y.play(0!==e,l,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(t,i).panWhenReady.push({x:n,y:r,a:s,ia:o,oa:a,og:B(h),thistag:c}))},dt.prototype.PlayAtObject=function(t,e,i,n,r,s,o,a){var h,c,l;S||!n||(h=n.getFirstPicked())&&(c=B(i),l=t[1],n=this.runtime.files_subfolder+t[0]+(g?".ogg":".m4a"),(y=this.getAudioInstance(n,a,l,0!==e,c))?(y.setPannerEnabled(!0),i=cr.rotatePtAround(h.x,h.y,-h.layer.getAngle(),_,v,!0),t=cr.rotatePtAround(h.x,h.y,-h.layer.getAngle(),_,v,!1),y.setPan(i,t,cr.to_degrees(h.angle-h.layer.getAngle()),r,s,B(o)),y.setObject(h),y.play(0!==e,c,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(n,l).panWhenReady.push({obj:h,ia:r,oa:s,og:B(o),thistag:a}))},dt.prototype.PlayByName=function(t,e,i,n,r){S||(n=B(n),t=1===t,e=this.runtime.files_subfolder+e.toLowerCase()+(g?".ogg":".m4a"),(y=this.getAudioInstance(e,r,t,0!==i,n))&&(y.setPannerEnabled(!1),y.play(0!==i,n,0,this.nextPlayTime),this.nextPlayTime=0))},dt.prototype.PlayAtPositionByName=function(t,e,i,n,r,s,o,a,h,c,l){S||(n=B(n),t=1===t,e=this.runtime.files_subfolder+e.toLowerCase()+(g?".ogg":".m4a"),(y=this.getAudioInstance(e,l,t,0!==i,n))?(y.setPannerEnabled(!0),y.setPan(r,s,o,a,h,B(c)),y.play(0!==i,n,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(e,t).panWhenReady.push({x:r,y:s,a:o,ia:a,oa:h,og:B(c),thistag:l}))},dt.prototype.PlayAtObjectByName=function(t,e,i,n,r,s,o,a,h){var c,l;S||!r||(c=r.getFirstPicked())&&(l=B(n),r=1===t,n=this.runtime.files_subfolder+e.toLowerCase()+(g?".ogg":".m4a"),(y=this.getAudioInstance(n,h,r,0!==i,l))?(y.setPannerEnabled(!0),t=cr.rotatePtAround(c.x,c.y,-c.layer.getAngle(),_,v,!0),e=cr.rotatePtAround(c.x,c.y,-c.layer.getAngle(),_,v,!1),y.setPan(t,e,cr.to_degrees(c.angle-c.layer.getAngle()),s,o,B(a)),y.setObject(c),y.play(0!==i,l,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(n,r).panWhenReady.push({obj:c,ia:s,oa:o,og:B(a),thistag:h}))},dt.prototype.SetLooping=function(t,e){var i,n;for(ct(t),i=0,n=at.length;i<n;i++)at[i].setLooping(0===e)},dt.prototype.SetMuted=function(t,e){var i,n;for(ct(t),i=0,n=at.length;i<n;i++)at[i].setMuted(0===e)},dt.prototype.SetVolume=function(t,e){ct(t);for(var i=B(e),n=0,r=at.length;n<r;n++)at[n].setVolume(i)},dt.prototype.Preload=function(t){var e;S||(e=t[1],t=this.runtime.files_subfolder+t[0]+(g?".ogg":".m4a"),p!==u?p!==l&&this.getAudioInstance(t,"<preload>",e,!1):(this.runtime.isDirectCanvas?AppMobi.context:AppMobi.player).loadSound(t))},dt.prototype.PreloadByName=function(t,e){S||(t=1===t,e=this.runtime.files_subfolder+e.toLowerCase()+(g?".ogg":".m4a"),p!==u?p!==l&&this.getAudioInstance(e,"<preload>",t,!1):(this.runtime.isDirectCanvas?AppMobi.context:AppMobi.player).loadSound(e))},dt.prototype.SetPlaybackRate=function(t,e){var i,n;for(ct(t),e<0&&(e=0),i=0,n=at.length;i<n;i++)at[i].setPlaybackRate(e)},dt.prototype.Stop=function(t){var e,i;for(ct(t),e=0,i=at.length;e<i;e++)at[e].stop()},dt.prototype.StopAll=function(){for(var t=0,e=x.length;t<e;t++)x[t].stop()},dt.prototype.SetPaused=function(t,e){var i,n;for(ct(t),i=0,n=at.length;i<n;i++)0===e?at[i].pause():at[i].resume()},dt.prototype.Seek=function(t,e){var i,n;for(ct(t),i=0,n=at.length;i<n;i++)at[i].seek(e)},dt.prototype.SetSilent=function(t){var e,i;if(2===t&&(t=S?1:0),0!==t||S){if(1===t&&S){for(e=0,i=x.length;e<i;e++)x[e].setSilent(!1);S=!1}}else{for(e=0,i=x.length;e<i;e++)x[e].setSilent(!0);S=!0}},dt.prototype.SetMasterVolume=function(t){var e,i;for(T=B(t),e=0,i=x.length;e<i;e++)x[e].updateVolume()},dt.prototype.AddFilterEffect=function(t,e,i,n,r,s,o){p!==h||e<0||U.length<=e||!d.createBiquadFilter||((o/=100)<0&&(o=0),1<o&&(o=1),ut(t=t.toLowerCase(),new G(e,i,n,r,s,o)))},dt.prototype.AddDelayEffect=function(t,e,i,n){p===h&&((n/=100)<0&&(n=0),1<n&&(n=1),ut(t=t.toLowerCase(),new q(e,B(i),n)))},dt.prototype.AddFlangerEffect=function(t,e,i,n,r,s){p===h&&d.createOscillator&&((s/=100)<0&&(s=0),1<s&&(s=1),ut(t=t.toLowerCase(),new H(e/1e3,i/1e3,n,r/100,s)))},dt.prototype.AddPhaserEffect=function(t,e,i,n,r,s,o){p===h&&d.createOscillator&&((o/=100)<0&&(o=0),1<o&&(o=1),ut(t=t.toLowerCase(),new Y(e,i,n,r,s,o)))},dt.prototype.AddConvolutionEffect=function(t,e,i,n){var r,s;p===h&&d.createConvolver&&(r=0===i,i=this.runtime.files_subfolder+e[0]+(g?".ogg":".m4a"),e=this.getAudioBuffer(i,!1),t=t.toLowerCase(),(n/=100)<0&&(n=0),1<n&&(n=1),e.bufferObject?s=new X(e.bufferObject,r,n,i):(s=new X(null,r,n,i),e.normalizeWhenReady=r,e.convolveWhenReady=s),ut(t,s))},dt.prototype.AddGainEffect=function(t,e){p===h&&ut(t=t.toLowerCase(),new J(B(e)))},dt.prototype.AddMuteEffect=function(t){p===h&&ut(t=t.toLowerCase(),new J(0))},dt.prototype.AddTremoloEffect=function(t,e,i){p===h&&d.createOscillator&&((i/=100)<0&&(i=0),1<i&&(i=1),ut(t=t.toLowerCase(),new Q(e,i)))},dt.prototype.AddRingModEffect=function(t,e,i){p===h&&d.createOscillator&&((i/=100)<0&&(i=0),1<i&&(i=1),ut(t=t.toLowerCase(),new K(e,i)))},dt.prototype.AddDistortionEffect=function(t,e,i,n,r,s){p===h&&d.createWaveShaper&&((s/=100)<0&&(s=0),1<s&&(s=1),ut(t=t.toLowerCase(),new Z(e,i,n,r,s)))},dt.prototype.AddCompressorEffect=function(t,e,i,n,r,s){p===h&&d.createDynamicsCompressor&&ut(t=t.toLowerCase(),new $(e,i,n,r/1e3,s/1e3))},dt.prototype.AddAnalyserEffect=function(t,e,i){p===h&&ut(t=t.toLowerCase(),new tt(e,i))},dt.prototype.RemoveEffects=function(t){var e,i,n;if(p===h&&(t=t.toLowerCase(),N.hasOwnProperty(t)&&(n=N[t]).length)){for(e=0,i=n.length;e<i;e++)n[e].remove();cr.clearArray(n),lt(t)}},dt.prototype.SetEffectParameter=function(t,e,i,n,r,s){p===h&&(t=t.toLowerCase(),e=Math.floor(e),N.hasOwnProperty(t)&&(t=N[t],e<0||e>=t.length||t[e].setParam(i,n,r,s)))},dt.prototype.SetListenerObject=function(t){!t||p!==h||(t=t.getFirstPicked())&&(this.listenerTracker.setObject(t),_=t.x,v=t.y)},dt.prototype.SetListenerZ=function(t){this.listenerZ=t},dt.prototype.ScheduleNextPlay=function(t){d&&(this.nextPlayTime=t)},dt.prototype.UnloadAudio=function(t){var e=t[1],t=this.runtime.files_subfolder+t[0]+(g?".ogg":".m4a"),e=this.getAudioBuffer(t,e,!0);e&&(e.release(),cr.arrayFindRemove(f,e))},dt.prototype.UnloadAudioByName=function(t,e){t=1===t,e=this.runtime.files_subfolder+e.toLowerCase()+(g?".ogg":".m4a"),t=this.getAudioBuffer(e,t,!0);t&&(t.release(),cr.arrayFindRemove(f,t))},dt.prototype.UnloadAll=function(){for(var t=0,e=f.length;t<e;++t)f[t].release();cr.clearArray(f)},t.acts=new dt,ft.prototype.Duration=function(t,e){ct(e,!0),at.length?t.set_float(at[0].getDuration()):t.set_float(0)},ft.prototype.PlaybackTime=function(t,e){ct(e,!0),at.length?t.set_float(at[0].getPlaybackTime(!0)):t.set_float(0)},ft.prototype.Volume=function(t,e){ct(e,!0),at.length?(e=at[0].getVolume(),t.set_float(L(e))):t.set_float(0)},ft.prototype.MasterVolume=function(t){t.set_float(L(T))},ft.prototype.EffectCount=function(t,e){e=e.toLowerCase();var i=null;N.hasOwnProperty(e)&&(i=N[e]),t.set_int(i?i.length:0)},ft.prototype.AnalyserFreqBinCount=function(t,e,i){i=yt(e=e.toLowerCase(),i=Math.floor(i));t.set_int(i?i.node.frequencyBinCount:0)},ft.prototype.AnalyserFreqBinAt=function(t,e,i,n){e=e.toLowerCase(),i=Math.floor(i),n=Math.floor(n);i=yt(e,i);!i||n<0||n>=i.node.frequencyBinCount?t.set_float(0):t.set_float(i.freqBins[n])},ft.prototype.AnalyserPeakLevel=function(t,e,i){i=yt(e=e.toLowerCase(),i=Math.floor(i));i?t.set_float(i.peak):t.set_float(0)},ft.prototype.AnalyserRMSLevel=function(t,e,i){i=yt(e=e.toLowerCase(),i=Math.floor(i));i?t.set_float(i.rms):t.set_float(0)},ft.prototype.SampleRate=function(t){t.set_int(d?d.sampleRate:0)},ft.prototype.CurrentTime=function(t){t.set_float(d?d.currentTime:cr.performance_now())},t.exps=new ft}(),cr.plugins_.Browser=function(t){this.runtime=t},function(){var pluginProto=cr.plugins_.Browser.prototype;pluginProto.Type=function(t){this.plugin=t,this.runtime=t.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){};var offlineScriptReady=!1,browserPluginReady=!1;document.addEventListener("DOMContentLoaded",function(){var t;window.C2_RegisterSW&&navigator.serviceWorker&&((t=document.createElement("script")).onload=function(){offlineScriptReady=!0,checkReady()},t.src="https://274539104-375910364482639571.preview.editmysite.com/uploads/b/139890129-908503369318119606/files/offlineClient.js",document.head.appendChild(t))});var browserInstance=null;function checkReady(){offlineScriptReady&&browserPluginReady&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(function(t){browserInstance.onSWMessage(t)})}typeProto.onAppBegin=function(){browserPluginReady=!0,checkReady()},pluginProto.Instance=function(t){this.type=t,this.runtime=t.runtime};var instanceProto=pluginProto.Instance.prototype;instanceProto.onCreate=function(){var e=this;window.addEventListener("resize",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnResize,e)}),browserInstance=this,void 0!==navigator.onLine&&(window.addEventListener("online",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOnline,e)}),window.addEventListener("offline",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOffline,e)})),void 0!==window.applicationCache&&(window.applicationCache.addEventListener("updateready",function(){e.runtime.loadingprogress=1,e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,e)}),window.applicationCache.addEventListener("progress",function(t){e.runtime.loadingprogress=t.loaded/t.total||0})),this.runtime.isDirectCanvas||(document.addEventListener("appMobi.device.update.available",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,e)}),document.addEventListener("backbutton",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,e)}),document.addEventListener("menubutton",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,e)}),document.addEventListener("searchbutton",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnSearchButton,e)}),document.addEventListener("tizenhwkey",function(t){switch(t.keyName){case"back":e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,e)||window.tizen&&window.tizen.application.getCurrentApplication().exit();break;case"menu":e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,e)||t.preventDefault()}})),this.runtime.isWindows10&&"undefined"!=typeof Windows?Windows.UI.Core.SystemNavigationManager.getForCurrentView().addEventListener("backrequested",function(t){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,e)&&(t.handled=!0)}):this.runtime.isWinJS&&WinJS.Application&&(WinJS.Application.onbackclick=function(t){return!!e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,e)}),this.runtime.addSuspendCallback(function(t){t?e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageHidden,e):e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageVisible,e)}),this.is_arcade=void 0!==window.is_scirra_arcade},instanceProto.onSWMessage=function(t){t=t.data.type;"downloading-update"===t?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateFound,this):"update-ready"===t||"update-pending"===t?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,this):"offline-ready"===t&&this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOfflineReady,this)};var batteryManager=null,loadedBatteryManager=!1;function maybeLoadBatteryManager(){var t;loadedBatteryManager||navigator.getBattery&&(t=navigator.getBattery(),loadedBatteryManager=!0,t&&t.then(function(t){batteryManager=t}))}function Cnds(){}function Acts(){}Cnds.prototype.CookiesEnabled=function(){return!!navigator&&navigator.cookieEnabled},Cnds.prototype.IsOnline=function(){return!!navigator&&navigator.onLine},Cnds.prototype.HasJava=function(){return!!navigator&&navigator.javaEnabled()},Cnds.prototype.OnOnline=function(){return!0},Cnds.prototype.OnOffline=function(){return!0},Cnds.prototype.IsDownloadingUpdate=function(){return void 0!==window.applicationCache&&window.applicationCache.status===window.applicationCache.DOWNLOADING},Cnds.prototype.OnUpdateReady=function(){return!0},Cnds.prototype.PageVisible=function(){return!this.runtime.isSuspended},Cnds.prototype.OnPageVisible=function(){return!0},Cnds.prototype.OnPageHidden=function(){return!0},Cnds.prototype.OnResize=function(){return!0},Cnds.prototype.IsFullscreen=function(){return!!(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||this.runtime.isNodeFullscreen)},Cnds.prototype.OnBackButton=function(){return!0},Cnds.prototype.OnMenuButton=function(){return!0},Cnds.prototype.OnSearchButton=function(){return!0},Cnds.prototype.IsMetered=function(){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return!!t&&!!t.metered},Cnds.prototype.IsCharging=function(){var t=navigator.battery||navigator.mozBattery||navigator.webkitBattery;return t?!!t.charging:(maybeLoadBatteryManager(),!batteryManager||!!batteryManager.charging)},Cnds.prototype.IsPortraitLandscape=function(t){return(window.innerWidth<=window.innerHeight?0:1)===t},Cnds.prototype.SupportsFullscreen=function(){if(this.runtime.isNodeWebkit)return!0;var t=this.runtime.canvasdiv||this.runtime.canvas;return!!(t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullScreen)},Cnds.prototype.OnUpdateFound=function(){return!0},Cnds.prototype.OnUpdateReady=function(){return!0},Cnds.prototype.OnOfflineReady=function(){return!0},pluginProto.cnds=new Cnds,Acts.prototype.Alert=function(t){this.runtime.isDomFree||alert(t.toString())},Acts.prototype.Close=function(){this.runtime.isCocoonJs?CocoonJS.App.forceToFinish():window.tizen?window.tizen.application.getCurrentApplication().exit():navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():this.is_arcade||this.runtime.isDomFree||window.close()},Acts.prototype.Focus=function(){this.runtime.isNodeWebkit?window.nwgui.Window.get().focus():this.is_arcade||this.runtime.isDomFree||window.focus()},Acts.prototype.Blur=function(){this.runtime.isNodeWebkit?window.nwgui.Window.get().blur():this.is_arcade||this.runtime.isDomFree||window.blur()},Acts.prototype.GoBack=function(){navigator.app&&navigator.app.backHistory?navigator.app.backHistory():this.is_arcade||this.runtime.isDomFree||!window.back||window.back()},Acts.prototype.GoForward=function(){this.is_arcade||this.runtime.isDomFree||!window.forward||window.forward()},Acts.prototype.GoHome=function(){this.is_arcade||this.runtime.isDomFree||!window.home||window.home()},Acts.prototype.GoToURL=function(t,e){this.runtime.isCocoonJs?CocoonJS.App.openURL(t):this.runtime.isEjecta?ejecta.openURL(t):this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(t)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(t,{openExternal:!0}):this.runtime.isCordova?window.open(t,"_system"):this.is_arcade||this.runtime.isDomFree||(2!==e||this.is_arcade?1!==e||this.is_arcade?window.location=t:window.parent.location=t:window.top.location=t)},Acts.prototype.GoToURLWindow=function(t,e){this.runtime.isCocoonJs?CocoonJS.App.openURL(t):this.runtime.isEjecta?ejecta.openURL(t):this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(t)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(t,{openExternal:!0}):this.runtime.isCordova?window.open(t,"_system"):this.is_arcade||this.runtime.isDomFree||window.open(t,e)},Acts.prototype.Reload=function(){this.is_arcade||this.runtime.isDomFree||window.location.reload()};var firstRequestFullscreen=!0,crruntime=null;function onFullscreenError(t){console&&console.warn&&console.warn("Fullscreen request failed: ",t),crruntime.setSize(window.innerWidth,window.innerHeight)}Acts.prototype.RequestFullScreen=function(t){this.runtime.isDomFree?cr.logexport("[Construct 2] Requesting fullscreen is not supported on this platform - the request has been ignored"):(2<=t&&(t+=1),6===t&&(t=2),this.runtime.isNodeWebkit?this.runtime.isDebug?debuggerFullscreen(!0):!this.runtime.isNodeFullscreen&&window.nwgui&&(window.nwgui.Window.get().enterFullscreen(),this.runtime.isNodeFullscreen=!0,this.runtime.fullscreen_scaling=2<=t?t:0):document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||document.fullScreen||document.fullScreenElement||(this.runtime.fullscreen_scaling=2<=t?t:0,t=document.documentElement,firstRequestFullscreen&&(firstRequestFullscreen=!1,crruntime=this.runtime,t.addEventListener("mozfullscreenerror",onFullscreenError),t.addEventListener("webkitfullscreenerror",onFullscreenError),t.addEventListener("MSFullscreenError",onFullscreenError),t.addEventListener("fullscreenerror",onFullscreenError)),t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():t.webkitRequestFullScreen&&("undefined"!=typeof Element&&void 0!==Element.ALLOW_KEYBOARD_INPUT?t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):t.webkitRequestFullScreen())))},Acts.prototype.CancelFullScreen=function(){this.runtime.isDomFree?cr.logexport("[Construct 2] Exiting fullscreen is not supported on this platform - the request has been ignored"):this.runtime.isNodeWebkit?this.runtime.isDebug?debuggerFullscreen(!1):this.runtime.isNodeFullscreen&&window.nwgui&&(window.nwgui.Window.get().leaveFullscreen(),this.runtime.isNodeFullscreen=!1):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},Acts.prototype.Vibrate=function(t){try{for(var e=t.split(","),i=0,n=e.length;i<n;i++)e[i]=parseInt(e[i],10);navigator.vibrate?navigator.vibrate(e):navigator.mozVibrate?navigator.mozVibrate(e):navigator.webkitVibrate?navigator.webkitVibrate(e):navigator.msVibrate&&navigator.msVibrate(e)}catch(t){}},Acts.prototype.InvokeDownload=function(t,e){var i,n=document.createElement("a");void 0===n.download?window.open(t):(i=document.getElementsByTagName("body")[0],n.textContent=e,n.href=t,n.download=e,i.appendChild(n),e=new MouseEvent("click"),n.dispatchEvent(e),i.removeChild(n))},Acts.prototype.InvokeDownloadString=function(t,e,i){var n="data:"+e+","+encodeURIComponent(t),e=document.createElement("a");void 0===e.download?window.open(n):(t=document.getElementsByTagName("body")[0],e.textContent=i,e.href=n,e.download=i,t.appendChild(e),i=new MouseEvent("click"),e.dispatchEvent(i),t.removeChild(e))},Acts.prototype.ConsoleLog=function(t,e){"undefined"!=typeof console&&(0===t&&console.log&&console.log(e.toString()),1===t&&console.warn&&console.warn(e.toString()),2===t&&console.error&&console.error(e.toString()))},Acts.prototype.ConsoleGroup=function(t){console&&console.group&&console.group(t)},Acts.prototype.ConsoleGroupEnd=function(){console&&console.groupEnd&&console.groupEnd()},Acts.prototype.ExecJs=function(js_){try{eval&&eval(js_)}catch(e){console&&console.error&&console.error("Error executing Javascript: ",e)}};var orientations=["portrait","landscape","portrait-primary","portrait-secondary","landscape-primary","landscape-secondary"];function Exps(){}Acts.prototype.LockOrientation=function(t){(t=Math.floor(t))<0||t>=orientations.length||(this.runtime.autoLockOrientation=!1,t=orientations[t],screen.orientation&&screen.orientation.lock?screen.orientation.lock(t):screen.lockOrientation?screen.lockOrientation(t):screen.webkitLockOrientation?screen.webkitLockOrientation(t):screen.mozLockOrientation?screen.mozLockOrientation(t):screen.msLockOrientation&&screen.msLockOrientation(t))},Acts.prototype.UnlockOrientation=function(){this.runtime.autoLockOrientation=!1,screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()},pluginProto.acts=new Acts,Exps.prototype.URL=function(t){t.set_string(this.runtime.isDomFree?"":window.location.toString())},Exps.prototype.Protocol=function(t){t.set_string(this.runtime.isDomFree?"":window.location.protocol)},Exps.prototype.Domain=function(t){t.set_string(this.runtime.isDomFree?"":window.location.hostname)},Exps.prototype.PathName=function(t){t.set_string(this.runtime.isDomFree?"":window.location.pathname)},Exps.prototype.Hash=function(t){t.set_string(this.runtime.isDomFree?"":window.location.hash)},Exps.prototype.Referrer=function(t){t.set_string(this.runtime.isDomFree?"":document.referrer)},Exps.prototype.Title=function(t){t.set_string(this.runtime.isDomFree?"":document.title)},Exps.prototype.Name=function(t){t.set_string(this.runtime.isDomFree?"":navigator.appName)},Exps.prototype.Version=function(t){t.set_string(this.runtime.isDomFree?"":navigator.appVersion)},Exps.prototype.Language=function(t){navigator&&navigator.language?t.set_string(navigator.language):t.set_string("")},Exps.prototype.Platform=function(t){t.set_string(this.runtime.isDomFree?"":navigator.platform)},Exps.prototype.Product=function(t){navigator&&navigator.product?t.set_string(navigator.product):t.set_string("")},Exps.prototype.Vendor=function(t){navigator&&navigator.vendor?t.set_string(navigator.vendor):t.set_string("")},Exps.prototype.UserAgent=function(t){t.set_string(this.runtime.isDomFree?"":navigator.userAgent)},Exps.prototype.QueryString=function(t){t.set_string(this.runtime.isDomFree?"":window.location.search)},Exps.prototype.QueryParam=function(t,e){!this.runtime.isDomFree&&(e=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search))?t.set_string(decodeURIComponent(e[1].replace(/\+/g," "))):t.set_string("")},Exps.prototype.Bandwidth=function(t){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e?void 0!==e.bandwidth?t.set_float(e.bandwidth):void 0!==e.downlinkMax?t.set_float(e.downlinkMax):t.set_float(Number.POSITIVE_INFINITY):t.set_float(Number.POSITIVE_INFINITY)},Exps.prototype.ConnectionType=function(t){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e?t.set_string(e.type||"unknown"):t.set_string("unknown")},Exps.prototype.BatteryLevel=function(t){var e=navigator.battery||navigator.mozBattery||navigator.webkitBattery;e?t.set_float(e.level):(maybeLoadBatteryManager(),batteryManager?t.set_float(batteryManager.level):t.set_float(1))},Exps.prototype.BatteryTimeLeft=function(t){var e=navigator.battery||navigator.mozBattery||navigator.webkitBattery;e?t.set_float(e.dischargingTime):(maybeLoadBatteryManager(),batteryManager?t.set_float(batteryManager.dischargingTime):t.set_float(Number.POSITIVE_INFINITY))},Exps.prototype.ExecJS=function(ret,js_){if(eval){var result=0;try{result=eval(js_)}catch(e){console&&console.error&&console.error("Error executing Javascript: ",e)}"number"==typeof result||"string"==typeof result?ret.set_any(result):"boolean"==typeof result?ret.set_any(result?1:0):ret.set_any(0)}else ret.set_any(0)},Exps.prototype.ScreenWidth=function(t){t.set_int(screen.width)},Exps.prototype.ScreenHeight=function(t){t.set_int(screen.height)},Exps.prototype.DevicePixelRatio=function(t){t.set_float(this.runtime.devicePixelRatio)},Exps.prototype.WindowInnerWidth=function(t){t.set_int(window.innerWidth)},Exps.prototype.WindowInnerHeight=function(t){t.set_int(window.innerHeight)},Exps.prototype.WindowOuterWidth=function(t){t.set_int(window.outerWidth)},Exps.prototype.WindowOuterHeight=function(t){t.set_int(window.outerHeight)},pluginProto.exps=new Exps}(),cr.plugins_.Function=function(t){this.runtime=t},function(){var t=cr.plugins_.Function.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var e=t.Instance.prototype,i=[],n=-1;function r(){this.name="",this.retVal=0,this.params=[]}function a(){return++n===i.length&&i.push(new r),i[n]}function s(){return n<0?null:i[n]}function h(){n--}function o(){}function c(){}function l(){}e.onCreate=function(){0;var o=this;window.c2_callFunction=function(t,e){var i,n,r,s=a();if(s.name=t.toLowerCase(),s.retVal=0,e)for(s.params.length=e.length,i=0,n=e.length;i<n;++i)r=e[i],s.params[i]="number"==typeof r||"string"==typeof r?r:"boolean"==typeof r&&r?1:0;else cr.clearArray(s.params);return o.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,o,s.name),h(),s.retVal}},o.prototype.OnFunction=function(t){var e=s();return!!e&&cr.equals_nocase(t,e.name)},o.prototype.CompareParam=function(t,e,i){var n=s();return!!n&&(!((t=cr.floor(t))<0||t>=n.params.length)&&cr.do_cmp(n.params[t],e,i))},t.cnds=new o,c.prototype.CallFunction=function(t,e){var i=a();i.name=t.toLowerCase(),i.retVal=0,cr.shallowAssignArray(i.params,e);this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,i.name);h()},c.prototype.SetReturnValue=function(t){var e=s();e&&(e.retVal=t)},c.prototype.CallExpression=function(t){},t.acts=new c,l.prototype.ReturnValue=function(t){var e=function(){if(!i.length)return null;var t=n+1;return t>=i.length&&(t=i.length-1),i[t]}();e?t.set_any(e.retVal):t.set_int(0)},l.prototype.ParamCount=function(t){var e=s();e?t.set_int(e.params.length):t.set_int(0)},l.prototype.Param=function(t,e){e=cr.floor(e);var i=s();i&&0<=e&&e<i.params.length?t.set_any(i.params[e]):t.set_int(0)},l.prototype.Call=function(t,e){var i,n,r=a();for(r.name=e.toLowerCase(),r.retVal=0,cr.clearArray(r.params),i=2,n=arguments.length;i<n;i++)r.params.push(arguments[i]);this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,r.name);h(),t.set_any(r.retVal)},t.exps=new l}();var localForageInitFailed=!1;try{!function(){var t,a,h,c,l;c={},l={},h=a=function(o){if(h._eak_seen=c,l[o])return l[o];if(l[o]={},!c[o])throw new Error("Could not find module "+o);for(var t,e=c[o],i=e.deps,e=e.callback,n=[],r=0,s=i.length;r<s;r++)"exports"===i[r]?n.push(t={}):n.push(a(function(t){if("."!==t.charAt(0))return t;for(var e=t.split("/"),i=o.split("/").slice(0,-1),n=0,r=e.length;n<r;n++){var s=e[n];".."===s?i.pop():"."!==s&&i.push(s)}return i.join("/")}(i[r])));e=e.apply(this,n);return l[o]=t||e},(t=function(t,e,i){c[t]={deps:e,callback:i}})("promise/all",["./utils","exports"],function(t,e){"use strict";var i=t.isArray,h=t.isFunction;e.all=function(a){if(!i(a))throw new TypeError("You must pass an array to all.");return new this(function(i,t){function n(t,e){r[t]=e,0==--s&&i(r)}var e,r=[],s=a.length;0===s&&i([]);for(var o=0;o<a.length;o++)(e=a[o])&&h(e.then)?e.then(function(e){return function(t){n(e,t)}}(o),t):n(o,e)})}}),t("promise/asap",["exports"],function(t){"use strict";function e(){for(var t=0;t<h.length;t++){var e=h[t];(0,e[0])(e[1])}h=[]}var i,n,r,s="undefined"!=typeof window?window:{},o=s.MutationObserver||s.WebKitMutationObserver,a="undefined"!=typeof global?global:void 0===this?window:this,h=[],c="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?function(){process.nextTick(e)}:o?(i=0,n=new o(e),r=document.createTextNode(""),n.observe(r,{characterData:!0}),function(){r.data=i=++i%2}):function(){a.setTimeout(e,1)};t.asap=function(t,e){1===h.push([t,e])&&c()}}),t("promise/config",["exports"],function(t){"use strict";var i={instrument:!1};t.config=i,t.configure=function(t,e){return 2!==arguments.length?i[t]:void(i[t]=e)}}),t("promise/polyfill",["./promise","./utils","exports"],function(t,e,i){"use strict";var n=t.Promise,r=e.isFunction;i.polyfill=function(){var e,t="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;"Promise"in t&&"resolve"in t.Promise&&"reject"in t.Promise&&"all"in t.Promise&&"race"in t.Promise&&(new t.Promise(function(t){e=t}),r(e))||(t.Promise=n)}}),t("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(t,e,i,n,r,s,o,a){"use strict";function h(t){if(!v(t))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof h))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],function(t,e){function i(t){f(e,t)}try{t(function(t){p(e,t)},i)}catch(t){i(t)}}(t,this)}function c(t,e,i,n){var r,s,o,a,h=v(i);if(h)try{r=i(n),o=!0}catch(t){a=!0,s=t}else r=n,o=!0;u(e,r)||(h&&o?p(e,r):a?f(e,s):t===x?p(e,r):t===S&&f(e,r))}function l(t,e){for(var i=t._subscribers,n=t._detail,r=0;r<i.length;r+=3)c(e,i[r],i[r+e],n);t._subscribers=null}function u(e,i){var n,t=null;try{if(e===i)throw new TypeError("A promises callback cannot return that same promise.");if(_(i)&&(t=i.then,v(t)))return t.call(i,function(t){return!!n||(n=!0,void(i!==t?p:d)(e,t))},function(t){return!!n||(n=!0,void f(e,t))}),1}catch(t){return n||f(e,t),1}}function p(t,e){t!==e&&u(t,e)||d(t,e)}function d(t,e){t._state===b&&(t._state=w,t._detail=e,m.async(y,t))}function f(t,e){t._state===b&&(t._state=w,t._detail=e,m.async(g,t))}function y(t){l(t,t._state=x)}function g(t){l(t,t._state=S)}var m=t.config,_=(t.configure,e.objectOrFunction),v=e.isFunction,i=(e.now,i.all),n=n.race,r=r.resolve,s=s.reject,o=o.asap;m.async=o;var b=void 0,w=0,x=1,S=2;h.prototype={constructor:h,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(t,e){var i,n,r,s,o=this,a=new this.constructor(function(){});return this._state?(i=arguments,m.async(function(){c(o._state,a,i[o._state-1],o._detail)})):(n=a,r=t,s=e,t=(e=(t=this)._subscribers).length,e[t]=n,e[t+x]=r,e[t+S]=s),a},catch:function(t){return this.then(null,t)}},h.all=i,h.race=n,h.resolve=r,h.reject=s,a.Promise=h}),t("promise/race",["./utils","exports"],function(t,e){"use strict";var i=t.isArray;e.race=function(r){if(!i(r))throw new TypeError("You must pass an array to race.");return new this(function(t,e){for(var i,n=0;n<r.length;n++)(i=r[n])&&"function"==typeof i.then?i.then(t,e):t(i)})}}),t("promise/reject",["exports"],function(t){"use strict";t.reject=function(i){return new this(function(t,e){e(i)})}}),t("promise/resolve",["exports"],function(t){"use strict";t.resolve=function(e){return e&&"object"==typeof e&&e.constructor===this?e:new this(function(t){t(e)})}}),t("promise/utils",["exports"],function(t){"use strict";function e(t){return"function"==typeof t}var i=Date.now||function(){return(new Date).getTime()};t.objectOrFunction=function(t){return e(t)||"object"==typeof t&&null!==t},t.isFunction=e,t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.now=i}),a("promise/polyfill").polyfill()}(),function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.localforage=e():t.localforage=e()}(this,function(){return r={},i.m=n=[function(t,e,s){"use strict";e.__esModule=!0;var i,n,c,r,o,l,a,u,h,i=(i="undefined"!=typeof window?window:self,c={},o=[(r={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"}).INDEXEDDB,r.WEBSQL,r.LOCALSTORAGE],l=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],a={description:"",driver:o.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},n=i,(i={})[r.INDEXEDDB]=!!function(){try{var t=n.indexedDB||n.webkitIndexedDB||n.mozIndexedDB||n.OIndexedDB||n.msIndexedDB;return(!(void 0!==n.openDatabase&&n.navigator&&n.navigator.userAgent&&/Safari/.test(n.navigator.userAgent))||/Chrome/.test(n.navigator.userAgent))&&(t&&"function"==typeof t.open&&void 0!==n.IDBKeyRange)}catch(t){return}}(),i[r.WEBSQL]=!!function(){try{return n.openDatabase}catch(t){return}}(),i[r.LOCALSTORAGE]=!!function(){try{return n.localStorage&&"setItem"in n.localStorage&&n.localStorage.setItem}catch(t){return}}(),u=i,h=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},new(f.prototype.config=function(t){if("object"!=typeof t)return"string"==typeof t?this._config[t]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t)"storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),this._config[e]=t[e];return"driver"in t&&t.driver&&this.setDriver(this._config.driver),!0},f.prototype.defineDriver=function(h,t,e){var i=new Promise(function(e,i){try{var n=h._driver,t=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver"),r=new Error("Custom driver name already in use: "+h._driver);if(!h._driver)return void i(t);if(d(h._driver))return void i(r);for(var s=l.concat("_initStorage"),o=0;o<s.length;o++){var a=s[o];if(!a||!h[a]||"function"!=typeof h[a])return void i(t)}r=Promise.resolve(!0);"_support"in h&&(r=h._support&&"function"==typeof h._support?h._support():Promise.resolve(!!h._support)),r.then(function(t){u[n]=t,c[n]=h,e()},i)}catch(t){i(t)}});return i.then(t,e),i},f.prototype.driver=function(){return this._driver||null},f.prototype.getDriver=function(t,e,i){var n=this,r=function(){if(d(t))switch(t){case n.INDEXEDDB:return new Promise(function(t,e){t(s(1))});case n.LOCALSTORAGE:return new Promise(function(t,e){t(s(2))});case n.WEBSQL:return new Promise(function(t,e){t(s(4))})}else if(c[t])return Promise.resolve(c[t]);return Promise.reject(new Error("Driver not found."))}();return r.then(e,i),r},f.prototype.getSerializer=function(e){var t=new Promise(function(t,e){t(s(3))});return e&&"function"==typeof e&&t.then(function(t){e(t)}),t},f.prototype.ready=function(t){var e=this,i=e._driverSet.then(function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready});return i.then(t,t),i},f.prototype.setDriver=function(t,e,i){function s(){o._config.driver=o.driver()}function n(r){return function(){var n=0;return function t(){for(;n<r.length;){var e=r[n];return n++,o._dbInfo=null,o._ready=null,o.getDriver(e).then(function(t){return o._extend(t),s(),o._ready=o._initStorage(o._config),o._ready}).catch(t)}s();var i=new Error("No available storage method found.");return o._driverSet=Promise.reject(i),o._driverSet}()}}var o=this;h(t)||(t=[t]);var r=this._getSupportedDrivers(t),t=null!==this._driverSet?this._driverSet.catch(function(){return Promise.resolve()}):Promise.resolve();return this._driverSet=t.then(function(){var t=r[0];return o._dbInfo=null,o._ready=null,o.getDriver(t).then(function(t){o._driver=t._driver,s(),o._wrapLibraryMethodsWithReady(),o._initDriver=n(r)})}).catch(function(){s();var t=new Error("No available storage method found.");return o._driverSet=Promise.reject(t),o._driverSet}),this._driverSet.then(e,i),this._driverSet},f.prototype.supports=function(t){return!!u[t]},f.prototype._extend=function(t){p(this,t)},f.prototype._getSupportedDrivers=function(t){for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i];this.supports(r)&&e.push(r)}return e},f.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0;t<l.length;t++)!function(e,i){e[i]=function(){var t=arguments;return e.ready().then(function(){return e[i].apply(e,t)})}}(this,l[t])},f.prototype.createInstance=function(t){return new f(t)},f));function p(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];if(i)for(var n in i)i.hasOwnProperty(n)&&(h(i[n])?t[n]=i[n].slice():t[n]=i[n])}return t}function d(t){for(var e in r)if(r.hasOwnProperty(e)&&r[e]===t)return 1}function f(t){(function(t){if(!(t instanceof f))throw new TypeError("Cannot call a class as a function")})(this),this.INDEXEDDB=r.INDEXEDDB,this.LOCALSTORAGE=r.LOCALSTORAGE,this.WEBSQL=r.WEBSQL,this._defaultConfig=p({},a),this._config=p({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver)}e.default=i,t.exports=e.default},function(t,e){"use strict";e.__esModule=!0;var i=function(l){function s(e,i){e=e||[],i=i||{};try{return new Blob(e,i)}catch(t){if("TypeError"!==t.name)throw t;for(var n=new(l.BlobBuilder||l.MSBlobBuilder||l.MozBlobBuilder||l.WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(i.type)}}function h(r){return new Promise(function(i,e){var t=s([""],{type:"image/png"}),n=r.transaction([m],"readwrite");n.objectStore(m).put(t,"key"),n.oncomplete=function(){var t=r.transaction([m],"readwrite").objectStore(m).get("key");t.onerror=e,t.onsuccess=function(t){var n,t=t.target.result,e=URL.createObjectURL(t);n=e,new Promise(function(t,e){var i=new XMLHttpRequest;i.open("GET",n),i.withCredentials=!0,i.responseType="arraybuffer",i.onreadystatechange=function(){return 4===i.readyState?200===i.status?t({response:i.response,type:i.getResponseHeader("Content-Type")}):void e({status:i.status,response:i.response}):void 0},i.send()}).then(function(t){i(!(!t||"image/png"!==t.type))},function(){i(!1)}).then(function(){URL.revokeObjectURL(e)})}},n.onerror=n.onabort=e}).catch(function(){return!1})}function a(t){return s([function(t){for(var e=t.length,i=new ArrayBuffer(e),n=new Uint8Array(i),r=0;r<e;r++)n[r]=t.charCodeAt(r);return i}(atob(t.data))],{type:t.type})}function c(t){return t&&t.__local_forage_encoded_blob}function u(t){var e=this,i=e._initReady().then(function(){var t=g[e._dbInfo.name];return t&&t.dbReady?t.dbReady:void 0});return i.then(t,t),i}function p(s,o){return new Promise(function(e,t){if(s.db){if(!o)return e(s.db);n=g[(n=s).name],(i={}).promise=new Promise(function(t){i.resolve=t}),n.deferredOperations.push(i),n.dbReady?n.dbReady=n.dbReady.then(function(){return i.promise}):n.dbReady=i.promise,s.db.close()}var i,n=[s.name];o&&n.push(s.version);var r=f.open.apply(f,n);o&&(r.onupgradeneeded=function(e){var t=r.result;try{t.createObjectStore(s.storeName),e.oldVersion<=1&&t.createObjectStore(m)}catch(t){if("ConstraintError"!==t.name)throw t;l.console.warn('The database "'+s.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+s.storeName+'" already exists.')}}),r.onerror=function(){t(r.error)},r.onsuccess=function(){var t;e(r.result),(t=g[(t=s).name].deferredOperations.pop())&&t.resolve()}})}function d(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}var f=f||l.indexedDB||l.webkitIndexedDB||l.mozIndexedDB||l.OIndexedDB||l.msIndexedDB;if(f){var y,g,m="local-forage-detect-blob-support";return{_driver:"asyncStorage",_initStorage:function(t){function e(){return Promise.resolve()}var n=this,r={db:null};if(t)for(var i in t)r[i]=t[i];var s=(g=g||{})[r.name];s||(s={forages:[],db:null,dbReady:null,deferredOperations:[]},g[r.name]=s),s.forages.push(n),n._initReady||(n._initReady=n.ready,n.ready=u);for(var o=[],a=0;a<s.forages.length;a++){var h=s.forages[a];h!==n&&o.push(h._initReady().catch(e))}var c=s.forages.slice(0);return Promise.all(o).then(function(){return r.db=s.db,p(r,!1)}).then(function(t){return r.db=t,function(t,e){if(!t.db)return!0;var i=!t.db.objectStoreNames.contains(t.storeName),n=t.version<t.db.version,r=t.version>t.db.version;if(n&&(t.version!==e&&l.console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),r||i)return!i||(i=t.db.version+1)>t.version&&(t.version=i),!0;return!1}(r,n._defaultConfig.version)?p(r,!0):t}).then(function(t){r.db=s.db=t,n._dbInfo=r;for(var e=0;e<c.length;e++){var i=c[e];i!==n&&(i._dbInfo.db=r.db,i._dbInfo.version=r.version)}})},iterate:function(s,t){var o=this,e=new Promise(function(r,e){o.ready().then(function(){var t=o._dbInfo,i=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName).openCursor(),n=1;i.onsuccess=function(){var t,e=i.result;e?(c(t=e.value)&&(t=a(t)),void 0!==(t=s(t,e.key,n++))?r(t):e.continue()):r()},i.onerror=function(){e(i.error)}}).catch(e)});return d(e,t),e},getItem:function(r,t){var s=this;"string"!=typeof r&&(l.console.warn(r+" used as a key, but it is not a string."),r=String(r));var e=new Promise(function(i,n){s.ready().then(function(){var t=s._dbInfo,e=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName).get(r);e.onsuccess=function(){var t=e.result;void 0===t&&(t=null),c(t)&&(t=a(t)),i(t)},e.onerror=function(){n(e.error)}}).catch(n)});return d(e,t),e},setItem:function(a,e,t){var i=this;"string"!=typeof a&&(l.console.warn(a+" used as a key, but it is not a string."),a=String(a));var n=new Promise(function(r,s){var o;i.ready().then(function(){return o=i._dbInfo,e instanceof Blob?(t=o.db,("boolean"==typeof y?Promise.resolve(y):h(t).then(function(t){return y=t})).then(function(t){return t?e:(n=e,new Promise(function(e,t){var i=new FileReader;i.onerror=t,i.onloadend=function(t){t=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:t,type:n.type})},i.readAsBinaryString(n)}));var n})):e;var t}).then(function(t){var e=o.db.transaction(o.storeName,"readwrite"),i=e.objectStore(o.storeName);null===t&&(t=void 0),e.oncomplete=function(){void 0===t&&(t=null),r(t)},e.onabort=e.onerror=function(){var t=n.error||n.transaction.error;s(t)};var n=i.put(t,a)}).catch(s)});return d(n,t),n},removeItem:function(s,t){var o=this;"string"!=typeof s&&(l.console.warn(s+" used as a key, but it is not a string."),s=String(s));var e=new Promise(function(n,r){o.ready().then(function(){var t=o._dbInfo,e=t.db.transaction(t.storeName,"readwrite"),i=e.objectStore(t.storeName).delete(s);e.oncomplete=function(){n()},e.onerror=function(){r(i.error)},e.onabort=function(){var t=i.error||i.transaction.error;r(t)}}).catch(r)});return d(e,t),e},clear:function(t){var s=this,e=new Promise(function(n,r){s.ready().then(function(){var t=s._dbInfo,e=t.db.transaction(t.storeName,"readwrite"),i=e.objectStore(t.storeName).clear();e.oncomplete=function(){n()},e.onabort=e.onerror=function(){var t=i.error||i.transaction.error;r(t)}}).catch(r)});return d(e,t),e},length:function(t){var r=this,e=new Promise(function(i,n){r.ready().then(function(){var t=r._dbInfo,e=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName).count();e.onsuccess=function(){i(e.result)},e.onerror=function(){n(e.error)}}).catch(n)});return d(e,t),e},key:function(s,t){var o=this,e=new Promise(function(n,r){return s<0?void n(null):void o.ready().then(function(){var t=o._dbInfo,t=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName),e=!1,i=t.openCursor();i.onsuccess=function(){var t=i.result;return t?void(0===s||e?n(t.key):(e=!0,t.advance(s))):void n(null)},i.onerror=function(){r(i.error)}}).catch(r)});return d(e,t),e},keys:function(t){var s=this,e=new Promise(function(n,r){s.ready().then(function(){var t=s._dbInfo,e=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName).openCursor(),i=[];e.onsuccess=function(){var t=e.result;return t?(i.push(t.key),void t.continue()):void n(i)},e.onerror=function(){r(e.error)}}).catch(r)});return d(e,t),e}}}}("undefined"!=typeof window?window:self);e.default=i,t.exports=e.default},function(t,e,n){"use strict";e.__esModule=!0;var i=function(r){function s(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}var l=null;try{if(!(r.localStorage&&"setItem"in r.localStorage))return;l=r.localStorage}catch(t){return}return{_driver:"localStorageWrapper",_initStorage:function(t){var e={};if(t)for(var i in t)e[i]=t[i];return e.keyPrefix=e.name+"/",e.storeName!==this._defaultConfig.storeName&&(e.keyPrefix+=e.storeName+"/"),this._dbInfo=e,new Promise(function(t,e){t(n(3))}).then(function(t){return e.serializer=t,Promise.resolve()})},iterate:function(h,t){var c=this,e=c.ready().then(function(){for(var t=c._dbInfo,e=t.keyPrefix,i=e.length,n=l.length,r=1,s=0;s<n;s++){var o=l.key(s);if(0===o.indexOf(e)){var a=(a=l.getItem(o))&&t.serializer.deserialize(a);if(void 0!==(a=h(a,o.substring(i),r++)))return a}}});return s(e,t),e},getItem:function(i,t){var n=this;"string"!=typeof i&&(r.console.warn(i+" used as a key, but it is not a string."),i=String(i));var e=n.ready().then(function(){var t=n._dbInfo,e=l.getItem(t.keyPrefix+i);return e=e&&t.serializer.deserialize(e)});return s(e,t),e},setItem:function(o,t,e){var a=this;"string"!=typeof o&&(r.console.warn(o+" used as a key, but it is not a string."),o=String(o));var i=a.ready().then(function(){void 0===t&&(t=null);var s=t;return new Promise(function(i,n){var r=a._dbInfo;r.serializer.serialize(t,function(t,e){if(e)n(e);else try{l.setItem(r.keyPrefix+o,t),i(s)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||n(t),n(t)}})})});return s(i,e),i},removeItem:function(e,t){var i=this;"string"!=typeof e&&(r.console.warn(e+" used as a key, but it is not a string."),e=String(e));var n=i.ready().then(function(){var t=i._dbInfo;l.removeItem(t.keyPrefix+e)});return s(n,t),n},clear:function(t){var n=this,e=n.ready().then(function(){for(var t=n._dbInfo.keyPrefix,e=l.length-1;0<=e;e--){var i=l.key(e);0===i.indexOf(t)&&l.removeItem(i)}});return s(e,t),e},length:function(t){var e=this.keys().then(function(t){return t.length});return s(e,t),e},key:function(i,t){var n=this,e=n.ready().then(function(){var e,t=n._dbInfo;try{e=l.key(i)}catch(t){e=null}return e=e&&e.substring(t.keyPrefix.length)});return s(e,t),e},keys:function(t){var r=this,e=r.ready().then(function(){for(var t=r._dbInfo,e=l.length,i=[],n=0;n<e;n++)0===l.key(n).indexOf(t.keyPrefix)&&i.push(l.key(n).substring(t.keyPrefix.length));return i});return s(e,t),e}}}("undefined"!=typeof window?window:self);e.default=i,t.exports=e.default},function(t,e){"use strict";e.__esModule=!0;var s,l,o,a,h,c,i=(s="undefined"!=typeof window?window:self,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=/^~~local_forage_type~([^~]+)~/,c=(h=(a="__lfsc__:").length)+"arbf".length,{serialize:function(e,i){var t="";if(e&&(t=e.toString()),e&&("[object ArrayBuffer]"===e.toString()||e.buffer&&"[object ArrayBuffer]"===e.buffer.toString())){var n,r=a;e instanceof ArrayBuffer?(n=e,r+="arbf"):(n=e.buffer,"[object Int8Array]"===t?r+="si08":"[object Uint8Array]"===t?r+="ui08":"[object Uint8ClampedArray]"===t?r+="uic8":"[object Int16Array]"===t?r+="si16":"[object Uint16Array]"===t?r+="ur16":"[object Int32Array]"===t?r+="si32":"[object Uint32Array]"===t?r+="ui32":"[object Float32Array]"===t?r+="fl32":"[object Float64Array]"===t?r+="fl64":i(new Error("Failed to get type for BinaryArray"))),i(r+p(n))}else if("[object Blob]"===t){t=new FileReader;t.onload=function(){var t="~~local_forage_type~"+e.type+"~"+p(this.result);i(a+"blob"+t)},t.readAsArrayBuffer(e)}else try{i(JSON.stringify(e))}catch(t){console.error("Couldn't convert value into a JSON string: ",e),i(null,t)}},deserialize:function(t){if(t.substring(0,h)!==a)return JSON.parse(t);var e,i=t.substring(c),n=t.substring(h,c);"blob"===n&&o.test(i)&&(e=(t=i.match(o))[1],i=i.substring(t[0].length));var r=u(i);switch(n){case"arbf":return r;case"blob":return function(e,i){e=e||[],i=i||{};try{return new Blob(e,i)}catch(t){if("TypeError"!==t.name)throw t;for(var n=new(s.BlobBuilder||s.MSBlobBuilder||s.MozBlobBuilder||s.WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(i.type)}}([r],{type:e});case"si08":return new Int8Array(r);case"ui08":return new Uint8Array(r);case"uic8":return new Uint8ClampedArray(r);case"si16":return new Int16Array(r);case"ur16":return new Uint16Array(r);case"si32":return new Int32Array(r);case"ui32":return new Uint32Array(r);case"fl32":return new Float32Array(r);case"fl64":return new Float64Array(r);default:throw new Error("Unkown type: "+n)}},stringToBuffer:u,bufferToString:p});function u(t){var e,i,n,r,s=.75*t.length,o=t.length,a=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);for(var s=new ArrayBuffer(s),h=new Uint8Array(s),c=0;c<o;c+=4)e=l.indexOf(t[c]),i=l.indexOf(t[c+1]),n=l.indexOf(t[c+2]),r=l.indexOf(t[c+3]),h[a++]=e<<2|i>>4,h[a++]=(15&i)<<4|n>>2,h[a++]=(3&n)<<6|63&r;return s}function p(t){for(var e=new Uint8Array(t),i="",n=0;n<e.length;n+=3)i+=l[e[n]>>2],i+=l[(3&e[n])<<4|e[n+1]>>4],i+=l[(15&e[n+1])<<2|e[n+2]>>6],i+=l[63&e[n+2]];return e.length%3==2?i=i.substring(0,i.length-1)+"=":e.length%3==1&&(i=i.substring(0,i.length-2)+"=="),i}e.default=i,t.exports=e.default},function(t,e,o){"use strict";e.__esModule=!0;var i=function(n){function h(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}var s=n.openDatabase;if(s)return{_driver:"webSQLStorage",_initStorage:function(t){var n=this,r={db:null};if(t)for(var e in t)r[e]="string"!=typeof t[e]?t[e].toString():t[e];var i=new Promise(function(e,i){try{r.db=s(r.name,String(r.version),r.description,r.size)}catch(t){return i(t)}r.db.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS "+r.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){n._dbInfo=r,e()},function(t,e){i(e)})})});return new Promise(function(t,e){t(o(3))}).then(function(t){return r.serializer=t,i})},iterate:function(c,t){var e=this,i=new Promise(function(h,i){e.ready().then(function(){var a=e._dbInfo;a.db.transaction(function(t){t.executeSql("SELECT * FROM "+a.storeName,[],function(t,e){for(var i=e.rows,n=i.length,r=0;r<n;r++){var s=i.item(r),o=(o=s.value)&&a.serializer.deserialize(o);if(void 0!==(o=c(o,s.key,r+1)))return void h(o)}h()},function(t,e){i(e)})})}).catch(i)});return h(i,t),i},getItem:function(e,t){var s=this;"string"!=typeof e&&(n.console.warn(e+" used as a key, but it is not a string."),e=String(e));var i=new Promise(function(n,r){s.ready().then(function(){var i=s._dbInfo;i.db.transaction(function(t){t.executeSql("SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(t,e){e=(e=e.rows.length?e.rows.item(0).value:null)&&i.serializer.deserialize(e);n(e)},function(t,e){r(e)})})}).catch(r)});return h(i,t),i},setItem:function(o,t,e){var a=this;"string"!=typeof o&&(n.console.warn(o+" used as a key, but it is not a string."),o=String(o));var i=new Promise(function(r,s){a.ready().then(function(){void 0===t&&(t=null);var i=t,n=a._dbInfo;n.serializer.serialize(t,function(e,t){t?s(t):n.db.transaction(function(t){t.executeSql("INSERT OR REPLACE INTO "+n.storeName+" (key, value) VALUES (?, ?)",[o,e],function(){r(i)},function(t,e){s(e)})},function(t){t.code===t.QUOTA_ERR&&s(t)})})}).catch(s)});return h(i,e),i},removeItem:function(r,t){var s=this;"string"!=typeof r&&(n.console.warn(r+" used as a key, but it is not a string."),r=String(r));var e=new Promise(function(i,n){s.ready().then(function(){var e=s._dbInfo;e.db.transaction(function(t){t.executeSql("DELETE FROM "+e.storeName+" WHERE key = ?",[r],function(){i()},function(t,e){n(e)})})}).catch(n)});return h(e,t),e},clear:function(t){var r=this,e=new Promise(function(i,n){r.ready().then(function(){var e=r._dbInfo;e.db.transaction(function(t){t.executeSql("DELETE FROM "+e.storeName,[],function(){i()},function(t,e){n(e)})})}).catch(n)});return h(e,t),e},length:function(t){var r=this,e=new Promise(function(i,n){r.ready().then(function(){var e=r._dbInfo;e.db.transaction(function(t){t.executeSql("SELECT COUNT(key) as c FROM "+e.storeName,[],function(t,e){e=e.rows.item(0).c;i(e)},function(t,e){n(e)})})}).catch(n)});return h(e,t),e},key:function(r,t){var s=this,e=new Promise(function(i,n){s.ready().then(function(){var e=s._dbInfo;e.db.transaction(function(t){t.executeSql("SELECT key FROM "+e.storeName+" WHERE id = ? LIMIT 1",[r+1],function(t,e){e=e.rows.length?e.rows.item(0).key:null;i(e)},function(t,e){n(e)})})}).catch(n)});return h(e,t),e},keys:function(t){var n=this,e=new Promise(function(r,i){n.ready().then(function(){var e=n._dbInfo;e.db.transaction(function(t){t.executeSql("SELECT key FROM "+e.storeName,[],function(t,e){for(var i=[],n=0;n<e.rows.length;n++)i.push(e.rows.item(n).key);r(i)},function(t,e){i(e)})})}).catch(i)});return h(e,t),e}}}("undefined"!=typeof window?window:self);e.default=i,t.exports=e.default}],i.c=r,i.p="",i(0);function i(t){if(r[t])return r[t].exports;var e=r[t]={exports:{},id:t,loaded:!1};return n[t].call(e.exports,e,e.exports,i),e.loaded=!0,e.exports}var n,r})}catch(e){localForageInitFailed=!0}cr.plugins_.LocalStorage=function(t){this.runtime=t},function(){var r="",s="",o=[],a="";function h(t){return t?"string"==typeof t?t:"string"==typeof t.message?t.message:"string"==typeof t.name?t.name:"string"==typeof t.data?t.data:"unknown error":"unknown error"}function c(t,e){a=e,t.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,t)}var l="",t=void 0!==window.is_scirra_arcade;function u(t){return!l||t.substr(0,l.length)===l}t&&(l="sa"+window.scirra_arcade_id+"_");var e=cr.plugins_.LocalStorage.prototype;e.Type=function(t){this.plugin=t,this.runtime=t.runtime},e.Type.prototype.onCreate=function(){},e.Instance=function(t){this.type=t,this.runtime=t.runtime};var i=e.Instance.prototype;function n(){}function p(){}function d(){}i.onCreate=function(){this.pendingSets=0,this.pendingGets=0},i.onDestroy=function(){},i.saveToJSON=function(){return{}},i.loadFromJSON=function(t){},n.prototype.OnItemSet=function(t){return r===t},n.prototype.OnAnyItemSet=function(){return!0},n.prototype.OnItemGet=function(t){return r===t},n.prototype.OnAnyItemGet=function(){return!0},n.prototype.OnItemRemoved=function(t){return r===t},n.prototype.OnAnyItemRemoved=function(){return!0},n.prototype.OnCleared=function(){return!0},n.prototype.OnAllKeyNamesLoaded=function(){return!0},n.prototype.OnError=function(){return!0},n.prototype.OnItemExists=function(t){return r===t},n.prototype.OnItemMissing=function(t){return r===t},n.prototype.CompareKey=function(t,e){return cr.do_cmp(r,t,e)},n.prototype.CompareValue=function(t,e){return cr.do_cmp(s,t,e)},n.prototype.IsProcessingSets=function(){return 0<this.pendingSets},n.prototype.IsProcessingGets=function(){return 0<this.pendingGets},n.prototype.OnAllSetsComplete=function(){return!0},n.prototype.OnAllGetsComplete=function(){return!0},e.cnds=new n,p.prototype.SetItem=function(i,t){var e,n;localForageInitFailed?c(this,"storage failed to initialise - may be disabled in browser settings"):(e=l+i,this.pendingSets++,n=this,localforage.setItem(e,t,function(t,e){n.pendingSets--,t?(a=h(t),n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,n)):(r=i,s=e,n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemSet,n),n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemSet,n),s=r=""),0===n.pendingSets&&n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllSetsComplete,n)}))},p.prototype.GetItem=function(i){var t,n;localForageInitFailed?c(this,"storage failed to initialise - may be disabled in browser settings"):(t=l+i,this.pendingGets++,n=this,localforage.getItem(t,function(t,e){n.pendingGets--,t?(a=h(t),n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,n)):(r=i,null==(s=e)&&(s=""),n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemGet,n),n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemGet,n),s=r=""),0===n.pendingGets&&n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllGetsComplete,n)}))},p.prototype.CheckItemExists=function(i){var t,n;localForageInitFailed?c(this,"storage failed to initialise - may be disabled in browser settings"):(t=l+i,n=this,localforage.getItem(t,function(t,e){t?(a=h(t),n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,n)):(r=i,null===e?(s="",n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemMissing,n)):(s=e,n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemExists,n)),s=r="")}))},p.prototype.RemoveItem=function(e){var t,i;localForageInitFailed?c(this,"storage failed to initialise - may be disabled in browser settings"):(t=l+e,i=this,localforage.removeItem(t,function(t){t?(a=h(t),i.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,i)):(r=e,s="",i.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemRemoved,i),i.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemRemoved,i),r="")}))},p.prototype.ClearStorage=function(){var e;localForageInitFailed?c(this,"storage failed to initialise - may be disabled in browser settings"):t||(e=this,localforage.clear(function(t){t?(a=h(t),e.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,e)):(s=r="",cr.clearArray(o),e.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnCleared,e))}))},p.prototype.GetAllKeyNames=function(){var s;localForageInitFailed?c(this,"storage failed to initialise - may be disabled in browser settings"):(s=this,localforage.keys(function(t,e){var i,n,r;if(t)a=h(t),s.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,s);else{for(cr.clearArray(o),i=0,n=e.length;i<n;++i)u(r=e[i])&&o.push((r=r,l?u(r)?r.substr(l.length):void 0:r));s.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllKeyNamesLoaded,s)}}))},e.acts=new p,d.prototype.ItemValue=function(t){t.set_any(s)},d.prototype.Key=function(t){t.set_string(r)},d.prototype.KeyCount=function(t){t.set_int(o.length)},d.prototype.KeyAt=function(t,e){(e=Math.floor(e))<0||e>=o.length?t.set_string(""):t.set_string(o[e])},d.prototype.ErrorMessage=function(t){t.set_string(a)},e.exps=new d}();var localForageInitFailed=!1;try{!function(){var t,a,h,c,l;c={},l={},h=a=function(o){if(h._eak_seen=c,l[o])return l[o];if(l[o]={},!c[o])throw new Error("Could not find module "+o);for(var t,e=c[o],i=e.deps,e=e.callback,n=[],r=0,s=i.length;r<s;r++)"exports"===i[r]?n.push(t={}):n.push(a(function(t){if("."!==t.charAt(0))return t;for(var e=t.split("/"),i=o.split("/").slice(0,-1),n=0,r=e.length;n<r;n++){var s=e[n];".."===s?i.pop():"."!==s&&i.push(s)}return i.join("/")}(i[r])));e=e.apply(this,n);return l[o]=t||e},(t=function(t,e,i){c[t]={deps:e,callback:i}})("promise/all",["./utils","exports"],function(t,e){"use strict";var i=t.isArray,h=t.isFunction;e.all=function(a){if(!i(a))throw new TypeError("You must pass an array to all.");return new this(function(i,t){function n(t,e){r[t]=e,0==--s&&i(r)}var e,r=[],s=a.length;0===s&&i([]);for(var o=0;o<a.length;o++)(e=a[o])&&h(e.then)?e.then(function(e){return function(t){n(e,t)}}(o),t):n(o,e)})}}),t("promise/asap",["exports"],function(t){"use strict";function e(){for(var t=0;t<h.length;t++){var e=h[t];(0,e[0])(e[1])}h=[]}var i,n,r,s="undefined"!=typeof window?window:{},o=s.MutationObserver||s.WebKitMutationObserver,a="undefined"!=typeof global?global:void 0===this?window:this,h=[],c="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?function(){process.nextTick(e)}:o?(i=0,n=new o(e),r=document.createTextNode(""),n.observe(r,{characterData:!0}),function(){r.data=i=++i%2}):function(){a.setTimeout(e,1)};t.asap=function(t,e){1===h.push([t,e])&&c()}}),t("promise/config",["exports"],function(t){"use strict";var i={instrument:!1};t.config=i,t.configure=function(t,e){return 2!==arguments.length?i[t]:void(i[t]=e)}}),t("promise/polyfill",["./promise","./utils","exports"],function(t,e,i){"use strict";var n=t.Promise,r=e.isFunction;i.polyfill=function(){var e,t="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;"Promise"in t&&"resolve"in t.Promise&&"reject"in t.Promise&&"all"in t.Promise&&"race"in t.Promise&&(new t.Promise(function(t){e=t}),r(e))||(t.Promise=n)}}),t("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(t,e,i,n,r,s,o,a){"use strict";function h(t){if(!v(t))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof h))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],function(t,e){function i(t){f(e,t)}try{t(function(t){p(e,t)},i)}catch(t){i(t)}}(t,this)}function c(t,e,i,n){var r,s,o,a,h=v(i);if(h)try{r=i(n),o=!0}catch(t){a=!0,s=t}else r=n,o=!0;u(e,r)||(h&&o?p(e,r):a?f(e,s):t===x?p(e,r):t===S&&f(e,r))}function l(t,e){for(var i=t._subscribers,n=t._detail,r=0;r<i.length;r+=3)c(e,i[r],i[r+e],n);t._subscribers=null}function u(e,i){var n,t=null;try{if(e===i)throw new TypeError("A promises callback cannot return that same promise.");if(_(i)&&(t=i.then,v(t)))return t.call(i,function(t){return!!n||(n=!0,void(i!==t?p:d)(e,t))},function(t){return!!n||(n=!0,void f(e,t))}),1}catch(t){return n||f(e,t),1}}function p(t,e){t!==e&&u(t,e)||d(t,e)}function d(t,e){t._state===b&&(t._state=w,t._detail=e,m.async(y,t))}function f(t,e){t._state===b&&(t._state=w,t._detail=e,m.async(g,t))}function y(t){l(t,t._state=x)}function g(t){l(t,t._state=S)}var m=t.config,_=(t.configure,e.objectOrFunction),v=e.isFunction,i=(e.now,i.all),n=n.race,r=r.resolve,s=s.reject,o=o.asap;m.async=o;var b=void 0,w=0,x=1,S=2;h.prototype={constructor:h,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(t,e){var i,n,r,s,o=this,a=new this.constructor(function(){});return this._state?(i=arguments,m.async(function(){c(o._state,a,i[o._state-1],o._detail)})):(n=a,r=t,s=e,t=(e=(t=this)._subscribers).length,e[t]=n,e[t+x]=r,e[t+S]=s),a},catch:function(t){return this.then(null,t)}},h.all=i,h.race=n,h.resolve=r,h.reject=s,a.Promise=h}),t("promise/race",["./utils","exports"],function(t,e){"use strict";var i=t.isArray;e.race=function(r){if(!i(r))throw new TypeError("You must pass an array to race.");return new this(function(t,e){for(var i,n=0;n<r.length;n++)(i=r[n])&&"function"==typeof i.then?i.then(t,e):t(i)})}}),t("promise/reject",["exports"],function(t){"use strict";t.reject=function(i){return new this(function(t,e){e(i)})}}),t("promise/resolve",["exports"],function(t){"use strict";t.resolve=function(e){return e&&"object"==typeof e&&e.constructor===this?e:new this(function(t){t(e)})}}),t("promise/utils",["exports"],function(t){"use strict";function e(t){return"function"==typeof t}var i=Date.now||function(){return(new Date).getTime()};t.objectOrFunction=function(t){return e(t)||"object"==typeof t&&null!==t},t.isFunction=e,t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.now=i}),a("promise/polyfill").polyfill()}(),function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.localforage=e():t.localforage=e()}(this,function(){return r={},i.m=n=[function(t,e,s){"use strict";e.__esModule=!0;var i,n,c,r,o,l,a,u,h,i=(i="undefined"!=typeof window?window:self,c={},o=[(r={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"}).INDEXEDDB,r.WEBSQL,r.LOCALSTORAGE],l=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],a={description:"",driver:o.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},n=i,(i={})[r.INDEXEDDB]=!!function(){try{var t=n.indexedDB||n.webkitIndexedDB||n.mozIndexedDB||n.OIndexedDB||n.msIndexedDB;return(!(void 0!==n.openDatabase&&n.navigator&&n.navigator.userAgent&&/Safari/.test(n.navigator.userAgent))||/Chrome/.test(n.navigator.userAgent))&&(t&&"function"==typeof t.open&&void 0!==n.IDBKeyRange)}catch(t){return}}(),i[r.WEBSQL]=!!function(){try{return n.openDatabase}catch(t){return}}(),i[r.LOCALSTORAGE]=!!function(){try{return n.localStorage&&"setItem"in n.localStorage&&n.localStorage.setItem}catch(t){return}}(),u=i,h=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},new(f.prototype.config=function(t){if("object"!=typeof t)return"string"==typeof t?this._config[t]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t)"storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),this._config[e]=t[e];return"driver"in t&&t.driver&&this.setDriver(this._config.driver),!0},f.prototype.defineDriver=function(h,t,e){var i=new Promise(function(e,i){try{var n=h._driver,t=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver"),r=new Error("Custom driver name already in use: "+h._driver);if(!h._driver)return void i(t);if(d(h._driver))return void i(r);for(var s=l.concat("_initStorage"),o=0;o<s.length;o++){var a=s[o];if(!a||!h[a]||"function"!=typeof h[a])return void i(t)}r=Promise.resolve(!0);"_support"in h&&(r=h._support&&"function"==typeof h._support?h._support():Promise.resolve(!!h._support)),r.then(function(t){u[n]=t,c[n]=h,e()},i)}catch(t){i(t)}});return i.then(t,e),i},f.prototype.driver=function(){return this._driver||null},f.prototype.getDriver=function(t,e,i){var n=this,r=function(){if(d(t))switch(t){case n.INDEXEDDB:return new Promise(function(t,e){t(s(1))});case n.LOCALSTORAGE:return new Promise(function(t,e){t(s(2))});case n.WEBSQL:return new Promise(function(t,e){t(s(4))})}else if(c[t])return Promise.resolve(c[t]);return Promise.reject(new Error("Driver not found."))}();return r.then(e,i),r},f.prototype.getSerializer=function(e){var t=new Promise(function(t,e){t(s(3))});return e&&"function"==typeof e&&t.then(function(t){e(t)}),t},f.prototype.ready=function(t){var e=this,i=e._driverSet.then(function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready});return i.then(t,t),i},f.prototype.setDriver=function(t,e,i){function s(){o._config.driver=o.driver()}function n(r){return function(){var n=0;return function t(){for(;n<r.length;){var e=r[n];return n++,o._dbInfo=null,o._ready=null,o.getDriver(e).then(function(t){return o._extend(t),s(),o._ready=o._initStorage(o._config),o._ready}).catch(t)}s();var i=new Error("No available storage method found.");return o._driverSet=Promise.reject(i),o._driverSet}()}}var o=this;h(t)||(t=[t]);var r=this._getSupportedDrivers(t),t=null!==this._driverSet?this._driverSet.catch(function(){return Promise.resolve()}):Promise.resolve();return this._driverSet=t.then(function(){var t=r[0];return o._dbInfo=null,o._ready=null,o.getDriver(t).then(function(t){o._driver=t._driver,s(),o._wrapLibraryMethodsWithReady(),o._initDriver=n(r)})}).catch(function(){s();var t=new Error("No available storage method found.");return o._driverSet=Promise.reject(t),o._driverSet}),this._driverSet.then(e,i),this._driverSet},f.prototype.supports=function(t){return!!u[t]},f.prototype._extend=function(t){p(this,t)},f.prototype._getSupportedDrivers=function(t){for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i];this.supports(r)&&e.push(r)}return e},f.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0;t<l.length;t++)!function(e,i){e[i]=function(){var t=arguments;return e.ready().then(function(){return e[i].apply(e,t)})}}(this,l[t])},f.prototype.createInstance=function(t){return new f(t)},f));function p(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];if(i)for(var n in i)i.hasOwnProperty(n)&&(h(i[n])?t[n]=i[n].slice():t[n]=i[n])}return t}function d(t){for(var e in r)if(r.hasOwnProperty(e)&&r[e]===t)return 1}function f(t){(function(t){if(!(t instanceof f))throw new TypeError("Cannot call a class as a function")})(this),this.INDEXEDDB=r.INDEXEDDB,this.LOCALSTORAGE=r.LOCALSTORAGE,this.WEBSQL=r.WEBSQL,this._defaultConfig=p({},a),this._config=p({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver)}e.default=i,t.exports=e.default},function(t,e){"use strict";e.__esModule=!0;var i=function(l){function s(e,i){e=e||[],i=i||{};try{return new Blob(e,i)}catch(t){if("TypeError"!==t.name)throw t;for(var n=new(l.BlobBuilder||l.MSBlobBuilder||l.MozBlobBuilder||l.WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(i.type)}}function h(r){return new Promise(function(i,e){var t=s([""],{type:"image/png"}),n=r.transaction([m],"readwrite");n.objectStore(m).put(t,"key"),n.oncomplete=function(){var t=r.transaction([m],"readwrite").objectStore(m).get("key");t.onerror=e,t.onsuccess=function(t){var n,t=t.target.result,e=URL.createObjectURL(t);n=e,new Promise(function(t,e){var i=new XMLHttpRequest;i.open("GET",n),i.withCredentials=!0,i.responseType="arraybuffer",i.onreadystatechange=function(){return 4===i.readyState?200===i.status?t({response:i.response,type:i.getResponseHeader("Content-Type")}):void e({status:i.status,response:i.response}):void 0},i.send()}).then(function(t){i(!(!t||"image/png"!==t.type))},function(){i(!1)}).then(function(){URL.revokeObjectURL(e)})}},n.onerror=n.onabort=e}).catch(function(){return!1})}function a(t){return s([function(t){for(var e=t.length,i=new ArrayBuffer(e),n=new Uint8Array(i),r=0;r<e;r++)n[r]=t.charCodeAt(r);return i}(atob(t.data))],{type:t.type})}function c(t){return t&&t.__local_forage_encoded_blob}function u(t){var e=this,i=e._initReady().then(function(){var t=g[e._dbInfo.name];return t&&t.dbReady?t.dbReady:void 0});return i.then(t,t),i}function p(s,o){return new Promise(function(e,t){if(s.db){if(!o)return e(s.db);n=g[(n=s).name],(i={}).promise=new Promise(function(t){i.resolve=t}),n.deferredOperations.push(i),n.dbReady?n.dbReady=n.dbReady.then(function(){return i.promise}):n.dbReady=i.promise,s.db.close()}var i,n=[s.name];o&&n.push(s.version);var r=f.open.apply(f,n);o&&(r.onupgradeneeded=function(e){var t=r.result;try{t.createObjectStore(s.storeName),e.oldVersion<=1&&t.createObjectStore(m)}catch(t){if("ConstraintError"!==t.name)throw t;l.console.warn('The database "'+s.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+s.storeName+'" already exists.')}}),r.onerror=function(){t(r.error)},r.onsuccess=function(){var t;e(r.result),(t=g[(t=s).name].deferredOperations.pop())&&t.resolve()}})}function d(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}var f=f||l.indexedDB||l.webkitIndexedDB||l.mozIndexedDB||l.OIndexedDB||l.msIndexedDB;if(f){var y,g,m="local-forage-detect-blob-support";return{_driver:"asyncStorage",_initStorage:function(t){function e(){return Promise.resolve()}var n=this,r={db:null};if(t)for(var i in t)r[i]=t[i];var s=(g=g||{})[r.name];s||(s={forages:[],db:null,dbReady:null,deferredOperations:[]},g[r.name]=s),s.forages.push(n),n._initReady||(n._initReady=n.ready,n.ready=u);for(var o=[],a=0;a<s.forages.length;a++){var h=s.forages[a];h!==n&&o.push(h._initReady().catch(e))}var c=s.forages.slice(0);return Promise.all(o).then(function(){return r.db=s.db,p(r,!1)}).then(function(t){return r.db=t,function(t,e){if(!t.db)return!0;var i=!t.db.objectStoreNames.contains(t.storeName),n=t.version<t.db.version,r=t.version>t.db.version;if(n&&(t.version!==e&&l.console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),r||i)return!i||(i=t.db.version+1)>t.version&&(t.version=i),!0;return!1}(r,n._defaultConfig.version)?p(r,!0):t}).then(function(t){r.db=s.db=t,n._dbInfo=r;for(var e=0;e<c.length;e++){var i=c[e];i!==n&&(i._dbInfo.db=r.db,i._dbInfo.version=r.version)}})},iterate:function(s,t){var o=this,e=new Promise(function(r,e){o.ready().then(function(){var t=o._dbInfo,i=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName).openCursor(),n=1;i.onsuccess=function(){var t,e=i.result;e?(c(t=e.value)&&(t=a(t)),void 0!==(t=s(t,e.key,n++))?r(t):e.continue()):r()},i.onerror=function(){e(i.error)}}).catch(e)});return d(e,t),e},getItem:function(r,t){var s=this;"string"!=typeof r&&(l.console.warn(r+" used as a key, but it is not a string."),r=String(r));var e=new Promise(function(i,n){s.ready().then(function(){var t=s._dbInfo,e=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName).get(r);e.onsuccess=function(){var t=e.result;void 0===t&&(t=null),c(t)&&(t=a(t)),i(t)},e.onerror=function(){n(e.error)}}).catch(n)});return d(e,t),e},setItem:function(a,e,t){var i=this;"string"!=typeof a&&(l.console.warn(a+" used as a key, but it is not a string."),a=String(a));var n=new Promise(function(r,s){var o;i.ready().then(function(){return o=i._dbInfo,e instanceof Blob?(t=o.db,("boolean"==typeof y?Promise.resolve(y):h(t).then(function(t){return y=t})).then(function(t){return t?e:(n=e,new Promise(function(e,t){var i=new FileReader;i.onerror=t,i.onloadend=function(t){t=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:t,type:n.type})},i.readAsBinaryString(n)}));var n})):e;var t}).then(function(t){var e=o.db.transaction(o.storeName,"readwrite"),i=e.objectStore(o.storeName);null===t&&(t=void 0),e.oncomplete=function(){void 0===t&&(t=null),r(t)},e.onabort=e.onerror=function(){var t=n.error||n.transaction.error;s(t)};var n=i.put(t,a)}).catch(s)});return d(n,t),n},removeItem:function(s,t){var o=this;"string"!=typeof s&&(l.console.warn(s+" used as a key, but it is not a string."),s=String(s));var e=new Promise(function(n,r){o.ready().then(function(){var t=o._dbInfo,e=t.db.transaction(t.storeName,"readwrite"),i=e.objectStore(t.storeName).delete(s);e.oncomplete=function(){n()},e.onerror=function(){r(i.error)},e.onabort=function(){var t=i.error||i.transaction.error;r(t)}}).catch(r)});return d(e,t),e},clear:function(t){var s=this,e=new Promise(function(n,r){s.ready().then(function(){var t=s._dbInfo,e=t.db.transaction(t.storeName,"readwrite"),i=e.objectStore(t.storeName).clear();e.oncomplete=function(){n()},e.onabort=e.onerror=function(){var t=i.error||i.transaction.error;r(t)}}).catch(r)});return d(e,t),e},length:function(t){var r=this,e=new Promise(function(i,n){r.ready().then(function(){var t=r._dbInfo,e=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName).count();e.onsuccess=function(){i(e.result)},e.onerror=function(){n(e.error)}}).catch(n)});return d(e,t),e},key:function(s,t){var o=this,e=new Promise(function(n,r){return s<0?void n(null):void o.ready().then(function(){var t=o._dbInfo,t=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName),e=!1,i=t.openCursor();i.onsuccess=function(){var t=i.result;return t?void(0===s||e?n(t.key):(e=!0,t.advance(s))):void n(null)},i.onerror=function(){r(i.error)}}).catch(r)});return d(e,t),e},keys:function(t){var s=this,e=new Promise(function(n,r){s.ready().then(function(){var t=s._dbInfo,e=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName).openCursor(),i=[];e.onsuccess=function(){var t=e.result;return t?(i.push(t.key),void t.continue()):void n(i)},e.onerror=function(){r(e.error)}}).catch(r)});return d(e,t),e}}}}("undefined"!=typeof window?window:self);e.default=i,t.exports=e.default},function(t,e,n){"use strict";e.__esModule=!0;var i=function(r){function s(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}var l=null;try{if(!(r.localStorage&&"setItem"in r.localStorage))return;l=r.localStorage}catch(t){return}return{_driver:"localStorageWrapper",_initStorage:function(t){var e={};if(t)for(var i in t)e[i]=t[i];return e.keyPrefix=e.name+"/",e.storeName!==this._defaultConfig.storeName&&(e.keyPrefix+=e.storeName+"/"),this._dbInfo=e,new Promise(function(t,e){t(n(3))}).then(function(t){return e.serializer=t,Promise.resolve()})},iterate:function(h,t){var c=this,e=c.ready().then(function(){for(var t=c._dbInfo,e=t.keyPrefix,i=e.length,n=l.length,r=1,s=0;s<n;s++){var o=l.key(s);if(0===o.indexOf(e)){var a=(a=l.getItem(o))&&t.serializer.deserialize(a);if(void 0!==(a=h(a,o.substring(i),r++)))return a}}});return s(e,t),e},getItem:function(i,t){var n=this;"string"!=typeof i&&(r.console.warn(i+" used as a key, but it is not a string."),i=String(i));var e=n.ready().then(function(){var t=n._dbInfo,e=l.getItem(t.keyPrefix+i);return e=e&&t.serializer.deserialize(e)});return s(e,t),e},setItem:function(o,t,e){var a=this;"string"!=typeof o&&(r.console.warn(o+" used as a key, but it is not a string."),o=String(o));var i=a.ready().then(function(){void 0===t&&(t=null);var s=t;return new Promise(function(i,n){var r=a._dbInfo;r.serializer.serialize(t,function(t,e){if(e)n(e);else try{l.setItem(r.keyPrefix+o,t),i(s)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||n(t),n(t)}})})});return s(i,e),i},removeItem:function(e,t){var i=this;"string"!=typeof e&&(r.console.warn(e+" used as a key, but it is not a string."),e=String(e));var n=i.ready().then(function(){var t=i._dbInfo;l.removeItem(t.keyPrefix+e)});return s(n,t),n},clear:function(t){var n=this,e=n.ready().then(function(){for(var t=n._dbInfo.keyPrefix,e=l.length-1;0<=e;e--){var i=l.key(e);0===i.indexOf(t)&&l.removeItem(i)}});return s(e,t),e},length:function(t){var e=this.keys().then(function(t){return t.length});return s(e,t),e},key:function(i,t){var n=this,e=n.ready().then(function(){var e,t=n._dbInfo;try{e=l.key(i)}catch(t){e=null}return e=e&&e.substring(t.keyPrefix.length)});return s(e,t),e},keys:function(t){var r=this,e=r.ready().then(function(){for(var t=r._dbInfo,e=l.length,i=[],n=0;n<e;n++)0===l.key(n).indexOf(t.keyPrefix)&&i.push(l.key(n).substring(t.keyPrefix.length));return i});return s(e,t),e}}}("undefined"!=typeof window?window:self);e.default=i,t.exports=e.default},function(t,e){"use strict";e.__esModule=!0;var s,l,o,a,h,c,i=(s="undefined"!=typeof window?window:self,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=/^~~local_forage_type~([^~]+)~/,c=(h=(a="__lfsc__:").length)+"arbf".length,{serialize:function(e,i){var t="";if(e&&(t=e.toString()),e&&("[object ArrayBuffer]"===e.toString()||e.buffer&&"[object ArrayBuffer]"===e.buffer.toString())){var n,r=a;e instanceof ArrayBuffer?(n=e,r+="arbf"):(n=e.buffer,"[object Int8Array]"===t?r+="si08":"[object Uint8Array]"===t?r+="ui08":"[object Uint8ClampedArray]"===t?r+="uic8":"[object Int16Array]"===t?r+="si16":"[object Uint16Array]"===t?r+="ur16":"[object Int32Array]"===t?r+="si32":"[object Uint32Array]"===t?r+="ui32":"[object Float32Array]"===t?r+="fl32":"[object Float64Array]"===t?r+="fl64":i(new Error("Failed to get type for BinaryArray"))),i(r+p(n))}else if("[object Blob]"===t){t=new FileReader;t.onload=function(){var t="~~local_forage_type~"+e.type+"~"+p(this.result);i(a+"blob"+t)},t.readAsArrayBuffer(e)}else try{i(JSON.stringify(e))}catch(t){console.error("Couldn't convert value into a JSON string: ",e),i(null,t)}},deserialize:function(t){if(t.substring(0,h)!==a)return JSON.parse(t);var e,i=t.substring(c),n=t.substring(h,c);"blob"===n&&o.test(i)&&(e=(t=i.match(o))[1],i=i.substring(t[0].length));var r=u(i);switch(n){case"arbf":return r;case"blob":return function(e,i){e=e||[],i=i||{};try{return new Blob(e,i)}catch(t){if("TypeError"!==t.name)throw t;for(var n=new(s.BlobBuilder||s.MSBlobBuilder||s.MozBlobBuilder||s.WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(i.type)}}([r],{type:e});case"si08":return new Int8Array(r);case"ui08":return new Uint8Array(r);case"uic8":return new Uint8ClampedArray(r);case"si16":return new Int16Array(r);case"ur16":return new Uint16Array(r);case"si32":return new Int32Array(r);case"ui32":return new Uint32Array(r);case"fl32":return new Float32Array(r);case"fl64":return new Float64Array(r);default:throw new Error("Unkown type: "+n)}},stringToBuffer:u,bufferToString:p});function u(t){var e,i,n,r,s=.75*t.length,o=t.length,a=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);for(var s=new ArrayBuffer(s),h=new Uint8Array(s),c=0;c<o;c+=4)e=l.indexOf(t[c]),i=l.indexOf(t[c+1]),n=l.indexOf(t[c+2]),r=l.indexOf(t[c+3]),h[a++]=e<<2|i>>4,h[a++]=(15&i)<<4|n>>2,h[a++]=(3&n)<<6|63&r;return s}function p(t){for(var e=new Uint8Array(t),i="",n=0;n<e.length;n+=3)i+=l[e[n]>>2],i+=l[(3&e[n])<<4|e[n+1]>>4],i+=l[(15&e[n+1])<<2|e[n+2]>>6],i+=l[63&e[n+2]];return e.length%3==2?i=i.substring(0,i.length-1)+"=":e.length%3==1&&(i=i.substring(0,i.length-2)+"=="),i}e.default=i,t.exports=e.default},function(t,e,o){"use strict";e.__esModule=!0;var i=function(n){function h(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}var s=n.openDatabase;if(s)return{_driver:"webSQLStorage",_initStorage:function(t){var n=this,r={db:null};if(t)for(var e in t)r[e]="string"!=typeof t[e]?t[e].toString():t[e];var i=new Promise(function(e,i){try{r.db=s(r.name,String(r.version),r.description,r.size)}catch(t){return i(t)}r.db.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS "+r.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){n._dbInfo=r,e()},function(t,e){i(e)})})});return new Promise(function(t,e){t(o(3))}).then(function(t){return r.serializer=t,i})},iterate:function(c,t){var e=this,i=new Promise(function(h,i){e.ready().then(function(){var a=e._dbInfo;a.db.transaction(function(t){t.executeSql("SELECT * FROM "+a.storeName,[],function(t,e){for(var i=e.rows,n=i.length,r=0;r<n;r++){var s=i.item(r),o=(o=s.value)&&a.serializer.deserialize(o);if(void 0!==(o=c(o,s.key,r+1)))return void h(o)}h()},function(t,e){i(e)})})}).catch(i)});return h(i,t),i},getItem:function(e,t){var s=this;"string"!=typeof e&&(n.console.warn(e+" used as a key, but it is not a string."),e=String(e));var i=new Promise(function(n,r){s.ready().then(function(){var i=s._dbInfo;i.db.transaction(function(t){t.executeSql("SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(t,e){e=(e=e.rows.length?e.rows.item(0).value:null)&&i.serializer.deserialize(e);n(e)},function(t,e){r(e)})})}).catch(r)});return h(i,t),i},setItem:function(o,t,e){var a=this;"string"!=typeof o&&(n.console.warn(o+" used as a key, but it is not a string."),o=String(o));var i=new Promise(function(r,s){a.ready().then(function(){void 0===t&&(t=null);var i=t,n=a._dbInfo;n.serializer.serialize(t,function(e,t){t?s(t):n.db.transaction(function(t){t.executeSql("INSERT OR REPLACE INTO "+n.storeName+" (key, value) VALUES (?, ?)",[o,e],function(){r(i)},function(t,e){s(e)})},function(t){t.code===t.QUOTA_ERR&&s(t)})})}).catch(s)});return h(i,e),i},removeItem:function(r,t){var s=this;"string"!=typeof r&&(n.console.warn(r+" used as a key, but it is not a string."),r=String(r));var e=new Promise(function(i,n){s.ready().then(function(){var e=s._dbInfo;e.db.transaction(function(t){t.executeSql("DELETE FROM "+e.storeName+" WHERE key = ?",[r],function(){i()},function(t,e){n(e)})})}).catch(n)});return h(e,t),e},clear:function(t){var r=this,e=new Promise(function(i,n){r.ready().then(function(){var e=r._dbInfo;e.db.transaction(function(t){t.executeSql("DELETE FROM "+e.storeName,[],function(){i()},function(t,e){n(e)})})}).catch(n)});return h(e,t),e},length:function(t){var r=this,e=new Promise(function(i,n){r.ready().then(function(){var e=r._dbInfo;e.db.transaction(function(t){t.executeSql("SELECT COUNT(key) as c FROM "+e.storeName,[],function(t,e){e=e.rows.item(0).c;i(e)},function(t,e){n(e)})})}).catch(n)});return h(e,t),e},key:function(r,t){var s=this,e=new Promise(function(i,n){s.ready().then(function(){var e=s._dbInfo;e.db.transaction(function(t){t.executeSql("SELECT key FROM "+e.storeName+" WHERE id = ? LIMIT 1",[r+1],function(t,e){e=e.rows.length?e.rows.item(0).key:null;i(e)},function(t,e){n(e)})})}).catch(n)});return h(e,t),e},keys:function(t){var n=this,e=new Promise(function(r,i){n.ready().then(function(){var e=n._dbInfo;e.db.transaction(function(t){t.executeSql("SELECT key FROM "+e.storeName,[],function(t,e){for(var i=[],n=0;n<e.rows.length;n++)i.push(e.rows.item(n).key);r(i)},function(t,e){i(e)})})}).catch(i)});return h(e,t),e}}}("undefined"!=typeof window?window:self);e.default=i,t.exports=e.default}],i.c=r,i.p="",i(0);function i(t){if(r[t])return r[t].exports;var e=r[t]={exports:{},id:t,loaded:!1};return n[t].call(e.exports,e,e.exports,i),e.loaded=!0,e.exports}var n,r})}catch(e){localForageInitFailed=!0}cr.plugins_.Rex_TimeAwayL=function(t){this.runtime=t},function(){var t=cr.plugins_.Rex_TimeAwayL.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var e=t.Instance.prototype;function r(t){return t?"string"==typeof t?t:"string"==typeof t.message?t.message:"string"==typeof t.name?t.name:"string"==typeof t.data?t.data:"unknown error":"unknown error"}function s(t,e){return t=t||{},e=e||(new Date).getTime(),t.state=1,t.start=e,t.acc=0,t}function i(){}function n(){}function o(){}e.onCreate=function(){this.cache={},this.pendingSave={},this.waitingSave={},this.pendingRemove={},this.currentKey=null,this.exp_Time=0,this.exp_ErrorMessage=""},e.GetTimer=function(i,n){var r;this.cache.hasOwnProperty(i)?n(null,this.cache[i]):(r=this,localforage.getItem(i,function(t,e){t||null==e?r.cache.hasOwnProperty(i)&&delete r.cache[i]:r.cache[i]=e,n(t,e)}))},t.cnds=new i,i.prototype.OnError=function(t){return!0},i.prototype.OnGetTimer=function(t){return this.currentKey===t},i.prototype.OnStartTimer=function(t){return this.currentKey===t},i.prototype.OnRemoveTimer=function(t){return this.currentKey===t},i.prototype.OnPauseTimer=function(t){return this.currentKey===t},i.prototype.OnResumeTimer=function(t){return this.currentKey===t},i.prototype.IsValid=function(t){return this.cache.hasOwnProperty(t)},t.acts=new n,n.prototype.StartTimer=function(i){this.cache[i]=s(this.cache[i]);var n=this;localforage.setItem(i,this.cache[i],function(t,e){n.currentKey=i,t?(n.exp_ErrorMessage=r(t),n.runtime.trigger(cr.plugins_.Rex_TimeAwayL.prototype.cnds.OnError,n)):n.runtime.trigger(cr.plugins_.Rex_TimeAwayL.prototype.cnds.OnStartTimer,n)})},n.prototype.RemoveTimer=function(e){this.cache.hasOwnProperty(e)&&delete this.cache[e];var i=this;localforage.removeItem(e,function(t){i.currentKey=e,t?(i.exp_ErrorMessage=r(t),i.runtime.trigger(cr.plugins_.Rex_TimeAwayL.prototype.cnds.OnError,i)):i.runtime.trigger(cr.plugins_.Rex_TimeAwayL.prototype.cnds.OnRemoveTimer,i)})},n.prototype.PauseTimer=function(i){var n=this;this.GetTimer(i,function(t,e){t?(n.currentKey=i,n.exp_ErrorMessage=r(t),n.runtime.trigger(cr.plugins_.Rex_TimeAwayL.prototype.cnds.OnError,n)):null!=e&&((t=n.cache[i])&&0!==t.state&&(t.state=0,e=(new Date).getTime(),t.acc+=e-t.start),localforage.setItem(i,n.cache[i],function(t,e){n.currentKey=i,t?(n.exp_ErrorMessage=r(t),n.runtime.trigger(cr.plugins_.Rex_TimeAwayL.prototype.cnds.OnError,n)):n.runtime.trigger(cr.plugins_.Rex_TimeAwayL.prototype.cnds.OnPauseTimer,n)}))})},n.prototype.ResumeTimer=function(i){var n=this;this.GetTimer(i,function(t,e){t?(n.currentKey=i,n.exp_ErrorMessage=r(t),n.runtime.trigger(cr.plugins_.Rex_TimeAwayL.prototype.cnds.OnError,n)):null!=e&&((e=n.cache[i])&&1!==e.state&&(e.state=1,e.start=(new Date).getTime()),localforage.setItem(i,n.cache[i],function(t,e){n.currentKey=i,t?(n.exp_ErrorMessage=r(t),n.runtime.trigger(cr.plugins_.Rex_TimeAwayL.prototype.cnds.OnError,n)):n.runtime.trigger(cr.plugins_.Rex_TimeAwayL.prototype.cnds.OnResumeTimer,n)}))})},n.prototype.GetORStartTimer=function(i){var n=this;this.GetTimer(i,function(t,e){t?(n.currentKey=i,n.exp_ErrorMessage=r(t),n.runtime.trigger(cr.plugins_.Rex_TimeAwayL.prototype.cnds.OnError,n)):null==e?(n.cache[i]=s(n.cache[i]),localforage.setItem(i,n.cache[i],function(t,e){n.currentKey=i,t?(n.exp_ErrorMessage=r(t),n.runtime.trigger(cr.plugins_.Rex_TimeAwayL.prototype.cnds.OnError,n)):n.runtime.trigger(cr.plugins_.Rex_TimeAwayL.prototype.cnds.OnGetTimer,n)})):(n.currentKey=i,n.runtime.trigger(cr.plugins_.Rex_TimeAwayL.prototype.cnds.OnGetTimer,n))})},n.prototype.GetTimer=function(i){var n=this;this.GetTimer(i,function(t,e){n.currentKey=i,t?(n.exp_ErrorMessage=r(t),n.runtime.trigger(cr.plugins_.Rex_TimeAwayL.prototype.cnds.OnError,n)):n.runtime.trigger(cr.plugins_.Rex_TimeAwayL.prototype.cnds.OnGetTimer,n)})},t.exps=new o,o.prototype.ErrorMessage=function(t){t.set_string(this.exp_ErrorMessage)},o.prototype.ElapsedTime=function(t,e){e=e||this.currentKey,t.set_float(function(t,e){if(!t)return 0;e=e||(new Date).getTime();var i=t.acc;return 1===t.state&&(i+=e-t.start),i}(this.cache[e])/1e3)}}(),cr.plugins_.Sprite=function(t){this.runtime=t},function(){var t=cr.plugins_.Sprite.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype;function c(){var t,e;return 0===this.datauri.length&&((t=document.createElement("canvas")).width=this.width,t.height=this.height,e=t.getContext("2d"),this.spritesheeted?e.drawImage(this.texture_img,this.offx,this.offy,this.width,this.height,0,0,this.width,this.height):e.drawImage(this.texture_img,0,0,this.width,this.height),this.datauri=t.toDataURL("image/png")),this.datauri}e.onCreate=function(){var t,e,i,n,r,s,o,a,h;if(!this.is_family)for(this.all_frames=[],this.has_loaded_textures=!1,t=0,e=this.animations.length;t<e;t++){for(r=this.animations[t],(o={}).name=r[0],o.speed=r[1],o.loop=r[2],o.repeatcount=r[3],o.repeatto=r[4],o.pingpong=r[5],o.sid=r[6],o.frames=[],i=0,n=r[7].length;i<n;i++)s=r[7][i],(a={}).texture_file=s[0],a.texture_filesize=s[1],a.offx=s[2],a.offy=s[3],a.width=s[4],a.height=s[5],a.duration=s[6],a.hotspotX=s[7],a.hotspotY=s[8],a.image_points=s[9],a.poly_pts=s[10],a.pixelformat=s[11],a.spritesheeted=0!==a.width,a.datauri="",a.getDataUri=c,h={left:0,top:0,right:1,bottom:1},a.sheetTex=h,a.webGL_texture=null,(h=this.runtime.findWaitingTexture(s[0]))?a.texture_img=h:(a.texture_img=new Image,a.texture_img.cr_src=s[0],a.texture_img.cr_filesize=s[1],a.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(a.texture_img,s[0])),cr.seal(a),o.frames.push(a),this.all_frames.push(a);cr.seal(o),this.animations[t]=o}},e.updateAllCurrentTexture=function(){for(var t,e=0,i=this.instances.length;e<i;e++)(t=this.instances[e]).curWebGLTexture=t.curFrame.webGL_texture},e.onLostWebGLContext=function(){if(!this.is_family){for(var t,e=0,i=this.all_frames.length;e<i;++e)(t=this.all_frames[e]).texture_img.c2webGL_texture=null,t.webGL_texture=null;this.has_loaded_textures=!1,this.updateAllCurrentTexture()}},e.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){for(var t,e=0,i=this.all_frames.length;e<i;++e)(t=this.all_frames[e]).webGL_texture=this.runtime.glwrap.loadTexture(t.texture_img,!1,this.runtime.linearSampling,t.pixelformat);this.updateAllCurrentTexture()}},e.loadTextures=function(){if(!this.is_family&&!this.has_loaded_textures&&this.runtime.glwrap){for(var t,e=0,i=this.all_frames.length;e<i;++e)(t=this.all_frames[e]).webGL_texture=this.runtime.glwrap.loadTexture(t.texture_img,!1,this.runtime.linearSampling,t.pixelformat);this.has_loaded_textures=!0}},e.unloadTextures=function(){if(!this.is_family&&!this.instances.length&&this.has_loaded_textures){for(var t,e=0,i=this.all_frames.length;e<i;++e)t=this.all_frames[e],this.runtime.glwrap.deleteTexture(t.webGL_texture),t.webGL_texture=null;this.has_loaded_textures=!1}};var r=[];e.preloadCanvas2D=function(t){var e,i,n;for(cr.clearArray(r),e=0,i=this.all_frames.length;e<i;++e)n=this.all_frames[e].texture_img,-1===r.indexOf(n)&&(t.drawImage(n,0,0),r.push(n))},t.Instance=function(t){this.type=t,this.runtime=t.runtime;t=this.type.animations[0].frames[0].poly_pts;this.recycled?this.collision_poly.set_pts(t):this.collision_poly=new cr.CollisionPoly(t)};var i=t.Instance.prototype;function n(){}i.onCreate=function(){this.visible=0===this.properties[0],this.isTicking=!1,this.inAnimTrigger=!1,this.collisionsEnabled=0!==this.properties[3],this.cur_animation=this.getAnimationByName(this.properties[1])||this.type.animations[0],this.cur_frame=this.properties[2],this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);var t,e,i,n,r,s,o,a,h=this.cur_animation.frames[this.cur_frame];for(this.collision_poly.set_pts(h.poly_pts),this.hotspotX=h.hotspotX,this.hotspotY=h.hotspotY,this.cur_anim_speed=this.cur_animation.speed,this.cur_anim_repeatto=this.cur_animation.repeatto,1===this.type.animations.length&&1===this.type.animations[0].frames.length||0===this.cur_anim_speed||(this.runtime.tickMe(this),this.isTicking=!0),this.recycled?this.animTimer.reset():this.animTimer=new cr.KahanAdder,this.frameStart=this.getNowTime(),this.animPlaying=!0,this.animRepeats=0,this.animForwards=!0,this.animTriggerName="",this.changeAnimName="",this.changeAnimFrom=0,this.changeAnimFrame=-1,this.type.loadTextures(),t=0,e=this.type.animations.length;t<e;t++)for(i=0,n=(r=this.type.animations[t]).frames.length;i<n;i++)0===(s=r.frames[i]).width&&(s.width=s.texture_img.width,s.height=s.texture_img.height),s.spritesheeted&&(a=s.texture_img,(o=s.sheetTex).left=s.offx/a.width,o.top=s.offy/a.height,o.right=(s.offx+s.width)/a.width,o.bottom=(s.offy+s.height)/a.height,0===s.offx&&0===s.offy&&s.width===a.width&&s.height===a.height&&(s.spritesheeted=!1));this.curFrame=this.cur_animation.frames[this.cur_frame],this.curWebGLTexture=this.curFrame.webGL_texture},i.saveToJSON=function(){var t={a:this.cur_animation.sid,f:this.cur_frame,cas:this.cur_anim_speed,fs:this.frameStart,ar:this.animRepeats,at:this.animTimer.sum,rt:this.cur_anim_repeatto};return this.animPlaying||(t.ap=this.animPlaying),this.animForwards||(t.af=this.animForwards),t},i.loadFromJSON=function(t){var e=this.getAnimationBySid(t.a);e&&(this.cur_animation=e),this.cur_frame=t.f,this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),this.cur_anim_speed=t.cas,this.frameStart=t.fs,this.animRepeats=t.ar,this.animTimer.reset(),this.animTimer.sum=t.at,this.animPlaying=!t.hasOwnProperty("ap")||t.ap,this.animForwards=!t.hasOwnProperty("af")||t.af,t.hasOwnProperty("rt")?this.cur_anim_repeatto=t.rt:this.cur_anim_repeatto=this.cur_animation.repeatto,this.curFrame=this.cur_animation.frames[this.cur_frame],this.curWebGLTexture=this.curFrame.webGL_texture,this.collision_poly.set_pts(this.curFrame.poly_pts),this.hotspotX=this.curFrame.hotspotX,this.hotspotY=this.curFrame.hotspotY},i.animationFinish=function(t){this.cur_frame=t?0:this.cur_animation.frames.length-1,this.animPlaying=!1,this.animTriggerName=this.cur_animation.name,this.inAnimTrigger=!0,this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,this),this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnimFinished,this),this.inAnimTrigger=!1,this.animRepeats=0},i.getNowTime=function(){return this.animTimer.sum},i.tick=function(){this.animTimer.add(this.runtime.getDt(this)),this.changeAnimName.length&&this.doChangeAnim(),0<=this.changeAnimFrame&&this.doChangeAnimFrame();var t=this.getNowTime(),e=this.cur_animation,i=e.frames[this.cur_frame],n=i.duration/this.cur_anim_speed;this.animPlaying&&t>=this.frameStart+n&&(this.animForwards?this.cur_frame++:this.cur_frame--,this.frameStart+=n,this.cur_frame>=e.frames.length&&(e.pingpong?(this.animForwards=!1,this.cur_frame=e.frames.length-2):e.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=e.repeatcount?this.animationFinish(!1):this.cur_frame=this.cur_anim_repeatto)),this.cur_frame<0&&(e.pingpong?(this.cur_frame=1,this.animForwards=!0,e.loop||(this.animRepeats++,this.animRepeats>=e.repeatcount&&this.animationFinish(!0))):e.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=e.repeatcount?this.animationFinish(!0):this.cur_frame=this.cur_anim_repeatto)),this.cur_frame<0?this.cur_frame=0:this.cur_frame>=e.frames.length&&(this.cur_frame=e.frames.length-1),t>this.frameStart+e.frames[this.cur_frame].duration/this.cur_anim_speed&&(this.frameStart=t),e=e.frames[this.cur_frame],this.OnFrameChanged(i,e),this.runtime.redraw=!0)},i.getAnimationByName=function(t){for(var e,i=0,n=this.type.animations.length;i<n;i++)if(e=this.type.animations[i],cr.equals_nocase(e.name,t))return e;return null},i.getAnimationBySid=function(t){for(var e,i=0,n=this.type.animations.length;i<n;i++)if((e=this.type.animations[i]).sid===t)return e;return null},i.doChangeAnim=function(){var t=this.cur_animation.frames[this.cur_frame],e=this.getAnimationByName(this.changeAnimName);this.changeAnimName="",e&&(cr.equals_nocase(e.name,this.cur_animation.name)&&this.animPlaying||(this.cur_animation=e,this.cur_anim_speed=e.speed,this.cur_anim_repeatto=e.repeatto,this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),1===this.changeAnimFrom&&(this.cur_frame=0),this.animPlaying=!0,this.frameStart=this.getNowTime(),this.animForwards=!0,this.OnFrameChanged(t,this.cur_animation.frames[this.cur_frame]),this.runtime.redraw=!0))},i.doChangeAnimFrame=function(){var t=this.cur_animation.frames[this.cur_frame],e=this.cur_frame;this.cur_frame=cr.floor(this.changeAnimFrame),this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),e!==this.cur_frame&&(this.OnFrameChanged(t,this.cur_animation.frames[this.cur_frame]),this.frameStart=this.getNowTime(),this.runtime.redraw=!0),this.changeAnimFrame=-1},i.OnFrameChanged=function(t,e){var i,n,r,s=t.width,o=t.height,a=e.width,h=e.height;for(s!=a&&(this.width*=a/s),o!=h&&(this.height*=h/o),this.hotspotX=e.hotspotX,this.hotspotY=e.hotspotY,this.collision_poly.set_pts(e.poly_pts),this.set_bbox_changed(),this.curFrame=e,this.curWebGLTexture=e.webGL_texture,i=0,n=this.behavior_insts.length;i<n;i++)(r=this.behavior_insts[i]).onSpriteFrameChanged&&r.onSpriteFrameChanged(t,e);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnFrameChanged,this)},i.draw=function(t){t.globalAlpha=this.opacity;var e,i,n=this.curFrame,r=n.spritesheeted,s=n.texture_img,o=this.x,a=this.y,h=this.width,c=this.height;0===this.angle&&0<=h&&0<=c?(o-=this.hotspotX*h,a-=this.hotspotY*c,this.runtime.pixel_rounding&&(o=Math.round(o),a=Math.round(a)),r?t.drawImage(s,n.offx,n.offy,n.width,n.height,o,a,h,c):t.drawImage(s,o,a,h,c)):(this.runtime.pixel_rounding&&(o=Math.round(o),a=Math.round(a)),t.save(),e=0<h?1:-1,i=0<c?1:-1,t.translate(o,a),1==e&&1==i||t.scale(e,i),t.rotate(this.angle*e*i),e=0-this.hotspotX*cr.abs(h),i=0-this.hotspotY*cr.abs(c),r?t.drawImage(s,n.offx,n.offy,n.width,n.height,e,i,cr.abs(h),cr.abs(c)):t.drawImage(s,e,i,cr.abs(h),cr.abs(c)),t.restore())},i.drawGL_earlyZPass=function(t){this.drawGL(t)},i.drawGL=function(t){t.setTexture(this.curWebGLTexture),t.setOpacity(this.opacity);var e,i,n=this.curFrame,r=this.bquad;this.runtime.pixel_rounding?(e=Math.round(this.x)-this.x,i=Math.round(this.y)-this.y,n.spritesheeted?t.quadTex(r.tlx+e,r.tly+i,r.trx+e,r.try_+i,r.brx+e,r.bry+i,r.blx+e,r.bly+i,n.sheetTex):t.quad(r.tlx+e,r.tly+i,r.trx+e,r.try_+i,r.brx+e,r.bry+i,r.blx+e,r.bly+i)):n.spritesheeted?t.quadTex(r.tlx,r.tly,r.trx,r.try_,r.brx,r.bry,r.blx,r.bly,n.sheetTex):t.quad(r.tlx,r.tly,r.trx,r.try_,r.brx,r.bry,r.blx,r.bly)},i.getImagePointIndexByName=function(t){for(var e=this.curFrame,i=0,n=e.image_points.length;i<n;i++)if(cr.equals_nocase(t,e.image_points[i][0]))return i;return-1},i.getImagePoint=function(t,e){var i=this.curFrame,n=i.image_points,r=cr.is_string(t)?this.getImagePointIndexByName(t):t-1;if((r=cr.floor(r))<0||r>=n.length)return e?this.x:this.y;var s=(n[r][1]-i.hotspotX)*this.width,t=((t=n[r][2])-i.hotspotY)*this.height,n=Math.cos(this.angle),r=Math.sin(this.angle),i=s*n-t*r;return t=t*n+s*r,s=i,s+=this.x,t+=this.y,e?s:t};var o=[];function v(t){t[0]=0,t[1]=0,t[2]=0,o.push(t)}function b(t,e){return t<e?t+","+e:e+","+t}function w(t,e,i,n){var r=e.uid,s=i.uid,e=b(r,s);t.hasOwnProperty(e)?t[e][2]=n:((i=o.length?o.pop():[0,0,0])[0]=r,i[1]=s,i[2]=n,t[e]=i)}var x=-2,S=[];n.prototype.OnCollision=function(t){if(!t)return!1;var e=this.runtime,i=e.getCurrentCondition(),n=i.type,r=null;i.extra.collmemory?r=i.extra.collmemory:(r={},i.extra.collmemory=r),i.extra.spriteCreatedDestroyCallback||(i.extra.spriteCreatedDestroyCallback=!0,e.addDestroyCallback(function(r){!function(t){var e,i,n=r.uid;for(e in t)t.hasOwnProperty(e)&&((i=t[e])[0]!==n&&i[1]!==n||(v(t[e]),delete t[e]))}(i.extra.collmemory)}));for(var s,o,a,h,c,l,u,p=n.getCurrentSol(),d=t.getCurrentSol(),f=p.getObjects(),y=this.runtime.tickcount,g=y-1,m=e.getCurrentEventStack().current_event,_=(m.orblock,0);_<f.length;_++){for(o=f[_],s=d.select_all?(o.update_bbox(),this.runtime.getCollisionCandidates(o.layer,t,o.bbox,S),S):d.getObjects(),a=0;a<s.length;a++)c=s[a],e.testOverlap(o,c)||e.checkRegisteredCollision(o,c)?(l=r,u=c,u=b(o.uid,u.uid),u=!(l.hasOwnProperty(u)?(x=l[u][2],!0):!(x=-2))||x<g,w(r,o,c,y),u&&(e.pushCopySol(m.solModifiers),u=n.getCurrentSol(),h=t.getCurrentSol(),u.select_all=!1,h.select_all=!1,n===t?(u.instances.length=2,u.instances[0]=o,u.instances[1]=c,n.applySolToContainer()):(u.instances.length=1,h.instances.length=1,u.instances[0]=o,h.instances[0]=c,n.applySolToContainer(),t.applySolToContainer()),m.retrigger(),e.popSol(m.solModifiers))):(h=r,c=c,c=b(o.uid,c.uid),h.hasOwnProperty(c)&&(v(h[c]),delete h[c]));cr.clearArray(S)}return!1};var y=null,g=new cr.ObjectSet,m=!1,_=[],T=new cr.rect(0,0,0,0);function s(t,e,i){if(!t)return!1;var n,r,s,o,a,h=0!==e||0!==i,c=!1,l=this.runtime.getCurrentCondition(),u=l.type,p=l.inverted,d=t.getCurrentSol(),l=this.runtime.getCurrentEventStack().current_event.orblock,f=d.select_all?(this.update_bbox(),T.copy(this.bbox),T.offset(e,i),this.runtime.getCollisionCandidates(this.layer,t,T,_),_):!l||this.runtime.isCurrentConditionFirst()&&!d.else_instances.length&&d.instances.length?d.instances:d.else_instances;for(m=u!==(y=t)&&!p,h&&(n=this.x,r=this.y,this.x+=e,this.y+=i,this.set_bbox_changed()),s=0,o=f.length;s<o;s++)if(a=f[s],this.runtime.testOverlap(this,a)){if(c=!0,p)break;u!==t&&g.add(a)}return h&&(this.x=n,this.y=r,this.set_bbox_changed()),cr.clearArray(_),c}function a(){}function h(){}e.finish=function(t){if(m){if(t){var e,t=this.runtime.getCurrentEventStack().current_event.orblock,i=y.getCurrentSol(),n=g.valuesRef();if(i.select_all){for(i.select_all=!1,cr.clearArray(i.instances),s=0,o=n.length;s<o;++s)i.instances[s]=n[s];if(t)for(cr.clearArray(i.else_instances),s=0,o=y.instances.length;s<o;++s)e=y.instances[s],g.contains(e)||i.else_instances.push(e)}else if(t)for(var r=i.instances.length,s=0,o=n.length;s<o;++s)i.instances[r+s]=n[s],cr.arrayFindRemove(i.else_instances,n[s]);else cr.shallowAssignArray(i.instances,n);y.applySolToContainer()}g.clear(),m=!1}},n.prototype.IsOverlapping=function(t){return s.call(this,t,0,0)},n.prototype.IsOverlappingOffset=function(t,e,i){return s.call(this,t,e,i)},n.prototype.IsAnimPlaying=function(t){return this.changeAnimName.length?cr.equals_nocase(this.changeAnimName,t):cr.equals_nocase(this.cur_animation.name,t)},n.prototype.CompareFrame=function(t,e){return cr.do_cmp(this.cur_frame,t,e)},n.prototype.CompareAnimSpeed=function(t,e){var i=this.animForwards?this.cur_anim_speed:-this.cur_anim_speed;return cr.do_cmp(i,t,e)},n.prototype.OnAnimFinished=function(t){return cr.equals_nocase(this.animTriggerName,t)},n.prototype.OnAnyAnimFinished=function(){return!0},n.prototype.OnFrameChanged=function(){return!0},n.prototype.IsMirrored=function(){return this.width<0},n.prototype.IsFlipped=function(){return this.height<0},n.prototype.OnURLLoaded=function(){return!0},n.prototype.IsCollisionEnabled=function(){return this.collisionsEnabled},t.cnds=new n,a.prototype.Spawn=function(t,e,i){if(t&&e){var n,r,s,o=this.runtime.createInstance(t,e,this.getImagePoint(i,!0),this.getImagePoint(i,!1));if(o){if(void 0!==o.angle&&(o.angle=this.angle,o.set_bbox_changed()),this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(t.plugin).cnds.OnCreated,o),o.is_contained)for(n=0,r=o.siblings.length;n<r;n++)s=o.siblings[n],this.runtime.trigger(Object.getPrototypeOf(s.type.plugin).cnds.OnCreated,s);this.runtime.isInOnDestroy--;var a,i=this.runtime.getCurrentAction(),h=!1;if((cr.is_undefined(i.extra.Spawn_LastExec)||i.extra.Spawn_LastExec<this.runtime.execcount)&&(h=!0,i.extra.Spawn_LastExec=this.runtime.execcount),t!=this.type&&((a=t.getCurrentSol()).select_all=!1,h?(cr.clearArray(a.instances),a.instances[0]=o):a.instances.push(o),o.is_contained))for(n=0,r=o.siblings.length;n<r;n++)(a=(s=o.siblings[n]).type.getCurrentSol()).select_all=!1,h?(cr.clearArray(a.instances),a.instances[0]=s):a.instances.push(s)}}},a.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},a.prototype.StopAnim=function(){this.animPlaying=!1},a.prototype.StartAnim=function(t){this.animPlaying=!0,this.frameStart=this.getNowTime(),1===t&&0!==this.cur_frame&&(this.changeAnimFrame=0,this.inAnimTrigger||this.doChangeAnimFrame()),this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)},a.prototype.SetAnim=function(t,e){this.changeAnimName=t,this.changeAnimFrom=e,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0),this.inAnimTrigger||this.doChangeAnim()},a.prototype.SetAnimFrame=function(t){this.changeAnimFrame=t,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0),this.inAnimTrigger||this.doChangeAnimFrame()},a.prototype.SetAnimSpeed=function(t){this.cur_anim_speed=cr.abs(t),this.animForwards=0<=t,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)},a.prototype.SetAnimRepeatToFrame=function(t){(t=Math.floor(t))<0&&(t=0),t>=this.cur_animation.frames.length&&(t=this.cur_animation.frames.length-1),this.cur_anim_repeatto=t},a.prototype.SetMirrored=function(t){t=cr.abs(this.width)*(0===t?-1:1);this.width!==t&&(this.width=t,this.set_bbox_changed())},a.prototype.SetFlipped=function(t){t=cr.abs(this.height)*(0===t?-1:1);this.height!==t&&(this.height=t,this.set_bbox_changed())},a.prototype.SetScale=function(t){var e=this.curFrame,i=this.width<0?-1:1,n=this.height<0?-1:1,i=e.width*t*i,n=e.height*t*n;this.width===i&&this.height===n||(this.width=i,this.height=n,this.set_bbox_changed())},a.prototype.LoadURL=function(t,e,i){var n=new Image,r=this,s=this.curFrame;n.onload=function(){if(s.texture_img.src===n.src)return r.runtime.glwrap&&r.curFrame===s&&(r.curWebGLTexture=s.webGL_texture),0===e&&(r.width=n.width,r.height=n.height,r.set_bbox_changed()),r.runtime.redraw=!0,void r.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,r);s.texture_img=n,s.offx=0,s.offy=0,s.width=n.width,s.height=n.height,s.spritesheeted=!1,s.datauri="",s.pixelformat=0,r.runtime.glwrap&&(s.webGL_texture&&r.runtime.glwrap.deleteTexture(s.webGL_texture),s.webGL_texture=r.runtime.glwrap.loadTexture(n,!1,r.runtime.linearSampling),r.curFrame===s&&(r.curWebGLTexture=s.webGL_texture),r.type.updateAllCurrentTexture()),0===e&&(r.width=n.width,r.height=n.height,r.set_bbox_changed()),r.runtime.redraw=!0,r.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,r)},"data:"!==t.substr(0,5)&&0===i&&(n.crossOrigin="anonymous"),this.runtime.setImageSrc(n,t)},a.prototype.SetCollisions=function(t){this.collisionsEnabled!==(0!==t)&&(this.collisionsEnabled=0!==t,this.collisionsEnabled?this.set_bbox_changed():(this.collcells.right>=this.collcells.left&&this.type.collision_grid.update(this,this.collcells,null),this.collcells.set(0,0,-1,-1)))},t.acts=new a,h.prototype.AnimationFrame=function(t){t.set_int(this.cur_frame)},h.prototype.AnimationFrameCount=function(t){t.set_int(this.cur_animation.frames.length)},h.prototype.AnimationName=function(t){t.set_string(this.cur_animation.name)},h.prototype.AnimationSpeed=function(t){t.set_float(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed)},h.prototype.ImagePointX=function(t,e){t.set_float(this.getImagePoint(e,!0))},h.prototype.ImagePointY=function(t,e){t.set_float(this.getImagePoint(e,!1))},h.prototype.ImagePointCount=function(t){t.set_int(this.curFrame.image_points.length)},h.prototype.ImageWidth=function(t){t.set_float(this.curFrame.width)},h.prototype.ImageHeight=function(t){t.set_float(this.curFrame.height)},t.exps=new h}(),cr.plugins_.Spritefont2=function(t){this.runtime=t},function(){var t=cr.plugins_.Spritefont2.prototype;t.onCreate=function(){},t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype;function p(t){return t.replace(/\s\s*$/,"")}e.onCreate=function(){this.is_family||(this.texture_img=new Image,this.runtime.waitForImageLoad(this.texture_img,this.texture_file),this.webGL_texture=null)},e.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)},e.onRestoreWebGLContext=function(){var t,e;if(!this.is_family&&this.instances.length)for(this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!1,this.runtime.linearSampling,this.texture_pixelformat)),t=0,e=this.instances.length;t<e;t++)this.instances[t].webGL_texture=this.webGL_texture},e.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},e.preloadCanvas2D=function(t){t.drawImage(this.texture_img,0,0)},t.Instance=function(t){this.type=t,this.runtime=t.runtime},(e=t.Instance.prototype).onDestroy=function(){var t;h(this.lines),t=this.clipList,n(b,t,!1),t=this.clipUV,n(w,t,!1),cr.wipe(this.characterWidthList)},e.onCreate=function(){this.texture_img=this.type.texture_img,this.characterWidth=this.properties[0],this.characterHeight=this.properties[1],this.characterSet=this.properties[2],this.text=this.properties[3],this.characterScale=this.properties[4],this.visible=0===this.properties[5],this.halign=this.properties[6]/2,this.valign=this.properties[7]/2,this.wrapbyword=0===this.properties[9],this.characterSpacing=this.properties[10],this.lineHeight=this.properties[11],this.textWidth=0,this.textHeight=0,this.recycled?(cr.clearArray(this.lines),cr.wipe(this.clipList),cr.wipe(this.clipUV),cr.wipe(this.characterWidthList)):(this.lines=[],this.clipList={},this.clipUV={},this.characterWidthList={}),this.text_changed=!0,this.lastwrapwidth=this.width,this.runtime.glwrap&&(this.type.webGL_texture||(this.type.webGL_texture=this.runtime.glwrap.loadTexture(this.type.texture_img,!1,this.runtime.linearSampling,this.type.texture_pixelformat)),this.webGL_texture=this.type.webGL_texture),this.SplitSheet()},e.saveToJSON=function(){var t,e={t:this.text,csc:this.characterScale,csp:this.characterSpacing,lh:this.lineHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick,ha:this.halign,va:this.valign,cw:{}};for(t in this.characterWidthList)e.cw[t]=this.characterWidthList[t];return e},e.loadFromJSON=function(t){for(var e in this.text=t.t,this.characterScale=t.csc,this.characterSpacing=t.csp,this.lineHeight=t.lh,this.textWidth=t.tw,this.textHeight=t.th,this.last_render_tick=t.lrt,t.hasOwnProperty("ha")&&(this.halign=t.ha),t.hasOwnProperty("va")&&(this.valign=t.va),t.cw)this.characterWidthList[e]=t.cw[e];this.text_changed=!0,this.lastwrapwidth=this.width};var i=1e3;function v(t,e){return t.length?t.pop():new e}function d(t,e){t.length<i&&t.push(e)}function n(t,e,i){if(i){for(var n=0,r=e.length;n<r;n++)d(t,e[n]);cr.clearArray(e)}else for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(d(t,e[s]),delete e[s])}function f(t,e,i){var n=t.lines;i=p(i),e>=n.length&&n.push(a()),(e=n[e]).text=i,e.width=t.measureWidth(i),t.textWidth=cr.max(t.textWidth,e.width)}var y=[];function a(){return v(y,Object)}function h(t){n(y,t,!0)}var b=[],w=[];e.SplitSheet=function(){for(var t,e,i,n,r,s,o=this.texture_img,a=o.width,o=o.height,h=this.characterWidth,c=this.characterHeight,l=h/a,u=c/o,p=this.characterSet,d=Math.floor(a/h),f=Math.floor(o/c),y=0;y<p.length&&!(d*f<=y);y++){var g=y%d,m=Math.floor(y/d),_=p.charAt(y);this.runtime.glwrap?(t=this.clipUV,i=g*l,n=m*u,r=(1+g)*l,s=(m+1)*u,void 0===t[e=_]&&(t[e]=v(w,cr.rect)),t[e].left=i,t[e].top=n,t[e].right=r,t[e].bottom=s):(t=this.clipList,e=g*h,s=m*c,g=h,m=c,void 0===t[_=_]&&(t[_]=v(b,Object)),t[_].x=e,t[_].y=s,t[_].w=g,t[_].h=m)}};var g=[];t.TokeniseWords=function(t){cr.clearArray(g);for(var e,i="",n=0;n<t.length;)if("\n"===(e=t.charAt(n)))i.length&&(g.push(i),i=""),g.push("\n"),++n;else if(" "===e||"\t"===e||"-"===e){for(;i+=t.charAt(n),n++,n<t.length&&(" "===t.charAt(n)||"\t"===t.charAt(n)););g.push(i),i=""}else n<t.length&&(i+=e,n++);i.length&&g.push(i)},t.WordWrap=function(t){var e=t.text,i=t.lines;if(e&&e.length){var n=t.width;if(n<=2)h(i);else{var r=t.characterWidth,s=t.characterScale,o=t.characterSpacing;if(e.length*(r*s+o)-o<=n&&-1===e.indexOf("\n")){o=t.measureWidth(e);if(o<=n)return h(i),i.push(a()),i[0].text=e,i[0].width=o,t.textWidth=o,void(t.textHeight=t.characterHeight*s+t.lineHeight)}t.wrapbyword;this.WrapText(t),t.textHeight=i.length*(t.characterHeight*s+t.lineHeight)}}else h(i)},t.WrapText=function(t){for(var e,i,n=t.wrapbyword,r=t.text,s=t.lines,o=t.width,a=n?(this.TokeniseWords(r),g):r,h="",c=0,l=!1,u=0;u<a.length;u++)"\n"!==a[u]?(l=!1,e=h,h+=a[u],o<t.measureWidth(p(h))&&(""===e?(f(t,c,h),l=!(h="")):(f(t,c,e),h=a[u]),c++,n||" "!==h||(h=""))):(!0===l?l=!1:(f(t,c,h),c++),h="");for(p(h).length&&(f(t,c,h),c++),u=c;u<s.length;u++)i=s[u],d(y,i);s.length=c},e.measureWidth=function(t){for(var e=this.characterSpacing,i=t.length,n=0,r=0;r<i;r++)n+=this.getCharacterWidth(t.charAt(r))*this.characterScale+e;return n-=0<n?e:0},e.getCharacterWidth=function(t){var e=this.characterWidthList;return void 0!==e[t]?e[t]:this.characterWidth},e.rebuildText=function(){!this.text_changed&&this.width===this.lastwrapwidth||(this.textWidth=0,this.textHeight=0,this.type.plugin.WordWrap(this),this.text_changed=!1,this.lastwrapwidth=this.width)},e.draw=function(t,e){var i=this.texture_img;if(""!==this.text&&null!=i&&(this.rebuildText(),!(this.height<this.characterHeight*this.characterScale+this.lineHeight))){t.globalAlpha=this.opacity;var n=this.x,r=this.y;this.runtime.pixel_rounding&&(n=Math.round(n),r=Math.round(r));var s=this.layer.viewLeft,o=this.layer.viewTop,a=this.layer.viewRight,h=this.layer.viewBottom;t.save(),t.translate(n,r),t.rotate(this.angle);for(var c,l=this.angle,u=this.halign,p=this.valign,d=this.characterScale,f=this.characterHeight*d,y=this.lineHeight,g=this.characterSpacing,m=this.lines,i=this.textHeight,p=p*cr.max(0,this.height-i),_=-(this.hotspotX*this.width),i=-(this.hotspotY*this.height),v=i+=p,b=0;b<m.length;b++){var w=m[b].text,x=m[b].width,S=_+u*cr.max(0,this.width-x);if(v+=y,0===l&&r+v+f<o)v+=f;else{for(var T=0;T<w.length;T++){var A=w.charAt(T),C=this.getCharacterWidth(A),k=this.clipList[A];if(0===l&&n+S+C*d+g<s)S+=C*d+g;else{if(S+C*d>this.width+1e-5)break;if(void 0!==k&&(c=S,A=v,0===l&&1===d&&(c=Math.round(c),A=Math.round(A)),t.drawImage(this.texture_img,k.x,k.y,k.w,k.h,c,A,k.w*d,k.h*d)),S+=C*d+g,0===l&&a<n+S)break}}if(v+=f,0===l&&(v+f+y>this.height||h<r+v))break}}t.restore()}};var B=new cr.quad;function r(){}function s(){}function o(){}e.drawGL=function(t){if(t.setTexture(this.webGL_texture),t.setOpacity(this.opacity),this.text&&(this.rebuildText(),!(this.height<this.characterHeight*this.characterScale+this.lineHeight))){this.update_bbox();var e=this.bquad,i=0,n=0;this.runtime.pixel_rounding&&(i=Math.round(this.x)-this.x,n=Math.round(this.y)-this.y);var r,s,o=this.layer.viewLeft,a=this.layer.viewTop,h=this.layer.viewRight,c=this.layer.viewBottom,l=this.angle,u=this.halign,p=this.valign,d=this.characterScale,f=this.characterHeight*d,y=this.lineHeight,g=this.characterSpacing,m=this.lines,_=this.textHeight;0!==l&&(r=Math.cos(l),s=Math.sin(l));for(var _=p*cr.max(0,this.height-_),v=e.tlx+i,b=e.tly+n,w=_,x=0;x<m.length;x++){var S=m[x].text,T=m[x].width,A=u*cr.max(0,this.width-T);if(w+=y,0===l&&b+w+f<a)w+=f;else{for(var C=0;C<S.length;C++){var k,O,P,I=S.charAt(C),E=this.getCharacterWidth(I),R=this.clipUV[I];if(0===l&&v+A+E*d+g<o)A+=E*d+g;else{if(A+E*d>this.width+1e-5)break;if(void 0!==R&&(k=this.characterWidth*d,O=this.characterHeight*d,P=A,I=w,0===l&&1===d&&(P=Math.round(P),I=Math.round(I)),B.tlx=P,B.tly=I,B.trx=P+k,B.try_=I,B.blx=P,B.bly=I+O,B.brx=P+k,B.bry=I+O,0!==l&&(P=r,k=s,I=void 0,I=(O=B).tlx*P-O.tly*k,O.tly=O.tly*P+O.tlx*k,O.tlx=I,I=O.trx*P-O.try_*k,O.try_=O.try_*P+O.trx*k,O.trx=I,I=O.blx*P-O.bly*k,O.bly=O.bly*P+O.blx*k,O.blx=I,I=O.brx*P-O.bry*k,O.bry=O.bry*P+O.brx*k,O.brx=I),B.offset(v,b),t.quadTex(B.tlx,B.tly,B.trx,B.try_,B.brx,B.bry,B.blx,B.bly,R)),A+=E*d+g,0===l&&h<v+A)break}}if(w+=f,0===l&&(w+f+y>this.height||c<b+w))break}}}},r.prototype.CompareText=function(t,e){return e?this.text==t:cr.equals_nocase(this.text,t)},t.cnds=new r,s.prototype.SetText=function(t){cr.is_number(t)&&t<1e9&&(t=Math.round(1e10*t)/1e10);t=t.toString();this.text!==t&&(this.text=t,this.text_changed=!0,this.runtime.redraw=!0)},s.prototype.AppendText=function(t){cr.is_number(t)&&(t=Math.round(1e10*t)/1e10);t=t.toString();t&&(this.text+=t,this.text_changed=!0,this.runtime.redraw=!0)},s.prototype.SetScale=function(t){t!==this.characterScale&&(this.characterScale=t,this.text_changed=!0,this.runtime.redraw=!0)},s.prototype.SetCharacterSpacing=function(t){t!==this.CharacterSpacing&&(this.characterSpacing=t,this.text_changed=!0,this.runtime.redraw=!0)},s.prototype.SetLineHeight=function(t){t!==this.lineHeight&&(this.lineHeight=t,this.text_changed=!0,this.runtime.redraw=!0)},e.SetCharWidth=function(t,e){e=parseInt(e,10);this.characterWidthList[t]!==e&&(this.characterWidthList[t]=e,this.text_changed=!0,this.runtime.redraw=!0)},s.prototype.SetCharacterWidth=function(t,e){if(""!==t)for(var i=0;i<t.length;i++)this.SetCharWidth(t.charAt(i),e)},s.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},s.prototype.SetHAlign=function(t){this.halign=t/2,this.text_changed=!0,this.runtime.redraw=!0},s.prototype.SetVAlign=function(t){this.valign=t/2,this.text_changed=!0,this.runtime.redraw=!0},t.acts=new s,o.prototype.CharacterWidth=function(t,e){t.set_int(this.getCharacterWidth(e))},o.prototype.CharacterHeight=function(t){t.set_int(this.characterHeight)},o.prototype.CharacterScale=function(t){t.set_float(this.characterScale)},o.prototype.CharacterSpacing=function(t){t.set_int(this.characterSpacing)},o.prototype.LineHeight=function(t){t.set_int(this.lineHeight)},o.prototype.Text=function(t){t.set_string(this.text)},o.prototype.TextWidth=function(t){this.rebuildText(),t.set_float(this.textWidth)},o.prototype.TextHeight=function(t){this.rebuildText(),t.set_float(this.textHeight)},t.exps=new o}(),cr.plugins_.Touch=function(t){this.runtime=t},function(){var t=cr.plugins_.Touch.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime,this.touches=[],this.mouseDown=!1};var e=t.Instance.prototype,l={left:0,top:0};e.findTouch=function(t){for(var e=0,i=this.touches.length;e<i;e++)if(this.touches[e].id===t)return e;return-1};var i=0,n=0,r=0;function a(t){i=t.x,n=t.y,r=t.z}var s=[];function h(t,e,i,n){var r=s.length?s.pop():new c;return r.init(t,e,i,n),r}function o(t){s.length<100&&s.push(t)}function c(){this.starttime=0,this.time=0,this.lasttime=0,this.startx=0,this.starty=0,this.x=0,this.y=0,this.lastx=0,this.lasty=0,this.id=0,this.startindex=0,this.triggeredHold=!1,this.tooFarForHold=!1}c.prototype.init=function(t,e,i,n){var r=cr.performance_now();this.time=r,this.lasttime=r,this.starttime=r,this.startx=t,this.starty=e,this.x=t,this.y=e,this.lastx=t,this.lasty=e,this.width=0,this.height=0,this.pressure=0,this.id=i,this.startindex=n,this.triggeredHold=!1,this.tooFarForHold=!1},c.prototype.update=function(t,e,i,n,r,s){this.lasttime=this.time,this.time=t,this.lastx=this.x,this.lasty=this.y,this.x=e,this.y=i,this.width=n,this.height=r,this.pressure=s,!this.tooFarForHold&&15<=cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(this.tooFarForHold=!0)},c.prototype.maybeTriggerHold=function(t,e){this.triggeredHold||500<=cr.performance_now()-this.starttime&&!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)<15&&(this.triggeredHold=!0,t.trigger_index=this.startindex,t.trigger_id=this.id,t.getTouchIndex=e,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGesture,t),t.curTouchX=this.x,t.curTouchY=this.y,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGestureObject,t),t.getTouchIndex=0)};var u=-1e3,p=-1e3,d=-1e4;function f(){}c.prototype.maybeTriggerTap=function(t,e){var i;this.triggeredHold||(i=cr.performance_now())-this.starttime<=333&&!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)<15&&(t.trigger_index=this.startindex,t.trigger_id=this.id,t.getTouchIndex=e,d=i-d<=666&&cr.distanceTo(u,p,this.x,this.y)<25?(t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGesture,t),t.curTouchX=this.x,t.curTouchY=this.y,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGestureObject,t),p=u=-1e3,-1e4):(t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGesture,t),t.curTouchX=this.x,t.curTouchY=this.y,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,t),u=this.x,p=this.y,i),t.getTouchIndex=0)},e.onCreate=function(){this.isWindows8=!(void 0===window.c2isWindows8||!window.c2isWindows8),this.orient_alpha=0,this.orient_beta=0,this.orient_gamma=0,this.acc_g_x=0,this.acc_g_y=0,this.acc_g_z=0,this.acc_x=0,this.acc_y=0,this.acc_z=0,this.curTouchX=0,this.curTouchY=0,this.trigger_index=0,this.trigger_id=0,this.getTouchIndex=0,this.useMouseInput=0!==this.properties[0];var t=0<this.runtime.fullscreen_mode?document:this.runtime.canvas,e=document;this.runtime.isDirectCanvas?e=t=window.Canvas:this.runtime.isCocoonJs&&(e=t=window);var i,n,r,s,o=this;"undefined"!=typeof PointerEvent?(t.addEventListener("pointerdown",function(t){o.onPointerStart(t)},!1),t.addEventListener("pointermove",function(t){o.onPointerMove(t)},!1),e.addEventListener("pointerup",function(t){o.onPointerEnd(t,!1)},!1),e.addEventListener("pointercancel",function(t){o.onPointerEnd(t,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),document.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),this.runtime.canvas.addEventListener("gesturehold",function(t){t.preventDefault()},!1),document.addEventListener("gesturehold",function(t){t.preventDefault()},!1))):window.navigator.msPointerEnabled?(t.addEventListener("MSPointerDown",function(t){o.onPointerStart(t)},!1),t.addEventListener("MSPointerMove",function(t){o.onPointerMove(t)},!1),e.addEventListener("MSPointerUp",function(t){o.onPointerEnd(t,!1)},!1),e.addEventListener("MSPointerCancel",function(t){o.onPointerEnd(t,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),document.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1))):(t.addEventListener("touchstart",function(t){o.onTouchStart(t)},!1),t.addEventListener("touchmove",function(t){o.onTouchMove(t)},!1),e.addEventListener("touchend",function(t){o.onTouchEnd(t,!1)},!1),e.addEventListener("touchcancel",function(t){o.onTouchEnd(t,!0)},!1)),this.isWindows8?(i=function(t){t=t.reading;o.acc_x=t.accelerationX,o.acc_y=t.accelerationY,o.acc_z=t.accelerationZ},n=function(t){t=t.reading;o.orient_alpha=t.yawDegrees,o.orient_beta=t.pitchDegrees,o.orient_gamma=t.rollDegrees},(r=Windows.Devices.Sensors.Accelerometer.getDefault())&&(r.reportInterval=Math.max(r.minimumReportInterval,16),r.addEventListener("readingchanged",i)),(s=Windows.Devices.Sensors.Inclinometer.getDefault())&&(s.reportInterval=Math.max(s.minimumReportInterval,16),s.addEventListener("readingchanged",n)),document.addEventListener("visibilitychange",function(t){document.hidden||document.msHidden?(r&&r.removeEventListener("readingchanged",i),s&&s.removeEventListener("readingchanged",n)):(r&&r.addEventListener("readingchanged",i),s&&s.addEventListener("readingchanged",n))},!1)):(window.addEventListener("deviceorientation",function(t){o.orient_alpha=t.alpha||0,o.orient_beta=t.beta||0,o.orient_gamma=t.gamma||0},!1),window.addEventListener("devicemotion",function(t){t.accelerationIncludingGravity&&(o.acc_g_x=t.accelerationIncludingGravity.x||0,o.acc_g_y=t.accelerationIncludingGravity.y||0,o.acc_g_z=t.accelerationIncludingGravity.z||0),t.acceleration&&(o.acc_x=t.acceleration.x||0,o.acc_y=t.acceleration.y||0,o.acc_z=t.acceleration.z||0)},!1)),this.useMouseInput&&!this.runtime.isDomFree&&(jQuery(document).mousemove(function(t){o.onMouseMove(t)}),jQuery(document).mousedown(function(t){o.onMouseDown(t)}),jQuery(document).mouseup(function(t){o.onMouseUp(t)})),!this.runtime.isiOS&&this.runtime.isCordova&&navigator.accelerometer&&navigator.accelerometer.watchAcceleration&&navigator.accelerometer.watchAcceleration(a,null,{frequency:40}),this.runtime.tick2Me(this)},e.onPointerMove=function(t){var e,i,n;t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType&&(t.preventDefault&&t.preventDefault(),n=this.findTouch(t.pointerId),e=cr.performance_now(),0<=n&&(i=this.runtime.isDomFree?l:jQuery(this.runtime.canvas).offset(),e-(n=this.touches[n]).time<2||n.update(e,t.pageX-i.left,t.pageY-i.top,t.width||0,t.height||0,t.pressure||0)))},e.onPointerStart=function(t){var e,i;t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType&&(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),i=this.runtime.isDomFree?l:jQuery(this.runtime.canvas).offset(),e=t.pageX-i.left,i=t.pageY-i.top,cr.performance_now(),this.trigger_index=this.touches.length,this.trigger_id=t.pointerId,this.touches.push(h(e,i,t.pointerId,this.trigger_index)),this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this),this.curTouchX=e,this.curTouchY=i,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this),this.runtime.isInUserInputEvent=!1)},e.onPointerEnd=function(t,e){t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType&&(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),t=this.findTouch(t.pointerId),this.trigger_index=0<=t?this.touches[t].startindex:-1,this.trigger_id=0<=t?this.touches[t].id:-1,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),0<=t&&(e||this.touches[t].maybeTriggerTap(this,t),o(this.touches[t]),this.touches.splice(t,1)),this.runtime.isInUserInputEvent=!1)},e.onTouchMove=function(t){t.preventDefault&&t.preventDefault();for(var e,i=cr.performance_now(),n=0,r=t.changedTouches.length;n<r;n++){e=t.changedTouches[n];var s,o,a,h,c=this.findTouch(e.identifier);0<=c&&(s=this.runtime.isDomFree?l:jQuery(this.runtime.canvas).offset(),i-(o=this.touches[c]).time<2||(a=2*(e.radiusX||e.webkitRadiusX||e.mozRadiusX||e.msRadiusX||0),h=2*(e.radiusY||e.webkitRadiusY||e.mozRadiusY||e.msRadiusY||0),c=e.force||e.webkitForce||e.mozForce||e.msForce||0,o.update(i,e.pageX-s.left,e.pageY-s.top,a,h,c)))}},e.onTouchStart=function(t){t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault();var e,i,n=this.runtime.isDomFree?l:jQuery(this.runtime.canvas).offset();cr.performance_now();for(this.runtime.isInUserInputEvent=!0,e=0,i=t.changedTouches.length;e<i;e++){var r,s,o=t.changedTouches[e];-1===this.findTouch(o.identifier)&&(r=o.pageX-n.left,s=o.pageY-n.top,this.trigger_index=this.touches.length,this.trigger_id=o.identifier,this.touches.push(h(r,s,o.identifier,this.trigger_index)),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this),this.curTouchX=r,this.curTouchY=s,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this))}this.runtime.isInUserInputEvent=!1},e.onTouchEnd=function(t,e){var i,n,r;for(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),this.runtime.isInUserInputEvent=!0,i=0,n=t.changedTouches.length;i<n;i++)r=t.changedTouches[i],0<=(r=this.findTouch(r.identifier))&&(this.trigger_index=this.touches[r].startindex,this.trigger_id=this.touches[r].id,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),e||this.touches[r].maybeTriggerTap(this,r),o(this.touches[r]),this.touches.splice(r,1));this.runtime.isInUserInputEvent=!1},e.getAlpha=function(){return this.runtime.isCordova&&0===this.orient_alpha&&0!==r?90*r:this.orient_alpha},e.getBeta=function(){return this.runtime.isCordova&&0===this.orient_beta&&0!==n?90*n:this.orient_beta},e.getGamma=function(){return this.runtime.isCordova&&0===this.orient_gamma&&0!==i?90*i:this.orient_gamma},e.onMouseDown=function(t){t={changedTouches:[{pageX:t.pageX,pageY:t.pageY,identifier:0}]};this.onTouchStart(t),this.mouseDown=!0},e.onMouseMove=function(t){this.mouseDown&&(t={changedTouches:[{pageX:t.pageX,pageY:t.pageY,identifier:0}]},this.onTouchMove(t))},e.onMouseUp=function(t){t.preventDefault&&this.runtime.had_a_click&&!this.runtime.isMobile&&t.preventDefault(),this.runtime.had_a_click=!0;t={changedTouches:[{pageX:t.pageX,pageY:t.pageY,identifier:0}]};this.onTouchEnd(t),this.mouseDown=!1},e.tick2=function(){for(var t,e=cr.performance_now(),i=0,n=this.touches.length;i<n;++i)(t=this.touches[i]).time<=e-50&&(t.lasttime=e),t.maybeTriggerHold(this,i)},f.prototype.OnTouchStart=function(){return!0},f.prototype.OnTouchEnd=function(){return!0},f.prototype.IsInTouch=function(){return this.touches.length},f.prototype.OnTouchObject=function(t){return!!t&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1)};var y=[];function g(){}f.prototype.IsTouchingObject=function(t){if(!t)return!1;for(var e,i,n=t.getCurrentSol(),r=n.getObjects(),s=0,o=r.length;s<o;s++){var a=r[s];for(a.update_bbox(),e=0,i=this.touches.length;e<i;e++){var h=this.touches[e],c=a.layer.canvasToLayer(h.x,h.y,!0),h=a.layer.canvasToLayer(h.x,h.y,!1);if(a.contains_pt(c,h)){y.push(a);break}}}return!!y.length&&(n.select_all=!1,cr.shallowAssignArray(n.instances,y),t.applySolToContainer(),cr.clearArray(y),!0)},f.prototype.CompareTouchSpeed=function(t,e,i){if((t=Math.floor(t))<0||t>=this.touches.length)return!1;var n=this.touches[t],t=cr.distanceTo(n.x,n.y,n.lastx,n.lasty),n=(n.time-n.lasttime)/1e3,n=0<n?t/n:0;return cr.do_cmp(n,e,i)},f.prototype.OrientationSupported=function(){return void 0!==window.DeviceOrientationEvent},f.prototype.MotionSupported=function(){return void 0!==window.DeviceMotionEvent},f.prototype.CompareOrientation=function(t,e,i){var n=0,n=0===t?this.getAlpha():1===t?this.getBeta():this.getGamma();return cr.do_cmp(n,e,i)},f.prototype.CompareAcceleration=function(t,e,i){var n=0;return 0===t?n=this.acc_g_x:1===t?n=this.acc_g_y:2===t?n=this.acc_g_z:3===t?n=this.acc_x:4===t?n=this.acc_y:5===t&&(n=this.acc_z),cr.do_cmp(n,e,i)},f.prototype.OnNthTouchStart=function(t){return(t=Math.floor(t))===this.trigger_index},f.prototype.OnNthTouchEnd=function(t){return(t=Math.floor(t))===this.trigger_index},f.prototype.HasNthTouch=function(t){return t=Math.floor(t),this.touches.length>=t+1},f.prototype.OnHoldGesture=function(){return!0},f.prototype.OnTapGesture=function(){return!0},f.prototype.OnDoubleTapGesture=function(){return!0},f.prototype.OnHoldGestureObject=function(t){return!!t&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1)},f.prototype.OnTapGestureObject=function(t){return!!t&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1)},f.prototype.OnDoubleTapGestureObject=function(t){return!!t&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1)},t.cnds=new f,g.prototype.TouchCount=function(t){t.set_int(this.touches.length)},g.prototype.X=function(t,e){var i,n,r,s,o,a=this.getTouchIndex;a<0||a>=this.touches.length?t.set_float(0):cr.is_undefined(e)?(n=(i=this.runtime.getLayerByNumber(0)).scale,r=i.zoomRate,s=i.parallaxX,o=i.angle,i.scale=1,i.zoomRate=1,i.parallaxX=1,i.angle=0,t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!0)),i.scale=n,i.zoomRate=r,i.parallaxX=s,i.angle=o):(i=cr.is_number(e)?this.runtime.getLayerByNumber(e):this.runtime.getLayerByName(e))?t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!0)):t.set_float(0)},g.prototype.XAt=function(t,e,i){var n,r,s,o,a;(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):cr.is_undefined(i)?(r=(n=this.runtime.getLayerByNumber(0)).scale,s=n.zoomRate,o=n.parallaxX,a=n.angle,n.scale=1,n.zoomRate=1,n.parallaxX=1,n.angle=0,t.set_float(n.canvasToLayer(this.touches[e].x,this.touches[e].y,!0)),n.scale=r,n.zoomRate=s,n.parallaxX=o,n.angle=a):(n=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(n.canvasToLayer(this.touches[e].x,this.touches[e].y,!0)):t.set_float(0)},g.prototype.XForID=function(t,e,i){var n,r,s,o,a=this.findTouch(e);a<0?t.set_float(0):(n=this.touches[a],cr.is_undefined(i)?(s=(r=this.runtime.getLayerByNumber(0)).scale,o=r.zoomRate,e=r.parallaxX,a=r.angle,r.scale=1,r.zoomRate=1,r.parallaxX=1,r.angle=0,t.set_float(r.canvasToLayer(n.x,n.y,!0)),r.scale=s,r.zoomRate=o,r.parallaxX=e,r.angle=a):(r=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(r.canvasToLayer(n.x,n.y,!0)):t.set_float(0))},g.prototype.Y=function(t,e){var i,n,r,s,o,a=this.getTouchIndex;a<0||a>=this.touches.length?t.set_float(0):cr.is_undefined(e)?(n=(i=this.runtime.getLayerByNumber(0)).scale,r=i.zoomRate,s=i.parallaxY,o=i.angle,i.scale=1,i.zoomRate=1,i.parallaxY=1,i.angle=0,t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!1)),i.scale=n,i.zoomRate=r,i.parallaxY=s,i.angle=o):(i=cr.is_number(e)?this.runtime.getLayerByNumber(e):this.runtime.getLayerByName(e))?t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!1)):t.set_float(0)},g.prototype.YAt=function(t,e,i){var n,r,s,o,a;(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):cr.is_undefined(i)?(r=(n=this.runtime.getLayerByNumber(0)).scale,s=n.zoomRate,o=n.parallaxY,a=n.angle,n.scale=1,n.zoomRate=1,n.parallaxY=1,n.angle=0,t.set_float(n.canvasToLayer(this.touches[e].x,this.touches[e].y,!1)),n.scale=r,n.zoomRate=s,n.parallaxY=o,n.angle=a):(n=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(n.canvasToLayer(this.touches[e].x,this.touches[e].y,!1)):t.set_float(0)},g.prototype.YForID=function(t,e,i){var n,r,s,o,a=this.findTouch(e);a<0?t.set_float(0):(n=this.touches[a],cr.is_undefined(i)?(s=(r=this.runtime.getLayerByNumber(0)).scale,o=r.zoomRate,e=r.parallaxY,a=r.angle,r.scale=1,r.zoomRate=1,r.parallaxY=1,r.angle=0,t.set_float(r.canvasToLayer(n.x,n.y,!1)),r.scale=s,r.zoomRate=o,r.parallaxY=e,r.angle=a):(r=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(r.canvasToLayer(n.x,n.y,!1)):t.set_float(0))},g.prototype.AbsoluteX=function(t){this.touches.length?t.set_float(this.touches[0].x):t.set_float(0)},g.prototype.AbsoluteXAt=function(t,e){(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):t.set_float(this.touches[e].x)},g.prototype.AbsoluteXForID=function(t,e){e=this.findTouch(e);e<0?t.set_float(0):(e=this.touches[e],t.set_float(e.x))},g.prototype.AbsoluteY=function(t){this.touches.length?t.set_float(this.touches[0].y):t.set_float(0)},g.prototype.AbsoluteYAt=function(t,e){(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):t.set_float(this.touches[e].y)},g.prototype.AbsoluteYForID=function(t,e){e=this.findTouch(e);e<0?t.set_float(0):(e=this.touches[e],t.set_float(e.y))},g.prototype.SpeedAt=function(t,e){var i;(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):(i=this.touches[e],e=cr.distanceTo(i.x,i.y,i.lastx,i.lasty),(i=(i.time-i.lasttime)/1e3)<=0?t.set_float(0):t.set_float(e/i))},g.prototype.SpeedForID=function(t,e){var i=this.findTouch(e);i<0?t.set_float(0):(e=this.touches[i],i=cr.distanceTo(e.x,e.y,e.lastx,e.lasty),(e=(e.time-e.lasttime)/1e3)<=0?t.set_float(0):t.set_float(i/e))},g.prototype.AngleAt=function(t,e){(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):(e=this.touches[e],t.set_float(cr.to_degrees(cr.angleTo(e.lastx,e.lasty,e.x,e.y))))},g.prototype.AngleForID=function(t,e){e=this.findTouch(e);e<0?t.set_float(0):(e=this.touches[e],t.set_float(cr.to_degrees(cr.angleTo(e.lastx,e.lasty,e.x,e.y))))},g.prototype.Alpha=function(t){t.set_float(this.getAlpha())},g.prototype.Beta=function(t){t.set_float(this.getBeta())},g.prototype.Gamma=function(t){t.set_float(this.getGamma())},g.prototype.AccelerationXWithG=function(t){t.set_float(this.acc_g_x)},g.prototype.AccelerationYWithG=function(t){t.set_float(this.acc_g_y)},g.prototype.AccelerationZWithG=function(t){t.set_float(this.acc_g_z)},g.prototype.AccelerationX=function(t){t.set_float(this.acc_x)},g.prototype.AccelerationY=function(t){t.set_float(this.acc_y)},g.prototype.AccelerationZ=function(t){t.set_float(this.acc_z)},g.prototype.TouchIndex=function(t){t.set_int(this.trigger_index)},g.prototype.TouchID=function(t){t.set_float(this.trigger_id)},g.prototype.WidthForID=function(t,e){e=this.findTouch(e);e<0?t.set_float(0):(e=this.touches[e],t.set_float(e.width))},g.prototype.HeightForID=function(t,e){e=this.findTouch(e);e<0?t.set_float(0):(e=this.touches[e],t.set_float(e.height))},g.prototype.PressureForID=function(t,e){e=this.findTouch(e);e<0?t.set_float(0):(e=this.touches[e],t.set_float(e.pressure))},t.exps=new g}(),cr.behaviors.DragnDrop=function(t){this.runtime=t;var e=this;this.runtime.isDomFree||(jQuery(document).mousemove(function(t){e.onMouseMove(t)}),jQuery(document).mousedown(function(t){e.onMouseDown(t)}),jQuery(document).mouseup(function(t){e.onMouseUp(t)}));t=0<this.runtime.fullscreen_mode?document:this.runtime.canvas;this.runtime.isDirectCanvas?t=window.Canvas:this.runtime.isCocoonJs&&(t=window),"undefined"!=typeof PointerEvent?(t.addEventListener("pointerdown",function(t){e.onPointerStart(t)},!1),t.addEventListener("pointermove",function(t){e.onPointerMove(t)},!1),t.addEventListener("pointerup",function(t){e.onPointerEnd(t)},!1),t.addEventListener("pointercancel",function(t){e.onPointerEnd(t)},!1)):window.navigator.msPointerEnabled?(t.addEventListener("MSPointerDown",function(t){e.onPointerStart(t)},!1),t.addEventListener("MSPointerMove",function(t){e.onPointerMove(t)},!1),t.addEventListener("MSPointerUp",function(t){e.onPointerEnd(t)},!1),t.addEventListener("MSPointerCancel",function(t){e.onPointerEnd(t)},!1)):(t.addEventListener("touchstart",function(t){e.onTouchStart(t)},!1),t.addEventListener("touchmove",function(t){e.onTouchMove(t)},!1),t.addEventListener("touchend",function(t){e.onTouchEnd(t)},!1),t.addEventListener("touchcancel",function(t){e.onTouchEnd(t)},!1))},function(){var n=cr.behaviors.DragnDrop.prototype,y={left:0,top:0};function g(t){for(var e=0,i=t.behavior_insts.length;e<i;e++)if(t.behavior_insts[e]instanceof n.Instance)return t.behavior_insts[e];return null}n.onMouseDown=function(t){1===t.which&&this.onInputDown("leftmouse",t.pageX,t.pageY)},n.onMouseMove=function(t){1===t.which&&this.onInputMove("leftmouse",t.pageX,t.pageY)},n.onMouseUp=function(t){1===t.which&&this.onInputUp("leftmouse")},n.onTouchStart=function(t){var e,i,n,r;for(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),e=0,i=t.changedTouches.length;e<i;e++)r=(n=t.changedTouches[e]).identifier,this.onInputDown(r?r.toString():"<none>",n.pageX,n.pageY)},n.onTouchMove=function(t){var e,i,n,r;for(t.preventDefault&&t.preventDefault(),e=0,i=t.changedTouches.length;e<i;e++)r=(n=t.changedTouches[e]).identifier,this.onInputMove(r?r.toString():"<none>",n.pageX,n.pageY)},n.onTouchEnd=function(t){var e,i,n;for(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),e=0,i=t.changedTouches.length;e<i;e++)n=t.changedTouches[e].identifier,this.onInputUp(n?n.toString():"<none>")},n.onPointerStart=function(t){t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType&&(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),this.onInputDown(t.pointerId.toString(),t.pageX,t.pageY))},n.onPointerMove=function(t){t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType&&(t.preventDefault&&t.preventDefault(),this.onInputMove(t.pointerId.toString(),t.pageX,t.pageY))},n.onPointerEnd=function(t){t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType&&(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),this.onInputUp(t.pointerId.toString()))},n.onInputDown=function(t,e,i){for(var n,r,s,o,a,h=this.runtime.isDomFree?y:jQuery(this.runtime.canvas).offset(),c=e-h.left,l=i-h.top,u=this.my_instances.valuesRef(),p=null,d=0,f=u.length;d<f;d++)(o=g(a=u[d])).enabled&&!o.dragging&&(n=a.layer.canvasToLayer(c,l,!0),o=a.layer.canvasToLayer(c,l,!1),a.update_bbox(),a.contains_pt(n,o)&&(!p||a.layer.index>p.layer.index||a.layer.index===p.layer.index&&a.get_zindex()>p.get_zindex())&&(p=a,r=n,s=o));p&&g(p).onDown(t,r,s)},n.onInputMove=function(t,e,i){for(var n,r,s,o=this.runtime.isDomFree?y:jQuery(this.runtime.canvas).offset(),a=e-o.left,h=i-o.top,c=this.my_instances.valuesRef(),l=0,u=c.length;l<u;l++)!(r=g(s=c[l])).enabled||!r.dragging||r.dragging&&r.dragsource!==t||(n=s.layer.canvasToLayer(a,h,!0),s=s.layer.canvasToLayer(a,h,!1),r.onMove(n,s))},n.onInputUp=function(t){for(var e,i=this.my_instances.valuesRef(),n=0,r=i.length;n<r;n++)(e=g(i[n])).dragging&&e.dragsource===t&&e.onUp()},n.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},n.Type.prototype.onCreate=function(){},n.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var t=n.Instance.prototype;function e(){}function i(){}t.onCreate=function(){this.dragging=!1,this.dx=0,this.dy=0,this.dragsource="<none>",this.axes=this.properties[0],this.enabled=0!==this.properties[1]},t.saveToJSON=function(){return{enabled:this.enabled}},t.loadFromJSON=function(t){this.enabled=t.enabled,this.dragging=!1},t.onDown=function(t,e,i){this.dx=e-this.inst.x,this.dy=i-this.inst.y,this.dragging=!0,this.dragsource=t,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.behaviors.DragnDrop.prototype.cnds.OnDragStart,this.inst),this.runtime.isInUserInputEvent=!1},t.onMove=function(t,e){t-=this.dx,e-=this.dy;0===this.axes?this.inst.x===t&&this.inst.y===e||(this.inst.x=t,this.inst.y=e,this.inst.set_bbox_changed()):1===this.axes?this.inst.x!==t&&(this.inst.x=t,this.inst.set_bbox_changed()):2===this.axes&&this.inst.y!==e&&(this.inst.y=e,this.inst.set_bbox_changed())},t.onUp=function(){this.dragging=!1,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.behaviors.DragnDrop.prototype.cnds.OnDrop,this.inst),this.runtime.isInUserInputEvent=!1},t.tick=function(){},e.prototype.IsDragging=function(){return this.dragging},e.prototype.OnDragStart=function(){return!0},e.prototype.OnDrop=function(){return!0},e.prototype.IsEnabled=function(){return!!this.enabled},n.cnds=new e,i.prototype.SetEnabled=function(t){this.enabled=0!==t,this.enabled||(this.dragging=!1)},i.prototype.Drop=function(){this.dragging&&this.onUp()},n.acts=new i,n.exps=new function(){}}(),cr.behaviors.Pin=function(t){this.runtime=t},function(){var t=cr.behaviors.Pin.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function n(){}function r(){}e.onCreate=function(){this.pinObject=null,this.pinObjectUid=-1,this.pinAngle=0,this.pinDist=0,this.myStartAngle=0,this.theirStartAngle=0,this.lastKnownAngle=0,this.mode=0;var e=this;this.recycled||(this.myDestroyCallback=function(t){e.onInstanceDestroyed(t)}),this.runtime.addDestroyCallback(this.myDestroyCallback)},e.saveToJSON=function(){return{uid:this.pinObject?this.pinObject.uid:-1,pa:this.pinAngle,pd:this.pinDist,msa:this.myStartAngle,tsa:this.theirStartAngle,lka:this.lastKnownAngle,m:this.mode}},e.loadFromJSON=function(t){this.pinObjectUid=t.uid,this.pinAngle=t.pa,this.pinDist=t.pd,this.myStartAngle=t.msa,this.theirStartAngle=t.tsa,this.lastKnownAngle=t.lka,this.mode=t.m},e.afterLoad=function(){-1===this.pinObjectUid?this.pinObject=null:this.pinObject=this.runtime.getObjectByUID(this.pinObjectUid),this.pinObjectUid=-1},e.onInstanceDestroyed=function(t){this.pinObject==t&&(this.pinObject=null)},e.onDestroy=function(){this.pinObject=null,this.runtime.removeDestroyCallback(this.myDestroyCallback)},e.tick=function(){},e.tick2=function(){var t,e,i,n;this.pinObject&&(this.lastKnownAngle!==this.inst.angle&&(this.myStartAngle=cr.clamp_angle(this.myStartAngle+(this.inst.angle-this.lastKnownAngle))),e=this.inst.x,i=this.inst.y,3===this.mode||4===this.mode?((t=cr.distanceTo(this.inst.x,this.inst.y,this.pinObject.x,this.pinObject.y))>this.pinDist||4===this.mode&&t<this.pinDist)&&(n=cr.angleTo(this.pinObject.x,this.pinObject.y,this.inst.x,this.inst.y),e=this.pinObject.x+Math.cos(n)*this.pinDist,i=this.pinObject.y+Math.sin(n)*this.pinDist):(e=this.pinObject.x+Math.cos(this.pinObject.angle+this.pinAngle)*this.pinDist,i=this.pinObject.y+Math.sin(this.pinObject.angle+this.pinAngle)*this.pinDist),n=cr.clamp_angle(this.myStartAngle+(this.pinObject.angle-this.theirStartAngle)),this.lastKnownAngle=n,0!==this.mode&&1!==this.mode&&3!==this.mode&&4!==this.mode||this.inst.x===e&&this.inst.y===i||(this.inst.x=e,this.inst.y=i,this.inst.set_bbox_changed()),0!==this.mode&&2!==this.mode||this.inst.angle===n||(this.inst.angle=n,this.inst.set_bbox_changed()))},i.prototype.IsPinned=function(){return!!this.pinObject},t.cnds=new i,n.prototype.Pin=function(t,e){!t||(t=t.getFirstPicked(this.inst))&&(this.pinObject=t,this.pinAngle=cr.angleTo(t.x,t.y,this.inst.x,this.inst.y)-t.angle,this.pinDist=cr.distanceTo(t.x,t.y,this.inst.x,this.inst.y),this.myStartAngle=this.inst.angle,this.lastKnownAngle=this.inst.angle,this.theirStartAngle=t.angle,this.mode=e)},n.prototype.Unpin=function(){this.pinObject=null},t.acts=new n,r.prototype.PinnedUID=function(t){t.set_int(this.pinObject?this.pinObject.uid:-1)},t.exps=new r}(),cr.behaviors.Rex_RotateTo=function(t){this.runtime=t},function(){var t=cr.behaviors.Rex_RotateTo.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function n(){}function r(){}e.onCreate=function(){this.activated=1==this.properties[0],this.move={max:this.properties[1],acc:this.properties[2],dec:this.properties[3]},this.target={a:0,cw:!0},this.is_rotating=!1,this.current_speed=0,this.remain_distance=0,this.is_my_call=!1},e.tick=function(){var t,e,i;this.activated&&this.is_rotating&&(0!=(i=this.runtime.getDt(this.inst))&&(e=!1,0!=this.move.dec&&(e=(t=this.current_speed)*t/(2*this.move.dec)>=this.remain_distance),0!=(e=e?-this.move.dec:this.move.acc)&&this.SetCurrentSpeed(this.current_speed+e*i),e=this.current_speed*i,this.remain_distance-=e,i=!1,this.remain_distance<=0||this.current_speed<=0?(this.is_rotating=!1,this.inst.angle=cr.to_clamped_radians(this.target.a),this.SetCurrentSpeed(0),i=!0):this.target.cw?this.inst.angle+=cr.to_clamped_radians(e):this.inst.angle-=cr.to_clamped_radians(e),this.inst.set_bbox_changed(),i&&(this.is_my_call=!0,this.runtime.trigger(cr.behaviors.Rex_RotateTo.prototype.cnds.OnHitTarget,this.inst),this.is_my_call=!1)))},e.tick2=function(){},e.SetCurrentSpeed=function(t){null!=t?this.current_speed=t>this.move.max?this.move.max:t:0==this.move.acc&&(this.current_speed=this.move.max)},e.SetTargetAngle=function(t,e){this.is_rotating=!0;var i=this.inst.angle;this.target.cw=2==e?cr.angleClockwise(t,i):1==e;i=2==e?cr.angleDiff(i,t):1==e?t-i:i-t;this.remain_distance=cr.to_clamped_degrees(i),this.target.a=cr.to_clamped_degrees(t),this.SetCurrentSpeed(null)},e.saveToJSON=function(){return{en:this.activated,v:this.move,t:this.target,ir:this.is_rotating,cs:this.current_speed,rd:this.remain_distance}},e.loadFromJSON=function(t){this.activated=t.en,this.move=t.v,this.target=t.t,this.is_rotating=t.ir,this.current_speed=t.cs,this.remain_distance=t.rd},t.cnds=new i,i.prototype.OnHitTarget=function(){return this.is_my_call},i.prototype.CompareSpeed=function(t,e){return cr.do_cmp(this.current_speed,t,e)},i.prototype.OnMoving=function(){return!1},i.prototype.IsRotating=function(){return this.activated&&this.is_rotating},t.acts=new n,n.prototype.SetActivated=function(t){this.activated=1==t},n.prototype.SetMaxSpeed=function(t){this.move.max=t,this.SetCurrentSpeed(null)},n.prototype.SetAcceleration=function(t){this.move.acc=t,this.SetCurrentSpeed(null)},n.prototype.SetDeceleration=function(t){this.move.dec=t},n.prototype.SetTargetAngle=function(t,e){this.SetTargetAngle(cr.to_clamped_radians(t),e)},n.prototype.SetCurrentSpeed=function(t){this.SetCurrentSpeed(t)},n.prototype.SetTargetAngleOnObject=function(t,e){!t||null!=(t=t.getFirstPicked())&&(t=Math.atan2(t.y-this.inst.y,t.x-this.inst.x),this.SetTargetAngle(t,e))},n.prototype.SetTargetAngleByDeltaAngle=function(t,e){t=cr.to_clamped_radians(t);0==e&&(t=-t);t=this.inst.angle+t;this.SetTargetAngle(t,e)},n.prototype.SetTargetAngleToPos=function(t,e,i){t=Math.atan2(e-this.inst.y,t-this.inst.x);this.SetTargetAngle(t,i)},n.prototype.Stop=function(){this.is_rotating=!1},t.exps=new r,r.prototype.Activated=function(t){t.set_int(this.activated?1:0)},r.prototype.Speed=function(t){t.set_float(this.current_speed)},r.prototype.MaxSpeed=function(t){t.set_float(this.move.max)},r.prototype.Acc=function(t){t.set_float(this.move.acc)},r.prototype.Dec=function(t){t.set_float(this.move.dec)},r.prototype.TargetAngle=function(t){var e=this.is_rotating?this.target.a:0;t.set_float(e)}}(),cr.behaviors.Sin=function(t){this.runtime=t},function(){var t=cr.behaviors.Sin.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime,this.i=0};var e=t.Instance.prototype,i=2*Math.PI,n=Math.PI/2,r=3*Math.PI/2;function s(){}function o(){}function a(){}e.onCreate=function(){this.active=1===this.properties[0],this.movement=this.properties[1],this.wave=this.properties[2],this.period=this.properties[3],this.period+=Math.random()*this.properties[4],0===this.period?this.i=0:(this.i=this.properties[5]/this.period*i,this.i+=Math.random()*this.properties[6]/this.period*i),this.mag=this.properties[7],this.mag+=Math.random()*this.properties[8],this.initialValue=0,this.initialValue2=0,this.ratio=0,this.init()},e.saveToJSON=function(){return{i:this.i,a:this.active,mv:this.movement,w:this.wave,p:this.period,mag:this.mag,iv:this.initialValue,iv2:this.initialValue2,r:this.ratio,lkv:this.lastKnownValue,lkv2:this.lastKnownValue2}},e.loadFromJSON=function(t){this.i=t.i,this.active=t.a,this.movement=t.mv,this.wave=t.w,this.period=t.p,this.mag=t.mag,this.initialValue=t.iv,this.initialValue2=t.iv2||0,this.ratio=t.r,this.lastKnownValue=t.lkv,this.lastKnownValue2=t.lkv2||0},e.init=function(){switch(this.movement){case 0:this.initialValue=this.inst.x;break;case 1:this.initialValue=this.inst.y;break;case 2:this.initialValue=this.inst.width,this.ratio=this.inst.height/this.inst.width;break;case 3:this.initialValue=this.inst.width;break;case 4:this.initialValue=this.inst.height;break;case 5:this.initialValue=this.inst.angle,this.mag=cr.to_radians(this.mag);break;case 6:this.initialValue=this.inst.opacity;break;case 7:this.initialValue=0;break;case 8:this.initialValue=this.inst.x,this.initialValue2=this.inst.y}this.lastKnownValue=this.initialValue,this.lastKnownValue2=this.initialValue2},e.waveFunc=function(t){switch(t%=i,this.wave){case 0:return Math.sin(t);case 1:return t<=n?t/n:t<=r?1-2*(t-n)/Math.PI:(t-r)/n-1;case 2:return 2*t/i-1;case 3:return-2*t/i+1;case 4:return t<Math.PI?-1:1}return 0},e.tick=function(){var t=this.runtime.getDt(this.inst);this.active&&0!==t&&(0===this.period?this.i=0:(this.i+=t/this.period*i,this.i=this.i%i),this.updateFromPhase())},e.updateFromPhase=function(){switch(this.movement){case 0:this.inst.x!==this.lastKnownValue&&(this.initialValue+=this.inst.x-this.lastKnownValue),this.inst.x=this.initialValue+this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.x;break;case 1:this.inst.y!==this.lastKnownValue&&(this.initialValue+=this.inst.y-this.lastKnownValue),this.inst.y=this.initialValue+this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.y;break;case 2:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag,this.inst.height=this.inst.width*this.ratio;break;case 3:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 4:this.inst.height=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 5:this.inst.angle!==this.lastKnownValue&&(this.initialValue=cr.clamp_angle(this.initialValue+(this.inst.angle-this.lastKnownValue))),this.inst.angle=cr.clamp_angle(this.initialValue+this.waveFunc(this.i)*this.mag),this.lastKnownValue=this.inst.angle;break;case 6:this.inst.opacity=this.initialValue+this.waveFunc(this.i)*this.mag/100,this.inst.opacity<0?this.inst.opacity=0:1<this.inst.opacity&&(this.inst.opacity=1);break;case 8:this.inst.x!==this.lastKnownValue&&(this.initialValue+=this.inst.x-this.lastKnownValue),this.inst.y!==this.lastKnownValue2&&(this.initialValue2+=this.inst.y-this.lastKnownValue2),this.inst.x=this.initialValue+Math.cos(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.inst.y=this.initialValue2+Math.sin(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.x,this.lastKnownValue2=this.inst.y}this.inst.set_bbox_changed()},e.onSpriteFrameChanged=function(t,e){switch(this.movement){case 2:this.initialValue*=e.width/t.width,this.ratio=e.height/e.width;break;case 3:this.initialValue*=e.width/t.width;break;case 4:this.initialValue*=e.height/t.height}},s.prototype.IsActive=function(){return this.active},s.prototype.CompareMovement=function(t){return this.movement===t},s.prototype.ComparePeriod=function(t,e){return cr.do_cmp(this.period,t,e)},s.prototype.CompareMagnitude=function(t,e){return 5===this.movement?cr.do_cmp(this.mag,t,cr.to_radians(e)):cr.do_cmp(this.mag,t,e)},s.prototype.CompareWave=function(t){return this.wave===t},t.cnds=new s,o.prototype.SetActive=function(t){this.active=1===t},o.prototype.SetPeriod=function(t){this.period=t},o.prototype.SetMagnitude=function(t){this.mag=t,5===this.movement&&(this.mag=cr.to_radians(this.mag))},o.prototype.SetMovement=function(t){5===this.movement&&(this.mag=cr.to_degrees(this.mag)),this.movement=t,this.init()},o.prototype.SetWave=function(t){this.wave=t},o.prototype.SetPhase=function(t){this.i=t*i%i,this.updateFromPhase()},o.prototype.UpdateInitialState=function(){this.init()},t.acts=new o,a.prototype.CyclePosition=function(t){t.set_float(this.i/i)},a.prototype.Period=function(t){t.set_float(this.period)},a.prototype.Magnitude=function(t){5===this.movement?t.set_float(cr.to_degrees(this.mag)):t.set_float(this.mag)},a.prototype.Value=function(t){t.set_float(this.waveFunc(this.i)*this.mag)},t.exps=new a}();var easeOutBounceArray=[],easeInElasticArray=[],easeOutElasticArray=[],easeInOutElasticArray=[],easeInCircle=[],easeOutCircle=[],easeInOutCircle=[],easeInBack=[],easeOutBack=[],easeInOutBack=[],litetween_precision=1e4,updateLimit=0;function easeOutBouncefunc(t){return result=(t/=1)<1/2.75?7.5625*t*t*1+0:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,result}function integerize(t,e){return Math.round(t/e*litetween_precision)}function easeFunc(t,e,i,n,r,s,o){var a,h,c,l,u=0;switch(t){case 0:u=n*e/r+i;break;case 1:u=n*(e/=r)*e+i;break;case 2:u=-n*(e/=r)*(e-2)+i;break;case 3:u=(e/=r/2)<1?n/2*e*e+i:-n/2*(--e*(e-2)-1)+i;break;case 4:u=n*(e/=r)*e*e+i;break;case 5:u=n*((e=e/r-1)*e*e+1)+i;break;case 6:u=(e/=r/2)<1?n/2*e*e*e+i:n/2*((e-=2)*e*e+2)+i;break;case 7:u=n*(e/=r)*e*e*e+i;break;case 8:u=-n*((e=e/r-1)*e*e*e-1)+i;break;case 9:u=(e/=r/2)<1?n/2*e*e*e*e+i:-n/2*((e-=2)*e*e*e-2)+i;break;case 10:u=n*(e/=r)*e*e*e*e+i;break;case 11:u=n*((e=e/r-1)*e*e*e*e+1)+i;break;case 12:u=(e/=r/2)<1?n/2*e*e*e*e*e+i:n/2*((e-=2)*e*e*e*e+2)+i;break;case 13:u=o.optimized?easeInCircle[integerize(e,r)]:-(Math.sqrt(1-e*e)-1);break;case 14:u=o.optimized?easeOutCircle[integerize(e,r)]:Math.sqrt(1-(e-1)*(e-1));break;case 15:u=o.optimized?easeInOutCircle[integerize(e,r)]:(e/=r/2)<1?-n/2*(Math.sqrt(1-e*e)-1)+i:n/2*(Math.sqrt(1-(e-=2)*e)+1)+i;break;case 16:u=o.optimized?easeInBack[integerize(e,r)]:n*(e/=r)*e*(((c=o.s)+1)*e-c)+i;break;case 17:u=o.optimized?easeOutBack[integerize(e,r)]:n*((e=e/r-1)*e*(((c=o.s)+1)*e+c)+1)+i;break;case 18:u=o.optimized?easeInOutBack[integerize(e,r)]:(c=o.s,(e/=r/2)<1?n/2*(e*e*((1+(c*=1.525))*e-c))+i:n/2*((e-=2)*e*((1+(c*=1.525))*e+c)+2)+i);break;case 19:u=o.optimized?easeInElasticArray[integerize(e,r)]:(a=o.a,(c=0)==e&&(u=i),1==(e/=r)&&(u=i+n),0==(h=o.p)&&(h=.3*r),c=0==a||a<Math.abs(n)?(a=n,h/4):h/(2*Math.PI)*Math.asin(n/a),-(a*Math.pow(2,10*--e)*Math.sin((e*r-c)*(2*Math.PI)/h))+i);break;case 20:u=o.optimized?easeOutElasticArray[integerize(e,r)]:(a=o.a,(c=0)==e&&(u=i),1==(e/=r)&&(u=i+n),0==(h=o.p)&&(h=.3*r),c=0==a||a<Math.abs(n)?(a=n,h/4):h/(2*Math.PI)*Math.asin(n/a),a*Math.pow(2,-10*e)*Math.sin((e*r-c)*(2*Math.PI)/h)+n+i);break;case 21:u=o.optimized?easeInOutElasticArray[integerize(e,r)]:(a=o.a,(c=0)==e&&(u=i),2==(e/=r/2)&&(u=i+n),0==(h=o.p)&&(h=r*(.3*1.5)),c=0==a||a<Math.abs(n)?(a=n,h/4):h/(2*Math.PI)*Math.asin(n/a),e<1?a*Math.pow(2,10*--e)*Math.sin((e*r-c)*(2*Math.PI)/h)*-.5+i:a*Math.pow(2,-10*--e)*Math.sin((e*r-c)*(2*Math.PI)/h)*.5+n+i);break;case 22:u=o.optimized?n-easeOutBounceArray[integerize(r-e,r)]+i:n-easeOutBouncefunc(r-e/r)+i;break;case 23:u=o.optimized?easeOutBounceArray[integerize(e,r)]:easeOutBouncefunc(e/r);break;case 24:u=o.optimized?e<r/2?.5*(n-easeOutBounceArray[integerize(r-2*e,r)]+i)+i:.5*easeOutBounceArray[integerize(2*e-r,r)]+.5*n+i:e<r/2?.5*(n-easeOutBouncefunc(r-2*e)+i)+i:.5*easeOutBouncefunc((2*e-r)/r)+.5*n+i;break;case 25:u=(l=e/r/2)*l*(3-2*l)*2;break;case 26:u=(l=(e/r+1)/2)*l*(3-2*l)*2-1;break;case 27:u=(l=e/r)*l*(3-2*l)}return s?n-i-u:u}!function(){for(var t=0,e=0,i=0,n=0,r=0,s=0;s<=litetween_precision;s++){n=s/litetween_precision,t=(n/=1)<1/2.75?7.5625*n*n*1+0:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375;easeOutBounceArray[s]=t,(i=e=0)==(n=s/litetween_precision)&&(t=0),1==(n/=1)&&(t=1),0==i&&(i=.3),r=0==e||e<Math.abs(1)?(e=1,i/4):i/(2*Math.PI)*Math.asin(1/e),t=0-e*Math.pow(2,10*--n)*Math.sin((+n-r)*(2*Math.PI)/i),easeInElasticArray[s]=t,(i=e=0)==(n=s/litetween_precision)&&(t=0),1==(n/=1)&&(t=1),0==i&&(i=.3),r=0==e||e<Math.abs(1)?(e=1,i/4):i/(2*Math.PI)*Math.asin(1/e),t=e*Math.pow(2,-10*n)*Math.sin((+n-r)*(2*Math.PI)/i)+1,easeOutElasticArray[s]=t,(i=e=0)==(n=s/litetween_precision)&&(t=0),2==(n/=.5)&&(t=1),0==i&&(i=.3*1.5*1),r=0==e||e<Math.abs(1)?(e=1,i/4):i/(2*Math.PI)*Math.asin(1/e),t=n<1?e*Math.pow(2,10*--n)*Math.sin((+n-r)*(2*Math.PI)/i)*-.5+0:e*Math.pow(2,-10*--n)*Math.sin((+n-r)*(2*Math.PI)/i)*.5+1,easeInOutElasticArray[s]=t,n=s/litetween_precision,easeInCircle[s]=-(Math.sqrt(1-n*n)-1),n=s/litetween_precision,easeOutCircle[s]=Math.sqrt(1-(n-1)*(n-1)),n=s/litetween_precision,t=(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1)+0:.5*(Math.sqrt(1-(n-=2)*n)+1)+0,easeInOutCircle[s]=t,n=s/litetween_precision,(r=0)==r&&(r=1.70158),t=(n/=1)*n*((r+1)*n-r)+0,easeInBack[s]=t,(r=0)==r&&(r=1.70158),t=(n=+(n=s/litetween_precision)-1)*n*((r+1)*n+r)+1,easeOutBack[s]=t,n=s/litetween_precision,(r=0)==r&&(r=1.70158),t=(n/=.5)<1?n*n*((1+(r*=1.525))*n-r)*.5+0:.5*((n-=2)*n*((1+(r*=1.525))*n+r)+2)+0,easeInOutBack[s]=t}}();var TweenObject=function(t,e,i,n,r,s,o){this.name=t,this.value=0,this.setInitial(n),this.setTarget(r),this.easefunc=i,this.tweened=e,this.duration=s,this.progress=0,this.state=0,this.onStart=!1,this.onEnd=!1,this.onReverseStart=!1,this.onReverseEnd=!1,this.lastKnownValue=0,this.lastKnownValue2=0,this.enforce=o,this.pingpong=1,this.flipEase=!1,this.easingparam=[],this.lastState=1;for(var a=0;a<28;a++)this.easingparam[a]={},this.easingparam[a].a=0,this.easingparam[a].p=0,this.easingparam[a].t=0,this.easingparam[a].s=0,this.easingparam[a].optimized=!0};function trim(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function isReversed(t){var e=t[0],i=t[1],t=t[2],e=cp.v.sub(i,e),i=cp.v.sub(t,i);return cp.v.cross(e,i)<0}function pointsInTriangle(t,e){for(var i,n=0;n<t.length;++n)if(i=t[n],-1==e.indexOf(i)&&pointInTriangle(i,e))return!0;return!1}function pointInTriangle(t,e){var i=t,n=e[0],r=e[1],s=e[2],t=cp.v.sub(s,n),e=cp.v.sub(r,n),s=cp.v.sub(i,n),r=cp.v.dot(t,t),i=cp.v.dot(t,e),n=cp.v.dot(t,s),t=cp.v.dot(e,e),e=cp.v.dot(e,s),s=1/(r*t-i*i),t=(t*n-i*e)*s,s=(r*e-i*n)*s;return 0<=t&&0<=s&&t+s<1}function triangulate(t){for(var e,i=t.slice(0),n=[],r=0;3<=i.length;)isReversed(e=[i[r],i[(r+1)%i.length],i[(r+2)%i.length]])||pointsInTriangle(i,e)?r++:(i.splice((r+1)%i.length,1),n.push(e)),r%=i.length;return n}function add_tri_2_poly(t,e){for(var i,n,r=0,s=0;s<3;s++)-1==t.indexOf(e[s])?(i=e[s],n=e[(s+1)%3]):r++;if(2!=r)return!1;s=t.indexOf(n);var o=t.length;return!isReversed([t[(s-2+o)%o],t[(s-1+o)%o],i])&&!isReversed([i,t[s],t[(s+1)%o]])&&(t.splice(s,0,i),!0)}function triangles2convex(t){for(var e=t,i=[];0<e.length;){var n=e[0];e.shift();for(var r=0;r<e.length;r++)add_tri_2_poly(n,e[r])&&(e.splice(r,1),r=-1);i.push(n)}return i}TweenObject.prototype={},TweenObject.prototype.flipTarget=function(){var t=this.initialparam1,e=this.initialparam2;this.initialparam1=this.targetparam1,this.initialparam2=this.targetparam2,this.targetparam1=t,this.targetparam2=e,this.lastKnownValue=0,this.lastKnownValue2=0},TweenObject.prototype.setInitial=function(t){this.initialparam1=parseFloat(t.split(",")[0]),this.initialparam2=parseFloat(t.split(",")[1]),this.lastKnownValue=0,this.lastKnownValue2=0},TweenObject.prototype.setTarget=function(t){this.targetparam1=parseFloat(t.split(",")[0]),this.targetparam2=parseFloat(t.split(",")[1]),isNaN(this.targetparam2)&&(this.targetparam2=this.targetparam1)},TweenObject.prototype.OnTick=function(t){return 0===this.state?-1:(1===this.state&&(this.progress+=t),2===this.state&&(this.progress-=t),3===this.state&&(this.state=0),4!==this.state&&6!==this.state||(this.progress+=t*this.pingpong),5===this.state&&(this.progress+=t*this.pingpong),this.progress<0?(this.progress=0,4===this.state?this.pingpong=1:6===this.state?(this.pingpong=1,this.flipEase=!1):this.state=0,this.onReverseEnd=!0,0):this.progress>this.duration?(this.progress=this.duration,4===this.state?this.pingpong=-1:6===this.state?(this.pingpong=-1,this.flipEase=!0):5===this.state?this.progress=0:this.state=0,this.onEnd=!0,1):this.flipEase?easeFunc(this.easefunc,this.duration-this.progress,0,1,this.duration,this.flipEase,this.easingparam[this.easefunc]):easeFunc(this.easefunc,this.progress,0,1,this.duration,this.flipEase,this.easingparam[this.easefunc]))},cr.behaviors.lunarray_LiteTween=function(t){this.runtime=t},function(){var t=cr.behaviors.lunarray_LiteTween.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime,this.i=0};var e=t.Instance.prototype;e.onCreate=function(){this.playmode=this.properties[0],this.active=1==this.playmode||2==this.playmode||3==this.playmode||4==this.playmode,this.tweened=this.properties[1],this.easing=this.properties[2],this.target=this.properties[3],this.targetmode=this.properties[4],this.useCurrent=!1,1===this.targetmode&&(this.target="relative("+this.target+")"),this.duration=this.properties[5],this.enforce=1===this.properties[6],this.value=0,this.tween_list={},this.addToTweenList("default",this.tweened,this.easing,"current",this.target,this.duration,this.enforce),1===this.properties[0]&&this.startTween(0),2===this.properties[0]&&this.startTween(2),3===this.properties[0]&&this.startTween(3),4===this.properties[0]&&this.startTween(4)},e.parseCurrent=function(t,e){void 0===e&&(e="current");var i=trim(e);e=trim(e);var n=this.value;if("current"===e)switch(t){case 0:i=this.inst.x+","+this.inst.y;break;case 1:case 2:case 3:i=this.inst.width+","+this.inst.height;break;case 4:i=cr.to_degrees(this.inst.angle)+","+cr.to_degrees(this.inst.angle);break;case 5:i=100*this.inst.opacity+","+100*this.inst.opacity;break;case 6:i=n+","+n;break;case 7:case 8:i=this.inst.x+","+this.inst.y;break;case 9:i=void 0!==this.inst.curFrame?this.inst.width/this.inst.curFrame.width+","+this.inst.height/this.inst.curFrame.height:"1,1"}if("relative"===e.substring(0,8)){var r,s,e=e.match(/\((.*?)\)/);switch(e&&(r=parseFloat(e[1].split(",")[0]),s=parseFloat(e[1].split(",")[1])),isNaN(r)&&(r=0),isNaN(s)&&(s=0),t){case 0:i=this.inst.x+r+","+(this.inst.y+s);break;case 1:case 2:case 3:i=this.inst.width+r+","+(this.inst.height+s);break;case 4:i=cr.to_degrees(this.inst.angle)+r+","+(cr.to_degrees(this.inst.angle)+s);break;case 5:i=100*this.inst.opacity+r+","+(100*this.inst.opacity+s);break;case 6:i=n+r+","+n+r;break;case 7:i=this.inst.x+r+","+this.inst.y;break;case 8:i=this.inst.x+","+(this.inst.y+r);break;case 9:i=r+","+s}}return i},e.addToTweenList=function(t,e,i,n,r,s,o){n=this.parseCurrent(e,n),r=this.parseCurrent(e,r),void 0!==this.tween_list[t]&&delete this.tween_list[t],this.tween_list[t]=new TweenObject(t,e,i,n,r,s,o),this.tween_list[t].dt=0},e.saveToJSON=function(){JSON.stringify(this.tween_list.default);return{playmode:this.playmode,active:this.active,tweened:this.tweened,easing:this.easing,target:this.target,targetmode:this.targetmode,useCurrent:this.useCurrent,duration:this.duration,enforce:this.enforce,value:this.value,tweenlist:JSON.stringify(this.tween_list.default)}},TweenObject.Load=function(t,e,i,n,r,s,o,a){var h,c=new TweenObject(e,i,n,r,s,o,a);for(h in t)c[h]=t[h];return c},e.loadFromJSON=function(t){var e=JSON.parse(t.tweenlist),e=TweenObject.Load(e,e.name,e.tweened,e.easefunc,e.initialparam1+","+e.initialparam2,e.targetparam1+","+e.targetparam2,e.duration,e.enforce);this.tween_list.default=e,this.playmode=t.playmode,this.active=t.active,this.movement=t.tweened,this.easing=t.easing,this.target=t.target,this.targetmode=t.targetmode,this.useCurrent=t.useCurrent,this.duration=t.duration,this.enforce=t.enforce,this.value=t.value},e.setProgressTo=function(t){for(var e in 1<t&&(t=1),t<0&&(t=0),this.tween_list){var i=this.tween_list[e];i.lastKnownValue=0,i.lastKnownValue2=0,i.state=3,i.progress=t*i.duration;var n=i.OnTick(0);this.updateTween(i,n)}},e.startTween=function(t){for(var e in this.tween_list){var i,n,r=this.tween_list[e];this.useCurrent&&(i=this.parseCurrent(r.tweened,"current"),n=this.parseCurrent(r.tweened,this.target),r.setInitial(i),r.setTarget(n)),0===t&&(r.progress=1e-6,r.lastKnownValue=0,r.lastKnownValue2=0,r.onStart=!0,r.state=1),1===t&&(r.state=r.lastState),2!==t&&4!==t||(r.progress=1e-6,r.lastKnownValue=0,r.lastKnownValue2=0,r.onStart=!0,2==t&&(r.state=4),4==t&&(r.state=6)),3===t&&(r.progress=1e-6,r.lastKnownValue=0,r.lastKnownValue2=0,r.onStart=!0,r.state=5)}},e.stopTween=function(t){for(var e in this.tween_list){var i=this.tween_list[e];3!=i.state&&0!=i.state&&(i.lastState=i.state),1===t&&(i.progress=0),2===t&&(i.progress=i.duration),i.state=3;var n=i.OnTick(0);this.updateTween(i,n)}},e.reverseTween=function(t){for(var e in this.tween_list){var i=this.tween_list[e];1===t&&(i.progress=i.duration,i.lastKnownValue=0,i.lastKnownValue2=0,i.onReverseStart=!0),i.state=2}},e.updateTween=function(t,e){var i,n;0===t.tweened?t.enforce?(this.inst.x=t.initialparam1+(t.targetparam1-t.initialparam1)*e,this.inst.y=t.initialparam2+(t.targetparam2-t.initialparam2)*e):(this.inst.x+=(t.targetparam1-t.initialparam1)*e-t.lastKnownValue,this.inst.y+=(t.targetparam2-t.initialparam2)*e-t.lastKnownValue2,t.lastKnownValue=(t.targetparam1-t.initialparam1)*e,t.lastKnownValue2=(t.targetparam2-t.initialparam2)*e):1===t.tweened?t.enforce?(this.inst.width=t.initialparam1+(t.targetparam1-t.initialparam1)*e,this.inst.height=t.initialparam2+(t.targetparam2-t.initialparam2)*e):(this.inst.width+=(t.targetparam1-t.initialparam1)*e-t.lastKnownValue,this.inst.height+=(t.targetparam2-t.initialparam2)*e-t.lastKnownValue2,t.lastKnownValue=(t.targetparam1-t.initialparam1)*e,t.lastKnownValue2=(t.targetparam2-t.initialparam2)*e):2===t.tweened?t.enforce?this.inst.width=t.initialparam1+(t.targetparam1-t.initialparam1)*e:(this.inst.width+=(t.targetparam1-t.initialparam1)*e-t.lastKnownValue,t.lastKnownValue=(t.targetparam1-t.initialparam1)*e):3===t.tweened?t.enforce?this.inst.height=t.initialparam2+(t.targetparam2-t.initialparam2)*e:(this.inst.height+=(t.targetparam2-t.initialparam2)*e-t.lastKnownValue2,t.lastKnownValue2=(t.targetparam2-t.initialparam2)*e):4===t.tweened?t.enforce?(n=t.initialparam1+(t.targetparam1-t.initialparam1)*e,this.inst.angle=cr.clamp_angle(cr.to_radians(n))):(n=(t.targetparam1-t.initialparam1)*e-t.lastKnownValue,this.inst.angle=cr.clamp_angle(this.inst.angle+cr.to_radians(n)),t.lastKnownValue=(t.targetparam1-t.initialparam1)*e):5===t.tweened?t.enforce?this.inst.opacity=(t.initialparam1+(t.targetparam1-t.initialparam1)*e)/100:(this.inst.opacity+=((t.targetparam1-t.initialparam1)*e-t.lastKnownValue)/100,t.lastKnownValue=(t.targetparam1-t.initialparam1)*e):6===t.tweened?t.enforce?this.value=t.initialparam1+(t.targetparam1-t.initialparam1)*e:(this.value+=(t.targetparam1-t.initialparam1)*e-t.lastKnownValue,t.lastKnownValue=(t.targetparam1-t.initialparam1)*e):7===t.tweened?t.enforce?this.inst.x=t.initialparam1+(t.targetparam1-t.initialparam1)*e:(this.inst.x+=(t.targetparam1-t.initialparam1)*e-t.lastKnownValue,t.lastKnownValue=(t.targetparam1-t.initialparam1)*e):8===t.tweened?t.enforce?this.inst.y=t.initialparam2+(t.targetparam2-t.initialparam2)*e:(this.inst.y+=(t.targetparam2-t.initialparam2)*e-t.lastKnownValue2,t.lastKnownValue2=(t.targetparam2-t.initialparam2)*e):9===t.tweened&&(i=t.initialparam1+(t.targetparam1-t.initialparam1)*e,n=t.initialparam2+(t.targetparam2-t.initialparam2)*e,this.inst.width<0&&(i=t.initialparam1+(t.targetparam1+t.initialparam1)*-e),this.inst.height<0&&(n=t.initialparam2+(t.targetparam2+t.initialparam2)*-e),t.enforce?(this.inst.width=this.inst.curFrame.width*i,this.inst.height=this.inst.curFrame.height*n):(this.inst.width<0?(this.inst.width=i*(this.inst.width/(-1+t.lastKnownValue)),t.lastKnownValue=i+1):(this.inst.width=i*(this.inst.width/(1+t.lastKnownValue)),t.lastKnownValue=i-1),this.inst.height<0?(this.inst.height=n*(this.inst.height/(-1+t.lastKnownValue2)),t.lastKnownValue2=n+1):(this.inst.height=n*(this.inst.height/(1+t.lastKnownValue2)),t.lastKnownValue2=n-1))),this.inst.set_bbox_changed()},e.tick=function(){var t=this.runtime.getDt(this.inst),e=this.tween_list.default;0!==e.state&&(e.onStart&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnStart,this.inst),e.onStart=!1),e.onReverseStart&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnReverseStart,this.inst),e.onReverseStart=!1),this.active=1==e.state||2==e.state||4==e.state||5==e.state||6==e.state,t=e.OnTick(t),this.updateTween(e,t),e.onEnd&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnEnd,this.inst),e.onEnd=!1),e.onReverseEnd&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnReverseEnd,this.inst),e.onReverseEnd=!1))},t.cnds={},(e=t.cnds).IsActive=function(){return 0!==this.tween_list.default.state},e.IsReversing=function(){return 2==this.tween_list.default.state},e.CompareProgress=function(t,e){var i=this.tween_list.default;return cr.do_cmp(i.progress/i.duration,t,e)},e.OnThreshold=function(t,e){var i=this.tween_list.default;this.threshold=cr.do_cmp(i.progress/i.duration,t,e);e=this.oldthreshold!=this.threshold&&this.threshold;return e&&(this.oldthreshold=this.threshold),e},e.OnStart=function(){return void 0!==this.tween_list.default&&this.tween_list.default.onStart},e.OnReverseStart=function(){return void 0!==this.tween_list.default&&this.tween_list.default.onReverseStart},e.OnEnd=function(){return void 0!==this.tween_list.default&&this.tween_list.default.onEnd},e.OnReverseEnd=function(){return void 0!==this.tween_list.default&&this.tween_list.default.onReverseEnd},t.acts={},(e=t.acts).Start=function(t,e){this.threshold=!1,this.oldthreshold=!1,this.useCurrent=1==e,this.startTween(t)},e.Stop=function(t){this.stopTween(t)},e.Reverse=function(t){this.threshold=!1,this.oldthreshold=!1,this.reverseTween(t)},e.ProgressTo=function(t){this.setProgressTo(t)},e.SetDuration=function(t){isNaN(t)||t<0||void 0!==this.tween_list.default&&(this.tween_list.default.duration=t)},e.SetEnforce=function(t){void 0!==this.tween_list.default&&(this.tween_list.default.enforce=1===t)},e.SetInitial=function(t){void 0!==this.tween_list.default&&(t=this.parseCurrent(this.tween_list.default.tweened,t),this.tween_list.default.setInitial(t))},e.SetTarget=function(t,e,i){if(void 0!==this.tween_list.default&&!isNaN(i)){var n=this.tween_list.default,r=i+"",s="",o="";if(1===(this.targetmode=e)){switch(this.target="relative("+r+")",t){case 0:s=this.inst.x+i,o=n.targetparam2;break;case 1:s=n.targetparam1,o=this.inst.y+i;break;case 2:o=s=""+cr.to_degrees(this.inst.angle+cr.to_radians(i));break;case 3:o=s=""+100*this.inst.opacity+i;break;case 4:s=this.inst.width+i,o=n.targetparam2;break;case 5:s=n.targetparam1,o=this.inst.height+i;break;case 6:o=s=i}r=s+","+o}else{switch(t){case 0:s=i,o=n.targetparam2;break;case 1:s=n.targetparam1,o=i;break;case 2:case 3:o=s=i;break;case 4:s=i,o=n.targetparam2;break;case 5:s=n.targetparam1,o=i;break;case 6:o=s=i}r=s+","+o,this.target=r}t=this.parseCurrent(this.tween_list.default.tweened,"current"),r=this.parseCurrent(this.tween_list.default.tweened,r);n.setInitial(t),n.setTarget(r)}},e.SetTweenedProperty=function(t){void 0!==this.tween_list.default&&(this.tween_list.default.tweened=t)},e.SetEasing=function(t){void 0!==this.tween_list.default&&(this.tween_list.default.easefunc=t)},e.SetEasingParam=function(t,e,i,n,r){void 0!==this.tween_list.default&&(this.tween_list.default.easingparam[t].optimized=!1,this.tween_list.default.easingparam[t].a=e,this.tween_list.default.easingparam[t].p=i,this.tween_list.default.easingparam[t].t=n,this.tween_list.default.easingparam[t].s=r)},e.ResetEasingParam=function(){void 0!==this.tween_list.default&&(this.tween_list.default.optimized=!0)},e.SetValue=function(t){var e=this.tween_list.default;this.value=t,6===e.tweened&&e.setInitial(this.parseCurrent(e.tweened,"current"))},e.SetParameter=function(t,e,i,n,r){var s;void 0===this.tween_list.default?this.addToTweenList("default",t,e,initial,i,n,r,0):((s=this.tween_list.default).tweened=t,s.easefunc=e,s.setInitial(this.parseCurrent(t,"current")),s.setTarget(this.parseCurrent(t,i)),s.duration=n,s.enforce=1===r)},t.exps={},(t=t.exps).State=function(t){var e="N/A";switch(this.tween_list.default.state){case 0:e="paused";break;case 1:e="playing";break;case 2:e="reversing";break;case 3:e="seeking"}t.set_string(e)},t.Progress=function(t){var e=this.tween_list.default.progress/this.tween_list.default.duration;t.set_float(e)},t.Duration=function(t){t.set_float(this.tween_list.default.duration)},t.Target=function(t){var e=this.tween_list.default,i="N/A";switch(e.tweened){case 0:i=e.targetparam1;break;case 1:i=e.targetparam2;break;case 2:case 3:case 4:i=e.targetparam1;break;case 5:i=e.targetparam2;break;case 6:i=e.targetparam1}t.set_float(i)},t.Value=function(t){var e=this.value;t.set_float(e)},t.Tween=function(t,e,i,n,r){n=1<n?1:n,n=easeFunc(r,n<0?0:n,0,1,1,!1,!1);t.set_float(e+n*(i-e))}}(),function(){var r;function g(t,e){!t&&console&&console.warn&&(console.warn("ASSERTION FAILED: "+e),console.trace&&console.trace())}function f(t,e){return t<e?t+" "+e:e+" "+t}function o(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return t[i]=t[t.length-1],t.length--,0}Object.create=Object.create||function(t){function e(){}return e.prototype=t,new e},"undefined"==typeof exports?(r={},"object"==typeof window&&(window.cp=r)):r=exports;var T,A="object"==typeof window&&-1<window.navigator.userAgent.indexOf("Firefox")?(T=Math.min,Math.max):(T=function(t,e){return t<e?t:e},function(t,e){return e<t?t:e});function d(t,e,i){var n=t[2*e];t[2*e]=t[2*i],t[2*i]=n,n=t[2*e+1],t[2*e+1]=t[2*i+1],t[2*i+1]=n}function l(t,e,i,n,r,s){if(0===i)return 0;for(var o=0,a=e,h=C(r,n),c=s*x(h),l=e,u=e+i-1;l<=u;){var p=new _(t[2*l],t[2*l+1]),p=P(h,C(p,n));c<p?(o<p&&(o=p,a=l),l++):(d(t,l,u),u--)}return a!=e&&d(t,e,a),l-e}r.momentForCircle=function(t,e,i,n){return t*(.5*(e*e+i*i)+E(n))},r.areaForCircle=function(t,e){return Math.PI*Math.abs(t*t-e*e)},r.momentForSegment=function(t,e,i){var n=O(S(e,i),.5);return t*(j(i,e)/12+E(n))},r.areaForSegment=function(t,e,i){return i*(Math.PI*i+2*N(t,e))},r.momentForPoly=function(t,e,i){for(var n=0,r=0,s=e.length,o=0;o<s;o+=2){var a=e[o]+i.x,h=e[o+1]+i.y,c=e[(o+2)%s]+i.x,l=e[(o+3)%s]+i.y,u=I(c,l,a,h);n+=u*(w(a,h,a,h)+w(a,h,c,l)+w(c,l,c,l)),r+=u}return t*n/(6*r)},r.areaForPoly=function(t){for(var e=0,i=0,n=t.length;i<n;i+=2)e+=P(new _(t[i],t[i+1]),new _(t[(i+2)%n],t[(i+3)%n]));return-e/2},r.centroidForPoly=function(t){for(var e=0,i=new _(0,0),n=0,r=t.length;n<r;n+=2){var s=new _(t[n],t[n+1]),o=new _(t[(n+2)%r],t[(n+3)%r]),a=P(s,o);e+=a,i=S(i,O(S(s,o),a))}return O(i,1/(3*e))},r.recenterPoly=function(t){for(var e=r.centroidForPoly(t),i=0;i<t.length;i+=2)t[i]-=e.x,t[i+1]-=e.y},r.momentForBox=function(t,e,i){return t*(e*e+i*i)/12},r.momentForBox2=function(t,e){var i=e.r-e.l,n=e.t-e.b,e=O([e.l+e.r,e.b+e.t],.5);return r.momentForBox(t,i,n)+t*E(e)};var a=r.loopIndexes=function(t){for(var e,i,n=0,r=0,s=e=t[0],o=i=t[1],a=t.length>>1,h=1;h<a;h++){var c=t[2*h],l=t[2*h+1];c<s||c==s&&l<o?(s=c,o=l,n=h):(e<c||c==e&&i<l)&&(e=c,i=l,r=h)}return[n,r]},u=function(t,e,i,n,r,s,o,a){if(n<0)return 0;if(0==n)return e[2*a]=s.x,e[2*a+1]=s.y,1;var h=l(e,i,n,r,s,t),c=new _(e[2*i],e[2*i+1]),r=u(t,e,i+1,h-1,r,c,s,a),c=a+r++;e[2*c]=s.x,e[2*c+1]=s.y;c=l(e,i+h,n-h,s,o,t),n=new _(e[2*(i+h)],e[2*(i+h)+1]);return r+u(t,e,i+h+1,c-1,s,n,o,a+r)};function y(t,e,i){return T(A(t,e),i)}r.convexHull=function(t,e,i){if(e)for(var n=0;n<t.length;n++)e[n]=t[n];else e=t;var r=a(t),s=r[0],o=r[1];if(s==o)return e.length=2,e;d(e,0,s),d(e,1,0==o?s:o);r=new _(e[0],e[1]),s=new _(e[2],e[3]),o=t.length>>1,r=u(i,e,2,o-2,r,s,r,1)+1;return e.length=2*r,g(X(e),"Internal error: cpConvexHull() and cpPolyValidate() did not agree.Please report this error with as much info as you can."),e};var m=function(t){return A(0,T(t,1))},_=r.Vect=function(t,e){this.x=t,this.y=e};r.v=function(t,e){return new _(t,e)};var v=r.vzero=new _(0,0),b=r.v.dot=function(t,e){return t.x*e.x+t.y*e.y},w=function(t,e,i,n){return t*i+e*n},x=r.v.len=function(t){return Math.sqrt(b(t,t))},s=r.v.len2=function(t,e){return Math.sqrt(t*t+e*e)},S=(r.v.eql=function(t,e){return t.x===e.x&&t.y===e.y},r.v.add=function(t,e){return new _(t.x+e.x,t.y+e.y)});_.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this};var C=r.v.sub=function(t,e){return new _(t.x-e.x,t.y-e.y)};_.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this};var k=r.v.neg=function(t){return new _(-t.x,-t.y)};_.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this};var O=r.v.mult=function(t,e){return new _(t.x*e,t.y*e)};_.prototype.mult=function(t){return this.x*=t,this.y*=t,this};var P=r.v.cross=function(t,e){return t.x*e.y-t.y*e.x},I=function(t,e,i,n){return t*n-e*i},c=r.v.perp=function(t){return new _(-t.y,t.x)},i=(r.v.pvrperp=function(t){return new _(t.y,-t.x)},r.v.project=function(t,e){return O(e,b(t,e)/E(e))});_.prototype.project=function(t){return this.mult(b(this,t)/E(t)),this};var h=r.v.rotate=function(t,e){return new _(t.x*e.x-t.y*e.y,t.x*e.y+t.y*e.x)};_.prototype.rotate=function(t){return this.x=this.x*t.x-this.y*t.y,this.y=this.x*t.y+this.y*t.x,this};var e=r.v.unrotate=function(t,e){return new _(t.x*e.x+t.y*e.y,t.y*e.x-t.x*e.y)},E=r.v.lengthsq=function(t){return b(t,t)},R=r.v.lengthsq2=function(t,e){return t*t+e*e},p=r.v.lerp=function(t,e,i){return S(O(t,1-i),O(e,i))},B=r.v.normalize=function(t){return O(t,1/x(t))},L=r.v.normalize_safe=function(t){return 0===t.x&&0===t.y?v:B(t)},M=r.v.clamp=function(t,e){return b(t,t)>e*e?O(B(t),e):t},N=(r.v.lerpconst=function(t,e,i){return S(t,M(C(e,t),i))},r.v.dist=function(t,e){return x(C(t,e))}),j=r.v.distsq=function(t,e){return E(C(t,e))},F=(r.v.near=function(t,e,i){return j(t,e)<i*i},r.v.slerp=function(t,e,i){var n=Math.acos(b(t,e));if(n){var r=1/Math.sin(n);return S(O(t,Math.sin((1-i)*n)*r),O(e,Math.sin(i*n)*r))}return t}),D=(r.v.slerpconst=function(t,e,i){var n=Math.acos(b(t,e));return F(t,e,T(i,n)/n)},r.v.forangle=function(t){return new _(Math.cos(t),Math.sin(t))},r.v.toangle=function(t){return Math.atan2(t.y,t.x)},r.v.str=function(t){return"("+t.x.toFixed(3)+", "+t.y.toFixed(3)+")"},r.BB=function(t,e,i,n){this.l=t,this.b=e,this.r=i,this.t=n,0});function V(t,e){return new D(t.x-e,t.y-e,t.x+e,t.y+e)}r.bb=function(t,e,i,n){return new D(t,e,i,n)};var n=0;r.NO_GROUP=0,r.ALL_LAYERS=-1,r.resetShapeIdCounter=function(){n=0};var W=r.Shape=function(t){this.body=t,this.bb_l=this.bb_b=this.bb_r=this.bb_t=0,this.hashid=n++,this.sensor=!1,this.e=0,this.u=0,this.surface_v=v,this.collision_type=0,this.group=0,this.layers=-1,this.space=null,this.isAdded=!1,this.collisionCode=this.collisionCode};W.prototype.setElasticity=function(t){this.e=t},W.prototype.setFriction=function(t){this.body.activate(),this.u=t},W.prototype.setLayers=function(t){this.body.activate(),this.layers=t},W.prototype.setSensor=function(t){this.body.activate(),this.sensor=t},W.prototype.setCollisionType=function(t){this.body.activate(),this.collision_type=t},W.prototype.getBody=function(){return this.body},W.prototype.active=function(){return this.body&&-1!==this.body.shapeList.indexOf(this)},W.prototype.setBody=function(t){this.active(),this.body=t},W.prototype.cacheBB=function(){return this.update(this.body.p,this.body.rot)},W.prototype.update=function(t,e){isNaN(e.x),isNaN(t.x),this.cacheData(t,e)},W.prototype.pointQuery=function(t){t=this.nearestPointQuery(t);if(t.d<0)return t},W.prototype.getBB=function(){return new D(this.bb_l,this.bb_b,this.bb_r,this.bb_t)};var z=r.NearestPointQueryInfo=function(t,e,i){this.shape=t,this.p=e,this.d=i},U=r.SegmentQueryInfo=function(t,e,i){this.shape=t,this.t=e,this.n=i};U.prototype.hitPoint=function(t,e){return p(t,e,this.t)},U.prototype.hitDist=function(t,e){return N(t,e)*this.t};var t=r.CircleShape=function(t,e,i){this.c=this.tc=i,this.r=e,this.type="circle",W.call(this,t)};function G(t,e,i,n,r,s){n=C(n,e),r=C(r,e);var o=b(n,n)-2*b(n,r)+b(r,r),e=-2*b(n,n)+2*b(n,r);if(0<=(i=e*e-4*o*(b(n,n)-i*i))){o=(-e-Math.sqrt(i))/(2*o);if(0<=o&&o<=1)return new U(t,o,B(p(n,r,o)))}}t.prototype=Object.create(W.prototype),t.prototype.cacheData=function(t,e){e=this.tc=h(this.c,e).add(t),t=this.r;this.bb_l=e.x-t,this.bb_b=e.y-t,this.bb_r=e.x+t,this.bb_t=e.y+t},t.prototype.nearestPointQuery=function(t){var e=t.x-this.tc.x,i=t.y-this.tc.y,n=s(e,i),t=this.r,i=new _(this.tc.x+e*t/n,this.tc.y+i*t/n);return new z(this,i,n-t)},t.prototype.segmentQuery=function(t,e){return G(this,this.tc,this.r,t,e)};var q=r.SegmentShape=function(t,e,i,n){this.a=e,this.b=i,this.n=c(B(C(i,e))),this.ta=this.tb=this.tn=null,this.r=n,this.a_tangent=v,this.b_tangent=v,this.type="segment",W.call(this,t)};q.prototype=Object.create(W.prototype),q.prototype.cacheData=function(t,e){var i,n,r;this.ta=S(t,h(this.a,e)),this.tb=S(t,h(this.b,e)),this.tn=h(this.n,e),n=this.ta.x<this.tb.x?(i=this.ta.x,this.tb.x):(i=this.tb.x,this.ta.x),t=this.ta.y<this.tb.y?(r=this.ta.y,this.tb.y):(r=this.tb.y,this.ta.y);e=this.r;this.bb_l=i-e,this.bb_b=r-e,this.bb_r=n+e,this.bb_t=t+e},q.prototype.nearestPointQuery=function(t){var e=function(t,e,i){e=C(e,i),t=m(b(e,C(t,i))/E(e));return S(i,O(e,t))}(t,this.ta,this.tb),i=t.x-e.x,n=t.y-e.y,r=s(i,n),t=this.r,e=r?S(e,O(new _(i,n),t/r)):e;return new z(this,e,r-t)},q.prototype.segmentQuery=function(t,e){var i=this.tn,n=b(C(this.ta,t),i),r=this.r,s=0<n?k(i):i,o=C(O(s,r),t),a=S(this.ta,o),h=S(this.tb,o),o=C(e,t);if(P(o,a)*P(o,h)<=0){h=n+(0<n?-r:r),n=-h,h=b(o,i)-h;if(n*h<0)return new U(this,n/(n-h),s)}else if(0!==r){r=G(this,this.ta,this.r,t,e),e=G(this,this.tb,this.r,t,e);return!r||e&&e.t<r.t?e:r}},q.prototype.setNeighbors=function(t,e){this.a_tangent=C(t,this.a),this.b_tangent=C(e,this.b)},q.prototype.setEndpoints=function(t,e){this.a=t,this.b=e,this.n=c(B(C(e,t)))};var X=cr.polyValidate=function(t){for(var e=t.length,i=0;i<e;i+=2){var n=t[i],r=t[i+1],s=t[(i+2)%e],o=t[(i+3)%e],a=t[(i+4)%e],h=t[(i+5)%e];if(0<I(s-n,o-r,a-s,h-o))return!1}return!0},H=r.PolyShape=function(t,e,i){this.setVerts(e,i),this.type="poly",W.call(this,t)};function Y(t,e){this.n=t,this.d=e}H.prototype=Object.create(W.prototype),Y.prototype.compare=function(t){return b(this.n,t)-this.d},H.prototype.setVerts=function(t,e){t.length,t[0],X(t);var i=t.length,n=i>>1;this.verts=new Array(i),this.tVerts=new Array(i),this.planes=new Array(n),this.tPlanes=new Array(n);for(var r=0;r<i;r+=2){var s=t[r]+e.x,o=t[r+1]+e.y,a=t[(r+2)%i]+e.x,h=t[(r+3)%i]+e.y,h=B(c(new _(a-s,h-o)));this.verts[r]=s,this.verts[r+1]=o,this.planes[r>>1]=new Y(h,w(h.x,h.y,s,o)),this.tPlanes[r>>1]=new Y(new _(0,0),0)}},r.BoxShape=function(t,e,i){e/=2,i/=2;return J(t,new D(-e,-i,e,i))};var J=r.BoxShape2=function(t,e){e=[e.l,e.b,e.l,e.t,e.r,e.t,e.r,e.b];return new H(t,e,v)};H.prototype.transformVerts=function(t,e){for(var i=this.verts,n=this.tVerts,r=1/0,s=-1/0,o=1/0,a=-1/0,h=0;h<i.length;h+=2){var c=i[h],l=i[h+1],u=t.x+c*e.x-l*e.y,l=t.y+c*e.y+l*e.x;n[h]=u,n[h+1]=l,r=T(r,u),s=A(s,u),o=T(o,l),a=A(a,l)}this.bb_l=r,this.bb_b=o,this.bb_r=s,this.bb_t=a},H.prototype.transformAxes=function(t,e){for(var i=this.planes,n=this.tPlanes,r=0;r<i.length;r++){var s=h(i[r].n,e);n[r].n=s,n[r].d=b(t,s)+i[r].d}},H.prototype.cacheData=function(t,e){this.transformAxes(t,e),this.transformVerts(t,e)},H.prototype.nearestPointQuery=function(t){for(var e=this.tPlanes,i=this.tVerts,n=i[i.length-2],r=i[i.length-1],s=1/0,o=v,a=!1,h=0;h<e.length;h++){0<e[h].compare(t)&&(a=!0);var c=i[2*h],l=i[2*h+1],u=function(t,e,i,n,r,s){i-=r,n-=s,e=m(w(i,n,t-r,e-s)/R(i,n));return new _(r+i*e,s+n*e)}(t.x,t.y,n,r,c,l),p=N(t,u);p<s&&(s=p,o=u),n=c,r=l}return new z(this,o,a?s:-s)},H.prototype.segmentQuery=function(t,e){for(var i=this.tPlanes,n=this.tVerts,r=i.length,s=2*r,o=0;o<r;o++){var a=i[o].n,h=b(t,a);if(!(i[o].d>h)){var c=b(e,a),l=(i[o].d-h)/(c-h);if(!(l<0||1<l)){var u=p(t,e,l),c=-P(a,u),h=-I(a.x,a.y,n[2*o],n[2*o+1]),u=-I(a.x,a.y,n[(2*o+2)%s],n[(2*o+3)%s]);if(h<=c&&c<=u)return new U(this,l,a)}}}},H.prototype.valueOnAxis=function(t,e){for(var i=this.tVerts,n=w(t.x,t.y,i[0],i[1]),r=2;r<i.length;r+=2)n=T(n,w(t.x,t.y,i[r],i[r+1]));return n-e},H.prototype.containsVert=function(t,e){for(var i=this.tPlanes,n=0;n<i.length;n++){var r=i[n].n;if(0<w(r.x,r.y,t,e)-i[n].d)return!1}return!0},H.prototype.containsVertPartial=function(t,e,i){for(var n=this.tPlanes,r=0;r<n.length;r++){var s=n[r].n;if(!(b(s,i)<0))if(0<w(s.x,s.y,t,e)-n[r].d)return!1}return!0},H.prototype.getNumVerts=function(){return this.verts.length/2},H.prototype.getVert=function(t){return new _(this.verts[2*t],this.verts[2*t+1])};var Q,K=r.Body=function(t,e){this.p=new _(0,0),this.vx=this.vy=0,this.f=new _(0,0),this.w=0,this.t=0,this.v_limit=1/0,this.w_limit=1/0,this.v_biasx=this.v_biasy=0,this.w_bias=0,this.space=null,this.isAdded=!1,this.shapeList=[],this.arbiterList=null,this.constraintList=null,this.nodeRoot=null,this.nodeNext=null,this.nodeIdleTime=0,this.setMass(t),this.setMoment(e),this.rot=new _(0,0),this.setAngle(0)};"undefined"!=typeof DEBUG&&DEBUG?(Q=function(t,e){var i;(i=t).x==i.x&&(i.y,i.y),t=t,Math.abs(t.x)!==1/0&&Math.abs(t.y)},K.prototype.sanityCheck=function(){this.m==this.m&&(this.m_inv,this.m_inv),this.i==this.i&&(this.i_inv,this.i_inv),Q(this.p),Q(this.f),this.vx==this.vx&&Math.abs(this.vx),this.vy==this.vy&&Math.abs(this.vy),this.a==this.a&&Math.abs(this.a),this.w==this.w&&Math.abs(this.w),this.t==this.t&&Math.abs(this.t),Q(this.rot),this.v_limit,this.v_limit,this.w_limit,this.w_limit}):K.prototype.sanityCheck=function(){},K.prototype.getPos=function(){return this.p},K.prototype.getAngle=function(){return r.v.toangle(this.rot)},K.prototype.getVel=function(){return new _(this.vx,this.vy)},K.prototype.getAngVel=function(){return this.w},K.prototype.isSleeping=function(){return null!==this.nodeRoot},K.prototype.isStatic=function(){return this.nodeIdleTime===1/0},K.prototype.isRogue=function(){return null===this.space},K.prototype.setMass=function(t){this.activate(),this.m=t,this.m_inv=1/t},K.prototype.setMoment=function(t){this.activate(),this.i=t,this.i_inv=1/t},K.prototype.addShape=function(t){this.shapeList.push(t)},K.prototype.removeShape=function(t){o(this.shapeList,t)};var Z=function(t,e,i){return t===i?t.next(e):(t.a===e?t.next_a=Z(t.next_a,e,i):t.next_b=Z(t.next_b,e,i),t)};K.prototype.removeConstraint=function(t){this.constraintList=Z(this.constraintList,this,t)},K.prototype.setPos=function(t){this.activate(),this.sanityCheck(),t===v&&(t=r.v(0,0)),this.p=t},K.prototype.setVel=function(t){this.activate(),this.vx=t.x,this.vy=t.y},K.prototype.setAngVel=function(t){this.activate(),this.w=t},K.prototype.setAngleInternal=function(t){isNaN(t),this.a=t,this.rot.x=Math.cos(t),this.rot.y=Math.sin(t)},K.prototype.setAngle=function(t){this.activate(),this.sanityCheck(),this.setAngleInternal(t)},K.prototype.velocity_func=function(t,e,i){var n=this.vx*e+(t.x+this.f.x*this.m_inv)*i,r=this.vy*e+(t.y+this.f.y*this.m_inv)*i,s=this.v_limit,t=n*n+r*r,t=s*s<t?s/Math.sqrt(t):1;this.vx=n*t,this.vy=r*t;t=this.w_limit;this.w=y(this.w*e+this.t*this.i_inv*i,-t,t),this.sanityCheck()},K.prototype.position_func=function(t){this.p.x+=(this.vx+this.v_biasx)*t,this.p.y+=(this.vy+this.v_biasy)*t,this.setAngleInternal(this.a+(this.w+this.w_bias)*t),this.v_biasx=this.v_biasy=0,this.w_bias=0,this.sanityCheck()},K.prototype.resetForces=function(){this.activate(),this.f=new _(0,0),this.t=0},K.prototype.applyForce=function(t,e){this.activate(),this.f=S(this.f,t),this.t+=P(e,t)},K.prototype.applyImpulse=function(t,e){this.activate(),Gt(this,t.x,t.y,e)},K.prototype.getVelAtPoint=function(t){return S(new _(this.vx,this.vy),O(c(t),this.w))},K.prototype.getVelAtWorldPoint=function(t){return this.getVelAtPoint(C(t,this.p))},K.prototype.getVelAtLocalPoint=function(t){return this.getVelAtPoint(h(t,this.rot))},K.prototype.eachShape=function(t){for(var e=0,i=this.shapeList.length;e<i;e++)t(this.shapeList[e])},K.prototype.eachConstraint=function(t){for(var e=this.constraintList;e;){var i=e.next(this);t(e),e=i}},K.prototype.eachArbiter=function(t){for(var e=this.arbiterList;e;){var i=e.next(this);e.swappedColl=this===e.body_b,t.call(this,e),e=i}},K.prototype.local2World=function(t){return S(this.p,h(t,this.rot))},K.prototype.world2Local=function(t){return e(C(t,this.p),this.rot)},K.prototype.kineticEnergy=function(){var t=this.vx*this.vx+this.vy*this.vy,e=this.w*this.w;return(t?t*this.m:0)+(e?e*this.i:0)};var $=r.SpatialIndex=function(t){if(this.staticIndex=t){if(t.dynamicIndex)throw new Error("This static index is already associated with a dynamic index.");t.dynamicIndex=this}};$.prototype.collideStatic=function(t,e){var i;0<t.count&&(i=t.query,this.each(function(t){i(t,new D(t.bb_l,t.bb_b,t.bb_r,t.bb_t),e)}))};var tt=r.BBTree=function(t){$.call(this,t),this.velocityFunc=null,this.leaves={},this.count=0,this.root=null,this.pooledNodes=null,this.pooledPairs=null,this.stamp=0};function et(t,e,i){this.obj=null,this.bb_l=T(e.bb_l,i.bb_l),this.bb_b=T(e.bb_b,i.bb_b),this.bb_r=A(e.bb_r,i.bb_r),this.bb_t=A(e.bb_t,i.bb_t),this.parent=null,this.setA(e),this.setB(i)}function it(t,e){this.obj=e,t.getBB(e,this),this.parent=null,this.stamp=1,this.pairs=null}function nt(t,e,i,n){this.prevA=null,this.leafA=t,this.nextA=e,this.prevB=null,this.leafB=i,this.nextB=n}function rt(t,e,i){i&&(i.leafA===e?i.prevA=t:i.prevB=t),t?t.leafA===e?t.nextA=i:t.nextB=i:e.pairs=i}function st(t,e,i){var n=t.pairs,r=e.pairs,i=i.makePair(t,n,e,r);t.pairs=e.pairs=i,n&&(n.leafA===t?n.prevA=i:n.prevB=i),r&&(r.leafA===e?r.prevA=i:r.prevB=i)}function ot(t,e){return(A(t.bb_r,e.bb_r)-T(t.bb_l,e.bb_l))*(A(t.bb_t,e.bb_t)-T(t.bb_b,e.bb_b))}function at(t,e){return Math.abs(t.bb_l+t.bb_r-e.bb_l-e.bb_r)+Math.abs(t.bb_b+t.bb_t-e.bb_b-e.bb_t)}tt.prototype=Object.create($.prototype),tt.prototype.makeNode=function(t,e){var i=this.pooledNodes;return i?(this.pooledNodes=i.parent,i.constructor(this,t,e),i):new et(0,t,e)},tt.prototype.getBB=function(t,e){var i,n,r=this.velocityFunc;r?(i=.1*(t.bb_r-t.bb_l),n=.1*(t.bb_t-t.bb_b),r=O(r(t),.1),e.bb_l=t.bb_l+T(-i,r.x),e.bb_b=t.bb_b+T(-n,r.y),e.bb_r=t.bb_r+A(i,r.x),e.bb_t=t.bb_t+A(n,r.y)):(e.bb_l=t.bb_l,e.bb_b=t.bb_b,e.bb_r=t.bb_r,e.bb_t=t.bb_t)},tt.prototype.getStamp=function(){var t=this.dynamicIndex;return(t&&t.stamp?t:this).stamp},tt.prototype.incrementStamp=function(){this.dynamicIndex&&this.dynamicIndex.stamp?this.dynamicIndex.stamp++:this.stamp++},tt.prototype.makePair=function(t,e,i,n){var r=this.pooledPairs;return r?(this.pooledPairs=r.prevA,r.prevA=null,r.leafA=t,r.nextA=e,r.prevB=null,r.leafB=i,r.nextB=n,r):new nt(t,e,i,n)},nt.prototype.recycle=function(t){this.prevA=t.pooledPairs,t.pooledPairs=this},it.prototype.clearPairs=function(t){var e,i=this.pairs;for(this.pairs=null;i;)i.leafA===this?(e=i.nextA,rt(i.prevB,i.leafB,i.nextB)):(e=i.nextB,rt(i.prevA,i.leafA,i.nextA)),i.recycle(t),i=e},et.prototype.recycle=function(t){this.parent=t.pooledNodes,t.pooledNodes=this},it.prototype.recycle=function(t){},et.prototype.setA=function(t){(this.A=t).parent=this},et.prototype.setB=function(t){(this.B=t).parent=this},et.prototype.isLeaf=!(it.prototype.isLeaf=!0),et.prototype.otherChild=function(t){return this.A==t?this.B:this.A},et.prototype.replaceChild=function(t,e,i){g(t==this.A||t==this.B,"Node is not a child of parent."),this.A==t?(this.A.recycle(i),this.setA(e)):(this.B.recycle(i),this.setB(e));for(var n=this;n;n=n.parent){var r=n.A,s=n.B;n.bb_l=T(r.bb_l,s.bb_l),n.bb_b=T(r.bb_b,s.bb_b),n.bb_r=A(r.bb_r,s.bb_r),n.bb_t=A(r.bb_t,s.bb_t)}},et.prototype.bbArea=it.prototype.bbArea=function(){return(this.bb_r-this.bb_l)*(this.bb_t-this.bb_b)};var ht=function(t,e,i){if(null==t)return e;if(t.isLeaf)return i.makeNode(e,t);var n=t.B.bbArea()+ot(t.A,e),r=t.A.bbArea()+ot(t.B,e);return n===r&&(n=at(t.A,e),r=at(t.B,e)),r<n?t.setB(ht(t.B,e,i)):t.setA(ht(t.A,e,i)),t.bb_l=T(t.bb_l,e.bb_l),t.bb_b=T(t.bb_b,e.bb_b),t.bb_r=A(t.bb_r,e.bb_r),t.bb_t=A(t.bb_t,e.bb_t),t};function ct(t,e,i){var n=1/(i.x-e.x),r=(t.bb_l-e.x)*n,s=(t.bb_r-e.x)*n,n=T(r,s),r=A(r,s),s=1/(i.y-e.y),i=(t.bb_b-e.y)*s,e=(t.bb_t-e.y)*s,s=T(i,e),e=A(i,e);if(s<=r&&n<=e){s=A(n,s);if(0<=T(r,e)&&s<=1)return A(s,0)}return 1/0}et.prototype.intersectsBB=it.prototype.intersectsBB=function(t){return this.bb_l<=t.r&&t.l<=this.bb_r&&this.bb_b<=t.t&&t.b<=this.bb_t};var lt=function(t,e,i){t.intersectsBB(e)&&(t.isLeaf?i(t.obj):(lt(t.A,e,i),lt(t.B,e,i)))},ut=function(t,e,i,n,r){if(t.isLeaf)return r(t.obj);var s=ct(t.A,e,i),o=ct(t.B,e,i);return s<o?(s<n&&(n=T(n,ut(t.A,e,i,n,r))),o<n&&(n=T(n,ut(t.B,e,i,n,r)))):(o<n&&(n=T(n,ut(t.B,e,i,n,r))),s<n&&(n=T(n,ut(t.A,e,i,n,r)))),n};function pt(t,e,i){if(e==t)return null;var n=e.parent;return n!=t?(n.parent.replaceChild(n,n.otherChild(e),i),t):((e=t.otherChild(e)).parent=t.parent,t.recycle(i),e)}function dt(t,e){return t.bb_l<=e.bb_r&&e.bb_l<=t.bb_r&&t.bb_b<=e.bb_t&&e.bb_b<=t.bb_t}function ft(t,e){}function yt(t,e,i,n,r){return(A(t.bb_r,n)-T(t.bb_l,e))*(A(t.bb_t,r)-T(t.bb_b,i))}tt.prototype.subtreeRecycle=function(t){t.isLeaf&&(this.subtreeRecycle(t.A),this.subtreeRecycle(t.B),t.recycle(this))},it.prototype.markLeafQuery=function(t,e,i,n){dt(t,this)&&(e?st(t,this,i):(this.stamp<t.stamp&&st(this,t,i),n&&n(t.obj,this.obj)))},et.prototype.markLeafQuery=function(t,e,i,n){dt(t,this)&&(this.A.markLeafQuery(t,e,i,n),this.B.markLeafQuery(t,e,i,n))},it.prototype.markSubtree=function(t,e,i){if(this.stamp==t.getStamp()){e&&e.markLeafQuery(this,!1,t,i);for(var n=this;n.parent;n=n.parent)n==n.parent.A?n.parent.B.markLeafQuery(this,!0,t,i):n.parent.A.markLeafQuery(this,!1,t,i)}else for(var r=this.pairs;r;)r=this===r.leafB?(i&&i(r.leafA.obj,this.obj),r.nextB):r.nextA},et.prototype.markSubtree=function(t,e,i){this.A.markSubtree(t,e,i),this.B.markSubtree(t,e,i)},it.prototype.containsObj=function(t){return this.bb_l<=t.bb_l&&this.bb_r>=t.bb_r&&this.bb_b<=t.bb_b&&this.bb_t>=t.bb_t},it.prototype.update=function(t){var e=t.root,i=this.obj;return!this.containsObj(i)&&(t.getBB(this.obj,this),e=pt(e,this,t),t.root=ht(e,this,t),this.clearPairs(t),this.stamp=t.getStamp(),!0)},it.prototype.addPairs=function(t){var e,i=t.dynamicIndex;i?(e=i.root)&&e.markLeafQuery(this,!0,i,null):(i=t.staticIndex.root,this.markSubtree(t,i,null))},tt.prototype.insert=function(t,e){t=new it(this,t);this.leaves[e]=t,this.root=ht(this.root,t,this),this.count++,t.stamp=this.getStamp(),t.addPairs(this),this.incrementStamp()},tt.prototype.remove=function(t,e){var i=this.leaves[e];delete this.leaves[e],this.root=pt(this.root,i,this),this.count--,i.clearPairs(this),i.recycle(this)},tt.prototype.contains=function(t,e){return null!=this.leaves[e]},tt.prototype.reindexQuery=function(t){if(this.root){var e,i=this.leaves;for(e in i)i[e].update(this);var n=this.staticIndex,r=n&&n.root;this.root.markSubtree(this,r,t),n&&!r&&this.collideStatic(this,n,t),this.incrementStamp()}},tt.prototype.reindex=function(){this.reindexQuery(ft)},tt.prototype.reindexObject=function(t,e){e=this.leaves[e];e&&(e.update(this)&&e.addPairs(this),this.incrementStamp())},tt.prototype.pointQuery=function(t,e){this.query(new D(t.x,t.y,t.x,t.y),e)},tt.prototype.segmentQuery=function(t,e,i,n){this.root&&ut(this.root,t,e,i,n)},tt.prototype.query=function(t,e){this&&this.root&&this instanceof r.BBTree&&lt(this.root,t,e)},tt.prototype.count=function(){return this.count},tt.prototype.each=function(t){for(var e in this.leaves)t(this.leaves[e].obj)};var gt=function(t,e,i,n){if(1==n)return e[i];if(2==n)return t.makeNode(e[i],e[i+1]);for(var r=(S=e[i]).bb_l,s=S.bb_b,o=S.bb_r,a=S.bb_t,h=i+n,c=i+1;c<h;c++)S=e[c],r=T(r,S.bb_l),s=T(s,S.bb_b),o=A(o,S.bb_r),a=A(a,S.bb_t);var l=a-s<o-r,u=new Array(2*n);if(l)for(c=i;c<h;c++)u[2*c+0]=e[c].bb_l,u[2*c+1]=e[c].bb_r;else for(c=i;c<h;c++)u[2*c+0]=e[c].bb_b,u[2*c+1]=e[c].bb_t;u.sort(function(t,e){return t-e});var p=.5*(u[n-1]+u[n]),d=r,f=s,y=o,g=a,m=r,_=s,v=o,b=a;l?y=m=p:g=_=p;for(var w=h,x=i;x<w;){var S=e[x];yt(S,m,_,v,b)<yt(S,d,f,y,g)?(w--,e[x]=e[w],e[w]=S):x++}if(w!=n)return NodeNew(t,gt(t,e,i,w-i),gt(t,e,w,h-w));for(S=null,c=i;c<h;c++)S=ht(S,e[c],t);return S};tt.prototype.optimize=function(){var t,e=new Array(this.count),i=0;for(t in this.leaves)e[i++]=this.nodes[t];tree.subtreeRecycle(root),this.root=gt(tree,e,e.length)};var mt=function(t,e){!t.isLeaf&&e<=10&&(mt(t.A,e+1),mt(t.B,e+1));for(var i="",n=0;n<e;n++)i+=" ";console.log(i+t.bb_b+" "+t.bb_t)};tt.prototype.log=function(){this.root&&mt(this.root,0)};var _t=r.CollisionHandler=function(){this.a=this.b=0};function vt(t,e){this.e=0,this.u=0,this.surface_vr=v,this.a=t,this.body_a=t.body,this.b=e,this.body_b=e.body,this.thread_a_next=this.thread_a_prev=null,this.thread_b_next=this.thread_b_prev=null,this.contacts=null,this.stamp=0,this.handler=null,this.swappedColl=!1,this.state="first coll"}function bt(t,e,i){this.point=t,this.normal=e,this.dist=i}function wt(t,e,i,n){i?i.body_a===e?i.thread_a_next=n:i.thread_b_next=n:e.arbiterList=n,n&&(n.body_a===e?n.thread_a_prev=i:n.thread_b_prev=i)}function xt(t,e,i,n){this.p=t,this.n=e,this.dist=i,this.r1=this.r2=v,this.nMass=this.tMass=this.bounce=this.bias=0,this.jnAcc=this.jtAcc=this.jBias=0,this.hash=n,0}function St(t,e,i,n){var r=i+n,n=C(e,t),e=E(n);if(!(r*r<=e)){e=Math.sqrt(e);return new xt(S(t,O(n,.5+(i-.5*r)/(e||1/0))),e?O(n,1/e):new _(1,0),e-r,0)}}function Tt(t,e){var i=0,n=t.valueOnAxis(e[0].n,e[0].d);if(0<n)return-1;for(var r=1;r<e.length;r++){var s=t.valueOnAxis(e[r].n,e[r].d);if(0<s)return-1;n<s&&(n=s,i=r)}return Pt=n,i}function At(t,e,i,n){for(var r=[],s=t.tVerts,o=0;o<s.length;o+=2){var a=s[o],h=s[o+1];e.containsVert(a,h)&&r.push(new xt(new _(a,h),i,n,f(t.hashid,o>>1)))}for(var c=e.tVerts,o=0;o<c.length;o+=2){a=c[o],h=c[o+1];t.containsVert(a,h)&&r.push(new xt(new _(a,h),i,n,f(e.hashid,o>>1)))}return r.length?r:function(t,e,i,n){for(var r=[],s=t.tVerts,o=0;o<s.length;o+=2){var a=s[o],h=s[o+1];e.containsVertPartial(a,h,k(i))&&r.push(new xt(new _(a,h),i,n,f(t.hashid,o)))}for(var c=e.tVerts,o=0;o<c.length;o+=2){a=c[o],h=c[o+1];t.containsVertPartial(a,h,i)&&r.push(new xt(new _(a,h),i,n,f(e.hashid,o)))}return r}(t,e,i,n)}function Ct(t,e,i){var n=b(e,t.ta)-t.r,t=b(e,t.tb)-t.r;return T(n,t)-i}function kt(t,e,i,n,r){for(var s=P(e.tn,e.ta),o=P(e.tn,e.tb),a=O(e.tn,r),h=i.tVerts,c=0;c<h.length;c+=2){var l,u=h[c],p=h[c+1];w(u,p,a.x,a.y)<b(e.tn,e.ta)*r+e.r&&((l=I(e.tn.x,e.tn.y,u,p))<=s&&o<=l&&t.push(new xt(new _(u,p),a,n,f(i.hashid,c))))}}_t.prototype.begin=function(t,e){return!0},_t.prototype.preSolve=function(t,e){return!0},_t.prototype.postSolve=function(t,e){},_t.prototype.separate=function(t,e){},vt.prototype.getShapes=function(){return this.swappedColl?[this.b,this.a]:[this.a,this.b]},vt.prototype.totalImpulse=function(){for(var t=this.contacts,e=new _(0,0),i=0,n=t.length;i<n;i++){var r=t[i];e.add(O(r.n,r.jnAcc))}return this.swappedColl?e:e.neg()},vt.prototype.totalImpulseWithFriction=function(){for(var t=this.contacts,e=new _(0,0),i=0,n=t.length;i<n;i++){var r=t[i];e.add(new _(r.jnAcc,r.jtAcc).rotate(r.n))}return this.swappedColl?e:e.neg()},vt.prototype.totalKE=function(){for(var t=(1-this.e)/(1+this.e),e=0,i=this.contacts,n=0,r=i.length;n<r;n++){var s=i[n],o=s.jnAcc,a=s.jtAcc;e+=t*o*o/s.nMass+a*a/s.tMass}return e},vt.prototype.ignore=function(){this.state="ignore"},vt.prototype.getA=function(){return this.swappedColl?this.b:this.a},vt.prototype.getB=function(){return this.swappedColl?this.a:this.b},vt.prototype.isFirstContact=function(){return"first coll"===this.state},vt.prototype.getContactPointSet=function(){for(var t=new Array(this.contacts.length),e=0;e<t.length;e++)t[e]=new bt(this.contacts[e].p,this.contacts[e].n,this.contacts[e].dist);return t},vt.prototype.getNormal=function(t){t=this.contacts[t].n;return this.swappedColl?k(t):t},vt.prototype.getPoint=function(t){return this.contacts[t].p},vt.prototype.getDepth=function(t){return this.contacts[t].dist},vt.prototype.unthread=function(){wt(0,this.body_a,this.thread_a_prev,this.thread_a_next),wt(0,this.body_b,this.thread_b_prev,this.thread_b_next),this.thread_a_prev=this.thread_a_next=null,this.thread_b_prev=this.thread_b_next=null},vt.prototype.update=function(t,e,i,n){if(this.contacts)for(var r=0;r<this.contacts.length;r++)for(var s=this.contacts[r],o=0;o<t.length;o++){var a=t[o];a.hash===s.hash&&(a.jnAcc=s.jnAcc,a.jtAcc=s.jtAcc)}this.contacts=t,this.handler=e,this.swappedColl=i.collision_type!==e.a,this.e=i.e*n.e,this.u=i.u*n.u,this.surface_vr=C(i.surface_v,n.surface_v),this.a=i,this.body_a=i.body,this.b=n,this.body_b=n.body,"cached"==this.state&&(this.state="first coll")},vt.prototype.preStep=function(t,e,i){for(var n=this.body_a,r=this.body_b,s=0;s<this.contacts.length;s++){var o=this.contacts[s];o.r1=C(o.p,n.p),o.r2=C(o.p,r.p),o.nMass=1/Ht(n,r,o.r1,o.r2,o.n),o.tMass=1/Ht(n,r,o.r1,o.r2,c(o.n)),o.bias=-i*T(0,o.dist+e)/t,o.jBias=0,o.bounce=Ut(n,r,o.r1,o.r2,o.n)*this.e}},vt.prototype.applyCachedImpulse=function(t){if(!this.isFirstContact())for(var e=this.body_a,i=this.body_b,n=0;n<this.contacts.length;n++){var r=this.contacts[n],s=r.n.x,o=r.n.y,a=s*r.jnAcc-o*r.jtAcc,o=s*r.jtAcc+o*r.jnAcc;qt(e,i,r.r1,r.r2,a*t,o*t)}},vt.prototype.applyImpulse=function(){0;for(var t=this.body_a,e=this.body_b,i=this.surface_vr,n=this.u,r=0;r<this.contacts.length;r++){0;var s=this.contacts[r],o=s.nMass,a=s.n,h=s.r1,c=s.r2,l=e.vx-c.y*e.w-(t.vx-h.y*t.w),u=e.vy+c.x*e.w-(t.vy+h.x*t.w),p=a.x*(e.v_biasx-c.y*e.w_bias-t.v_biasx+h.y*t.w_bias)+a.y*(c.x*e.w_bias+e.v_biasy-h.x*t.w_bias-t.v_biasy),d=w(l,u,a.x,a.y),l=w(l+i.x,u+i.y,-a.y,a.x),u=(s.bias-p)*o,p=s.jBias;s.jBias=A(p+u,0);u=-(s.bounce+d)*o,d=s.jnAcc;s.jnAcc=A(d+u,0);o=n*s.jnAcc,u=-l*s.tMass,l=s.jtAcc;s.jtAcc=y(l+u,-o,o);o=a.x*(s.jBias-p),p=a.y*(s.jBias-p);Xt(t,-o,-p,h),Xt(e,o,p,c);d=s.jnAcc-d,l=s.jtAcc-l;qt(t,e,h,c,a.x*d-a.y*l,a.x*l+a.y*d)}},vt.prototype.callSeparate=function(t){t.lookupHandler(this.a.collision_type,this.b.collision_type).separate(this,t)},vt.prototype.next=function(t){return this.body_a==t?this.thread_a_next:this.thread_b_next};var Ot=[],Pt=0;t.prototype.collisionCode=0,q.prototype.collisionCode=1,H.prototype.collisionCode=2,t.prototype.collisionTable=[function(t,e){e=St(t.tc,e.tc,t.r,e.r);return e?[e]:Ot},function(t,e){var i=e.ta,n=e.tb,r=t.tc,s=C(n,i),n=m(b(s,C(r,i))/E(s)),s=S(i,O(s,n)),s=St(r,s,t.r,e.r);if(s){t=s.n;return 0===n&&b(t,e.a_tangent)<0||1===n&&b(t,e.b_tangent)<0?Ot:[s]}return Ot},function(t,e){for(var i=e.tPlanes,n=0,r=b(i[0].n,t.tc)-i[0].d-t.r,s=0;s<i.length;s++){var o=b(i[s].n,t.tc)-i[s].d-t.r;if(0<o)return Ot;r<o&&(r=o,n=s)}var a,h=i[n].n,c=e.tVerts,l=c.length,u=n<<1,p=c[u],d=c[1+u],f=c[(2+u)%l],e=c[(3+u)%l],c=I(h.x,h.y,p,d),u=I(h.x,h.y,f,e),l=P(h,t.tc);return l<u?(a=St(t.tc,new _(f,e),t.r,0))?[a]:Ot:l<c?[new xt(C(t.tc,O(h,t.r+r/2)),k(h),r,0)]:(a=St(t.tc,new _(p,d),t.r,0))?[a]:Ot}],q.prototype.collisionTable=[null,function(t,e){return Ot},function(t,e){var i=[],n=e.tPlanes,r=n.length,s=b(t.tn,t.ta),o=e.valueOnAxis(t.tn,s)-t.r,a=e.valueOnAxis(k(t.tn),-s)-t.r;if(0<a||0<o)return Ot;var h=0,c=Ct(t,n[0].n,n[0].d);if(0<c)return Ot;for(var l=0;l<r;l++){var u=Ct(t,n[l].n,n[l].d);if(0<u)return Ot;c<u&&(c=u,h=l)}var p=k(n[h].n),d=S(t.ta,O(p,t.r)),s=S(t.tb,O(p,t.r));if(e.containsVert(d.x,d.y)&&i.push(new xt(d,p,c,f(t.hashid,0))),e.containsVert(s.x,s.y)&&i.push(new xt(s,p,c,f(t.hashid,1))),(c<=o||c<=a)&&(a<o?kt(i,t,e,o,1):kt(i,t,e,a,-1)),0===i.length){p=2*h,o=e.tVerts,a=new _(o[p],o[1+p]);if(e=St(t.ta,a,t.r,0))return[e];if(e=St(t.tb,a,t.r,0))return[e];a=2*r,a=new _(o[(2+p)%a],o[(3+p)%a]);if(e=St(t.ta,a,t.r,0))return[e];if(e=St(t.tb,a,t.r,0))return[e]}return i}],H.prototype.collisionTable=[null,null,function(t,e){var i=Tt(e,t.tPlanes);if(-1==i)return Ot;var n=Pt,r=Tt(t,e.tPlanes);if(-1==r)return Ot;var s=Pt;return s<n?At(t,e,t.tPlanes[i].n,n):At(t,e,k(e.tPlanes[r].n),s)}];var It=r.collideShapes=function(t,e){return t.collisionCode,e.collisionCode,t.collisionTable[e.collisionCode](t,e)},Et=new _t;function Rt(t){t.locked}function Bt(t){return t?t.nodeRoot:null}(q=r.Space=function(){this.stamp=0,this.curr_dt=0,this.bodies=[],this.rousedBodies=[],this.sleepingComponents=[],this.staticShapes=new tt(null),this.activeShapes=new tt(this.staticShapes),this.arbiters=[],this.contactBuffersHead=null,this.cachedArbiters={},this.constraints=[],this.locked=0,this.collisionHandlers={},this.defaultHandler=Et,this.postStepCallbacks=[],this.delayedAddRemove=[],this.iterations=10,this.gravity=v,this.damping=1,this.idleSpeedThreshold=0,this.sleepTimeThreshold=1/0,this.collisionSlop=.1,this.collisionBias=Math.pow(.9,60),this.collisionPersistence=3,this.enableContactGraph=!1,this.staticBody=new K(1/0,1/0),this.staticBody.nodeIdleTime=1/0,this.collideShapes=this.makeCollideShapes()}).prototype.getCurrentTimeStep=function(){return this.curr_dt},q.prototype.setIterations=function(t){this.iterations=t},q.prototype.isLocked=function(){return this.locked},q.prototype.addCollisionHandler=function(t,e,i,n,r,s){Rt(this),this.removeCollisionHandler(t,e);var o=new _t;o.a=t,o.b=e,i&&(o.begin=i),n&&(o.preSolve=n),r&&(o.postSolve=r),s&&(o.separate=s),this.collisionHandlers[f(t,e)]=o},q.prototype.removeCollisionHandler=function(t,e){Rt(this),delete this.collisionHandlers[f(t,e)]},q.prototype.setDefaultCollisionHandler=function(t,e,i,n){Rt(this);var r=new _t;t&&(r.begin=t),e&&(r.preSolve=e),i&&(r.postSolve=i),n&&(r.separate=n),this.defaultHandler=r},q.prototype.lookupHandler=function(t,e){return this.collisionHandlers[f(t,e)]||this.defaultHandler},q.prototype.addShape=function(t){var e=t.body;return e.isStatic()?this.addStaticShape(t):(this.locked?t.isAdded||(t.isAdded=!0,this.delayedAddRemove.push(this.addShape),this.delayedAddRemove.push(t)):(t.isAdded=!0,t.space,Rt(this),e.activate(),e.addShape(t),t.update(e.p,e.rot),this.activeShapes.insert(t,t.hashid),t.space=this),t)},q.prototype.addStaticShape=function(t){if(this.locked)return t.isAdded||(t.isAdded=!0,this.delayedAddRemove.push(this.addStaticShape),this.delayedAddRemove.push(t)),t;t.isAdded=!0,t.space,Rt(this);var e=t.body;return e.addShape(t),t.update(e.p,e.rot),this.staticShapes.insert(t,t.hashid),t.space=this,t},q.prototype.addBody=function(t){return t.isStatic(),this.locked?t.isAdded||(t.isAdded=!0,this.delayedAddRemove.push(this.addBody),this.delayedAddRemove.push(t)):(t.isAdded=!0,t.space,Rt(this),this.bodies.push(t),t.space=this),t},q.prototype.addConstraint=function(t){if(this.locked)return t.isAdded||(t.isAdded=!0,this.delayedAddRemove.push(this.addConstraint),this.delayedAddRemove.push(t)),t;t.isAdded=!0,t.space,Rt(this);var e=t.a,i=t.b;return e.activate(),i.activate(),this.constraints.push(t),t.next_a=e.constraintList,(e.constraintList=t).next_b=i.constraintList,(i.constraintList=t).space=this,t},q.prototype.filterArbiters=function(t,e){for(var i in this.cachedArbiters){var n=this.cachedArbiters[i];(t!==n.body_a||e!==n.a&&null!==e)&&(t!==n.body_b||e!==n.b&&null!==e)||(e&&"cached"!==n.state&&n.callSeparate(this),n.unthread(),o(this.arbiters,n),delete this.cachedArbiters[i])}},q.prototype.removeShape=function(t){var e=t.body;e.isStatic()?this.removeStaticShape(t):this.locked?t.isAdded&&(t.isAdded=!1,this.delayedAddRemove.push(this.removeShape),this.delayedAddRemove.push(t)):(t.isAdded=!1,this.containsShape(t),Rt(this),e.activate(),e.removeShape(t),this.filterArbiters(e,t),this.activeShapes.remove(t,t.hashid),t.space=null)},q.prototype.removeStaticShape=function(t){var e;this.locked?t.isAdded&&(t.isAdded=!1,this.delayedAddRemove.push(this.removeStaticShape),this.delayedAddRemove.push(t)):(t.isAdded=!1,this.containsShape(t),Rt(this),(e=t.body).isStatic()&&e.activateStatic(t),e.removeShape(t),this.filterArbiters(e,t),this.staticShapes.remove(t,t.hashid),t.space=null)},q.prototype.removeBody=function(t){this.locked?t.isAdded&&(t.isAdded=!1,this.delayedAddRemove.push(this.removeBody),this.delayedAddRemove.push(t)):(t.isAdded=!1,this.containsBody(t),Rt(this),t.activate(),o(this.bodies,t),t.space=null)},q.prototype.removeConstraint=function(t){this.locked?t.isAdded&&(t.isAdded=!1,this.delayedAddRemove.push(this.removeConstraint),this.delayedAddRemove.push(t)):(t.isAdded=!1,this.containsConstraint(t),Rt(this),t.a.activate(),t.b.activate(),o(this.constraints,t),t.a.removeConstraint(t),t.b.removeConstraint(t),t.space=null)},q.prototype.containsShape=function(t){return t.space===this},q.prototype.containsBody=function(t){return t.space==this},q.prototype.containsConstraint=function(t){return t.space==this},q.prototype.uncacheArbiter=function(t){delete this.cachedArbiters[f(t.a.hashid,t.b.hashid)],o(this.arbiters,t)},q.prototype.eachBody=function(t,e){this.lock();for(var i=this.bodies,n=0;n<i.length;n++)t.call(e,i[n]);for(var r=this.sleepingComponents,n=0;n<r.length;n++)for(var s=r[n];s;){var o=s.nodeNext;t.call(e,s),s=o}this.unlock(!0)},q.prototype.eachShape=function(t){this.lock(),this.activeShapes.each(t),this.staticShapes.each(t),this.unlock(!0)},q.prototype.eachConstraint=function(t){this.lock();for(var e=this.constraints,i=0;i<e.length;i++)t(e[i]);this.unlock(!0)},q.prototype.reindexStatic=function(){this.locked,this.staticShapes.each(function(t){var e=t.body;t.update(e.p,e.rot)}),this.staticShapes.reindex()},q.prototype.reindexShape=function(t){this.locked;var e=t.body;t.update(e.p,e.rot),this.activeShapes.reindexObject(t,t.hashid),this.staticShapes.reindexObject(t,t.hashid)},q.prototype.reindexShapesForBody=function(t){for(var e=t.shapeList;e;e=e.next)this.reindexShape(e)},q.prototype.useSpatialHash=function(t,e){throw new Error("Spatial Hash not implemented.")},q.prototype.activateBody=function(t){if(t.isRogue(),this.locked)-1===this.rousedBodies.indexOf(t)&&this.rousedBodies.push(t);else{this.bodies.push(t);for(var e=0;e<t.shapeList.length;e++){var i=t.shapeList[e];this.staticShapes.remove(i,i.hashid),this.activeShapes.insert(i,i.hashid)}for(var n,r,s=t.arbiterList;s;s=s.next(t))t!==(o=s.body_a)&&!o.isStatic()||(n=s.a,r=s.b,(this.cachedArbiters[f(n.hashid,r.hashid)]=s).stamp=this.stamp,s.handler=this.lookupHandler(n.collision_type,r.collision_type),this.arbiters.push(s));for(var o,a=t.constraintList;a;a=a.nodeNext)t!==(o=a.a)&&!o.isStatic()||this.constraints.push(a)}},q.prototype.deactivateBody=function(t){t.isRogue(),o(this.bodies,t);for(var e=0;e<t.shapeList.length;e++){var i=t.shapeList[e];this.activeShapes.remove(i,i.hashid),this.staticShapes.insert(i,i.hashid)}for(var n=t.arbiterList;n;n=n.next(t))t!==(r=n.body_a)&&!r.isStatic()||this.uncacheArbiter(n);for(var r,s=t.constraintList;s;s=s.nodeNext)t!==(r=s.a)&&!r.isStatic()||o(this.constraints,s)},K.prototype.activate=function(){this.isRogue()||(this.nodeIdleTime=0,function(t){if(t&&t.isSleeping(t)){t.isRogue();for(var e=t.space,i=t;i;){var n=i.nodeNext;i.nodeIdleTime=0,i.nodeRoot=null,i.nodeNext=null,e.activateBody(i),i=n}o(e.sleepingComponents,t)}}(Bt(this)))},K.prototype.activateStatic=function(t){this.isStatic();for(var e=this.arbiterList;e;e=e.next(this))t&&t!=e.a&&t!=e.b||(e.body_a==this?e.body_b:e.body_a).activate()},K.prototype.pushArbiter=function(t){g(null===(t.body_a===this?t.thread_a_next:t.thread_b_next),"Internal Error: Dangling contact graph pointers detected. (A)"),g(null===(t.body_a===this?t.thread_a_prev:t.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (B)");var e=this.arbiterList;g(null===e||null===(e.body_a===this?e.thread_a_prev:e.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (C)"),t.body_a===this?t.thread_a_next=e:t.thread_b_next=e,e&&(e.body_a===this?e.thread_a_prev=t:e.thread_b_prev=t),this.arbiterList=t};var Lt,Mt=function(t,e){if(!e.isRogue()){var i=Bt(e);if(null==i){s=t,(o=e).nodeRoot=s,o!==s&&(o.nodeNext=s.nodeNext,s.nodeNext=o);for(var n=e.arbiterList;n;n=n.next(e))Mt(t,e==n.body_a?n.body_b:n.body_a);for(var r=e.constraintList;r;r=r.next(e))Mt(t,e==r.a?r.b:r.a)}else g(i===t,"Internal Error: Inconsistency detected in the contact graph.")}var s,o};function Nt(t,e){var i,n,r,s,o,a=Lt;t.bb_l<=e.bb_r&&e.bb_l<=t.bb_r&&t.bb_b<=e.bb_t&&e.bb_b<=t.bb_t&&t.body!==e.body&&(!t.group||t.group!==e.group)&&t.layers&e.layers&&(i=a.lookupHandler(t.collision_type,e.collision_type),(n=t.sensor||e.sensor)&&i===Et||(t.collisionCode>e.collisionCode&&(o=t,t=e,e=o),0!==(r=It(t,e)).length&&(s=f(t.hashid,e.hashid),(o=(o=a.cachedArbiters[s])||(a.cachedArbiters[s]=new vt(t,e))).update(r,i,t,e),"first coll"!=o.state||i.begin(o,a)||o.ignore(),"ignore"!==o.state&&i.preSolve(o,a)&&!n?a.arbiters.push(o):(o.contacts=null,"ignore"!==o.state&&(o.state="normal")),o.stamp=a.stamp)))}function jt(t){var e=t.body;t.update(e.p,e.rot)}function Ft(t,e,i,n){var r=t.vx+-i.y*t.w,i=t.vy+i.x*t.w,t=e.vx+-n.y*e.w,e=e.vy+n.x*e.w;return new _(t-r,e-i)}function Dt(t,e,i){return i=P(e,i),t.m_inv+t.i_inv*i*i}function Vt(t,e,i,n,r,s){var o=u=t.m_inv+e.m_inv,a=0,h=0,c=u,l=t.i_inv,u=i.x*i.x*l,t=i.y*i.y*l,l=-i.x*i.y*l;o+=t,a+=l,h+=l,c+=u,l=e.i_inv,u=n.x*n.x*l,e=n.y*n.y*l,l=-n.x*n.y*l,l=(o+=e)*(c+=u)-(a+=l)*(h+=l),g(0!=l,"Unsolvable constraint."),l=1/l,r.x=c*l,r.y=-a*l,s.x=-h*l,s.y=o*l}function Wt(t,e,i){return new _(b(t,e),b(t,i))}function zt(t,e){return 1-Math.pow(t,e)}q.prototype.processComponents=function(t){for(var e=this.sleepTimeThreshold!==1/0,i=this.bodies,n=0;n<i.length;n++){var r=i[n];g(null===r.nodeNext,"Internal Error: Dangling next pointer detected in contact graph."),g(null===r.nodeRoot,"Internal Error: Dangling root pointer detected in contact graph.")}if(e)for(var s,o=this.idleSpeedThreshold,a=o?o*o:E(this.gravity)*t*t,n=0;n<i.length;n++)(r=i[n]).m!==1/0?(s=a?r.m*a:0,r.nodeIdleTime=r.kineticEnergy()>s?0:r.nodeIdleTime+t):r.nodeIdleTime=1/0;for(var h=this.arbiters,n=0,c=h.length;n<c;n++){var l=h[n],u=l.body_a,p=l.body_b;e&&((p.isRogue()&&!p.isStatic()||u.isSleeping())&&u.activate(),(u.isRogue()&&!u.isStatic()||p.isSleeping())&&p.activate()),u.pushArbiter(l),p.pushArbiter(l)}if(e){for(var d=this.constraints,n=0;n<d.length;n++){var f=d[n],u=f.a;(p=f.b).isRogue()&&!p.isStatic()&&u.activate(),u.isRogue()&&!u.isStatic()&&p.activate()}for(n=0;n<i.length;){r=i[n];if(null!==Bt(r)||(Mt(r,r),function(t,e){for(var i=t;i;i=i.nodeNext)if(i.nodeIdleTime<e)return!0;return!1}(r,this.sleepTimeThreshold)))n++,r.nodeRoot=null,r.nodeNext=null;else{this.sleepingComponents.push(r);for(var y=r;y;y=y.nodeNext)this.deactivateBody(y)}}}},K.prototype.sleep=function(){this.sleepWithGroup(null)},K.prototype.sleepWithGroup=function(t){this.isStatic()||this.isRogue();var e=this.space;if(e.locked,null===t||t.isSleeping(),this.isSleeping())return Bt(this),void Bt(t);for(var i=0;i<this.shapeList.length;i++)this.shapeList[i].update(this.p,this.rot);e.deactivateBody(this),t?(t=Bt(t),this.nodeRoot=t,this.nodeNext=t.nodeNext,this.nodeIdleTime=0,t.nodeNext=this):((this.nodeRoot=this).nodeNext=null,this.nodeIdleTime=0,e.sleepingComponents.push(this)),o(e.bodies,this)},q.prototype.activateShapesTouchingShape=function(t){this.sleepTimeThreshold!==1/0&&this.shapeQuery(t,function(t,e){t.body.activate()})},q.prototype.pointQuery=function(e,i,n,r){function t(t){(!t.group||n!==t.group)&&i&t.layers&&t.pointQuery(e)&&r(t)}var s=new D(e.x,e.y,e.x,e.y);this.lock(),this.activeShapes.query(s,t),this.staticShapes.query(s,t),this.unlock(!0)},q.prototype.pointQueryFirst=function(t,e,i){var n=null;return this.pointQuery(t,e,i,function(t){t.sensor||(n=t)}),n},q.prototype.nearestPointQuery=function(i,n,r,s,o){function t(t){var e;t.group&&s===t.group||!(r&t.layers)||(e=t.nearestPointQuery(i)).d<n&&o(t,e.d,e.p)}var e=V(i,n);this.lock(),this.activeShapes.query(e,t),this.staticShapes.query(e,t),this.unlock(!0)},q.prototype.nearestPointQueryNearest=function(e,i,n,r){function t(t){t.group&&r===t.group||!(n&t.layers)||t.sensor||(t=t.nearestPointQuery(e)).d<i&&(!s||t.d<s.d)&&(s=t)}var s,o=V(e,i);return this.activeShapes.query(o,t),this.staticShapes.query(o,t),s},q.prototype.segmentQuery=function(i,n,r,s,o){function t(t){var e;return(!t.group||s!==t.group)&&r&t.layers&&(e=t.segmentQuery(i,n))&&o(t,e.t,e.n),1}this.lock(),this.staticShapes.segmentQuery(i,n,1,t),this.activeShapes.segmentQuery(i,n,1,t),this.unlock(!0)},q.prototype.segmentQueryFirst=function(i,n,r,s){function t(t){var e;return(!t.group||s!==t.group)&&r&t.layers&&!t.sensor&&(e=t.segmentQuery(i,n))&&(null===o||e.t<o.t)&&(o=e),o?o.t:1}var o=null;return this.staticShapes.segmentQuery(i,n,1,t),this.activeShapes.segmentQuery(i,n,o?o.t:1,t),o},q.prototype.bbQuery=function(o,a,h,c){function t(t){var e,i,n,r,s;(!t.group||h!==t.group)&&a&t.layers&&(e=o,i=t.bb_l,n=t.bb_b,r=t.bb_r,s=t.bb_t,e.l<=r&&i<=e.r&&e.b<=s&&n<=e.t)&&c(t)}this.lock(),this.activeShapes.query(o,t),this.staticShapes.query(o,t),this.unlock(!0)},q.prototype.shapeQuery=function(s,o){var t=s.body;t&&s.update(t.p,t.rot);var e=new D(s.bb_l,s.bb_b,s.bb_r,s.bb_t),a=!1,t=function(t){var e,i=s;if((!i.group||i.group!==t.group)&&i.layers&t.layers&&i!==t){if(i.collisionCode<=t.collisionCode)e=It(i,t);else{e=It(t,i);for(var n=0;n<e.length;n++)e[n].n=k(e[n].n)}if(e.length&&(a=!(i.sensor||t.sensor),o)){for(var r=new Array(e.length),n=0;n<e.length;n++)r[n]=new bt(e[n].p,e[n].n,e[n].dist);o(t,r)}}};return this.lock(),this.activeShapes.query(e,t),this.staticShapes.query(e,t),this.unlock(!0),a},q.prototype.addPostStepCallback=function(t){g(this.locked,"Adding a post-step callback when the space is not locked is unnecessary. Post-step callbacks will not called until the end of the next call to cpSpaceStep() or the next query."),this.postStepCallbacks.push(t)},q.prototype.runPostStepCallbacks=function(){for(var t=0;t<this.postStepCallbacks.length;t++)this.postStepCallbacks[t]();this.postStepCallbacks.length=0},q.prototype.lock=function(){this.locked++},q.prototype.unlock=function(t){if(this.locked--,this.locked,0===this.locked&&t){for(var e=this.rousedBodies,i=0;i<e.length;i++)this.activateBody(e[i]);e.length=0,this.runPostStepCallbacks()}},q.prototype.makeCollideShapes=function(){return Lt=this,Nt},q.prototype.arbiterSetFilter=function(t){var e=this.stamp-t.stamp,i=t.body_a,n=t.body_b;return!(!i.isStatic()&&!i.isSleeping()||!n.isStatic()&&!n.isSleeping())||(1<=e&&"cached"!=t.state&&(t.callSeparate(this),t.state="cached"),!(e>=this.collisionPersistence)||(t.contacts=null,!1))},q.prototype.step=function(t){if(0!==t){0===v.x&&v.y,this.stamp++;var e,i,n=this.curr_dt;this.curr_dt=t;var r=this.bodies,s=this.constraints,o=this.arbiters;for(l=0;l<o.length;l++){var a=o[l];a.state="normal",a.body_a.isSleeping()||a.body_b.isSleeping()||a.unthread()}for(o.length=0,this.lock(),l=0;l<r.length;l++)r[l].position_func(t);for(i in this.activeShapes.each(jt),this.activeShapes.reindexQuery(this.collideShapes),this.unlock(!1),this.processComponents(t),this.lock(),this.cachedArbiters)this.arbiterSetFilter(this.cachedArbiters[i])||delete this.cachedArbiters[i];for(var h=this.collisionSlop,c=1-Math.pow(this.collisionBias,t),l=0;l<o.length;l++)o[l].preStep(t,h,c);for(l=0;l<s.length;l++){var u=s[l];u.preSolve(this),u.preStep(t)}var p=Math.pow(this.damping,t),d=this.gravity;for(l=0;l<r.length;l++)r[l].velocity_func(d,p,t);var f=0===n?0:t/n;for(l=0;l<o.length;l++)o[l].applyCachedImpulse(f);for(l=0;l<s.length;l++)s[l].applyCachedImpulse(f);for(l=0;l<this.iterations;l++){for(e=0;e<o.length;e++)o[e].applyImpulse();for(e=0;e<s.length;e++)s[e].applyImpulse()}for(l=0;l<s.length;l++)s[l].postSolve(this);for(l=0;l<o.length;l++)o[l].handler.postSolve(o[l],this);this.unlock(!0)}};var Ut=function(t,e,i,n,r){var s=t.vx+-i.y*t.w,i=t.vy+i.x*t.w,t=e.vx+-n.y*e.w,e=e.vy+n.x*e.w;return w(t-s,e-i,r.x,r.y)},Gt=function(t,e,i,n){t.vx+=e*t.m_inv,t.vy+=i*t.m_inv,t.w+=t.i_inv*(n.x*i-n.y*e)},qt=function(t,e,i,n,r,s){Gt(t,-r,-s,i),Gt(e,r,s,n)},Xt=function(t,e,i,n){t.v_biasx+=e*t.m_inv,t.v_biasy+=i*t.m_inv,t.w_bias+=t.i_inv*I(n.x,n.y,e,i)},Ht=function(t,e,i,n,r){r=Dt(t,i,r)+Dt(e,n,r);return g(0!==r,"Unsolvable collision or constraint."),r},Yt=r.Constraint=function(t,e){this.a=t,this.b=e,this.space=null,this.isAdded=!1,this.next_a=null,this.next_b=null,this.maxForce=1/0,this.errorBias=Math.pow(.9,60),this.maxBias=1/0};function Jt(t,e){return(t.restLength-e)*t.stiffness}function Qt(t,e){return(e-t.restAngle)*t.stiffness}Yt.prototype.activateBodies=function(){this.a&&this.a.activate(),this.b&&this.b.activate()},Yt.prototype.preStep=function(t){},Yt.prototype.applyCachedImpulse=function(t){},Yt.prototype.applyImpulse=function(){},Yt.prototype.getImpulse=function(){return 0},Yt.prototype.preSolve=function(t){},Yt.prototype.postSolve=function(t){},Yt.prototype.next=function(t){return this.a===t?this.next_a:this.next_b},(q=r.PinJoint=function(t,e,i,n){Yt.call(this,t,e),this.anchr1=i,this.anchr2=n;i=t?S(t.p,h(i,t.rot)):i,n=e?S(e.p,h(n,e.rot)):n;this.dist=x(C(n,i)),g(0<this.dist,"You created a 0 length pin joint. A pivot joint will be much more stable."),this.r1=this.r2=null,this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0}).prototype=Object.create(Yt.prototype),q.prototype.preStep=function(t){var e,i,n=this.a,r=this.b;n.isRogue()&&r.isRogue()||(this.r1=h(this.anchr1,n.rot),this.r2=h(this.anchr2,r.rot),e=C(S(r.p,this.r2),S(n.p,this.r1)),i=x(e),this.n=O(e,1/(i||1/0)),this.nMass=1/Ht(n,r,this.r1,this.r2,this.n),r=this.maxBias,this.bias=y(-zt(this.errorBias,t)*(i-this.dist)/t,-r,r),this.jnMax=this.maxForce*t)},q.prototype.applyCachedImpulse=function(t){t=O(this.n,this.jnAcc*t);qt(this.a,this.b,this.r1,this.r2,t.x,t.y)},q.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.n,n=Ut(t,e,this.r1,this.r2,i),r=(this.bias-n)*this.nMass,n=this.jnAcc;this.jnAcc=y(n+r,-this.jnMax,this.jnMax),r=this.jnAcc-n,qt(t,e,this.r1,this.r2,i.x*r,i.y*r)},q.prototype.getImpulse=function(){return Math.abs(this.jnAcc)},(q=r.SlideJoint=function(t,e,i,n,r,s){Yt.call(this,t,e),this.anchr1=i,this.anchr2=n,this.min=r,this.max=s,this.r1=this.r2=this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0}).prototype=Object.create(Yt.prototype),q.prototype.preStep=function(t){var e,i,n,r=this.a,s=this.b;r.isRogue()&&s.isRogue()||(this.r1=h(this.anchr1,r.rot),this.r2=h(this.anchr2,s.rot),e=C(S(s.p,this.r2),S(r.p,this.r1)),n=0,(i=x(e))>this.max?(n=i-this.max,this.n=L(e)):i<this.min?(n=this.min-i,this.n=k(L(e))):(this.n=v,this.jnAcc=0),this.nMass=1/Ht(r,s,this.r1,this.r2,this.n),s=this.maxBias,this.bias=y(-zt(this.errorBias,t)*n/t,-s,s),this.jnMax=this.maxForce*t)},q.prototype.applyCachedImpulse=function(t){t=this.jnAcc*t;qt(this.a,this.b,this.r1,this.r2,this.n.x*t,this.n.y*t)},q.prototype.applyImpulse=function(){var t,e,i,n,r;0===this.n.x&&0===this.n.y||(t=this.a,e=this.b,i=this.n,n=this.r1,r=this.r2,n=Ft(t,e,n,r),r=b(n,i),n=(this.bias-r)*this.nMass,r=this.jnAcc,this.jnAcc=y(r+n,-this.jnMax,0),n=this.jnAcc-r,qt(t,e,this.r1,this.r2,i.x*n,i.y*n))},q.prototype.getImpulse=function(){return Math.abs(this.jnAcc)},(q=r.PivotJoint=function(t,e,i,n){var r;Yt.call(this,t,e),void 0===n&&(r=i,i=t?t.world2Local(r):r,n=e?e.world2Local(r):r),this.anchr1=i,this.anchr2=n,this.r1=this.r2=v,this.k1=new _(0,0),this.k2=new _(0,0),this.jAcc=v,this.jMaxLen=0,this.bias=v}).prototype=Object.create(Yt.prototype),q.prototype.preStep=function(t){var e=this.a,i=this.b;e.isRogue()&&i.isRogue()||(this.r1=h(this.anchr1,e.rot),this.r2=h(this.anchr2,i.rot),Vt(e,i,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t,e=C(S(i.p,this.r2),S(e.p,this.r1)),this.bias=M(O(e,-zt(this.errorBias,t)/t),this.maxBias))},q.prototype.applyCachedImpulse=function(t){qt(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},q.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.r1,n=this.r2,i=Ft(t,e,i,n),n=Wt(C(this.bias,i),this.k1,this.k2),i=this.jAcc;this.jAcc=M(S(this.jAcc,n),this.jMaxLen),qt(t,e,this.r1,this.r2,this.jAcc.x-i.x,this.jAcc.y-i.y)},q.prototype.getImpulse=function(){return x(this.jAcc)},(q=r.GrooveJoint=function(t,e,i,n,r){Yt.call(this,t,e),this.grv_a=i,this.grv_b=n,this.grv_n=c(B(C(n,i))),this.anchr2=r,this.grv_tn=null,this.clamp=0,this.r1=this.r2=null,this.k1=new _(0,0),this.k2=new _(0,0),this.jAcc=v,this.jMaxLen=0,this.bias=null}).prototype=Object.create(Yt.prototype),q.prototype.preStep=function(t){var e,i,n,r,s,o=this.a,a=this.b;o.isRogue()&&a.isRogue()||(e=o.local2World(this.grv_a),i=o.local2World(this.grv_b),n=h(this.grv_n,o.rot),r=b(e,n),this.grv_tn=n,this.r2=h(this.anchr2,a.rot),(s=P(S(a.p,this.r2),n))<=P(e,n)?(this.clamp=1,this.r1=C(e,o.p)):s>=P(i,n)?(this.clamp=-1,this.r1=C(i,o.p)):(this.clamp=0,this.r1=C(S(O(c(n),-s),O(n,r)),o.p)),Vt(o,a,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t,o=C(S(a.p,this.r2),S(o.p,this.r1)),this.bias=M(O(o,-zt(this.errorBias,t)/t),this.maxBias))},q.prototype.applyCachedImpulse=function(t){qt(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},q.prototype.grooveConstrain=function(t){var e=this.grv_tn,e=0<this.clamp*P(t,e)?t:i(t,e);return M(e,this.jMaxLen)},q.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.r1,n=this.r2,i=Ft(t,e,i,n),n=Wt(C(this.bias,i),this.k1,this.k2),i=this.jAcc;this.jAcc=this.grooveConstrain(S(i,n)),qt(t,e,this.r1,this.r2,this.jAcc.x-i.x,this.jAcc.y-i.y)},q.prototype.getImpulse=function(){return x(this.jAcc)},q.prototype.setGrooveA=function(t){this.grv_a=t,this.grv_n=c(B(C(this.grv_b,t))),this.activateBodies()},q.prototype.setGrooveB=function(t){this.grv_b=t,this.grv_n=c(B(C(t,this.grv_a))),this.activateBodies()},(q=r.DampedSpring=function(t,e,i,n,r,s,o){Yt.call(this,t,e),this.anchr1=i,this.anchr2=n,this.restLength=r,this.stiffness=s,this.damping=o,this.springForceFunc=Jt,this.target_vrn=this.v_coef=0,this.r1=this.r2=null,this.nMass=0,this.n=null}).prototype=Object.create(Yt.prototype),q.prototype.preStep=function(t){var e,i,n=this.a,r=this.b;n.isRogue()&&r.isRogue()||(this.r1=h(this.anchr1,n.rot),this.r2=h(this.anchr2,r.rot),e=C(S(r.p,this.r2),S(n.p,this.r1)),i=x(e),this.n=O(e,1/(i||1/0)),e=Ht(n,r,this.r1,this.r2,this.n),g(0!==e,"Unsolvable this."),this.nMass=1/e,this.target_vrn=0,this.v_coef=1-Math.exp(-this.damping*t*e),i=this.springForceFunc(this,i),qt(n,r,this.r1,this.r2,this.n.x*i*t,this.n.y*i*t))},q.prototype.applyCachedImpulse=function(t){},q.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.n,n=this.r1,r=this.r2,r=Ut(t,e,n,r,i),i=(this.target_vrn-r)*this.v_coef;this.target_vrn=r+i,i*=this.nMass,qt(t,e,this.r1,this.r2,this.n.x*i,this.n.y*i)},q.prototype.getImpulse=function(){return 0},(q=r.DampedRotarySpring=function(t,e,i,n,r){Yt.call(this,t,e),this.restAngle=i,this.stiffness=n,this.damping=r,this.springTorqueFunc=Qt,this.target_wrn=0,this.w_coef=0,this.iSum=0}).prototype=Object.create(Yt.prototype),q.prototype.preStep=function(t){var e,i=this.a,n=this.b;i.isRogue()&&n.isRogue()||(e=i.i_inv+n.i_inv,g(0!==e,"Unsolvable spring."),this.iSum=1/e,this.w_coef=1-Math.exp(-this.damping*t*e),this.target_wrn=0,t=this.springTorqueFunc(this,i.a-n.a)*t,i.w-=t*i.i_inv,n.w+=t*n.i_inv)},q.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=t.w-e.w,n=(this.target_wrn-i)*this.w_coef;this.target_wrn=i+n;n*=this.iSum;t.w+=n*t.i_inv,e.w-=n*e.i_inv},(q=r.RotaryLimitJoint=function(t,e,i,n){Yt.call(this,t,e),this.min=i,this.max=n,this.jAcc=0,this.iSum=this.bias=this.jMax=0}).prototype=Object.create(Yt.prototype),q.prototype.preStep=function(t){var e,i,n=this.a,r=this.b;n.isRogue()&&r.isRogue()||(i=0,(e=r.a-n.a)>this.max?i=this.max-e:e<this.min&&(i=this.min-e),this.iSum=1/(1/n.i+1/r.i),r=this.maxBias,this.bias=y(-zt(this.errorBias,t)*i/t,-r,r),this.jMax=this.maxForce*t,this.bias||(this.jAcc=0))},q.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,t=this.jAcc*t;e.w-=t*e.i_inv,i.w+=t*i.i_inv},q.prototype.applyImpulse=function(){var t,e,i,n;this.bias&&(t=this.a,n=(e=this.b).w-t.w,i=-(this.bias+n)*this.iSum,n=this.jAcc,this.bias<0?this.jAcc=y(n+i,0,this.jMax):this.jAcc=y(n+i,-this.jMax,0),i=this.jAcc-n,t.w-=i*t.i_inv,e.w+=i*e.i_inv)},q.prototype.getImpulse=function(){return Math.abs(joint.jAcc)},(q=r.RatchetJoint=function(t,e,i,n){Yt.call(this,t,e),this.angle=0,this.phase=i,this.ratchet=n,this.angle=(e?e.a:0)-(t?t.a:0),this.iSum=this.bias=this.jAcc=this.jMax=0}).prototype=Object.create(Yt.prototype),q.prototype.preStep=function(t){var e,i,n,r,s,o=this.a,a=this.b;o.isRogue()&&a.isRogue()||(r=this.angle,e=this.phase,i=this.ratchet,(s=0)<(r=r-(n=a.a-o.a))*i?s=r:this.angle=Math.floor((n-e)/i)*i+e,this.iSum=1/(o.i_inv+a.i_inv),a=this.maxBias,this.bias=y(-zt(this.errorBias,t)*s/t,-a,a),this.jMax=this.maxForce*t,this.bias||(this.jAcc=0))},q.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,t=this.jAcc*t;e.w-=t*e.i_inv,i.w+=t*i.i_inv},q.prototype.applyImpulse=function(){var t,e,i,n,r;this.bias&&(t=this.a,r=(e=this.b).w-t.w,i=this.ratchet,n=-(this.bias+r)*this.iSum,r=this.jAcc,this.jAcc=y((r+n)*i,0,this.jMax*Math.abs(i))/i,n=this.jAcc-r,t.w-=n*t.i_inv,e.w+=n*e.i_inv)},q.prototype.getImpulse=function(t){return Math.abs(t.jAcc)},(q=r.GearJoint=function(t,e,i,n){Yt.call(this,t,e),this.phase=i,this.ratio=n,this.ratio_inv=1/n,this.jAcc=0,this.iSum=this.bias=this.jMax=0}).prototype=Object.create(Yt.prototype),q.prototype.preStep=function(t){var e,i=this.a,n=this.b;i.isRogue()&&n.isRogue()||(this.iSum=1/(i.i_inv*this.ratio_inv+this.ratio*n.i_inv),e=this.maxBias,this.bias=y(-zt(this.errorBias,t)*(n.a*this.ratio-i.a-this.phase)/t,-e,e),this.jMax=this.maxForce*t)},q.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,t=this.jAcc*t;e.w-=t*e.i_inv*this.ratio_inv,i.w+=t*i.i_inv},q.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=e.w*this.ratio-t.w,n=(this.bias-i)*this.iSum,i=this.jAcc;this.jAcc=y(i+n,-this.jMax,this.jMax),n=this.jAcc-i,t.w-=n*t.i_inv*this.ratio_inv,e.w+=n*e.i_inv},q.prototype.getImpulse=function(){return Math.abs(this.jAcc)},q.prototype.setRatio=function(t){this.ratio=t,this.ratio_inv=1/t,this.activateBodies()},(q=r.SimpleMotor=function(t,e,i){Yt.call(this,t,e),this.rate=i,this.jAcc=0,this.iSum=this.jMax=0}).prototype=Object.create(Yt.prototype),q.prototype.preStep=function(t){this.iSum=1/(this.a.i_inv+this.b.i_inv),this.jMax=this.maxForce*t},q.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,t=this.jAcc*t;e.w-=t*e.i_inv,i.w+=t*i.i_inv},q.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=-(e.w-t.w+this.rate)*this.iSum,n=this.jAcc;this.jAcc=y(n+i,-this.jMax,this.jMax),i=this.jAcc-n,t.w-=i*t.i_inv,e.w+=i*e.i_inv},q.prototype.getImpulse=function(){return Math.abs(this.jAcc)}}(),cr.behaviors.rojoChipmunkBeta=function(r){this.runtime=r;var t=this.space=new cp.Space;t.addCollisionHandler(0,0,null,function(t,e){var i,n;return t.isFirstContact()&&(i=t.getA().body.c2obj,n=t.getB().body.c2obj,i.Arbiter=t,i.swapped=!1,n.Arbiter=t,n.swapped=!0,r.trigger(cr.behaviors.rojoChipmunkBeta.prototype.cnds.onPreCollide,i.inst),r.trigger(cr.behaviors.rojoChipmunkBeta.prototype.cnds.onPreCollide,n.inst),i.Arbiter=null,n.Arbiter=null),"ignore"!==t.state},function(t,e){var i,n;return t.isFirstContact()&&(i=t.getA().body.c2obj,n=t.getB().body.c2obj,i.Arbiter=t,i.swapped=!1,n.Arbiter=t,n.swapped=!0,r.trigger(cr.behaviors.rojoChipmunkBeta.prototype.cnds.onPostCollide,i.inst),r.trigger(cr.behaviors.rojoChipmunkBeta.prototype.cnds.onPostCollide,n.inst),i.Arbiter=null,n.Arbiter=null),!0},null),t.gravity=cp.v(0,100),t.fixed_step=1/30,t.stepping_mode=0,t.sleepTimeThreshold=1},function(){var t=cr.behaviors.rojoChipmunkBeta.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){this.behavior.lastUpdateTick=-1,this.behavior.rogues=[]},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime,this.space=this.behavior.space};var e=t.Instance.prototype;function r(t){this.runtime.trigger(cr.behaviors.rojoChipmunkBeta.prototype.cnds.onPreStep,t.c2obj.inst)}function h(t){return"string"==typeof t?(t=parseInt(t.slice(),16),isNaN(t)&&(t=-1)):t|=0,t}function i(){}function n(){}function s(){}e.updateTileMap=function(){if(0!==this.col_shape&&2!==this.col_shape&&4!==this.col_shape){var t,e,i,n,r,s,o=this.inst,a=[];for(o.update_bbox(),o.getAllCollisionRects(a),t=0,e=a.length;t<e;++t)if(l=(i=a[t]).rc,i.poly&&3===this.col_shape){i.poly.cp_convexpolys||(s=-2147483648==(s=3758096384&i.id)||1073741824==s||536870912==s||-2147483648&s&&1073741824&s&&536870912&s,i.poly.cp_convexpolys=this.getConvexPolygons(i.poly,s)),n=cp.v(l.left,l.top);for(var h=i.poly.cp_convexpolys,c=0;c<h.length;++c)this.shapes.push(new cp.PolyShape(this.body,h[c],n))}else{n=cp.v(0,0);var l=[l.left,l.top,l.left,l.bottom,l.right,l.bottom,l.right,l.top];this.shapes.push(new cp.PolyShape(this.body,l,n))}for(t=0,e=this.shapes.length;t<e;++t)(r=this.shapes[t]).group=this.col_group,r.layers=this.col_layers,r.setElasticity(this.elasticity),r.setFriction(this.friction),this.enabled&&this.space.addShape(r)}},e.getConvexPolygons=function(t,e){var i=t.pts_cache,n=t.pts_count,r=[];for(r.length=n,a=0;a<n;a++)r[a]=cp.v(i[2*a],i[2*a+1]);e&&r.reverse();for(var s=triangles2convex(triangulate(r)),o=[],a=0;a<s.length;++a){var h=s[a].reverse(),c=[];c.length=2*h.length;for(var l=0;l<h.length;++l)c[2*l]=h[l].x,c[2*l+1]=h[l].y;o.push(c)}return o},e.updateShape=function(){var t=this.shapes;if(this.enabled)for(var e=0,i=t.length;e<i;e++)this.space.removeShape(t[e]);if(t.length=0,this.updateCOM(this.body),this.inst.tilemap_exists)return this.total_poly_area=0,this.updateTileMap(),this.no_rotation=!0,void this.body.setMoment(1/0);var n=this.col_shape;3!=n||this.inst.collision_poly&&!this.inst.collision_poly.is_empty()||(n=1);var r,s=Math.abs(this.inst.width),o=Math.abs(this.inst.height);switch(n){case 0:this.inertia=1;break;case 1:this.inertia=cp.momentForBox(this.mass,s,o),t.push(new cp.BoxShape(this.body,s,o));break;case 2:this.inertia=cp.momentForCircle(this.mass,s/2,0,cp.v(0,0)),t.push(new cp.CircleShape(this.body,o/2,cp.v(0,0)));break;case 3:this.inst.collision_poly.cache_poly(this.inst.width,this.inst.height,0);var a=this.inst.width<0!=this.inst.height<0,h=this.getConvexPolygons(this.inst.collision_poly,a);for(cp.centroidForPoly(this.inst.collision_poly),e=this.total_poly_area=0;e<h.length;++e)(r=new cp.PolyShape(this.body,h[e],this.offset)).area=cp.areaForPoly(h[e]),this.total_poly_area+=r.area,t.push(r);var c,l=0;for(e=0;e<t.length;++e)c=t[e].area/this.total_poly_area,l+=cp.momentForPoly(c*this.mass,h[e],this.offset);this.inertia=l;break;case 4:var u=0;this.edgeRadius<0&&(u=-this.edgeRadius);a=cp.v(-s/2+u,0),u=cp.v(s/2-u,0);this.inertia=cp.momentForSegment(this.mass,a,u),t.push(new cp.SegmentShape(this.body,a,u,Math.abs(this.edgeRadius)))}for(this.inertia<=0&&(this.inertia=1),this.immovable||this.no_rotation?this.body.setMoment(1/0):this.body.setMoment(this.inertia),this.body.isRogue()||this.body.activate(),e=0;e<t.length;++e)(r=t[e]).group=this.col_group,r.layers=this.col_layers,r.setElasticity(this.elasticity),r.setFriction(this.friction),this.enabled&&this.space.addShape(r)},e.onCreate=function(){var t;this.immovable=1==this.properties[0],this.col_shape=this.properties[1],this.col_group=this.properties[2],this.col_layers=parseInt(this.properties[3],16),this.mass=this.properties[4],this.inertia=1,this.elasticity=this.properties[5],this.friction=this.properties[6],this.enabled=0==this.properties[7],this.edgeRadius=this.properties[8],this.no_rotation=1==this.properties[9],this.invalidateShape=!0,this.updateStatic=!1,this.offset=cp.v(0,0),this.last_x=0,this.last_y=0,this.last_angle=0,this.last_hotspotX=0,this.last_hotspotY=0,this.last_width=0,this.last_height=0,this.last_anim=null,this.last_anim_frame=-1,this.queryInfo=null,this.Arbiter=null,this.swapped=!1,this.total_poly_area=0,this.immovable?(t=this.body=new cp.Body(1/0,1/0),this.enabled&&this.behavior.rogues.push(t),t.nodeIdleTime=1/0):(t=this.body=new cp.Body(this.mass,1),this.enabled&&this.space.addBody(t)),t.wasForceApplied=!1,(t.c2obj=this).inst.chipmunkbetabody=t,this.shapes=[]},e.postCreate=function(){this.changeShapeCheck(this.body)},e.onDestroy=function(){if(this.enabled)for(var t=0;t<this.shapes.length;t++)this.space.removeShape(this.shapes[t]);this.shapes.length=0;var e=this;this.body.eachConstraint(function(t){e.space.removeConstraint(t)}),this.body.isRogue()?cr.arrayFindRemove(this.behavior.rogues,this.body):this.space.removeBody(this.body)},e.saveToJSON=function(){return{}},e.loadFromJSON=function(t){},e.recalcOffset=function(t){var e=t.c2obj,t=e.inst;t.update_bbox(),t.tilemap_exists?e.offset=cp.v(0,0):e.offset=cp.v((t.hotspotX-.5)*t.width,(t.hotspotY-.5)*t.height)},e.updateCOM=function(t){var e=t.c2obj,i=e.inst,n=!1;i.update_bbox(),e.last_width===i.width&&e.last_height===i.height||(n=!0,e.invalidateShape=!0,e.last_width=i.width,e.last_height=i.height),!n&&e.last_x===i.x&&e.last_y===i.y&&e.last_angle===i.angle&&e.last_hotspotX===i.hotspotX&&e.last_hotspotY===i.hotspotY||(i.tilemap_exists?t.setPos(cp.v(i.x,i.y)):(e.offset=cp.v((i.hotspotX-.5)*i.width,(i.hotspotY-.5)*i.height),t.setAngle(i.angle),t.setPos(cp.v.sub(cp.v(i.x,i.y),cp.v.rotate(e.offset,t.rot)))),t.isStatic()&&(e.updateStatic=!0,t.activateStatic()),e.last_x=i.x,e.last_y=i.y,e.last_angle=i.angle,e.last_hotspotX=i.hotspotX,e.last_hotspotY=i.hotspotY)},e.updateC2=function(t){var e,i=t.c2obj,n=i.inst;t.wasForceApplied&&(t.resetForces(),t.wasForceApplied=!1),t.isRogue()||(i.updateCOM(t),e=cp.v.add(t.getPos(),cp.v.rotate(i.offset,t.rot)),i.last_x=n.x=e.x,i.last_y=n.y=e.y,i.last_angle=n.angle=t.getAngle(),n.set_bbox_changed())},e.changeShapeCheck=function(t){var e=t.c2obj;if(e.enabled&&((e.invalidateShape||e.inst.tilemap_exists&&e.inst.physics_changed||e.last_width!==e.inst.width||4!==e.col_shape&&e.last_height!==e.inst.height||3===e.col_shape&&(e.last_anim!==e.inst.cur_animation||e.last_anim_frame!==e.inst.cur_frame))&&(e.updateShape(),e.inst.tilemap_exists&&(e.inst.physics_changed=!1),e.last_width=e.inst.width,e.last_height=e.inst.height,e.last_anim=e.inst.cur_animation,e.last_anim_frame=e.inst.cur_frame,e.invalidateShape=!1,e.updateStatic=!1),e.updateStatic)){for(var i=0,n=e.shapes.length;i<n;i++)e.space.reindexShape(e.shapes[i]);e.updateStatic=!1}},e.tick=function(){var t=this.runtime.timescale;if(this.runtime.tickcount>this.behavior.lastUpdateTick&&0<t){this.space.eachBody(r,this),this.behavior.rogues.forEach(this.updateCOM),this.space.eachBody(this.updateCOM),this.behavior.rogues.forEach(this.changeShapeCheck),this.space.bodies.forEach(this.changeShapeCheck),this.space.stepping_mode?this.space.step(this.runtime.getDt(this.inst)):this.space.step(this.space.fixed_step*t);for(var e=this.space.delayedAddRemove,i=0,n=e.length/2;i<n;i++)e[2*i].call(this.space,e[2*i+1]);e.length=0,this.space.eachBody(this.updateC2),this.behavior.rogues.forEach(this.updateC2),this.behavior.lastUpdateTick=this.runtime.tickcount}},e.getJointHelper=function(e){var i=null,n=0;return"string"==typeof e?this.body.eachConstraint(function(t){t.tag===e&&(i=t)}):this.body.eachConstraint(function(t){e==n&&(i=t),n++}),i},i.prototype.isSleeping=function(){return this.body.isSleeping()},i.prototype.isDisabled=function(){return!this.enabled},i.prototype.isImmovable=function(){return this.immovable},i.prototype.isUnrotatable=function(){return this.no_rotation},i.prototype.compareCollisionShape=function(t){return this.col_shape==t},i.prototype.compareSteppingMode=function(t){return this.behavior.space.stepping_mode==t},i.prototype.queryPoint=function(t,e){for(var i,n,r=0;r<this.shapes.length;r++)n=this.shapes[r].nearestPointQuery(cp.v(t,e)),(!i||n.d<i.d)&&(i=n);return!!i&&(this.queryInfo=i,!0)},i.prototype.nearestQueryPoint=function(t,e,i,n,r){var s=this.runtime.getCurrentCondition().type,o=new cp.NearestPointQueryInfo(null,0,0);if(this.behavior.space.nearestPointQuery(cp.v(t,e),i,h(r),n,function(t,e,i){var n=t.body.c2obj.inst;(n.type==s||s.is_family&&-1!=s.members.indexOf(n.type))&&(!o.shape||e<o.d)&&(o.shape=t,o.d=e,o.p=i)}),!o.shape)return!1;r=o.shape.body.c2obj;r.queryInfo=o;n=r.inst,r=s.getCurrentSol();return r.select_all=!0,r.pick_one(n),s.applySolToContainer(),!0},i.prototype.querySegment=function(t,e,i,n){for(var r,s,o=cp.v(t,e),a=cp.v(i,n),h=0;h<this.shapes.length;h++)(s=this.shapes[h].segmentQuery(o,a))&&(!r||s.t<r.t)&&(r=s);return!!r&&(this.queryInfo=r,this.queryInfo.p1=o,this.queryInfo.p2=a,!0)},i.prototype.nearestQuerySegment=function(t,e,i,n,r,s){var o=this.runtime.getCurrentCondition().type,e=cp.v(t,e),n=cp.v(i,n),a=new cp.SegmentQueryInfo(null,0,0);if(this.behavior.space.segmentQuery(e,n,h(s),r,function(t,e,i){var n=t.body.c2obj.inst;(n.type==o||o.is_family&&-1!=o.members.indexOf(n.type))&&(!a.shape||e<a.t)&&(a.shape=t,a.t=e,a.n=i)}),!a.shape)return!1;r=a.shape.body.c2obj;(r.queryInfo=a).p1=e,a.p2=n;n=r.inst,r=o.getCurrentSol();return r.select_all=!0,r.pick_one(n),o.applySolToContainer(),!0},i.prototype.onPreStep=function(){return!0},i.prototype.onPostCollide=function(){return this.updateC2(this.body),!0},i.prototype.onPreCollide=function(){return this.updateC2(this.body),!0},i.prototype.forEachCollisionPair=function(){var n=this.runtime.getCurrentEventStack().current_event;return this.body.eachArbiter(function(t){var e=this.c2obj;e.Arbiter=t,e.swapped=!1;var i=t.swappedColl;t.swappedColl=!1,e.swapped=e.inst.uid==t.getB().body.c2obj.inst.uid,t.swappedColl=i,e.runtime.pushCopySol(n.solModifiers),n.retrigger(),e.runtime.popSol(n.solModifiers),e.Arbiter=null}),!1},t.cnds=new i,e.getVector=function(t,e,i,n){switch(t){case 0:o=cp.v(e,i);break;case 1:e=cr.to_radians(e),o=cp.v(i*Math.cos(e),i*Math.sin(e));break;case 2:o=n.world2Local(cp.v(e,i));break;case 3:if(!n.c2obj){o=cp.v(0,0);break}var r=n.c2obj.inst;r.update_bbox();var s=e,o=r.getImagePoint&&-1!==s?(e=r.getImagePoint(s,!0),i=r.getImagePoint(s,!1),n.world2Local(cp.v(e,i))):cp.v(0,0)}return o},n.prototype.setVelocity=function(t,e,i){this.body.setVel(this.getVector(t,e,i))},n.prototype.setAngularVelocity=function(t){this.body.setAngVel(cr.to_radians(t))},n.prototype.applyForceAt=function(t,e,i,n,r,s){this.body.applyForce(this.getVector(t,e,i),this.getVector(n,r,s)),this.body.wasForceApplied=!0},n.prototype.applyImpulseAt=function(t,e,i,n,r,s){this.body.applyImpulse(this.getVector(t,e,i),this.getVector(n,r,s)),this.body.wasForceApplied=!0},n.prototype.setTorque=function(t){this.body.activate(),this.body.t=cr.to_radians(t),this.body.wasForceApplied=!0},n.prototype.setMaxSpeed=function(t){this.body.v_limit=t},n.prototype.setMaxAngularSpeed=function(t){this.body.w_limit=cr.to_radians(t)},n.prototype.setImmovable=function(t){var e,i;if(0==t&&this.immovable){if(this.immovable=!1,this.enabled){for(this.body.activateStatic(),e=0,i=this.shapes.length;e<i;e++)this.space.removeShape(this.shapes[e]);for(cr.arrayFindRemove(this.behavior.rogues,this.body),this.body.setMass(this.mass),this.no_rotation||this.body.setMoment(this.inertia),this.body.nodeIdleTime=0,this.space.addBody(this.body),e=0,i=this.shapes.length;e<i;e++)this.space.addShape(this.shapes[e])}}else if(1==t&&!this.immovable&&(this.immovable=!0,this.enabled)){for(e=0,i=this.shapes.length;e<i;e++)this.space.removeShape(this.shapes[e]);for(this.space.removeBody(this.body),this.body.setMass(1/0),this.body.setMoment(1/0),this.body.nodeIdleTime=1/0,this.behavior.rogues.push(this.body),this.body.vx=0,this.body.vy=0,e=this.body.w=0,i=this.shapes.length;e<i;e++)this.space.addShape(this.shapes[e])}},n.prototype.setNoRotation=function(t){this.inst.tilemap_exists||(0==t&&this.no_rotation?(this.no_rotation=!1,this.immovable||this.body.setMoment(this.inertia)):1!=t||this.no_rotation||(this.no_rotation=!0,this.body.w=0,this.body.setMoment(1/0)))},n.prototype.setCollisionShape=function(t,e){this.col_shape==t&&4==t&&this.edgeRadius==e||(this.col_shape=t,this.edgeRadius=e,this.invalidateShape=!0)},n.prototype.setCollisionGroup=function(t){this.body.activate(),this.col_group=t;for(var e=0;e<this.shapes.length;e++)this.shapes[e].group=t},n.prototype.setCollisionLayers=function(t){this.body.activate(),t=h(t),this.col_layers=t;for(var e=0;e<this.shapes.length;e++)this.shapes[e].layers=t},n.prototype.setMass=function(t){if(this.mass=t,this.inst.tilemap_exists)this.immovable||this.body.setMass(this.mass);else{var e=this.shapes[0];switch(this.col_shape){case 0:this.inertia=1;break;case 1:this.inertia=cp.momentForPoly(this.mass,e.verts,cp.v(0,0));break;case 2:this.inertia=cp.momentForCircle(this.mass,e.r,0,cp.v(0,0));break;case 3:for(var i,n=0,r=0;r<this.shapes.length;++r)i=shapes[r].area/this.total_poly_area,n+=cp.momentForPoly(i*this.mass,polys[r],this.offset);this.inertia=n;break;case 4:this.inertia=cp.momentForSegment(this.mass,e.a,e.b)}this.inertia<=0&&(this.inertia=1),this.immovable||(this.body.setMass(this.mass),this.no_rotation||this.body.setMoment(this.inertia))}},n.prototype.setFriction=function(t){this.friction=t;for(var e=0;e<this.shapes.length;e++)this.shapes[e].setFriction(t)},n.prototype.setElasticity=function(t){this.elasticity=t;for(var e=0;e<this.shapes.length;e++)this.shapes[e].setElasticity(t)},n.prototype.disablePhysics=function(t){if(!t&&this.enabled){this.enabled=!1,this.immovable?cr.arrayFindRemove(this.behavior.rogues,this.body):this.space.removeBody(this.body);for(var e=0;e<this.shapes.length;e++)this.space.removeShape(this.shapes[e])}else if(t&&!this.enabled){this.enabled=!0,this.immovable?this.behavior.rogues.push(this.body):this.space.addBody(this.body);for(e=0;e<this.shapes.length;e++)this.space.addShape(this.shapes[e])}},n.prototype.setGravity=function(t,e,i){this.space.gravity=this.getVector(t,e,i)},n.prototype.setIterations=function(t){this.space.iterations=t},n.prototype.setDamping=function(t){this.space.damping=t},n.prototype.setSteppingMode=function(t){this.space.stepping_mode=t},n.prototype.setFixedTimestep=function(t){this.space.fixed_step=t},n.prototype.setSleepTimeThreshold=function(t){this.space.sleepTimeThreshold=t},n.prototype.setIdleSpeedThreshold=function(t){this.space.idleSpeedThreshold=t},e.getBody2=function(t,e){var i;if(this.updateCOM(t),-1==e)i=this.space.staticBody;else{e=this.runtime.getObjectByUID(e);if(!e)return null;i=e.chipmunkbetabody,this.updateCOM(i)}return i&&t!=i?i:null},n.prototype.addPinJoint=function(t,e,i,n,r,s,o,a){n=this.getBody2(this.body,n);n&&(i=this.getVector(t,e,i,this.body),o=this.getVector(r,s,o,n),(o=this.space.addConstraint(new cp.PinJoint(this.body,n,i,o))).typeName="pin",o.tag=a)},n.prototype.addPivotJoint=function(t,e,i,n,r,s,o,a){n=this.getBody2(this.body,n);n&&(i=this.getVector(t,e,i,this.body),o=this.getVector(r,s,o,n),(o=this.space.addConstraint(new cp.PivotJoint(this.body,n,i,o))).typeName="pivot",o.tag=a)},n.prototype.addPivotJointAtXY=function(t,e,i,n){t=this.getBody2(this.body,t);t&&((i=this.space.addConstraint(new cp.PivotJoint(this.body,t,cp.v(e,i)))).typeName="pivot",i.tag=n)},n.prototype.addGrooveJoint=function(t,e,i,n,r,s,o,a,h,c,l){o=this.getBody2(this.body,o);o&&(i=this.getVector(t,e,i,this.body),s=this.getVector(n,r,s,this.body),c=this.getVector(a,h,c,o),(c=this.space.addConstraint(new cp.GrooveJoint(this.body,o,i,s,c))).typeName="groove",c.tag=l)},n.prototype.addSlideJoint=function(t,e,i,n,r,s,o,a,h,c){n=this.getBody2(this.body,n);n&&(i=this.getVector(t,e,i,this.body),o=this.getVector(r,s,o,n),(h=this.space.addConstraint(new cp.SlideJoint(this.body,n,i,o,a,h))).typeName="slide",h.tag=c)},n.prototype.addDampedSpring=function(t,e,i,n,r,s,o,a,h,c,l){n=this.getBody2(this.body,n);n&&(i=this.getVector(t,e,i,this.body),o=this.getVector(r,s,o,n),(c=this.space.addConstraint(new cp.DampedSpring(this.body,n,i,o,a,h,c))).typeName="spring",c.tag=l)},n.prototype.addDampedRotarySpring=function(t,e,i,n,r){t=this.getBody2(this.body,t);t&&((n=this.space.addConstraint(new cp.DampedRotarySpring(this.body,t,cr.to_radians(e),i,n))).typeName="rotarySpring",n.tag=r)},n.prototype.addRatchetJoint=function(t,e,i,n){t=this.getBody2(this.body,t);t&&((i=this.space.addConstraint(new cp.RatchetJoint(this.body,t,cr.to_radians(e),cr.to_radians(i)))).typeName="ratchet",i.tag=n)},n.prototype.addGearJoint=function(t,e,i,n){t=this.getBody2(this.body,t);t&&((i=this.space.addConstraint(new cp.GearJoint(this.body,t,cr.to_radians(e),i))).typeName="gear",i.tag=n)},n.prototype.addRotaryLimitJoint=function(t,e,i,n){t=this.getBody2(this.body,t);t&&((i=this.space.addConstraint(new cp.RotaryLimitJoint(this.body,t,cr.to_radians(e),cr.to_radians(i)))).typeName="rotaryLimit",i.tag=n)},n.prototype.addSimpleMotor=function(t,e,i){t=this.getBody2(this.body,t);t&&((e=this.space.addConstraint(new cp.SimpleMotor(this.body,t,cr.to_radians(e)))).typeName="motor",e.tag=i)},n.prototype.destroyConnectedJoints=function(){var e=this;this.body.eachConstraint(function(t){e.space.removeConstraint(t)})},n.prototype.destroyJointAtTag=function(t){t=this.getJointHelper(t);t&&this.space.removeConstraint(t)},n.prototype.setMaxJointForceAtTag=function(t,e){e=this.getJointHelper(e);e&&(e.maxForce=t)},n.prototype.setJointProperty=function(t,e,i){var n=this.getJointHelper(i);if(n)switch(t){case 0:"pin"===n.typeName&&(n.dist=e);break;case 1:"slide"===n.typeName&&(n.min=e);break;case 2:"slide"===n.typeName&&(n.max=e);break;case 3:"spring"===n.typeName?n.restLength=e:"rotarySpring"===n.typeName&&(n.restAngle=cr.to_radians(e));break;case 4:"spring"!==n.typeName&&"rotarySpring"!==n.typeName||(n.stiffness=e);break;case 5:"spring"!==n.typeName&&"rotarySpring"!==n.typeName||(n.damping=e);break;case 6:"rotaryLimit"===n.typeName&&(n.min=cr.to_radians(e));break;case 7:"rotaryLimit"===n.typeName&&(n.max=cr.to_radians(e));break;case 8:"ratchet"===n.typeName&&(n.angle=cr.to_radians(e));break;case 9:"ratchet"===n.typeName&&(n.phase=cr.to_radians(e));break;case 10:"ratchet"===n.typeName&&(n.ratchet=cr.to_radians(e));break;case 11:"gear"===n.typeName&&(n.phase=cr.to_radians(e));break;case 12:"gear"===n.typeName&&(n.ratio=e);break;case 13:"motor"===n.typeName&&(n.rate=cr.to_radians(e))}},n.prototype.sleepWake=function(t){this.body.isRogue()||(t?this.body.activate():this.body.nodeIdleTime=1/0)},n.prototype.ignoreCollision=function(){this.Arbiter&&this.Arbiter.ignore()},t.acts=new n,s.prototype.velocityX=function(t){t.set_float(this.body.vx)},s.prototype.velocityY=function(t){t.set_float(this.body.vy)},s.prototype.speed=function(t){var e=this.body.vx,i=this.body.vy;t.set_float(Math.sqrt(e*e+i*i))},s.prototype.angleOfMotion=function(t){t.set_float(cr.to_degrees(Math.atan2(this.body.vy,this.body.vx)))},s.prototype.angVel=function(t){t.set_float(cr.to_degrees(this.body.getAngVel()))},s.prototype.torque=function(t){t.set_float(cr.to_degrees(this.body.t))},s.prototype.forceX=function(t){t.set_float(this.body.f.x)},s.prototype.forceY=function(t){t.set_float(this.body.f.y)},s.prototype.maxSpeed=function(t){t.set_float(this.body.v_limit)},s.prototype.maxAngSpeed=function(t){t.set_float(cr.to_degrees(this.body.w_limit))},s.prototype.group=function(t){t.set_int(this.col_group)},s.prototype.layers=function(t){t.set_int(this.col_layers)},s.prototype.mass=function(t){this.immovable?t.set_float(1/0):t.set_float(this.body.m)},s.prototype.inertia=function(t){this.immovable||this.no_rotation?t.set_float(1/0):t.set_float(this.body.i)},s.prototype.elasticity=function(t){t.set_float(this.elasticity)},s.prototype.friction=function(t){t.set_float(this.friction)},s.prototype.segmentRadius=function(t){t.set_float(this.edgeRadius)},s.prototype.area=function(t){if(this.inst.tilemap_exists||3===this.col_shape){if(!this.total_poly_area)for(var e=0;e<this.shapes.length;++e)this.total_poly_area+=cp.areaForPoly(this.shapes[e].verts);t.set_float(this.total_poly_area)}else{var i;if(0!=this.shapes.length){var n=this.shapes[0];switch(this.col_shape){case 0:i=0;break;case 1:i=cp.areaForPoly(n.verts);break;case 3:i=this.total_poly_area;break;case 2:i=cp.areaForCircle(n.r,0);break;case 4:i=cp.areaForSegment(n.a,n.b,n.r)}t.set_float(i)}else t.set_float(0)}},s.prototype.CoMx=function(t){t.set_float(this.body.getPos().x)},s.prototype.CoMy=function(t){t.set_float(this.body.getPos().y)},s.prototype.SpaceIterations=function(t){t.set_int(this.space.iterations)},s.prototype.SpaceDamping=function(t){t.set_float(this.space.damping)},s.prototype.SpaceTimestep=function(t){this.space.stepping_mode?t.set_float(this.runtime.getDt(this.inst)):t.set_float(this.space.fixed_step)},s.prototype.sleepTimeThreshold=function(t){t.set_float(this.space.sleepTimeThreshold)},s.prototype.idleSpeedThreshold=function(t){t.set_float(this.space.idleSpeedThreshold)},s.prototype.gravityX=function(t){t.set_float(this.space.gravity.x)},s.prototype.gravityY=function(t){t.set_float(this.space.gravity.y)},s.prototype.queryX=function(t){var e,i;this.queryInfo?(this.queryInfo.p||(e=this.queryInfo.p1,i=this.queryInfo.p2,this.queryInfo.p=this.queryInfo.hitPoint(e,i)),t.set_float(this.queryInfo.p.x)):t.set_float(0)},s.prototype.queryY=function(t){var e,i;this.queryInfo?(this.queryInfo.p||(e=this.queryInfo.p1,i=this.queryInfo.p2,this.queryInfo.p=this.queryInfo.hitPoint(e,i)),t.set_float(this.queryInfo.p.y)):t.set_float(0)},s.prototype.queryDist=function(t){var e,i;this.queryInfo?(this.queryInfo.d||(e=this.queryInfo.p1,i=this.queryInfo.p2,this.queryInfo.d=this.queryInfo.hitDist(e,i)),t.set_float(this.queryInfo.d)):t.set_float(0)},s.prototype.queryT=function(t){this.queryInfo&&this.queryInfo.t?t.set_float(this.queryInfo.t):t.set_float(0)},s.prototype.queryNormX=function(t){this.queryInfo&&this.queryInfo.n?t.set_float(this.queryInfo.n.x):t.set_float(0)},s.prototype.queryNormY=function(t){this.queryInfo&&this.queryInfo.n?t.set_float(this.queryInfo.n.y):t.set_float(0)},s.prototype.jointCount=function(t){var e=0;this.body.eachConstraint(function(t){++e}),t.set_int(e)},s.prototype.jointMaxForce=function(t,e){e=this.getJointHelper(e);e?t.set_float(e.maxForce):t.set_float(0)},s.prototype.jointImpulse=function(t,e){e=this.getJointHelper(e);e?t.set_float(e.getImpulse()):t.set_float(0)},s.prototype.jointOtherUID=function(t,e){e=this.getJointHelper(e);e?null==(e=e.a===this.body?e.b:e.a).c2obj?t.set_int(-1):t.set_int(e.c2obj.inst.uid):t.set_int(-2)},s.prototype.jointType=function(t,e){e=this.getJointHelper(e);e?t.set_string(e.typeName):t.set_string("")},s.prototype.jointAnchorX=function(t,e){e=this.getJointHelper(e);e&&e.anchr2?this.body===e.a&&"groove"!=e.typeName?(this.updateCOM(e.a),t.set_float(e.a.local2World(e.anchr1).x)):(e.b.c2obj&&this.updateCOM(e.b),t.set_float(e.b.local2World(e.anchr2).x)):t.set_float(0)},s.prototype.jointAnchorY=function(t,e){e=this.getJointHelper(e);e&&e.anchr2?this.body===e.a&&"groove"!=e.typeName?(this.updateCOM(e.a),t.set_float(e.a.local2World(e.anchr1).y)):(e.b.c2obj&&this.updateCOM(e.b),t.set_float(e.b.local2World(e.anchr2).y)):t.set_float(0)},s.prototype.jointOtherAnchorX=function(t,e){e=this.getJointHelper(e);e&&e.anchr2?this.body===e.b&&"groove"!=e.typeName?(this.updateCOM(e.a),t.set_float(e.a.local2World(e.anchr1).x)):(e.b.c2obj&&this.updateCOM(e.b),t.set_float(e.b.local2World(e.anchr2).x)):t.set_float(0)},s.prototype.jointOtherAnchorY=function(t,e){e=this.getJointHelper(e);e&&e.anchr2?this.body===e.b&&"groove"!=e.typeName?(this.updateCOM(e.a),t.set_float(e.a.local2World(e.anchr1).y)):(e.b.c2obj&&this.updateCOM(e.b),t.set_float(e.b.local2World(e.anchr2).y)):t.set_float(0)},s.prototype.joint_PinDist=function(t,e){e=this.getJointHelper(e);e&&"pin"==e.typeName?t.set_float(e.dist):t.set_float(0)},s.prototype.joint_SlideMin=function(t,e){e=this.getJointHelper(e);e&&"slide"==e.typeName?t.set_float(e.min):t.set_float(0)},s.prototype.joint_SlideMax=function(t,e){e=this.getJointHelper(e);e&&"slide"==e.typeName?t.set_float(e.max):t.set_float(0)},s.prototype.joint_SpringRest=function(t,e){e=this.getJointHelper(e);e?"spring"==e.typeName?t.set_float(e.restLength):"rotarySpring"==e.typeName&&t.set_float(cr.to_degrees(e.restAngle)):t.set_float(0)},s.prototype.joint_SpringStiff=function(t,e){e=this.getJointHelper(e);!e||"spring"!=e.typeName&&"rotarySpring"!=e.typeName?t.set_float(0):t.set_float(e.stiffness)},s.prototype.joint_SpringDamp=function(t,e){e=this.getJointHelper(e);!e||"spring"!=e.typeName&&"rotarySpring"!=e.typeName?t.set_float(0):t.set_float(e.damping)},s.prototype.joint_RotaryLimitMin=function(t,e){e=this.getJointHelper(e);e&&"rotaryLimit"==e.typeName?t.set_float(cr.to_degrees(e.min)):t.set_float(0)},s.prototype.joint_RotaryLimitMax=function(t,e){e=this.getJointHelper(e);e&&"rotaryLimit"==e.typeName?t.set_float(cr.to_degrees(e.max)):t.set_float(0)},s.prototype.joint_RatchetAngle=function(t,e){e=this.getJointHelper(e);e&&"ratchet"==e.typeName?t.set_float(cr.to_degrees(e.angle)):t.set_float(0)},s.prototype.joint_RatchetPhase=function(t,e){e=this.getJointHelper(e);e&&"ratchet"==e.typeName?t.set_float(cr.to_degrees(e.phase)):t.set_float(0)},s.prototype.joint_RatchetRatchet=function(t,e){e=this.getJointHelper(e);e&&"ratchet"==e.typeName?t.set_float(cr.to_degrees(e.ratchet)):t.set_float(0)},s.prototype.joint_GearPhase=function(t,e){e=this.getJointHelper(e);e&&"gear"==e.typeName?t.set_float(cr.to_degrees(e.phase)):t.set_float(0)},s.prototype.joint_GearRatio=function(t,e){e=this.getJointHelper(e);e&&"gear"==e.typeName?t.set_float(e.ratio):t.set_float(0)},s.prototype.joint_MotorRate=function(t,e){e=this.getJointHelper(e);e&&"motor"==e.typeName?t.set_float(cr.to_degrees(e.rate)):t.set_float(0)},s.prototype.CollisionImpactX=function(t){var e;this.Arbiter?(e=this.Arbiter.swappedColl,this.Arbiter.swappedColl=this.swapped,t.set_float(this.Arbiter.totalImpulseWithFriction().x),this.Arbiter.swappedColl=e):t.set_float(0)},s.prototype.CollisionImpactY=function(t){var e;this.Arbiter?(e=this.Arbiter.swappedColl,this.Arbiter.swappedColl=this.swapped,t.set_float(this.Arbiter.totalImpulseWithFriction().y),this.Arbiter.swappedColl=e):t.set_float(0)},s.prototype.CollisionKE=function(t){this.Arbiter?t.set_float(this.Arbiter.totalKE()):t.set_float(0)},s.prototype.CollisionOtherObj=function(t){var e;this.Arbiter?(e=this.Arbiter.swappedColl,this.Arbiter.swappedColl=this.swapped,t.set_float(this.Arbiter.getB().body.c2obj.inst.uid),this.Arbiter.swappedColl=e):t.set_float(-1)},s.prototype.ContactCount=function(t){this.Arbiter?t.set_float(this.Arbiter.contacts.length):t.set_float(0)},s.prototype.ContactPointX=function(t,e){this.Arbiter&&0<=e&&e<this.Arbiter.contacts.length?t.set_float(this.Arbiter.getPoint(e).x):t.set_float(0)},s.prototype.ContactPointY=function(t,e){this.Arbiter&&0<=e&&e<this.Arbiter.contacts.length?t.set_float(this.Arbiter.getPoint(e).y):t.set_float(0)},s.prototype.ContactNormX=function(t,e){var i;this.Arbiter&&0<=e&&e<this.Arbiter.contacts.length?(i=this.Arbiter.swappedColl,this.Arbiter.swappedColl=this.swapped,t.set_float(this.Arbiter.getNormal(e).x),this.Arbiter.swappedColl=i):t.set_float(0)},s.prototype.ContactNormY=function(t,e){var i;this.Arbiter&&0<=e&&e<this.Arbiter.contacts.length?(i=this.Arbiter.swappedColl,this.Arbiter.swappedColl=this.swapped,t.set_float(this.Arbiter.getNormal(e).y),this.Arbiter.swappedColl=i):t.set_float(0)},s.prototype.ContactDepth=function(t,e){this.Arbiter&&0<=e&&e<this.Arbiter.contacts.length?t.set_float(this.Arbiter.getDepth(e)):t.set_float(0)},s.prototype.world2LocalX=function(t,e,i){t.set_float(this.body.world2Local(cp.v(e,i)).x)},s.prototype.world2LocalY=function(t,e,i){t.set_float(this.body.world2Local(cp.v(e,i)).y)},s.prototype.local2WorldX=function(t,e,i){t.set_float(this.body.local2World(cp.v(e,i)).x)},s.prototype.local2WorldY=function(t,e,i){t.set_float(this.body.local2World(cp.v(e,i)).y)},t.exps=new s}(),cr.getObjectRefTable=function(){return[cr.plugins_.Arr,cr.plugins_.Audio,cr.plugins_.Browser,cr.plugins_.Function,cr.plugins_.Rex_TimeAwayL,cr.plugins_.LocalStorage,cr.plugins_.Sprite,cr.plugins_.Spritefont2,cr.plugins_.Touch,cr.behaviors.lunarray_LiteTween,cr.behaviors.Sin,cr.behaviors.rojoChipmunkBeta,cr.behaviors.Pin,cr.behaviors.Rex_RotateTo,cr.behaviors.DragnDrop,cr.system_object.prototype.cnds.IsGroupActive,cr.system_object.prototype.acts.SetTimescale,cr.system_object.prototype.cnds.OnLayoutStart,cr.plugins_.Sprite.prototype.acts.Destroy,cr.behaviors.rojoChipmunkBeta.prototype.acts.setGravity,cr.plugins_.Sprite.prototype.acts.SetPos,cr.plugins_.Sprite.prototype.exps.X,cr.plugins_.Sprite.prototype.exps.Y,cr.system_object.prototype.cnds.For,cr.system_object.prototype.acts.CreateObject,cr.plugins_.Sprite.prototype.acts.SetSize,cr.system_object.prototype.exps.loopindex,cr.system_object.prototype.cnds.LayerVisible,cr.system_object.prototype.acts.Wait,cr.system_object.prototype.acts.SetVar,cr.system_object.prototype.cnds.CompareVar,cr.system_object.prototype.acts.SetLayerOpacity,cr.system_object.prototype.exps.layeropacity,cr.system_object.prototype.cnds.LayerCmpOpacity,cr.system_object.prototype.acts.SetLayerVisible,cr.plugins_.Touch.prototype.cnds.OnTouchStart,cr.plugins_.Touch.prototype.exps.X,cr.plugins_.Touch.prototype.exps.Y,cr.plugins_.Touch.prototype.cnds.OnTouchEnd,cr.plugins_.Touch.prototype.cnds.IsInTouch,cr.plugins_.Touch.prototype.cnds.IsTouchingObject,cr.plugins_.Sprite.prototype.cnds.IsOnLayer,cr.system_object.prototype.cnds.Compare,cr.system_object.prototype.exps.distance,cr.plugins_.Sprite.prototype.acts.MoveAtAngle,cr.system_object.prototype.exps.angle,cr.system_object.prototype.cnds.Else,cr.plugins_.Function.prototype.cnds.OnFunction,cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,cr.plugins_.Sprite.prototype.acts.SetPosToObject,cr.plugins_.Sprite.prototype.cnds.PickByUID,cr.plugins_.Sprite.prototype.acts.SetVisible,cr.plugins_.Sprite.prototype.acts.SetTowardPosition,cr.plugins_.Sprite.prototype.exps.ImagePointX,cr.plugins_.Sprite.prototype.exps.ImagePointY,cr.system_object.prototype.exps.cos,cr.plugins_.Sprite.prototype.exps.Angle,cr.system_object.prototype.exps.sin,cr.plugins_.Sprite.prototype.acts.SetInstanceVar,cr.plugins_.Sprite.prototype.acts.MoveToTop,cr.plugins_.Sprite.prototype.acts.SetAngle,cr.system_object.prototype.exps.max,cr.plugins_.Sprite.prototype.acts.SetOpacity,cr.plugins_.Sprite.prototype.acts.SetHeight,cr.system_object.prototype.exps.min,cr.plugins_.Function.prototype.acts.CallFunction,cr.system_object.prototype.cnds.ForEach,cr.system_object.prototype.acts.AddVar,cr.plugins_.Sprite.prototype.cnds.CompareX,cr.system_object.prototype.exps.layoutwidth,cr.behaviors.rojoChipmunkBeta.prototype.cnds.isDisabled,cr.behaviors.rojoChipmunkBeta.prototype.acts.disablePhysics,cr.behaviors.rojoChipmunkBeta.prototype.acts.setVelocity,cr.behaviors.lunarray_LiteTween.prototype.acts.SetDuration,cr.behaviors.lunarray_LiteTween.prototype.acts.SetTarget,cr.behaviors.lunarray_LiteTween.prototype.acts.Start,cr.plugins_.Sprite.prototype.cnds.OnCreated,cr.system_object.prototype.exps.int,cr.system_object.prototype.exps.random,cr.behaviors.rojoChipmunkBeta.prototype.cnds.isSleeping,cr.behaviors.rojoChipmunkBeta.prototype.cnds.onPostCollide,cr.plugins_.Sprite.prototype.cnds.IsOverlapping,cr.plugins_.Sprite.prototype.cnds.OnCollision,cr.plugins_.Sprite.prototype.cnds.PickDistance,cr.plugins_.Sprite.prototype.exps.UID,cr.plugins_.Sprite.prototype.acts.SetAnimFrame,cr.plugins_.Function.prototype.exps.Param,cr.behaviors.Pin.prototype.acts.Pin,cr.plugins_.Sprite.prototype.exps.Width,cr.plugins_.Sprite.prototype.exps.Height,cr.plugins_.Function.prototype.cnds.CompareParam,cr.plugins_.Sprite.prototype.exps.Count,cr.behaviors.lunarray_LiteTween.prototype.acts.SetEasing,cr.plugins_.Browser.prototype.acts.Vibrate,cr.system_object.prototype.exps.tokenat,cr.system_object.prototype.cnds.EveryTick,cr.plugins_.Sprite.prototype.cnds.CompareY,cr.system_object.prototype.exps.choose,cr.plugins_.Sprite.prototype.cnds.PickInstVarHiLow,cr.plugins_.Sprite.prototype.acts.SetMirrored,cr.plugins_.Sprite.prototype.cnds.CompareFrame,cr.behaviors.Sin.prototype.acts.SetMovement,cr.behaviors.Sin.prototype.acts.SetActive,cr.behaviors.Sin.prototype.acts.SetMagnitude,cr.behaviors.Rex_RotateTo.prototype.acts.SetTargetAngle,cr.plugins_.Sprite.prototype.cnds.IsOnScreen,cr.system_object.prototype.exps.layoutheight,cr.system_object.prototype.acts.ScrollToObject,cr.system_object.prototype.exps.lerp,cr.system_object.prototype.cnds.Every,cr.plugins_.Sprite.prototype.cnds.OnDestroyed,cr.plugins_.Arr.prototype.acts.JSONLoad,cr.plugins_.Arr.prototype.exps.Height,cr.plugins_.Spritefont2.prototype.acts.SetCharacterWidth,cr.plugins_.Arr.prototype.exps.At,cr.plugins_.Spritefont2.prototype.acts.SetText,cr.plugins_.Spritefont2.prototype.acts.Destroy,cr.plugins_.Spritefont2.prototype.cnds.OnCreated,cr.system_object.prototype.exps.str,cr.plugins_.Spritefont2.prototype.acts.SetOpacity,cr.plugins_.Spritefont2.prototype.exps.X,cr.plugins_.Spritefont2.prototype.exps.Y,cr.behaviors.lunarray_LiteTween.prototype.acts.Reverse,cr.plugins_.LocalStorage.prototype.acts.SetItem,cr.plugins_.LocalStorage.prototype.acts.CheckItemExists,cr.plugins_.LocalStorage.prototype.cnds.OnItemExists,cr.plugins_.LocalStorage.prototype.acts.GetItem,cr.plugins_.LocalStorage.prototype.cnds.OnItemGet,cr.plugins_.LocalStorage.prototype.exps.ItemValue,cr.plugins_.LocalStorage.prototype.cnds.OnItemMissing,cr.plugins_.LocalStorage.prototype.cnds.OnItemRemoved,cr.system_object.prototype.acts.ResetGlobals,cr.system_object.prototype.acts.RestartLayout,cr.plugins_.Browser.prototype.acts.GoToURL,cr.plugins_.Sprite.prototype.cnds.IsVisible,cr.system_object.prototype.cnds.TriggerOnce,cr.plugins_.Sprite.prototype.acts.MoveToBottom,cr.plugins_.Spritefont2.prototype.acts.MoveToTop,cr.plugins_.Spritefont2.prototype.acts.MoveToLayer,cr.behaviors.Pin.prototype.acts.Unpin,cr.plugins_.Sprite.prototype.cnds.IsAnimPlaying,cr.plugins_.Sprite.prototype.acts.SetAnim,cr.system_object.prototype.exps.find,cr.system_object.prototype.exps.replace,cr.system_object.prototype.acts.SubVar,cr.plugins_.Sprite.prototype.acts.SetY,cr.system_object.prototype.acts.SetLayerBackground,cr.system_object.prototype.exps.rgb,cr.plugins_.Spritefont2.prototype.acts.SetEffectParam,cr.plugins_.Sprite.prototype.acts.SetEffectParam,cr.system_object.prototype.exps.zeropad,cr.plugins_.Spritefont2.prototype.acts.SetScale,cr.plugins_.Rex_TimeAwayL.prototype.acts.GetTimer,cr.plugins_.Spritefont2.prototype.acts.SetVisible,cr.plugins_.Rex_TimeAwayL.prototype.cnds.OnGetTimer,cr.plugins_.Rex_TimeAwayL.prototype.cnds.IsValid,cr.plugins_.Rex_TimeAwayL.prototype.acts.StartTimer,cr.system_object.prototype.exps.floor,cr.plugins_.Rex_TimeAwayL.prototype.exps.ElapsedTime,cr.plugins_.Sprite.prototype.cnds.CompareHeight,cr.plugins_.Audio.prototype.cnds.IsTagPlaying,cr.plugins_.Audio.prototype.acts.PlayByName,cr.plugins_.Audio.prototype.acts.Play,cr.plugins_.Audio.prototype.acts.StopAll]};
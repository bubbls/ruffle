"use strict";!function(f){var g;(e=g=f.EventType||(f.EventType={}))[e.CUSTOM=0]="CUSTOM",e[e.CREATE_SCENE=1]="CREATE_SCENE",e[e.INIT_SCENE=2]="INIT_SCENE",e[e.RESET_SCENE=3]="RESET_SCENE",e[e.VIEW_UPDATE=4]="VIEW_UPDATE",e[e.STEP_UPDATE=5]="STEP_UPDATE",e[e.TIME_UPDATE=6]="TIME_UPDATE",e[e.CLEAR_SCENE=7]="CLEAR_SCENE",e[e.DESTROY=8]="DESTROY",e[e.SURVIVE=9]="SURVIVE";var n=function(e){this.name="",this.receptors=new Array,this.name=e},a=function(e,t){this.chainable=e,this.action=t},e=(p.triggerEvents=function(e){for(var t=0,n=p.listenerGroups[e];t<n.length;t++)for(var i=0,r=n[t].receptors;i<r.length;i++){var o=r[i];o.action(o.chainable)}},p.triggerCustomEvent=function(e){for(var t=0,n=p.listenerGroups[g.CUSTOM];t<n.length;t++){var i=n[t];if(i.name==e){for(var r=0,o=i.receptors;r<o.length;r++){var s=o[r];s.action(s.chainable)}return}}console.log("error")},p.getDestroyReceptors=function(){for(var e=[],t=0,n=p.listenerGroups[g.DESTROY];t<n.length;t++)for(var i=0,r=n[t].receptors;i<r.length;i++){for(var o=r[i],s=o.chainable;null!=s.owner;)s=s.owner;null!=s.preserved&&s.preserved||e.push(o)}return e},p.onViewChanged=function(){p.triggerEvents(g.VIEW_UPDATE)},p.onStepUpdate=function(){if(null!=p.nextSceneClass){if(p.needReset=!0,null!=p.currentScene){p.triggerEvents(g.CLEAR_SCENE);for(var e=p.getDestroyReceptors(),t=0,n=p.listenerGroups;t<n.length;t++)for(var i=0,r=n[t];i<r.length;i++){for(var o=r[i],s=[],a=0,l=o.receptors;a<l.length;a++){for(var u=(d=l[a]).chainable;null!=u.owner;)u=u.owner;null!=u.preserved&&u.preserved&&s.push(d)}o.receptors=s}for(var d,c=0,h=e;c<h.length;c++)(d=h[c]).action(d.chainable);f.Texture.recycleAll(),f.AudioPlayer.recycleAll(),p.triggerEvents(g.SURVIVE)}p.currentSceneClass=p.nextSceneClass,p.nextSceneClass=null,p.canCreateScene=!0,p.currentScene=new p.currentSceneClass,p.triggerEvents(g.CREATE_SCENE),p.addListenersFrom(p.currentScene),p.canCreateScene=!1,p.creatingScene=!1,p.triggerEvents(g.INIT_SCENE)}p.needReset&&(p.needReset=!1,p.triggerEvents(g.RESET_SCENE)),p.triggerEvents(g.STEP_UPDATE)},p.onTimeUpdate=function(){f.AudioManager.checkSuspended(),p.triggerEvents(g.TIME_UPDATE)},p.requireReset=function(){p.needReset=!0},p.update=function(){if(0==p.pauseCount){for(f.Renderer.clear();p.STEP_DELTA_TIME<=p.stepTimeCount;)p.stepExtrapolation=1,p.inputInStepUpdate&&(f.Keyboard.update(),f.Mouse.update(),f.TouchInput.update()),p.onStepUpdate(),f.Renderer.updateHandCursor(),p.stepTimeCount-=p.STEP_DELTA_TIME;p.stepExtrapolation=p.stepTimeCount/p.STEP_DELTA_TIME,f.Renderer.xSizeWindow==window.innerWidth&&f.Renderer.ySizeWindow==window.innerHeight||(f.Renderer.fixCanvasSize(),p.triggerEvents(g.VIEW_UPDATE)),p.inputInStepUpdate||(f.Keyboard.update(),f.Mouse.update(),f.TouchInput.update()),p.onTimeUpdate(),f.Renderer.update();var e=Date.now()/1e3;p.MAX_DELTA_TIME<(p.deltaTime=e-p.oldTime)?p.deltaTime=p.MAX_DELTA_TIME:p.deltaTime<0&&(p.deltaTime=0),p.stepTimeCount+=p.deltaTime,p.oldTime=e}window.requestAnimationFrame(p.update)},p.pause=function(){1==(p.pauseCount+=1)&&f.AudioManager.pause()},p.resume=function(){0<p.pauseCount?0==--p.pauseCount&&(f.AudioManager.resume(),p.oldTime=Date.now()-p.STEP_DELTA_TIME):console.log("error")},p.start=function(){f.Renderer.inited&&f.AudioManager.inited?(p.canCreateEvents=!0,p.onInit(),p.canCreateEvents=!1,p.started=!0,window.requestAnimationFrame(p.update)):setTimeout(p.start,1/60)},p.run=function(){p.onRun(),p.inited?console.log("ERROR"):(p.inited=!0,f.Renderer.init(),f.AudioManager.init(),setTimeout(p.start,1/60))},p.MAX_DELTA_TIME=4*(p.STEP_DELTA_TIME=1/60),p.PI_OVER_180=Math.PI/180,p.inited=!1,p.started=!1,p.stepTimeCount=0,p.stepExtrapolation=0,p.oldTime=0,p.deltaTime=0,p.pauseCount=0,p.listenerGroups=[[],[],[],[],[],[],[],[],[],[]],p.canCreateEvents=!1,p.canCreateScene=!1,p.creatingScene=!1,p.needReset=!1,p.inputInStepUpdate=!0,p.createEvent=function(e,t){p.canCreateEvents?p.listenerGroups[e].push(new n(t)):console.log("error")},p.addListenersFrom=function(e){p.creatingScene||console.log("error");for(var t=0,n=p.listenerGroups;t<n.length;t++)for(var i=0,r=n[t];i<r.length;i++){var o=r[i];if(null!=e.constructor)for(var s in e.constructor)s==o.name&&o.receptors.push(new a(e,e.constructor[s]));for(s in e)s==o.name&&o.receptors.push(new a(e,e[s].bind(e)))}},p.onRun=function(){},p);function p(){}f.System=e,window.requestAnimationFrame||(window.requestAnimationFrame=function(){window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}),window.onclick=function(e){f.AudioManager.verify(),f.LinkManager.triggerMouse(e)},window.ontouchstart=function(e){f.AudioManager.verify(),f.LinkManager.triggerTouch(e)}}(Engine=Engine||{}),function(o){var e=(Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(e){o.AudioManager.mode==o.AudioManagerMode.WEB?(this._volume=e,this.volumeGain.gain.value=e):o.AudioManager.mode==o.AudioManagerMode.HTML&&(this._volume=e,this.htmlAudio.volume=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"muted",{get:function(){return this._muted},set:function(e){o.AudioManager.mode==o.AudioManagerMode.WEB?(this._muted=e,this.muteGain.gain.value=this._muted||o.AudioManager._muted||0<o.System.pauseCount?0:1):o.AudioManager.mode==o.AudioManagerMode.HTML&&(this._muted=e,this.htmlAudio.muted=this._muted||o.AudioManager._muted||0<o.System.pauseCount)},enumerable:!1,configurable:!0}),t.recycleAll=function(){for(var e=new Array,t=0,n=o.AudioManager.players;t<n.length;t++){for(var i=n[t],r=i;null!=r.owner;)r=r.owner;r.preserved?e.push(i):i.destroy()}o.AudioManager.players=e},t.prototype.pause=function(){o.AudioManager.mode==o.AudioManagerMode.WEB||o.AudioManager.mode==o.AudioManagerMode.HTML&&this.played&&(this.lockTime=this.htmlAudio.currentTime,this.muted=this._muted)},t.prototype.resume=function(){o.AudioManager.mode==o.AudioManagerMode.WEB||o.AudioManager.mode==o.AudioManagerMode.HTML&&this.played&&(this.htmlAudio.currentTime=this.lockTime,this.lockTime=-1,this.muted=this._muted)},t.prototype.destroy=function(){this.muted=!0,this.stop()},t.prototype.play=function(e){if(void 0===e&&(e=1),o.AudioManager.mode==o.AudioManagerMode.WEB)this.autoplay(e);else if(o.AudioManager.mode==o.AudioManagerMode.HTML){this.played=!0;try{this.htmlAudio.currentTime=0}catch(e){}this.htmlAudio.playbackRate=e,this.htmlAudio.play()}},t.prototype.autoplay=function(e){void 0===e&&(e=1),o.AudioManager.mode==o.AudioManagerMode.WEB?(this.played&&this.source.stop(),this.played=!0,this.source=o.AudioManager.context.createBufferSource(),this.source.buffer=this.buffer,this.source.loop=0<this.loopEnd,this.source.playbackRate.value=e,this.source.loop&&(this.source.loopStart=this.loopStart,this.source.loopEnd=this.loopEnd),this.source.connect(this.muteGain),this.source[this.source.start?"start":"noteOn"](0,(this.source.loop,0))):o.AudioManager.mode==o.AudioManagerMode.HTML&&this.play()},t.prototype.stop=function(){o.AudioManager.mode==o.AudioManagerMode.WEB?this.played&&this.source.stop():o.AudioManager.mode==o.AudioManagerMode.HTML&&this.played&&(this.htmlAudio.currentTime=0,this.htmlAudio.pause())},t);function t(e){var t;this.loopStart=0,this.loopEnd=0,this.restoreVolume=1,this._volume=1,this._muted=!1,o.System.canCreateScene||console.log("error"),o.AudioManager.players.push(this),this.path=e,o.AudioManager.mode==o.AudioManagerMode.WEB?(this.buffer=o.Assets.loadAudio(e),this.volumeGain=o.AudioManager.context.createGain(),this.volumeGain.connect(o.AudioManager.context.destination),this.muteGain=o.AudioManager.context.createGain(),this.muteGain.connect(this.volumeGain)):o.AudioManager.mode==o.AudioManagerMode.HTML&&(this.path=e,this.lockTime=-1,this.htmlAudio=new Audio,this.htmlAudio.src=o.Assets.findAsset(o.Assets.findAudioExtension(e)).audioURL,(t=this).htmlAudio.addEventListener("timeupdate",function(){0<o.System.pauseCount&&0<=t.lockTime?this.currentTime=t.lockTime:0<t.loopEnd&&(this.currentTime>t.loopEnd||t.htmlAudio.ended)&&(this.currentTime=t.loopStart,this.play())},!1)),this.muted=!1}o.AudioPlayer=e}(Engine=Engine||{}),function(e){var t;(n=t=e.AudioManagerMode||(e.AudioManagerMode={}))[n.NONE=0]="NONE",n[n.HTML=1]="HTML",n[n.WEB=2]="WEB";var n=(Object.defineProperty(r,"muted",{get:function(){return r._muted},set:function(e){r._muted=e;for(var t=0,n=r.players;t<n.length;t++){var i=n[t];i.muted=i._muted}},enumerable:!1,configurable:!0}),r.init=function(){var e;r.supported=void 0!==window.Audio,r.webSupported=void 0!==window.AudioContext||void 0!==window.webkitAudioContext,r.supported&&(e=new Audio,r.wavSupported=0<e.canPlayType("audio/wav; codecs=2").length||0<e.canPlayType("audio/wav; codecs=1").length||0<e.canPlayType("audio/wav; codecs=0").length||0<e.canPlayType("audio/wav").length,r.oggSupported=0<e.canPlayType("audio/ogg; codecs=vorbis").length||0<e.canPlayType("audio/ogg").length,r.aacSupported=0<e.canPlayType("audio/aac").length||0<e.canPlayType("audio/mp4").length),(r.supported=r.wavSupported||r.oggSupported||r.aacSupported)&&r.preferredMode!=t.NONE?r.webSupported&&r.preferredMode==t.WEB?(r.mode=t.WEB,window.AudioContext=window.AudioContext||window.webkitAudioContext,(r.context=new window.AudioContext).suspend(),r.context.createGain=r.context.createGain||r.context.createGainNode):(r.preferredMode==t.HTML&&console.error('Set "AudioManager.preferredMode = AudioManagerMode.HTML" only for testing proposes.'),r.mode=t.HTML):(r.preferredMode==t.NONE&&console.error('Set "AudioManager.preferredMode = AudioManagerMode.NONE" only for testing proposes.'),r.mode=t.NONE),r.inited=!0},r.verify=function(){0==e.System.pauseCount&&r.inited&&!r.verified&&(r.mode==t.WEB&&(r.context.resume(),e.System.pauseCount),r.verified=!0),r.verified&&r.mode==t.WEB&&"suspended"==r.context.state&&r.context.resume()},r.pause=function(){},r.resume=function(){},r.checkSuspended=function(){0==e.System.pauseCount&&r.inited&&r.mode==t.WEB&&"suspended"==r.context.state&&r.context.resume()},r.preferredMode=t.WEB,r.wavSupported=!1,r.oggSupported=!1,r.aacSupported=!1,r.verified=!1,r.supported=!1,r.webSupported=!1,r.players=new Array,r._muted=!1,r);function r(){}e.AudioManager=n}(Engine=Engine||{}),function(n){var i;(e=i=n.RendererMode||(n.RendererMode={}))[e.CANVAS_2D=0]="CANVAS_2D",e[e.WEB_GL=1]="WEB_GL";var e=(r.xViewToWindow=function(e){return(e+.5*r.xSizeView)*r.xSizeWindow/r.xSizeView},r.yViewToWindow=function(e){return(e+.5*r.ySizeView)*r.ySizeWindow/r.ySizeView},r.camera=function(e,t){r.xCamera=e,r.yCamera=t,r.mode==i.WEB_GL&&r.gl.uniform2f(r.glCameraPosition,e,t)},r.sizeView=function(e,t){r.xSizeViewIdeal=e,r.ySizeViewIdeal=t,r.fixViewValues(),r.mode==i.WEB_GL&&r.gl.uniform2f(r.glSizeView,r.xSizeView,r.xSizeView)},r.scaleView=function(e,t){r.xScaleView=e,r.yScaleView=t,r.mode==i.WEB_GL&&r.gl.uniform2f(r.glScaleView,e,t)},r.clearColor=function(e,t,n){r.clearRed=e,r.clearGreen=t,r.clearBlue=n,r.mode==i.WEB_GL&&r.gl.clearColor(e,t,n,1)},r.fixViewValues=function(){(r.xFitView=r.xSizeWindow<r.ySizeWindow||r.xSizeWindow/r.ySizeWindow<r.xSizeViewIdeal/r.ySizeViewIdeal-.001)?(r.xSizeView=r.xSizeViewIdeal,r.ySizeView=r.ySizeWindow*r.xSizeViewIdeal/r.xSizeWindow):(r.xSizeView=r.xSizeWindow*r.ySizeViewIdeal/r.ySizeWindow,r.ySizeView=r.ySizeViewIdeal)},r.fixCanvasSize=function(){var e,t;r.autoscale&&(e=window.innerWidth,t=window.innerHeight,r.canvas.style.width="100%",r.canvas.style.height="100%",r.canvas.width=e*(r.useDPI?r.dpr:1),r.canvas.height=t*(r.useDPI?r.dpr:1),r.xSizeWindow=e,r.ySizeWindow=t,r.fixViewValues()),r.mode==i.WEB_GL?(r.gl.viewport(0,0,r.canvas.width,r.canvas.height),r.gl.uniform2f(r.glSizeView,r.xSizeView,r.ySizeView)):null!=r.context.imageSmoothingEnabled&&null!=r.context.imageSmoothingEnabled?r.context.imageSmoothingEnabled=!1:null!=r.context.msImageSmoothingEnabled&&null!=r.context.msImageSmoothingEnabled&&(r.context.msImageSmoothingEnabled=!1)},r.clear=function(){r.mode==i.CANVAS_2D?(r.context.fillStyle="rgba("+255*r.clearRed+", "+255*r.clearGreen+", "+255*r.clearBlue+", 1.0)",r.context.fillRect(0,0,r.canvas.width,r.canvas.height)):r.gl.clear(r.gl.COLOR_BUFFER_BIT),r.drawCalls=0},r.renderSprite=function(e){e.enabled&&(r.mode==i.CANVAS_2D?(r.context.scale(r.useDPI?r.dpr:1,r.useDPI?r.dpr:1),r.context.translate(.5*r.xSizeWindow,.5*r.ySizeWindow),r.xFitView?r.context.scale(r.xSizeWindow/r.xSizeView,r.xSizeWindow/r.xSizeView):r.context.scale(r.ySizeWindow/r.ySizeView,r.ySizeWindow/r.ySizeView),1!=r.xScaleView&&1!=r.yScaleView&&r.context.scale(r.xScaleView,r.yScaleView),e.pinned||r.context.translate(-r.xCamera,-r.yCamera),r.context.translate(e.x,e.y),(1!=e.xScale||1!=e.yScale||e.xMirror||e.yMirror)&&r.context.scale(e.xScale*(e.xMirror?-1:1),e.yScale*(e.yMirror?-1:1)),0!=e.angle&&r.context.rotate(e.angle*n.System.PI_OVER_180),r.context.translate(e.xOffset,e.yOffset),null==e.texture?(r.context.fillStyle="rgba("+255*e.red+", "+255*e.green+", "+255*e.blue+", "+e.alpha+")",r.context.fillRect(0,0,e.xSize,e.ySize)):null==e.canvasTexture?r.context.drawImage(e.texture.canvas,e.xTexture,e.yTexture,e.xSizeTexture,e.ySizeTexture,0,0,e.xSize,e.ySize):r.context.drawImage(e.canvasTexture.canvas,0,0,e.xSizeTexture,e.ySizeTexture,0,0,e.xSize,e.ySize),null!=r.context.resetTransform&&null!=r.context.resetTransform?r.context.resetTransform():r.context.setTransform(1,0,0,1,0,0)):(r.drawableCount==r.maxElementsDrawCall&&r.update(),r.vertexArray.push(e.pinned?1:0),r.vertexArray.push(e.x),r.vertexArray.push(e.y),r.vertexArray.push(e.xOffset),r.vertexArray.push(e.yOffset),r.vertexArray.push(e.xScale),r.vertexArray.push(e.yScale),r.vertexArray.push(e.xMirror?1:0),r.vertexArray.push(e.yMirror?1:0),r.vertexArray.push(e.angle),r.vertexArray.push(e.u0),r.vertexArray.push(e.v0),r.vertexArray.push(null==e.texture?-1:e.texture.slot),r.vertexArray.push(e.red),r.vertexArray.push(e.green),r.vertexArray.push(e.blue),r.vertexArray.push(e.alpha),r.vertexArray.push(e.pinned?1:0),r.vertexArray.push(e.x),r.vertexArray.push(e.y),r.vertexArray.push(e.xOffset+e.xSize),r.vertexArray.push(e.yOffset),r.vertexArray.push(e.xScale),r.vertexArray.push(e.yScale),r.vertexArray.push(e.xMirror?1:0),r.vertexArray.push(e.yMirror?1:0),r.vertexArray.push(e.angle),r.vertexArray.push(e.u1),r.vertexArray.push(e.v0),r.vertexArray.push(null==e.texture?-1:e.texture.slot),r.vertexArray.push(e.red),r.vertexArray.push(e.green),r.vertexArray.push(e.blue),r.vertexArray.push(e.alpha),r.vertexArray.push(e.pinned?1:0),r.vertexArray.push(e.x),r.vertexArray.push(e.y),r.vertexArray.push(e.xOffset),r.vertexArray.push(e.yOffset+e.ySize),r.vertexArray.push(e.xScale),r.vertexArray.push(e.yScale),r.vertexArray.push(e.xMirror?1:0),r.vertexArray.push(e.yMirror?1:0),r.vertexArray.push(e.angle),r.vertexArray.push(e.u0),r.vertexArray.push(e.v1),r.vertexArray.push(null==e.texture?-1:e.texture.slot),r.vertexArray.push(e.red),r.vertexArray.push(e.green),r.vertexArray.push(e.blue),r.vertexArray.push(e.alpha),r.vertexArray.push(e.pinned?1:0),r.vertexArray.push(e.x),r.vertexArray.push(e.y),r.vertexArray.push(e.xOffset+e.xSize),r.vertexArray.push(e.yOffset+e.ySize),r.vertexArray.push(e.xScale),r.vertexArray.push(e.yScale),r.vertexArray.push(e.xMirror?1:0),r.vertexArray.push(e.yMirror?1:0),r.vertexArray.push(e.angle),r.vertexArray.push(e.u1),r.vertexArray.push(e.v1),r.vertexArray.push(null==e.texture?-1:e.texture.slot),r.vertexArray.push(e.red),r.vertexArray.push(e.green),r.vertexArray.push(e.blue),r.vertexArray.push(e.alpha),r.faceArray.push(r.SPRITE_RENDERER_VERTICES*r.drawableCount+0),r.faceArray.push(r.SPRITE_RENDERER_VERTICES*r.drawableCount+1),r.faceArray.push(r.SPRITE_RENDERER_VERTICES*r.drawableCount+2),r.faceArray.push(r.SPRITE_RENDERER_VERTICES*r.drawableCount+1),r.faceArray.push(r.SPRITE_RENDERER_VERTICES*r.drawableCount+3),r.faceArray.push(r.SPRITE_RENDERER_VERTICES*r.drawableCount+2),r.drawableCount+=1))},r.update=function(){r.mode==i.CANVAS_2D?r.drawCalls+=1:0<r.drawableCount&&(r.gl.bindBuffer(r.gl.ARRAY_BUFFER,r.vertexBuffer),r.gl.bufferData(r.gl.ARRAY_BUFFER,new Float32Array(r.vertexArray),r.gl.DYNAMIC_DRAW),r.gl.vertexAttribPointer(r.glVertexPinned,1,r.gl.FLOAT,!1,68,0),r.gl.vertexAttribPointer(r.glVertexAnchor,2,r.gl.FLOAT,!1,68,4),r.gl.vertexAttribPointer(r.glVertexPosition,2,r.gl.FLOAT,!1,68,12),r.gl.vertexAttribPointer(r.glVertexScale,2,r.gl.FLOAT,!1,68,20),r.gl.vertexAttribPointer(r.glVertexMirror,2,r.gl.FLOAT,!1,68,28),r.gl.vertexAttribPointer(r.glVertexAngle,1,r.gl.FLOAT,!1,68,36),r.gl.vertexAttribPointer(r.glVertexUV,2,r.gl.FLOAT,!1,68,40),r.gl.vertexAttribPointer(r.glVertexTexture,1,r.gl.FLOAT,!1,68,48),r.gl.vertexAttribPointer(r.glVertexColor,4,r.gl.FLOAT,!1,68,52),r.gl.bindBuffer(r.gl.ELEMENT_ARRAY_BUFFER,r.faceBuffer),r.gl.bufferData(r.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(r.faceArray),r.gl.DYNAMIC_DRAW),r.gl.drawElements(r.gl.TRIANGLES,6*r.drawableCount,r.gl.UNSIGNED_SHORT,0),r.gl.flush(),r.drawCalls+=1,r.vertexArray=[],r.faceArray=[],r.drawableCount=0)},r.updateHandCursor=function(){r.useHandPointer?(r.canvas.style.cursor="pointer",r.useHandPointer=!1):r.canvas.style.cursor="default"},r.init=function(){var e,t;if(r.canvas=document.getElementById("gameCanvas"),r.autoscale?(r.canvas.style.display="block",r.canvas.style.position="absolute",r.canvas.style.top="0px",r.canvas.style.left="0px",e=window.innerWidth,t=window.innerHeight,r.canvas.style.width="100%",r.canvas.style.height="100%",r.canvas.width=e*(r.useDPI?r.dpr:1),r.canvas.height=t*(r.useDPI?r.dpr:1),r.xSizeView=(r.xSizeWindow=e)*r.ySizeViewIdeal/(r.ySizeWindow=t)):(r.xSizeWindow=r.canvas.width,r.ySizeWindow=r.canvas.height,r.xSizeView=r.xSizeWindow*r.ySizeViewIdeal/r.ySizeWindow),r.ySizeView=r.ySizeViewIdeal,r.fixViewValues(),r.preferredMode==i.WEB_GL)try{r.gl=r.canvas.getContext("webgl")||r.canvas.getContext("experimental-webgl"),r.glSupported=r.gl&&r.gl instanceof WebGLRenderingContext}catch(e){r.glSupported=!1}r.glSupported&&r.preferredMode==i.WEB_GL?(r.mode=i.WEB_GL,n.Assets.queue(r.PATH_SHADER_VERTEX),n.Assets.queue(r.PATH_SHADER_FRAGMENT),n.Assets.download(),r.initGL()):(r.preferredMode==i.CANVAS_2D&&console.error('Set "Renderer.preferredMode = RendererMode.CANVAS_2D" only for testing proposes.'),r.mode=i.CANVAS_2D,null!=(r.context=r.canvas.getContext("2d")).imageSmoothingEnabled&&null!=r.context.imageSmoothingEnabled?r.context.imageSmoothingEnabled=!1:null!=r.context.msImageSmoothingEnabled&&null!=r.context.msImageSmoothingEnabled&&(r.context.msImageSmoothingEnabled=!1),r.inited=!0)},r.getGLTextureUnitIndex=function(e){switch(e){case 0:return r.gl.TEXTURE0;case 1:return r.gl.TEXTURE1;case 2:return r.gl.TEXTURE2;case 3:return r.gl.TEXTURE3;case 4:return r.gl.TEXTURE4;case 5:return r.gl.TEXTURE5;case 6:return r.gl.TEXTURE6;case 7:return r.gl.TEXTURE7;case 8:return r.gl.TEXTURE8;case 9:return r.gl.TEXTURE9;case 10:return r.gl.TEXTURE10;case 11:return r.gl.TEXTURE11;case 12:return r.gl.TEXTURE12;case 13:return r.gl.TEXTURE13;case 14:return r.gl.TEXTURE14;case 15:return r.gl.TEXTURE15;case 16:return r.gl.TEXTURE16;case 17:return r.gl.TEXTURE17;case 18:return r.gl.TEXTURE18;case 19:return r.gl.TEXTURE19;case 20:return r.gl.TEXTURE20;case 21:return r.gl.TEXTURE21;case 22:return r.gl.TEXTURE22;case 23:return r.gl.TEXTURE23;case 24:return r.gl.TEXTURE24;case 25:return r.gl.TEXTURE25;case 26:return r.gl.TEXTURE26;case 27:return r.gl.TEXTURE27;case 28:return r.gl.TEXTURE28;case 29:return r.gl.TEXTURE29;case 30:return r.gl.TEXTURE30;case 31:return r.gl.TEXTURE31;default:return r.gl.NONE}},r.createShader=function(e,t){t=r.gl.createShader(t);if(null==t||t==r.gl.NONE)console.log("Error");else{if(r.gl.shaderSource(t,e),r.gl.compileShader(t),!(r.gl.getShaderParameter(t,r.gl.COMPILE_STATUS)<=0))return t;console.log("Error")}return r.gl.NONE},r.renderTexture=function(e,t){r.textureSamplerIndices[e.slot]=e.slot,r.gl.uniform1iv(r.glTextureSamplers,new Int32Array(r.textureSamplerIndices)),r.gl.activeTexture(r.getGLTextureUnitIndex(e.slot)),r.gl.bindTexture(r.gl.TEXTURE_2D,r.textureSlots[e.slot]),r.gl.texImage2D(r.gl.TEXTURE_2D,0,r.gl.RGBA,e.assetData.xSize,e.assetData.ySize,0,r.gl.RGBA,r.gl.UNSIGNED_BYTE,new Uint8Array(e.assetData.bytes)),t&&e.assetData.filterable?(r.gl.generateMipmap(r.gl.TEXTURE_2D),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_MAG_FILTER,r.gl.LINEAR),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_MIN_FILTER,r.gl.LINEAR_MIPMAP_LINEAR)):(r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_MAG_FILTER,r.gl.NEAREST),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_MIN_FILTER,r.gl.NEAREST),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_WRAP_T,r.gl.CLAMP_TO_EDGE),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_WRAP_S,r.gl.CLAMP_TO_EDGE))},r.initGL=function(){if(n.Assets.downloadComplete){for(var e=0;e<r.MAX_TEXTURE_SLOTS;e+=1)r.textureSamplerIndices[e]=0;r.vertexShader=r.createShader(n.Assets.loadText(r.PATH_SHADER_VERTEX),r.gl.VERTEX_SHADER);var t="#define MAX_TEXTURE_SLOTS "+r.MAX_TEXTURE_SLOTS+"\nprecision mediump float;\n"+n.Assets.loadText(r.PATH_SHADER_FRAGMENT);if(r.fragmentShader=r.createShader(t,r.gl.FRAGMENT_SHADER),null==(r.shaderProgram=r.gl.createProgram())||0==r.shaderProgram)console.log("Error");else{r.gl.attachShader(r.shaderProgram,r.vertexShader),r.gl.attachShader(r.shaderProgram,r.fragmentShader),r.gl.linkProgram(r.shaderProgram),r.glTextureSamplers=r.gl.getUniformLocation(r.shaderProgram,"textures"),r.glSizeView=r.gl.getUniformLocation(r.shaderProgram,"view_size"),r.glScaleView=r.gl.getUniformLocation(r.shaderProgram,"view_scale"),r.glCameraPosition=r.gl.getUniformLocation(r.shaderProgram,"camera_position"),r.glVertexPinned=r.gl.getAttribLocation(r.shaderProgram,"vertex_pinned"),r.glVertexAnchor=r.gl.getAttribLocation(r.shaderProgram,"vertex_anchor"),r.glVertexPosition=r.gl.getAttribLocation(r.shaderProgram,"vertex_position"),r.glVertexScale=r.gl.getAttribLocation(r.shaderProgram,"vertex_scale"),r.glVertexMirror=r.gl.getAttribLocation(r.shaderProgram,"vertex_mirror"),r.glVertexAngle=r.gl.getAttribLocation(r.shaderProgram,"vertex_angle"),r.glVertexUV=r.gl.getAttribLocation(r.shaderProgram,"vertex_uv"),r.glVertexTexture=r.gl.getAttribLocation(r.shaderProgram,"vertex_texture"),r.glVertexColor=r.gl.getAttribLocation(r.shaderProgram,"vertex_color"),r.gl.useProgram(r.shaderProgram),r.gl.enableVertexAttribArray(r.glVertexPinned),r.gl.enableVertexAttribArray(r.glVertexAnchor),r.gl.enableVertexAttribArray(r.glVertexPosition),r.gl.enableVertexAttribArray(r.glVertexScale),r.gl.enableVertexAttribArray(r.glVertexMirror),r.gl.enableVertexAttribArray(r.glVertexAngle),r.gl.enableVertexAttribArray(r.glVertexUV),r.gl.enableVertexAttribArray(r.glVertexTexture),r.gl.enableVertexAttribArray(r.glVertexColor),r.gl.uniform1iv(r.glTextureSamplers,new Int32Array(r.textureSamplerIndices)),r.gl.viewport(0,0,r.canvas.width,r.canvas.height),r.gl.uniform2f(r.glSizeView,r.xSizeView,r.ySizeView),r.gl.uniform2f(r.glScaleView,r.xScaleView,r.yScaleView),r.vertexBuffer=r.gl.createBuffer(),r.faceBuffer=r.gl.createBuffer(),r.gl.enable(r.gl.BLEND),r.gl.blendFuncSeparate(r.gl.SRC_ALPHA,r.gl.ONE_MINUS_SRC_ALPHA,r.gl.ZERO,r.gl.ONE),r.gl.clearColor(r.clearRed,r.clearGreen,r.clearBlue,1);for(e=0;e<r.MAX_TEXTURE_SLOTS;e+=1)r.textureSlots[e]=r.gl.createTexture(),r.gl.activeTexture(r.getGLTextureUnitIndex(e)),r.gl.bindTexture(r.gl.TEXTURE_2D,r.textureSlots[e]),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_MAG_FILTER,r.gl.NEAREST),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_MIN_FILTER,r.gl.NEAREST),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_WRAP_T,r.gl.CLAMP_TO_EDGE),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_WRAP_S,r.gl.CLAMP_TO_EDGE);r.gl.activeTexture(r.getGLTextureUnitIndex(0)),r.gl.bindTexture(r.gl.TEXTURE_2D,r.textureSlots[0]),r.gl.texImage2D(r.gl.TEXTURE_2D,0,r.gl.RGBA,2,2,0,r.gl.RGBA,r.gl.UNSIGNED_BYTE,new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]))}r.gl.clearColor(0,0,0,1),r.inited=!0}else setTimeout(r.initGL,1/60)},r.MAX_TEXTURE_SLOTS=8,r.SPRITE_RENDERER_VERTICES=4,r.PATH_SHADER_VERTEX="https://137205836-418472038857163927.preview.editmysite.com/uploads/b/146211889-771688149676829714/files/System/Vertex.glsl",r.PATH_SHADER_FRAGMENT="https://137205836-418472038857163927.preview.editmysite.com/uploads/b/146211889-771688149676829714/files/System/Fragment.glsl",r.inited=!1,r.preferredMode=i.WEB_GL,r.glSupported=!1,r.useHandPointer=!1,r.xCamera=0,r.yCamera=0,r.xSizeViewIdeal=235,r.ySizeViewIdeal=176,r.clearRed=0,r.clearGreen=0,r.clearBlue=0,r.xFitView=!1,r.xScaleView=1,r.yScaleView=1,r.drawCalls=0,r.autoscale=!0,r.maxElementsDrawCall=8192,r.textureSlots=new Array,r.drawableCount=0,r.vertexArray=new Array,r.faceArray=new Array,r.textureSamplerIndices=new Array,r.useDPI=!0,r.dpr=window.devicePixelRatio||1,r.a=!1,r);function r(){}n.Renderer=e}(Engine=Engine||{}),function(e){Engine.System.onInit=function(){Engine.Data.useLocalStorage?Engine.Data.setID("com","noa","zrist"):Engine.Data.setID("c","n","zrs"),e.SceneColors.clearColor(0,0,0),Engine.System.createEvent(Engine.EventType.CREATE_SCENE,"onCreateScene"),Engine.System.createEvent(Engine.EventType.RESET_SCENE,"onReset"),Engine.System.createEvent(Engine.EventType.VIEW_UPDATE,"onViewUpdateAnchor"),Engine.System.createEvent(Engine.EventType.VIEW_UPDATE,"onViewUpdateText"),Engine.System.createEvent(Engine.EventType.VIEW_UPDATE,"onViewUpdate"),Engine.System.createEvent(Engine.EventType.STEP_UPDATE,"onControlPreUpdate"),Engine.System.createEvent(Engine.EventType.STEP_UPDATE,"onControlUpdate"),Engine.System.createEvent(Engine.EventType.STEP_UPDATE,"onMapUpdate"),Engine.System.createEvent(Engine.EventType.STEP_UPDATE,"onMoveUpdate"),Engine.System.createEvent(Engine.EventType.STEP_UPDATE,"onOverlapUpdate"),Engine.System.createEvent(Engine.EventType.STEP_UPDATE,"onAnimationUpdate"),Engine.System.createEvent(Engine.EventType.STEP_UPDATE,"onStepUpdate"),Engine.System.createEvent(Engine.EventType.STEP_UPDATE,"onStepLateUpdate"),Engine.System.createEvent(Engine.EventType.STEP_UPDATE,"onStepUpdateFade"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onPlayerConfigureTimeUpdate"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onMapConfigureTimeUpdate"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onTimeUpdate"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onTimeUpdateSceneBeforeDrawFixed"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onDrawSceneMap"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onDrawSceneFill"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onDrawFog"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onDrawObjectsBack"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onDrawParticlesBack"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onDrawObjects"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onDrawObjectsFront"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onDrawPlayer"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onDrawGoal"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onDrawParticlesFront"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onDrawPause"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onDrawDialogs"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onDrawButtons"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onDrawText"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onDrawObjectsAfterUI"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onDrawFade"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onDrawOrientationUI"),Engine.System.createEvent(Engine.EventType.TIME_UPDATE,"onDrawTextFront"),Engine.System.createEvent(Engine.EventType.CLEAR_SCENE,"onClearScene"),Engine.Box.debugRender=!1,e.startingSceneClass=e.Level}}(Game=Game||{}),function(i){function e(){null!=i.Resources.bgm&&(i.Resources.bgm.volume=0);for(var e=0,t=i.sfxs;e<t.length;e++)t[e].volume=0}i.HAS_PRELOADER=!0,i.HAS_LINKS=!0,i.HAS_GOOGLE_PLAY_LOGOS=!0,i.IS_EDGE=/Edge/.test(navigator.userAgent),i.STEPS_CHANGE_SCENE=10,i.STEPS_CHANGE_SCENE_AD=30,i.X_BUTTONS_LEFT=3,i.X_BUTTONS_RIGHT=-3,i.Y_BUTTONS_TOP=4,i.Y_BUTTONS_BOTTOM=-2,i.Y_ARROWS_GAME_BUTTONS=2,i.X_SEPARATION_BUTTONS_LEFT=9,i.MUSIC_MUTED=!1,i.SOUND_MUTED=!1,i.IS_TOUCH=!1,i.SKIP_PRELOADER=!1,i.FORCE_TOUCH=!1,i.SKIP_CREDITS=!1,i.DIRECT_PRELOADER=!1,i.TRACK_ORIENTATION=!1,i.URL_MORE_GAMES="http://noadev.com/games",i.URL_NOADEV="http://noadev.com/games",i.TEXT_MORE_GAMES="+GAMES",i.IS_APP=!1,i.IS_IOS_SAFARI=!1,i.fixViewHandler=function(){},i.HAS_STARTED=!1,i.STRONG_TOUCH_MUTE_CHECK=!1,i.muteAll=e,i.unmute=function(){if(i.Resources.bgmVolumeTracker<1&&(i.Resources.bgmVolumeTracker+=1,null!=i.Resources.bgm&&(i.Resources.bgm.volume=1==i.Resources.bgmVolumeTracker?i.Resources.bgm.restoreVolume:0),1==i.Resources.bgmVolumeTracker))for(var e=0,t=i.sfxs;e<t.length;e++){var n=t[e];n.volume=n.restoreVolume}return 1==i.Resources.bgmVolumeTracker},i.mute=function(){return--i.Resources.bgmVolumeTracker,e(),i.Resources.bgmVolumeTracker<1},Engine.System.onRun=function(){i.IS_APP||(window.onfocus=function(){i.fixViewHandler()},window.onblur=function(){i.fixViewHandler()},document.addEventListener("visibilitychange",function(){i.fixViewHandler(),"visible"==document.visibilityState?(i.STRONG_TOUCH_MUTE_CHECK&&(!i.HAS_STARTED||i.IS_TOUCH)||i.unmute(),Engine.System.resume()):"hidden"==document.visibilityState&&(i.STRONG_TOUCH_MUTE_CHECK&&(!i.HAS_STARTED||i.IS_TOUCH)||i.mute(),Engine.System.pause())}))};var a=new Array,s=new Array;function n(e,t,n){for(var i,r=0,o=e;r<o.length;r++)if((i=o[r]).type==t)return void i.elements.push(n);(i={}).type=t,i.elements=[n],e.push(i)}i.dataLevels=new Array,i.bgms=new Array,i.sfxs=new Array,i.switchMusicMute=function(){i.MUSIC_MUTED=!i.MUSIC_MUTED;for(var e=0,t=i.bgms;e<t.length;e++)t[e].muted=i.MUSIC_MUTED},i.switchSoundMute=function(){i.SOUND_MUTED=!i.SOUND_MUTED;for(var e=0,t=i.sfxs;e<t.length;e++)t[e].muted=i.SOUND_MUTED},i.findInJSON=function(e,t){if(null!=e.find&&null!=e.find)return e.find(t);for(var n=0,i=e;n<i.length;n++){var r=i[n];if(t(r))return r}},i.addPath=function(e,t){n(a,e,t)},i.addAction=function(e,t){n(s,e,t)},i.forEachPath=function(e,t){for(var n=0,i=a;n<i.length;n++){var r=i[n];if(r.type==e){for(var o=0,s=r.elements;o<s.length;o++)t(s[o]);return}}},i.triggerActions=function(e){for(var t=0,n=s;t<n.length;t++){var i=n[t];if(i.type==e){for(var r=0,o=i.elements;r<o.length;r++)(0,o[r])();return}}}}(Game=Game||{}),function(e){function t(){this.preserved=!1,e.System.addListenersFrom(this)}e.Entity=t}(Engine=Engine||{});var Game,Utils,Engine,__extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();!function(i){var n,e=(n=Engine.Entity,__extends(t,n),t.create=function(e){new i[e.type.type](e)},t.getDefProperty=function(e,t){var n=null;return null!=e.instance.properties&&(n=i.findInJSON(e.instance.properties,function(e){return e.name==t})),null==n&&null!=e.type.properties&&(n=i.findInJSON(e.type.properties,function(e){return e.name==t})),null!=n?n.value:null},t.prototype.getProperty=function(e){return t.getDefProperty(this.def,e)},t);function t(e){var t=n.call(this)||this;return t.def=e,t}i.Entity=e}(Game=Game||{}),function(o){var s,i,e,t,r=1,a=2,l=3,u=4,d=5,n=100,c=101,h=102,f=103,g=104,p=80,E=128,x=0,S=1,y=16,A=8,T=300,b=10,w=4.2,v=1.7*w,m=-5.5,_=-5.5,R=25,L=32,D=100,U=.35,O=12,I=15,M=-8,P=-8,C=16,B=16,z=-10,V=-10,N=20,k=20,G=null;o.addAction("init",function(){G=o.FrameSelector.complex("player",o.Resources.texture,251,28)});var F=0,H=0,W=0,X=0,j=0,Y=0,K=!1,J=!1,q=0,Z=!1,Q=!1,$=!1,ee=!1,te=0,ne=0,ie=[],re=[],oe=0;function se(){(s=new Engine.Box).enabled=!0,s.renderable=!0,i=new Engine.Sprite,function(){for(var e=0;e<I;e+=1)ie.push(new Engine.Sprite),re.push(new Engine.Point(0,0))}(),he(r)}function ae(){var e;if(o.LevelFlow.backtracking&&(s.x-=o.MAP_WIDTH*o.SIZE_TILE,j-=o.MAP_WIDTH*o.SIZE_TILE,W-=o.MAP_WIDTH*o.SIZE_TILE),o.LevelFlow.freezed&&!o.LevelFlow.reseting||(o.LevelFlow.playing&&(ee=$=!1,o.LevelFlow.lagged?(0<te&&--te%O==0&&($=!0),0<ne&&--ne%O==0&&(ee=!0),pe()&&(te+=O),Ee()&&(ne+=O)):ne=te=0,function(){switch(Y){case r:break;case a:i.angle+=o.LevelFlow.freezed?0:Z?-b:b;break;case l:break;case u:q+=1}}(),J=!1,de(x),(oe+=Z?-U:U)<-T?oe=-T:T<oe&&(oe=T),de(S),e=s.x,H+=e-j,j=e,L<=H&&(H-=L,F+=D)),ce()),Y==d)for(var t=0;t<I;t+=1)re[t].y+=Z?-U:U,re[t].y<-300?re[t].y=-300:300<re[t].y&&(re[t].y=300),ie[t].x+=re[t].x,ie[t].y+=re[t].y}function le(){return o.LevelData.currentRule==o.RULE_SPEED_UP?v:w}function ue(){o.IS_TOUCH&&(e.bounds.y=.5*-Engine.Renderer.ySizeView,e.bounds.xSize=.5*Engine.Renderer.xSizeView,e.bounds.ySize=Engine.Renderer.ySizeView,t.bounds.x=.5*-Engine.Renderer.xSizeView,t.bounds.y=.5*-Engine.Renderer.ySizeView,t.bounds.xSize=.5*Engine.Renderer.xSizeView,t.bounds.ySize=Engine.Renderer.ySizeView)}function de(e){var t=e==S&&(Z?oe<0:0<oe),n=s.cast(o.boxesTiles,null,e==x,e==x?le():oe,!0,Engine.Box.LAYER_ALL);if(s.translate(n,e==x,e==x?le():oe,!0),null!=n)for(var i=0;i<n.length;i+=1){var r=n[i].other.data;if(r==o.VALUE_TILE_RED||r==o.VALUE_TILE_RED_HALF||r==o.VALUE_TILE_RED_HALF_B){K=!0;break}e==S&&(oe=0,t&&(J=!0))}}function ce(){if(Y!=d&&Y!=r&&(K||s.y>(o.MAP_HEIGHT+1)*o.SIZE_TILE||s.y<-(y+3*o.SIZE_TILE)))he(d);else switch(Y){case r:o.LevelFlow.playing&&he(a);break;case a:J?he(c):!Q&&ge()&&(o.LevelData.currentRule==o.RULE_GRAVITY?he(f):o.LevelData.currentRule==o.RULE_DOUBLE_JUMP&&he(g));break;case l:J?ge()?he(h):fe()&&he(u):he(a);break;case u:var e=s.cast(o.boxesTiles,null,!1,Z?1:-1,!0,Engine.Box.LAYER_ALL);if(null==e||0==e.length)J?ge()?he(h):R<=q&&he(l):he(a);else if(R<=q||ge())for(var t=0;t<e.length;t+=1){var n=e[t].other.data;if(n==o.VALUE_TILE_RED||n==o.VALUE_TILE_RED_HALF||n==o.VALUE_TILE_RED_HALF_B){he(d);break}}break;case d:o.LevelFlow.reseting&&he(r);break;case c:ge()?he(h):fe()?he(u):he(l);break;case h:case f:case g:he(a)}}function he(e){!function(){switch(Y){case r:i.enabled=!0,s.enabled=!0;break;case a:i.angle=0;break;case l:break;case u:s.ySize=y,Z?G[1].applyToSprite(i):(s.y-=A,G[0].applyToSprite(i))}}();Y=e,function(){switch(Y){case r:H=F=0,Q=Z=!1,s.x=p,s.y=E,W=s.x,X=s.y,j=p,s.xSize=y,s.ySize=y,G[0].applyToSprite(i);for(var e=0;e<I;e+=1)ie[e].enabled=!1;break;case a:case l:break;case u:q=0,s.ySize=A,Z?G[3].applyToSprite(i):(s.y+=A,G[2].applyToSprite(i)),o.Resources.sfxSlide.play();break;case d:K=!1,i.enabled=!1,s.enabled=!1,oe=0,o.Resources.sfxDead.play(),function(){for(var e=0;e<I;e+=1){var t=ie[e],n=re[e];t.enabled=!0,t.x=W+A,t.y=X+A*(Z?-1:1),t.x+=M+Math.random()*C,t.y+=(P+Math.random()*B)*(Z?-1:1),n.x=z+Math.random()*N,n.y=(V+Math.random()*k)*(Z?-1:1);n=Math.floor(3*Math.random());G[4+n].applyToSprite(t)}}();break;case c:Q=!1;break;case h:oe=Z?-m:m,o.Resources.sfxJump.play();break;case f:Q=!0,((Z=!Z)?G[1]:G[0]).applyToSprite(i),o.Resources.sfxGravityJump.play();break;case g:Q=!0,oe=_,o.Resources.sfxJump.play()}}(),n<=Y&&ce()}function fe(){return o.LevelData.currentRule==o.RULE_LAG?ee:Ee()}function ge(){return o.LevelData.currentRule==o.RULE_LAG?$:pe()}function pe(){return e.pressed}function Ee(){return t.pressed}var xe,Se=(xe=Engine.Entity,__extends(ye,xe),Object.defineProperty(ye,"score",{get:function(){return F},enumerable:!1,configurable:!0}),Object.defineProperty(ye,"cursor",{get:function(){return W},enumerable:!1,configurable:!0}),Object.defineProperty(ye,"physicsCursor",{get:function(){return s.x+A},enumerable:!1,configurable:!0}),Object.defineProperty(ye,"physicsCursorY",{get:function(){return s.y+A},enumerable:!1,configurable:!0}),Object.defineProperty(ye,"dead",{get:function(){return Y==d},enumerable:!1,configurable:!0}),ye.init=function(){se(),(e=new o.Control).enabled=!0,e.freezeable=!0,e.listener=this,e.useKeyboard=!0,e.newInteractionRequired=!0,e.useMouse=!0,e.mouseButtons=[0],e.keys=[Engine.Keyboard.X],(t=new o.Control).enabled=!0,t.freezeable=!0,t.listener=this,t.useKeyboard=!0,t.newInteractionRequired=!0,t.useMouse=!0,t.mouseButtons=[2],t.keys=[Engine.Keyboard.C],o.IS_TOUCH&&(e.useTouch=!0,e.bounds=new Engine.Sprite,e.bounds.enabled=!0,e.bounds.pinned=!0,t.useTouch=!0,t.bounds=new Engine.Sprite,t.bounds.enabled=!0,t.bounds.pinned=!0,ue()),new ye},ye.prototype.onViewUpdate=function(){ue()},ye.prototype.onStepUpdate=function(){e.enabled&&o.LevelFlow.freezed?(e.enabled=!1,t.enabled=!1):e.enabled||o.LevelFlow.freezed||(e.enabled=!0,t.enabled=!0),ae()},ye.prototype.onPlayerConfigureTimeUpdate=function(){var e,t;o.LevelFlow.freezed&&!o.LevelFlow.backtracking||(e=s.x,t=s.cast(o.boxesTiles,null,!0,le()*Engine.System.stepExtrapolation,!0,Engine.Box.LAYER_ALL),s.translate(t,!0,le()*Engine.System.stepExtrapolation,!0),W=s.x,s.x=e,e=s.y,t=s.cast(o.boxesTiles,null,!1,oe*Engine.System.stepExtrapolation,!0,Engine.Box.LAYER_ALL),s.translate(t,!1,oe*Engine.System.stepExtrapolation,!0),X=s.y,s.y=e)},ye.prototype.onDrawPlayer=function(){o.LevelData.currentRule!=o.RULE_INVISIBILITY&&(function(){if(Y==u?(i.x=W+A,i.y=X+A/2):(i.x=W+A,i.y=X+A),Y==d)for(var e=0;e<I;e+=1){var t=ie[e].x,n=ie[e].y;ie[e].x+=re[e].x*Engine.System.stepExtrapolation,ie[e].y+=re[e].y*Engine.System.stepExtrapolation,ie[e].render(),ie[e].x=t,ie[e].y=n}}(),i.render()),Engine.Box.debugRender&&s.renderExtrapolated(o.boxesTiles,le()*(o.LevelFlow.freezed?0:1),oe*(o.LevelFlow.freezed?0:1),!0,Engine.Box.LAYER_ALL)},ye);function ye(){return xe.call(this)||this}o.Player=Se}(Game=Game||{}),function(o){var n,e=(n=Engine.Entity,__extends(t,n),Object.defineProperty(t.prototype,"bounds",{get:function(){return this.control.bounds},enumerable:!1,configurable:!0}),t.prototype.onDrawButtons=function(){this.control.bounds.render()},t);function t(e){void 0===e&&(e=new Engine.Sprite);var t=n.call(this)||this;return t.arrows=new o.Arrows,t.control=new o.Control,t.anchor=new Utils.Anchor,t.control.bounds=e,t.anchor.bounds=e,t.control.enabled=!0,t.control.useMouse=!0,t.control.mouseButtons=[0],t.control.useTouch=!0,t.control.blockOthersSelection=!0,t.control.newInteractionRequired=!0,(t.control.listener=t).arrows.control=t.control,t.arrows.bounds=t.control.bounds,t}o.Button=e;var i,e=(i=Engine.Entity,__extends(r,i),r);function r(){var e=i.call(this)||this;return e.text=new Utils.Text,e.control=new o.Control,e.control.bounds=e.text.bounds,e.control.enabled=!0,e.control.useMouse=!0,e.control.mouseButtons=[0],e.control.useTouch=!0,e.control.blockOthersSelection=!0,e.control.newInteractionRequired=!0,e.control.listener=e}o.TextButton=e;var s,e=(s=Engine.Entity,__extends(a,s),Object.defineProperty(a.prototype,"enabled",{set:function(e){this.control.enabled=e,this.dialog.enabled=e,this.text.enabled=e},enumerable:!1,configurable:!0}),a);function a(e,t,n,i){var r=s.call(this)||this;return r.arrows=new o.Arrows,r.control=new o.Control,r.text=new Utils.Text,r.dialog=new o.ColorDialog("blue",e,t,n,i),r.control.bounds=r.dialog.fill,r.control.enabled=!0,r.control.useMouse=!0,r.control.mouseButtons=[0],r.control.useTouch=!0,r.control.blockOthersSelection=!0,r.control.newInteractionRequired=!0,(r.control.listener=r).arrows.control=r.control,r.arrows.bounds=r.text.bounds,r}o.DialogButton=e}(Game=Game||{}),function(t){var n,i,e=(i=t.TextButton,__extends(r,i),r.init=function(){n=new r},Object.defineProperty(r,"enabled",{set:function(e){n.text.enabled=e,n.control.enabled=e,n.control.blockOthersSelection=e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"pressed",{get:function(){return n.control.pressed},enumerable:!1,configurable:!0}),r.prototype.fixText=function(){t.LevelFlow.paused?this.text.str="UNPAUSE"+(t.IS_TOUCH?"":" (P)"):this.text.str="PAUSE"+(t.IS_TOUCH?"":" (P)"),t.IS_TOUCH&&(this.text.bounds.ySize+=t.Y_SIZE_EXTRA_TOUCH)},r.prototype.onViewUpdate=function(){this.fixText()},r.prototype.onStepUpdate=function(){0<=this.text.str.indexOf("UN")?t.LevelFlow.paused||this.fixText():t.LevelFlow.paused&&this.fixText()},r);function r(){var e=i.call(this)||this;return e.control.enabled=!1,e.text.font=t.FontManager.a,e.text.scale=1,e.text.enabled=!1,e.text.pinned=!0,e.text.xAlignBounds=Utils.AnchorAlignment.END,e.text.xAlignView=Utils.AnchorAlignment.END,e.text.yAlignBounds=Utils.AnchorAlignment.START,e.text.yAlignView=Utils.AnchorAlignment.START,e.text.xAligned=t.X_BUTTONS_RIGHT,e.text.yAligned=t.Y_BUTTONS_TOP,e.text.str="PAUSE"+(t.IS_TOUCH?"":" (P)"),t.IS_TOUCH&&(e.text.bounds.ySize+=t.Y_SIZE_EXTRA_TOUCH),e.control.useKeyboard=!0,e.control.keys=[Engine.Keyboard.P],e}t.PauseButton=e}(Game=Game||{}),function(t){t.Y_SIZE_EXTRA_TOUCH=20;var n,e=(n=t.TextButton,__extends(i,n),i.init=function(){new i},i.prototype.onPressed=function(){t.switchSoundMute(),t.switchMusicMute(),this.fixText()},i.prototype.fixText=function(){t.SOUND_MUTED?this.text.str="UNMUTE"+(t.IS_TOUCH?"":" (M)"):this.text.str="MUTE"+(t.IS_TOUCH?"":" (M)"),t.IS_TOUCH&&(this.text.bounds.ySize+=t.Y_SIZE_EXTRA_TOUCH)},i.prototype.onStepUpdate=function(){t.Resources.bgmPlayed&&!this.control.enabled&&(this.control.enabled=!0,this.text.enabled=!0)},i.prototype.onViewUpdate=function(){this.fixText()},i);function i(){var e=n.call(this)||this;return e.control.enabled=!1,e.text.font=t.FontManager.a,e.text.scale=1,e.text.enabled=!1,e.text.pinned=!0,e.text.xAlignBounds=Utils.AnchorAlignment.START,e.text.xAlignView=Utils.AnchorAlignment.START,e.text.yAlignBounds=Utils.AnchorAlignment.START,e.text.yAlignView=Utils.AnchorAlignment.START,e.text.xAligned=t.X_BUTTONS_LEFT,e.text.yAligned=t.Y_BUTTONS_TOP,e.fixText(),e.control.useKeyboard=!0,e.control.keys=[Engine.Keyboard.M],e.control.onPressedDelegate=e.onPressed,e}t.SoundButton=e}(Game=Game||{}),function(e){var t=(Object.defineProperty(n.prototype,"preserved",{get:function(){return!1},set:function(e){console.log("ERROR")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"owner",{get:function(){return null},set:function(e){console.log("ERROR")},enumerable:!1,configurable:!0}),n);function n(){e.System.canCreateScene&&!e.System.creatingScene||console.log("error"),e.System.creatingScene=!0}e.Scene=t}(Engine=Engine||{}),function(t){var n,e=(n=Engine.Scene,__extends(i,n),Object.defineProperty(i,"nextSceneClass",{get:function(){return i.instance.nextSceneClass},enumerable:!1,configurable:!0}),Object.defineProperty(i,"waiting",{get:function(){return i.instance.waiting},enumerable:!1,configurable:!0}),i.prototype.onReset=function(){this.nextSceneClass=null,this.waiting=!1,this.countStepsWait=0},i.prototype.onStepUpdate=function(){this.waiting?(this.countStepsWait+=1,this.countStepsWait>=this.stepsWait&&("reset"==this.nextSceneClass?Engine.System.requireReset():Engine.System.nextSceneClass=this.nextSceneClass,this.onEndWaiting())):!this.waiting&&null!=this.nextSceneClass&&t.SceneFade.filled&&(this.waiting=!0,this.onStartWaiting())},i.prototype.onStartWaiting=function(){},i.prototype.onEndWaiting=function(){},i);function i(){var e=n.call(this)||this;return e.countStepsWait=0,e.stepsWait=0,i.instance=e,t.SceneFreezer.init(),t.SceneFade.init(),t.SceneColors.init(),t.SceneColors.clearColor(0,0,0),t.SceneOrientator.init(),e}t.Scene=e}(Game=Game||{}),function(h){var f,g,n,e=(n=Engine.Entity,__extends(t,n),Object.defineProperty(t,"finished",{get:function(){return t.instance.finished},enumerable:!1,configurable:!0}),t.init=function(){t.instance=new t},t.prototype.initStates=function(){var e=this,t=new h.State(this),n=new h.State(this),i=new h.State(this),r=new h.State(this),o=new h.State(this),s=new h.State(this),a=new h.State(this),l=new h.State(this),u=new h.State(this),d=new h.State(this),c=new h.State(this);t.addLink(l,function(){return h.SKIP_CREDITS}),t.addLink(n,function(){return 60<=e.steps}),n.onEnter=function(){h.Resources.playBGM(),e.textNoadev.enabled=!0,h.triggerActions("zristenteringgame")},n.addLink(i,function(){return 200<=e.steps}),i.onEnter=function(){e.textNoadev.enabled=!1},i.addLink(r,function(){return 60<=e.steps}),r.onEnter=function(){e.textNieldacan.enabled=!0,e.textBehe.enabled=!0},r.addLink(o,function(){return 200<=e.steps}),o.onEnter=function(){e.textNieldacan.enabled=!1,e.textBehe.enabled=!1},o.addLink(s,function(){return 60<=e.steps}),s.onEnter=function(){e.textThanks.enabled=!0,e.textThanksVictor.enabled=!0,e.textThanksJair.enabled=!0,e.textThanksFredy.enabled=!0,e.textThanksReaper.enabled=!0,e.textThanksGross.enabled=!0,e.textThanksKaro.enabled=!0,e.textThanksCortex.enabled=!0,e.textThanksKalpar.enabled=!0,e.textThanksLau.enabled=!0,e.textThanksMark.enabled=!0,e.textThanksRodrigo.enabled=!0,e.textThanksNyto.enabled=!0,e.textThanksAriella.enabled=!0,e.textThanksFlojo.enabled=!0},s.addLink(a,function(){return 200<=e.steps}),a.onEnter=function(){e.textThanks.enabled=!1,e.textThanksVictor.enabled=!1,e.textThanksJair.enabled=!1,e.textThanksFredy.enabled=!1,e.textThanksReaper.enabled=!1,e.textThanksGross.enabled=!1,e.textThanksKaro.enabled=!1,e.textThanksCortex.enabled=!1,e.textThanksKalpar.enabled=!1,e.textThanksLau.enabled=!1,e.textThanksMark.enabled=!1,e.textThanksRodrigo.enabled=!1,e.textThanksNyto.enabled=!1,e.textThanksAriella.enabled=!1,e.textThanksFlojo.enabled=!1},a.addLink(l,function(){return 50<=e.steps}),l.onEnter=function(){h.SKIP_CREDITS&&h.Resources.playBGM(),e.textTitle.enabled=!0,e.textJump.enabled=!0,e.textSlide.enabled=!0,e.textStart.enabled=!0,f.enabled=!0,g.enabled=!0,h.textScore.enabled=!0,h.textHiScore.enabled=!0,h.LevelGraphics.canRender=!0},l.onStepUpdate=function(){e.updateTextStart(!1)},l.addLink(u,function(){return h.LevelControl.pressed}),u.onEnter=function(){e.countSteps=0,e.countStepsBlink=0,e.textStart.enabled=!1,h.Resources.sfxEvent.play(),h.triggerActions("playbutton")},u.onStepUpdate=function(){e.countSteps+=1,e.updateTextStart(!0)},u.addLink(d,function(){return 50<=e.countSteps}),d.onEnter=function(){e.textTitle.enabled=!1,e.textJump.enabled=!1,e.textSlide.enabled=!1,e.textStart.enabled=!1,f.enabled=!1,g.enabled=!1},d.onStepUpdate=function(){e.countSteps+=1},d.addLink(c,function(){return 20<=e.countSteps}),c.onEnter=function(){e.finished=!0};c=new h.StateMachine(this);c.anyState.onEnter=function(){e.steps=0},c.anyState.onStepUpdate=function(){e.steps+=1},c.startState=t},t.prototype.updateTextStart=function(e){this.countStepsBlink+=1,this.countStepsBlink>=(e?h.STEPS_BLINK_TEXT_PROCEED_FAST:h.STEPS_BLINK_TEXT_PROCEED_NORMAL)&&(this.textStart.enabled=!this.textStart.enabled,this.countStepsBlink=0)},t.prototype.onDrawDialogs=function(){f.render(),g.render()},t);function t(){var e=n.call(this)||this;e.countSteps=0,e.countStepsBlink=0,e.finished=!1,h.SceneFade.disable(),h.SceneFade.speed=1e6,e.textNoadev=h.SceneText.createMiddleText("CREATED BY: NOADEV",0,!1),e.textNieldacan=h.SceneText.createMiddleText("MUSIC BY: NIELDACAN",-5,!1),e.textBehe=h.SceneText.createMiddleText("THUMBNAIL BY: DEUS BEHEMOTH",5,!1);var t=.5*-Engine.Renderer.ySizeViewIdeal+42;return e.textThanks=h.SceneText.createMiddleText("SPECIAL THANKS:",t,!1,19),e.textThanksVictor=h.SceneText.createStartMiddleText("VICTOR CARDONA",-78,t,!1),e.textThanksJair=h.SceneText.createEndMiddleText("JAIR FRANCO",78,t,!1,12),e.textThanksFredy=h.SceneText.createStartMiddleText("FREDY ESPINOSA",-78,t,!1),e.textThanksRodrigo=h.SceneText.createEndMiddleText("RODRIGO PORRAS",78,t,!1,12),e.textThanksReaper=h.SceneText.createStartMiddleText("RE4PERX6",-78,t,!1),e.textThanksGross=h.SceneText.createEndMiddleText("GROSS STANDARDS",78,t,!1,12),e.textThanksKaro=h.SceneText.createStartMiddleText("KARODEV",-78,t,!1),e.textThanksCortex=h.SceneText.createEndMiddleText("CESAR CORTEX",78,t,!1,12),e.textThanksKalpar=h.SceneText.createStartMiddleText("KALPAR",-78,t,!1),e.textThanksLau=h.SceneText.createEndMiddleText("LAUTARO LUCARAS",78,t,!1,12),e.textThanksMark=h.SceneText.createStartMiddleText("MARK",-78,t,!1),e.textThanksFlojo=h.SceneText.createEndMiddleText("EL FLOJO",78,t,!1,12),e.textThanksNyto=h.SceneText.createStartMiddleText("NYTO",-78,t,!1),e.textThanksAriella=h.SceneText.createEndMiddleText("ARIELLA'S GHOST",78,t,!1,12),h.SceneText.yOffsetText=0,e.textTitle=h.SceneText.createMiddleText("ZRIST",-10,!1),e.textTitle.scale=3,e.textJump=h.SceneText.createMiddleText(h.STR_JUMP,15,!1),e.textSlide=h.SceneText.createMiddleText(h.STR_SLIDE,25,!1),e.textStart=h.SceneText.createMiddleText(h.STR_START,47,!1),(f=new Engine.Sprite).enabled=!1,f.pinned=!0,f.y=-25,i[1].applyToSprite(f),(g=new Engine.Sprite).enabled=!1,g.pinned=!0,g.y=6,i[2].applyToSprite(g),e.initStates(),h.triggerActions("zriststart"),e}h.LevelMenu=e;var i=null;h.addAction("init",function(){i=h.FrameSelector.complex("Level Menu",h.Resources.texture,513,1)})}(Game=Game||{}),function(t){t.STEPS_BLINK_TEXT_PROCEED_NORMAL=40,t.STEPS_BLINK_TEXT_PROCEED_FAST=4,t.SIZE_TILE=16;var n,e=(n=t.Scene,__extends(i,n),i.initStr=function(){t.SceneText.yOffsetText=0,t.STR_JUMP=t.IS_TOUCH?"TOUCH RIGHT TO JUMP":"X OR LEFT CLICK TO JUMP",t.STR_SLIDE=t.IS_TOUCH?"TOUCH LEFT TO SLIDE":"C OR RIGHT CLICK TO SLIDE",t.STR_START=t.IS_TOUCH?"TOUCH TO START":"PRESS X OR LEFT CLICK TO START",t.STR_CONTINUE=t.IS_TOUCH?"TOUCH TO CONTINUE":"PRESS X OR LEFT CLICK TO CONTINUE"},i);function i(){var e=n.call(this)||this;return i.initStr(),t.SoundButton.init(),t.PauseButton.init(),t.Player.init(),t.LevelControl.init(),t.LevelMenu.init(),t.LevelData.init(),t.LevelMaps.init(),t.LevelFlow.init(),t.LevelGraphics.init(),t.LevelFog.init(),t.LevelPhysics.init(),e}t.Level=e}(Game=Game||{}),function(u){var t,e=(t=Engine.Entity,__extends(d,t),Object.defineProperty(d.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this.setEnabled(e)},enumerable:!1,configurable:!0}),d.prototype.setEnabled=function(e){var t=this.enabled;(this._enabled=e)!=t&&(e?this.onEnable():(this._selected&&(this._selected=!1,null!=this._url&&Engine.LinkManager.remove(this,this._url),this.onSelectionEnd()),this.onDisable()))},Object.defineProperty(d.prototype,"selected",{get:function(){return this._selected},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"url",{get:function(){return this._url},set:function(e){null!=this._url&&Engine.LinkManager.remove(this,this._url),this._url=e,null!=this._url&&Engine.LinkManager.add(this,this._url)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"downSteps",{get:function(){return this._downSteps},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"stepsSincePressed",{get:function(){return this._stepsSincePressed},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"pressed",{get:function(){return 1==this._downSteps},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"down",{get:function(){return 0<this._downSteps},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"upSteps",{get:function(){return this._upSteps},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"stepsSinceReleased",{get:function(){return this._stepsSinceReleased},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"released",{get:function(){return 1==this._upSteps},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"up",{get:function(){return!this.down},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"touchDown",{get:function(){return this._touchDown},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"touchPressed",{get:function(){return this._touchDown&&this.pressed},enumerable:!1,configurable:!0}),d.prototype.onEnable=function(){null!=this.onEnableDelegate&&this.onEnableDelegate.call(this.listener)},d.prototype.onDisable=function(){null!=this.onDisableDelegate&&this.onDisableDelegate.call(this.listener)},d.prototype.onSelectionStart=function(){null!=this.audioSelected&&this.firstUpdate&&!this.touchSelected&&this.audioSelected.play(),null!=this.onSelectionStartDelegate&&this.onSelectionStartDelegate.call(this.listener)},d.prototype.onSelectionStay=function(){null!=this.onSelectionStayDelegate&&this.onSelectionStayDelegate.call(this.listener)},d.prototype.onSelectionEnd=function(){null!=this.onSelectionEndDelegate&&this.onSelectionEndDelegate.call(this.listener)},d.prototype.onPressed=function(){null!=this.audioPressed&&this.audioPressed.play(),null!=this.onPressedDelegate&&this.onPressedDelegate.call(this.listener)},d.prototype.onReleased=function(){null!=this.onReleasedDelegate&&this.onReleasedDelegate.call(this.listener)},d.prototype.onClearScene=function(){null!=this.url&&Engine.LinkManager.remove(this,this._url)},d.prototype.onControlPreUpdate=function(){d.selectionBlocker=null},d.prototype.onControlUpdate=function(){var e=this._selected;if(this.mouseSelected=!1,this.touchSelected=!1,this.enabled){this.mouseSelected=this.useMouse&&(null==this.bounds||this.bounds.mouseOver),this.touchSelected=this.useTouch&&(null==this.bounds||this.bounds.touched),(this.freezeable&&u.SceneFreezer.stoped||null!=d.selectionBlocker)&&(this.mouseSelected=!1,this.touchSelected=!1),this._selected||!this.mouseSelected&&!this.touchSelected?!this._selected||this.mouseSelected||this.touchSelected||(this._selected=!1,this.onSelectionEnd()):(this._selected=!0,this.onSelectionStart()),this._selected&&this.blockOthersSelection&&(d.selectionBlocker=this);var t=!1;if(this.mouseSelected&&null!=this.mouseButtons)for(var n=0,i=this.mouseButtons;n<i.length;n++){var r=i[n];if(t=this.newInteractionRequired&&0==this._downSteps?Engine.Mouse.pressed(r):Engine.Mouse.down(r))break}var o=!1;if(this.touchSelected&&(o=this.newInteractionRequired?null!=this.bounds?0==this._downSteps?this.bounds.pointed:this.bounds.touched:0==this._downSteps?Engine.TouchInput.pressed(0,0,Engine.Renderer.xSizeWindow,Engine.Renderer.ySizeWindow,!0):Engine.TouchInput.down(0,0,Engine.Renderer.xSizeWindow,Engine.Renderer.ySizeWindow,!0):null!=this.bounds?this.bounds.touched:Engine.TouchInput.down(0,0,Engine.Renderer.xSizeWindow,Engine.Renderer.ySizeWindow,!0),t=t||o),!t&&this.useKeyboard&&(!this.freezeable||!u.SceneFreezer.stoped))for(var s=0,a=this.keys;s<a.length;s++){var l=a[s];if(t=this.newInteractionRequired&&0==this._downSteps?Engine.Keyboard.pressed(l):Engine.Keyboard.down(l))break}t?(this._firstDown=!0,this._downSteps+=1,this._upSteps=0,this._touchDown=o,this.pressed&&(this._stepsSincePressed=0,this.onPressed())):this._firstDown&&(this._firstUp=!0,this._downSteps=0,this._upSteps+=1,this._touchDown=!1,this.released&&(this._stepsSinceReleased=0,this.onReleased())),this._firstDown&&(this._stepsSincePressed+=1),this._firstUp&&(this._stepsSinceReleased+=1)}this._selected&&e&&this.onSelectionStay(),this.firstUpdate=!0},d.selectionBlocker=null,d);function d(){var e=null!==t&&t.apply(this,arguments)||this;return e._enabled=!1,e._selected=!1,e._url=null,e.linkCondition=function(){return!0},e.onLinkTrigger=null,e.useMouse=!1,e.useKeyboard=!1,e.useTouch=!1,e.newInteractionRequired=!1,e.blockOthersSelection=!1,e.freezeable=!1,e._firstDown=!1,e._firstUp=!1,e.firstUpdate=!1,e._downSteps=0,e._stepsSincePressed=0,e._upSteps=0,e._stepsSinceReleased=0,e._touchDown=!1,e}u.Control=e}(Game=Game||{}),function(e){var t,n=(t=e.Control,__extends(i,t),Object.defineProperty(i,"pressed",{get:function(){return i.instance.pressed},enumerable:!1,configurable:!0}),i.init=function(){i.instance=new i},i);function i(){var e=t.call(this)||this;return e.enabled=!0,e.freezeable=!0,(e.listener=e).useKeyboard=!0,e.newInteractionRequired=!0,e.useMouse=!0,e.mouseButtons=[0],e.keys=[Engine.Keyboard.X],e.useTouch=!0,e}e.LevelControl=n}(Game=Game||{}),function(s){s.MAX_RULES=8,s.RULE_VOID=-1,s.RULE_NOTHING=0,s.RULE_FOG=1,s.RULE_SPEED_UP=2,s.RULE_INVISIBILITY=3,s.RULE_LAG=4,s.RULE_MEMORY=5,s.RULE_DOUBLE_JUMP=6,s.RULE_GRAVITY=7;var a=3,l=3,o=4,u=5,d=0,e=s.DIFICULTY_HARD=1;s.testRule=-1,s.testDifficulty=-1,s.testMap=-1;var c=0,t=0,h=0,f=0,n=0,g=0,p=0,E=0,x=0,r=new Int32Array(s.MAX_RULES),S=new Int32Array(o),y=new Int32Array(s.MAX_RULES*a),A=new Int32Array(s.MAX_RULES*l);function i(){for(var e=E=p=n=f=0;e<s.MAX_RULES;e+=1)r[e]=0;T(),b(),c=s.RULE_VOID}function T(){for(var e=E==d?y:A,t=E==d?a:l,n=[],i=0;i<u;i+=1){for(var r=!0,o=0;o<t;o+=1)if(e[p*t+o]==i){r=!1;break}r&&n.push(i)}x=0<=s.testMap?(h=s.testMap,g=s.testMap,s.testMap):(h=g,g=x,n[Math.floor(Math.random()*n.length)])}function b(){!function(){r[p]+=1;for(var e=o-1;0<e;--e)S[e]=S[e-1];S[0]=p;for(var t=E==d?y:A,n=E==d?a:l,i=n-1;0<i;--i)t[p*n+i]=t[p*n+i-1];t[p*n]=x}(),function(){for(var e=new Int32Array(s.MAX_RULES-1),t=0,n=1;n<s.MAX_RULES;n+=1){for(var i=!0,r=0;r<o;r+=1)if(S[r]==n){i=!1;break}i&&(e[(t+=1)-1]=n)}p=0<=s.testRule?(c=s.testRule,f=s.testRule,s.testRule):(c=f,f=p,e[Math.floor(Math.random()*t)])}(),E=0<=s.testDifficulty?(t=s.testDifficulty,n=s.testDifficulty,s.testDifficulty):(t=n,n=E,r[p]>=e?s.DIFICULTY_HARD:d),T()}var w,v=(w=Engine.Entity,__extends(m,w),Object.defineProperty(m,"previousRule",{get:function(){return c},enumerable:!1,configurable:!0}),Object.defineProperty(m,"previousDifficulty",{get:function(){return t},enumerable:!1,configurable:!0}),Object.defineProperty(m,"previousMap",{get:function(){return h},enumerable:!1,configurable:!0}),Object.defineProperty(m,"currentRule",{get:function(){return f},enumerable:!1,configurable:!0}),Object.defineProperty(m,"currentDifficulty",{get:function(){return n},enumerable:!1,configurable:!0}),Object.defineProperty(m,"currentMap",{get:function(){return g},enumerable:!1,configurable:!0}),Object.defineProperty(m,"futureRule",{get:function(){return p},enumerable:!1,configurable:!0}),Object.defineProperty(m,"futureDifficulty",{get:function(){return E},enumerable:!1,configurable:!0}),Object.defineProperty(m,"futureMap",{get:function(){return x},enumerable:!1,configurable:!0}),m.init=function(){!function(){for(var e=0;e<o;e+=1)S[e]=9;for(var t=0;t<s.MAX_RULES*a;t+=1)y[t]=9;for(t=0;t<s.MAX_RULES*l;t+=1)A[t]=9}(),i()},m.setFirstMap=function(){i()},m.setNextMap=function(){b()},m);function m(){return null!==w&&w.apply(this,arguments)||this}s.LevelData=v}(Game=Game||{}),function(t){var n,i,e,r,o,s,a,l,u,d,c,h,f,g,p,E,x,S,y,A,T,b,w,v,m,_,R,L,D,U="NONE",O="FOG",I="SPEED UP",M="MEMORY",P="EXTRA JUMP IN AIR",C="LAG",B="INVISIBLE",z="JUMP IN AIR TO SWITCH GRAVITY",V=0,N=0,k=t.screens=0,G=0,F=0,H=0,W=0,X=0;function j(){Engine.Data.save("hiScore",N,60),Engine.Data.save("hiScreens",k,60),t.triggerActions("savegame")}function Y(){L.xSize=Engine.Renderer.xSizeView,L.ySize=Engine.Renderer.ySizeView,L.x=.5*-Engine.Renderer.xSizeView,L.y=.5*-Engine.Renderer.ySizeViewIdeal}function K(){i=new t.State(n),e=new t.State(n),r=new t.State(n),o=new t.State(n),s=new t.State(n),a=new t.State(n),l=new t.State(n),u=new t.State(n),d=new t.State(n),c=new t.State(n),h=new t.State(n),f=new t.State(n),g=new t.State(n),i.addLink(e,function(){return t.LevelMenu.finished}),e.onEnter=function(){t.PauseButton.enabled=!0,p.oldState==i&&t.triggerActions("play"),p.oldState!=i&&p.oldState!=g||t.triggerActions("zriststartplay")},e.onStepUpdate=function(){V!=t.Player.score&&(V=t.Player.score,t.textScore.str="SCORE: "+t.Player.score,N<V&&(N=V,t.textHiScore.str="HI: "+N))},e.onExit=function(){t.PauseButton.enabled=p.nextState==c},e.addLink(h,function(){return t.Player.dead}),e.addLink(r,function(){return t.Player.physicsCursor>=t.MAP_WIDTH*t.SIZE_TILE}),e.addLink(c,function(){return t.PauseButton.pressed}),c.onEnter=function(){D.enabled=!0,L.enabled=!0,w.enabled=!0},c.onStepUpdate=function(){},c.onExit=function(){D.enabled=!1,L.enabled=!1,w.enabled=!1},c.addLink(e,function(){return t.PauseButton.pressed}),r.onEnter=function(){},r.onStepUpdate=function(){},r.addLink(o,function(){return!0}),o.onEnter=function(){G=0,t.LevelData.setNextMap(),function(){switch(t.LevelData.currentRule){case t.RULE_FOG:x.str=O;break;case t.RULE_SPEED_UP:x.str=I;break;case t.RULE_MEMORY:x.str=M;break;case t.RULE_DOUBLE_JUMP:x.str=P;break;case t.RULE_LAG:x.str=C;break;case t.RULE_INVISIBILITY:x.str=B;break;case t.RULE_GRAVITY:x.str=z;break;default:x.str=U}}(),E.enabled=!0,y.enabled=!0,t.Resources.sfxEvent.play(),t.screens+=1,t.screens>k&&(k=t.screens),j(),t.LevelData.currentRule!=t.RULE_GRAVITY&&t.triggerActions("zriststopplay")},o.onStepUpdate=function(){G+=1},o.addLink(s,function(){return 40<=G}),s.onEnter=function(){G=0,t.triggerActions("lose"),x.enabled=!0},s.onStepUpdate=function(){G+=1},s.addLink(a,function(){return 50<=G}),a.onEnter=function(){S.enabled=!0,F=0},a.onStepUpdate=function(){(F+=1)>=t.STEPS_BLINK_TEXT_PROCEED_NORMAL&&(S.enabled=!S.enabled,F=0)},a.onExit=function(){E.enabled=!1,x.enabled=!1,S.enabled=!1,y.enabled=!1,t.triggerActions("playlevelbutton"),t.triggerActions("zriststartplay")},a.addLink(l,function(){return t.LevelData.currentRule==t.RULE_MEMORY&&t.LevelControl.pressed}),a.addLink(e,function(){return t.LevelControl.pressed}),l.onEnter=function(){H=0},l.onStepUpdate=function(){H+=8},l.addLink(u,function(){return q.cursor>=q.maxCursor}),u.onEnter=function(){G=0},u.onStepUpdate=function(){G+=1},u.addLink(d,function(){return 60<=G}),d.onEnter=function(){H=0},d.onStepUpdate=function(){H-=16},d.addLink(e,function(){return q.cursor<=q.defaultCursor}),h.onEnter=function(){G=0,j()},h.onStepUpdate=function(){20<(G+=1)&&(G=20)},h.addLink(f,function(){return 20<=G}),f.onEnter=function(){v.enabled=!0,A.enabled=!0,F=0,t.triggerActions("lose"),t.LevelData.currentRule!=t.RULE_GRAVITY&&t.triggerActions("zriststopplay")},f.onStepUpdate=function(){(F+=1)>=t.STEPS_BLINK_TEXT_PROCEED_NORMAL&&(m.enabled=!m.enabled,F=0)},f.addLink(g,function(){return t.LevelControl.pressed}),g.onEnter=function(){v.enabled=!1,m.enabled=!1,A.enabled=!1},g.onStepUpdate=function(){},g.onExit=function(){V=0,t.screens=0,t.LevelData.setFirstMap(),t.triggerActions("resetlevelbutton")},g.addLink(e,function(){return!0}),(p=new t.StateMachine(n)).startState=i}var J,q=(J=Engine.Entity,__extends(Z,J),Object.defineProperty(Z,"cursor",{get:function(){var e=0;switch(p.currentState){case l:e=Z.defaultCursor+H+8*Engine.System.stepExtrapolation,Z.maxCursor<e&&(e=Z.maxCursor);break;case u:e=Z.maxCursor;break;case d:(e=Z.maxCursor+H-16*Engine.System.stepExtrapolation)<Z.defaultCursor&&(e=Z.defaultCursor);break;default:e=Z.defaultCursor}return e},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"defaultCursor",{get:function(){return t.Player.cursor-Engine.Renderer.xSizeView/6},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"maxCursor",{get:function(){return t.MAP_WIDTH*t.SIZE_TILE-Engine.Renderer.xSizeView},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"freezed",{get:function(){var e=p.currentState==i;return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e||p.currentState==r)||p.currentState==o)||p.currentState==s)||p.currentState==a)||p.currentState==l)||p.currentState==c)||p.currentState==u)||p.currentState==d)||p.currentState==h)||p.currentState==f)||p.currentState==g},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"backtracking",{get:function(){return p.currentState==r},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"reseting",{get:function(){return p.currentState==g},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"playing",{get:function(){return p.currentState==e},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"lagged",{get:function(){return t.LevelData.currentRule==t.RULE_LAG},enumerable:!1,configurable:!0}),Object.defineProperty(Z,"paused",{get:function(){return p.currentState==c},enumerable:!1,configurable:!0}),Z.init=function(){var e;n=new Z,e=Engine.Data.load("hiScore"),N=null==e?0:+e,e=Engine.Data.load("hiScreens"),k=null==e?0:+e,t.triggerActions("loadgame"),E=t.SceneText.createMiddleText("NEXT RULE:",-10,!1),x=t.SceneText.createMiddleText(U,10,!1),S=t.SceneText.createMiddleText(t.STR_CONTINUE,35,!1),(v=t.SceneText.createMiddleText("GAME OVER",-5,!1)).scale=3,m=t.SceneText.createMiddleText(t.STR_CONTINUE,35,!1),t.textScore=t.SceneText.createMiddleStartText("SCORE: 0",1,!1),t.textHiScore=t.SceneText.createMiddleStartText("HI: "+N,8,!1),_=t.SceneText.createMiddleText(t.STR_JUMP,-6,!1),R=t.SceneText.createMiddleText(t.STR_SLIDE,6,!1),(y=new Engine.Sprite).pinned=!0,y.y=-20,Q[0].applyToSprite(y),(A=new Engine.Sprite).pinned=!0,A.y=-20,Q[0].applyToSprite(A),(T=new Engine.Sprite).pinned=!0,T.y=3,$[0].applyToSprite(T),(b=new Engine.Sprite).pinned=!0,b.y=-2,b.yMirror=!0,$[0].applyToSprite(b),D=t.SceneText.createMiddleText("PAUSED",0,!1),(L=new Engine.Sprite).setRGBA(0,0,0,.5),L.enabled=!1,L.pinned=!0,Y(),(w=new Engine.Sprite).pinned=!0,w.y=0,ee[0].applyToSprite(w),K()},Z.prototype.onViewUpdate=function(){Y()},Z.prototype.onTimeUpdate=function(){p.currentState==e?(W==t.Player.physicsCursor?X+=Engine.System.deltaTime:(W=t.Player.physicsCursor,X=0),4<=X?_.enabled||(_.enabled=!0,R.enabled=!0,T.enabled=!0,b.enabled=!0):_.enabled&&(_.enabled=!1,R.enabled=!1,T.enabled=!1,b.enabled=!1)):(X=0,W=-100,_.enabled&&(_.enabled=!1,R.enabled=!1,T.enabled=!1,b.enabled=!1))},Z.prototype.onDrawPause=function(){L.render()},Z.prototype.onDrawDialogs=function(){y.render(),A.render(),T.render(),b.render(),w.render()},Z);function Z(){return J.call(this)||this}t.LevelFlow=q;var Q=null,$=null,ee=null;t.addAction("init",function(){Q=t.FrameSelector.complex("levelFlow a",t.Resources.texture,513,1),$=t.FrameSelector.complex("levelFlow b",t.Resources.texture,379,50),ee=t.FrameSelector.complex("levelFlow c",t.Resources.texture,1,33)})}(Game=Game||{}),function(s){var n,e,a=[],l=0,t=(e=Engine.Entity,__extends(i,e),i.init=function(){new i,n=+s.SIZE_TILE;for(var e=0;e<6;e+=1){var t=new Engine.Sprite;t.x=n+s.SIZE_TILE*e,t.y=0,t.ySize=Engine.Renderer.ySizeViewIdeal,a.push(t)}i.fix()},i.fix=function(){for(var e=0;e<a.length;e+=1)a[e].xSize=Engine.Renderer.xSizeView},i.prototype.onViewUpdate=function(){i.fix()},i.prototype.onTimeUpdate=function(){if(s.LevelData.currentRule==s.RULE_FOG?.45<(l+=+Engine.System.deltaTime)&&(l=.45):(s.LevelData.currentRule==s.RULE_NOTHING||(l-=+Engine.System.deltaTime)<=0)&&(l=0),0<l)for(var e=s.Player.cursor+8*s.SIZE_TILE,t=0,n=a;t<n.length;t++)(i=n[t]).x=e,e+=s.SIZE_TILE,i.enabled=!0,i.setRGBA(0,0,0,l);else for(var i,r=0,o=a;r<o.length;r++)(i=o[r]).enabled=!1},i.prototype.onDrawFog=function(){for(var e=0,t=a;e<t.length;e++)t[e].render()},i);function i(){return null!==e&&e.apply(this,arguments)||this}s.LevelFog=t}(Game=Game||{}),function(s){var a=11,l=0,u=[];function t(){u=[],s.boxesTiles=[],l=Math.ceil(Engine.Renderer.xSizeView/s.SIZE_TILE)+2;for(var e=u.length;e<l*a;e+=1){var t=new Engine.Sprite;u.push(t);t=new Engine.Box;t.renderable=!0,t.xSize=s.SIZE_TILE,t.ySize=s.SIZE_TILE,s.boxesTiles.push(t)}}function e(){var e=s.LevelFlow.cursor/s.SIZE_TILE;e<0&&--e;for(var t=0;t<l;t+=1)for(var n=0;n<a;n+=1){var i=s.LevelMaps.getTile(e+t,n),r=u[t*a+n],o=s.boxesTiles[t*a+n];null!=i?(r.enabled=!0,r.x=i.x,r.y=i.y,o.enabled=!0,o.x=i.x,o.y=i.y,o.data=i.value,i.value==s.VALUE_TILE_BLUE?(d[0].applyToSprite(r),o.ySize=s.SIZE_TILE):i.value==s.VALUE_TILE_BLUE_HALF?(d[2].applyToSprite(r),o.ySize=8):i.value==s.VALUE_TILE_RED?(d[1].applyToSprite(r),o.ySize=s.SIZE_TILE):i.value==s.VALUE_TILE_RED_HALF?(d[3].applyToSprite(r),o.ySize=8):i.value==s.VALUE_TILE_BLUE_HALF_B?(d[2].applyToSprite(r),r.y+=8,o.y+=8,o.ySize=8):i.value==s.VALUE_TILE_RED_HALF_B&&(d[3].applyToSprite(r),r.y+=8,o.y+=8,o.ySize=8),(o.x<s.Player.physicsCursor-s.SIZE_TILE||o.x>s.Player.physicsCursor+2*s.SIZE_TILE||o.y<s.Player.physicsCursorY-3*s.SIZE_TILE||o.y>s.Player.physicsCursorY+3*s.SIZE_TILE)&&(o.enabled=!1)):(r.enabled=!1,o.enabled=!1)}}s.boxesTiles=[];var n,i=(n=Engine.Entity,__extends(r,n),r.init=function(){new r},r.prototype.onViewUpdate=function(){t()},r.prototype.onMapUpdate=function(){e()},r.prototype.onMapConfigureTimeUpdate=function(){e(),Engine.Renderer.camera(s.LevelFlow.cursor+.5*Engine.Renderer.xSizeView,.5*Engine.Renderer.ySizeViewIdeal)},r.prototype.onDrawSceneMap=function(){r.canRender&&function(){for(var e=0,t=u;e<t.length;e++)t[e].render();if(Engine.Box.debugRender)for(var n=0,i=s.boxesTiles;n<i.length;n++)i[n].render()}()},r.canRender=!1,r);function r(){var e=n.call(this)||this;return t(),e}s.LevelGraphics=i;var d=null;s.addAction("init",function(){d=s.FrameSelector.complex("scene",s.Resources.texture,251,1)})}(Game=Game||{}),function(r){r.VALUE_TILE_NONE=0,r.VALUE_TILE_BLUE=1,r.VALUE_TILE_BLUE_HALF=2,r.VALUE_TILE_RED=3,r.VALUE_TILE_RED_HALF=4,r.VALUE_TILE_BLUE_HALF_B=5,r.VALUE_TILE_RED_HALF_B=6,r.MAP_WIDTH=200,r.MAP_HEIGHT=11;var i=0,o=0,e={r:0,g:0,b:0,a:0},n={r:0,g:0,b:0,a:0},s={r:0,g:0,b:0,a:0},a={r:0,g:0,b:0,a:0},l={r:0,g:0,b:0,a:0},u=[];function d(e,t,n){var i={};return i.r=r.Resources.texture.getRed(e,t),i.g=r.Resources.texture.getGreen(e,t),i.b=r.Resources.texture.getBlue(e,t),i.r==n.r&&i.g==n.g&&i.b==n.b}function c(e,t,n){e!=r.RULE_NOTHING&&(o+=(2*e-1)*r.MAP_HEIGHT,t==r.DIFICULTY_HARD&&(o+=r.MAP_HEIGHT)),i+=n*r.MAP_WIDTH}var t=null,h=null;r.addAction("init",function(){t=r.FrameSelector.complex("LevelMaps a",r.Resources.texture,251,1),h=r.FrameSelector.complex("LevelMaps b",r.Resources.texture,1,79)});var f=(g.init=function(){e.r=r.Resources.texture.getRed(t[4].xTexture,t[4].yTexture),e.g=r.Resources.texture.getGreen(t[4].xTexture,t[4].yTexture),e.b=r.Resources.texture.getBlue(t[4].xTexture,t[4].yTexture),e.a=r.Resources.texture.getAlpha(t[4].xTexture,t[4].yTexture),n.r=r.Resources.texture.getRed(t[5].xTexture,t[5].yTexture),n.g=r.Resources.texture.getGreen(t[5].xTexture,t[5].yTexture),n.b=r.Resources.texture.getBlue(t[5].xTexture,t[5].yTexture),n.a=r.Resources.texture.getAlpha(t[5].xTexture,t[5].yTexture),s.r=r.Resources.texture.getRed(t[6].xTexture,t[6].yTexture),s.g=r.Resources.texture.getGreen(t[6].xTexture,t[6].yTexture),s.b=r.Resources.texture.getBlue(t[6].xTexture,t[6].yTexture),s.a=r.Resources.texture.getAlpha(t[6].xTexture,t[6].yTexture),a.r=r.Resources.texture.getRed(t[7].xTexture,t[7].yTexture),a.g=r.Resources.texture.getGreen(t[7].xTexture,t[7].yTexture),a.b=r.Resources.texture.getBlue(t[7].xTexture,t[7].yTexture),a.a=r.Resources.texture.getAlpha(t[7].xTexture,t[7].yTexture),l.r=r.Resources.texture.getRed(t[8].xTexture,t[8].yTexture),l.g=r.Resources.texture.getGreen(t[8].xTexture,t[8].yTexture),l.b=r.Resources.texture.getBlue(t[8].xTexture,t[8].yTexture),l.a=r.Resources.texture.getAlpha(t[8].xTexture,t[8].yTexture),function(){for(var e=0;e<h[0].xSize;e+=1){u[e]=[];for(var t=0;t<h[0].ySize;t+=1)d(e+h[0].xTexture,t+h[0].yTexture,n)?u[e][t]=r.VALUE_TILE_BLUE:d(e+h[0].xTexture,t+h[0].yTexture,s)?u[e][t]=r.VALUE_TILE_RED:d(e+h[0].xTexture,t+h[0].yTexture,a)?d(e+h[0].xTexture,t-1+h[0].yTexture,n)?u[e][t]=r.VALUE_TILE_BLUE_HALF:u[e][t]=r.VALUE_TILE_RED_HALF:d(e+h[0].xTexture,t+h[0].yTexture,l)?d(e+h[0].xTexture,t+1+h[0].yTexture,n)?u[e][t]=r.VALUE_TILE_BLUE_HALF_B:u[e][t]=r.VALUE_TILE_RED_HALF_B:u[e][t]=r.VALUE_TILE_NONE}}()},g.getTile=function(e,t){return n=e,e=t,(t={value:0,x:0,y:0}).x=Math.floor(n)*r.SIZE_TILE,t.y=e*r.SIZE_TILE,t.y>=Engine.Renderer.ySizeViewIdeal*r.SIZE_TILE||t.y<=-r.SIZE_TILE?null:(i=n,o=e,r.LevelData.previousRule==r.RULE_VOID&&n<0||n>=2*r.MAP_WIDTH?o==r.MAP_HEIGHT-1?t.value=r.VALUE_TILE_BLUE:t.value=r.VALUE_TILE_NONE:(n<0?(i+=r.MAP_WIDTH,c(r.LevelData.previousRule,r.LevelData.previousDifficulty,r.LevelData.previousMap)):n>=r.MAP_WIDTH?(i-=r.MAP_WIDTH,c(r.LevelData.futureRule,r.LevelData.futureDifficulty,r.LevelData.futureMap)):c(r.LevelData.currentRule,r.LevelData.currentDifficulty,r.LevelData.currentMap),t.value=u[Math.floor(i)][o]),t.value!=r.VALUE_TILE_NONE?t:null);var n},g);function g(){}r.LevelMaps=f}(Game=Game||{}),function(e){var t,n=(t=Engine.Entity,__extends(i,t),i.init=function(){},i);function i(){return null!==t&&t.apply(this,arguments)||this}e.LevelPhysics=n}(Game=Game||{}),function(s){var t,e=(t=s.Scene,__extends(a,t),a.prototype.initStates=function(){var e=this,t=new s.State(this),n=new s.State(this),i=new s.State(this),r=new s.State(this),o=new s.State(this);t.onStepUpdate=function(){e.count+=1,20==e.count&&(e.count=0,"LOADING   "==e.text.str?e.text.str="LOADING.  ":"LOADING.  "==e.text.str?e.text.str="LOADING.. ":"LOADING.. "==e.text.str?e.text.str="LOADING...":"LOADING..."==e.text.str&&(e.text.str="LOADING   "))},t.addLink(i,function(){return s.DIRECT_PRELOADER&&Engine.Assets.downloadComplete&&e.bar.full}),t.addLink(n,function(){return Engine.Assets.downloadComplete&&e.bar.full}),n.onEnter=function(){e.count=0,e.text.str="PRESS TO CONTINUE",e.text.xAligned=-40},n.onStepUpdate=function(){e.count+=1,40==e.count&&(e.count=0,e.text.enabled=!e.text.enabled)},n.addLink(i,function(){return e.control.pressed}),i.onEnter=function(){s.DIRECT_PRELOADER&&(e.text.str="LOAD COMPLETE!",e.text.xAligned=-33),s.HAS_STARTED=!0,s.IS_TOUCH=s.FORCE_TOUCH||e.control.touchPressed,e.text.enabled=!0,s.SceneFade.trigger(),s.triggerActions("postinit")},i.addLink(r,function(){return s.SceneFade.filled&&a.canFinish}),r.onEnter=function(){e.count=0},r.onStepUpdate=function(){e.count+=1},r.addLink(o,function(){return 120<=e.count}),o.onEnter=function(){Engine.System.nextSceneClass=s.PreloadEnd},new s.StateMachine(this).startState=t},a.canFinish=!0,a);function a(){var e=t.call(this)||this;return e.count=0,s.SceneFade.speed=.0166666666666667,e.text=new Utils.Text,e.text.font=s.FontManager.a,e.text.scale=1,e.text.enabled=!0,e.text.pinned=!0,e.text.str="LOADING   ",e.text.xAlignBounds=Utils.AnchorAlignment.START,e.text.xAlignView=Utils.AnchorAlignment.MIDDLE,e.text.yAlignBounds=Utils.AnchorAlignment.START,e.text.yAlignView=Utils.AnchorAlignment.MIDDLE,e.text.xAligned=-20.5,e.text.yAligned=-9,e.text.front=!1,e.control=new s.Control,e.control.enabled=!0,e.control.freezeable=!0,e.control.newInteractionRequired=!0,e.control.useMouse=!0,e.control.mouseButtons=[0],e.control.useTouch=!0,e.bar=new s.PreloaderBar(0),s.SceneColors.clearColor(0,0,0),e.initStates(),s.triggerActions("preloader"),e}s.Preloader=e}(Game=Game||{}),function(t){t.MAX=.3,t.LOAD_VELOCITY=1;var n,e=(n=Engine.Entity,__extends(i,n),Object.defineProperty(i.prototype,"full",{get:function(){return 0==this.fill.xSize},enumerable:!1,configurable:!0}),i.prototype.onStepUpdate=function(){var e=t.MAX;e<Engine.Assets.downloadedRatio&&(e=Engine.Assets.downloadedRatio),e*=this.loadSize,this.loadCount+=t.LOAD_VELOCITY,this.loadCount>e&&(this.loadCount=e),this.fill.xSize=this.loadSize-Math.floor(this.loadCount)},i.prototype.onDrawDialogs=function(){this.fill.render(),this.border.render()},i);function i(e){var t=n.call(this)||this;return t.loadCount=0,t.border=new Engine.Sprite,t.border.enabled=!0,t.border.pinned=!0,r[0].applyToSprite(t.border),t.anchorBorder=new Utils.Anchor,t.anchorBorder.bounds=t.border,t.anchorBorder.xAlignBounds=Utils.AnchorAlignment.MIDDLE,t.anchorBorder.xAlignView=Utils.AnchorAlignment.MIDDLE,t.anchorBorder.yAlignBounds=Utils.AnchorAlignment.START,t.anchorBorder.yAlignView=Utils.AnchorAlignment.MIDDLE,t.anchorBorder.xAligned=0,t.anchorBorder.yAligned=e,t.fill=new Engine.Sprite,t.fill.enabled=!0,t.fill.pinned=!0,r[1].applyToSprite(t.fill),t.fill.xMirror=!0,t.anchorFill=new Utils.Anchor,t.anchorFill.bounds=t.fill,t.anchorFill.xAlignBounds=Utils.AnchorAlignment.START,t.anchorFill.xAlignView=Utils.AnchorAlignment.MIDDLE,t.anchorFill.yAlignBounds=Utils.AnchorAlignment.START,t.anchorFill.yAlignView=Utils.AnchorAlignment.MIDDLE,t.anchorFill.xAligned=.5*t.fill.xSize,t.anchorFill.yAligned=e,t.loadSize=t.border.xSize,t}t.PreloaderBar=e;var r=null;t.addAction("init",function(){r=t.FrameSelector.complex("PreloaderBar",t.Resources.texture,1,1)})}(Game=Game||{}),function(t){var n,e=(n=Engine.Scene,__extends(i,n),i.prototype.onStepUpdate=function(){Engine.Assets.downloadComplete&&(Engine.System.nextSceneClass=o)},i);function i(){var e=n.call(this)||this;return t.triggerActions("pathconfigure"),t.forEachPath("preload",function(e){Engine.Assets.queue(e)}),Engine.Assets.download(),e}t.PreloadStart=e;var r,o=(r=Engine.Scene,__extends(s,r),s);function s(){var e=r.call(this)||this;return t.triggerActions("preinit"),t.triggerActions("init"),t.forEachPath("load",function(e){Engine.Assets.queue(e)}),Engine.Assets.download(),Engine.System.nextSceneClass=t.SKIP_PRELOADER?l:t.Preloader,e}t.PreloadMiddle=o;var a,l=(a=t.Scene,__extends(u,a),u.prototype.onStepUpdate=function(){Engine.Assets.downloadComplete&&(Engine.System.nextSceneClass=c)},u);function u(){var e=a.call(this)||this;return t.SceneFade.speed=16.6666666666667,t.SceneColors.clearColor(0,0,0),t.triggerActions("preloader"),t.IS_TOUCH=t.FORCE_TOUCH,t.triggerActions("postinit"),e}t.SimplePreloader=l;var d,c=(d=Engine.Scene,__extends(h,d),h);function h(){var e=d.call(this)||this;return t.triggerActions("configure"),t.triggerActions("prepare"),t.triggerActions("start"),Engine.System.nextSceneClass=t.startingSceneClass,e}t.PreloadEnd=c}(Game=Game||{}),Engine.System.nextSceneClass=Game.PreloadStart,function(t){var n,e=(n=Engine.Entity,__extends(i,n),Object.defineProperty(i.prototype,"font",{set:function(e){this.arrowLeft.font=e,this.arrowRight.font=e},enumerable:!1,configurable:!0}),i.prototype.onTimeUpdate=function(){this.arrowLeft.enabled=!1,this.arrowRight.enabled=!1,this.control.selected&&(this.arrowLeft.enabled=this.enabled&&this.bounds.enabled,this.arrowRight.enabled=this.enabled&&this.bounds.enabled,this.arrowLeft.pinned=this.bounds.pinned,this.arrowRight.pinned=this.bounds.pinned,this.arrowLeft.xAligned=this.bounds.x-this.arrowLeft.font.xOffset-this.xOffset,this.arrowLeft.yAligned=this.bounds.y+this.yOffset,this.arrowRight.xAligned=this.bounds.x+this.bounds.xSize*this.bounds.xScale+this.arrowLeft.font.xOffset+this.xOffset,this.arrowRight.yAligned=this.bounds.y+this.yOffset)},i);function i(){var e=n.call(this)||this;return e.enabled=!0,e.xOffset=0,e.yOffset=0,e.arrowLeft=new Utils.Text,(e.arrowLeft.owner=e).arrowLeft.str=">",e.arrowLeft.font=t.FontManager.a,e.arrowLeft.xAlignView=Utils.AnchorAlignment.MIDDLE,e.arrowLeft.yAlignView=Utils.AnchorAlignment.MIDDLE,e.arrowLeft.xAlignBounds=Utils.AnchorAlignment.END,e.arrowLeft.yAlignBounds=Utils.AnchorAlignment.START,e.arrowRight=new Utils.Text,(e.arrowRight.owner=e).arrowRight.str="<",e.arrowRight.font=t.FontManager.a,e.arrowRight.xAlignView=Utils.AnchorAlignment.MIDDLE,e.arrowRight.yAlignView=Utils.AnchorAlignment.MIDDLE,e.arrowRight.xAlignBounds=Utils.AnchorAlignment.START,e.arrowRight.yAlignBounds=Utils.AnchorAlignment.START,e}t.Arrows=e}(Game=Game||{}),function(e){var t=(n.prototype.setFull=function(e,t,n,i){return this.texture=e,this.frames=Game.FrameSelector.complex("font",e,t,n),this.xOffset=i,this.ySize=this.frames[0].ySize,this},n);function n(){this.ySize=0,this.xOffset=0}e.Font=t}(Utils=Utils||{}),function(e){var t=(n.createFonts=function(){(n.a=new Utils.Font).setFull(e.Resources.texture,95,1,-1)},n);function n(){}e.FontManager=t,e.addAction("init",function(){t.createFonts()})}(Game=Game||{}),function(d){var x=0,c=null,h=null;d.DEBUG_FRAME_SELECTOR=!1,d.DEBUG_FRAME_SELECTOR&&d.addAction("start",function(){console.log(c),console.log(JSON.stringify(c))});var e=(t.complex=function(e,t,n,i,r,o){if(void 0===r&&(r=new Array),void 0===o&&(o=0),d.DEBUG_FRAME_SELECTOR){null==c&&(console.error("DEBUG_FRAME_SELECTOR ONLY FOR TESTING"),c={}),console.log(e),x=o;o=r.length;!function e(t,n,i,r){var o=y(n,i,r);var s=A(n,i,r);var a=i+2;var l=r+2;for(;a<o-3;){var u=new Utils.AnimationFrame;t.push(u),a=g(u,n,a,l)+1}var r={};T(r,n,i,s);b(r,f)&&e(t,n,i,s-1)}(r,t,n,i);for(var s={},a=0,l=o;l<r.length;l+=1)s[a+""]=r[l].getGeneric(),a+=1;c[t.path+" "+n+" "+i]=s}else{null==h&&(h=JSON.parse(Engine.Assets.loadText(d.Resources.PATH_FRAMES)));for(var a=0,u=h[t.path+" "+n+" "+i][a+""];null!=u&&null!=u;)r.push(new Utils.AnimationFrame(t,u.xTexture,u.yTexture,u.xSize,u.ySize,u.xOffset,u.yOffset,null,u.hasBox,u.xSizeBox,u.ySizeBox,u.xOffsetBox,u.yOffsetBox)),a+=1,u=h[t.path+" "+n+" "+i][a+""]}return r},t);function t(){}d.FrameSelector=e;var f={r:0,g:0,b:0,a:255},S={r:255,g:255,b:255,a:255};function g(e,t,n,i){for(var r=y(t,n,i),o=A(t,n,i),s={},a=0,l=0,u=0,d=0,c=n+1;c<r-1;c+=1)T(s,t,c,i),b(s,S)&&(0==u&&(u=c),d=c+1),T(s,t,c,o-1),b(s,S)&&(0==a&&(a=c),l=c+1);for(var h=0,f=0,g=0,p=0,E=i+1;E<o-1;E+=1)T(s,t,n,E),b(s,S)&&(0==g&&(g=E),p=E+1),T(s,t,r-1,E),b(s,S)&&(0==h&&(h=E),f=E+1);return e.texture=t,e.xSize=r-2-(n+2)-2*x,e.ySize=o-2-(i+2)-2*x,e.xTexture=n+2+x,e.yTexture=i+2+x,0<a&&(e.xOffset=e.xTexture-a-.5*(l-a)),0<h&&(e.yOffset=e.yTexture-h-.5*(f-h)),0<u?(e.hasBox=!0,e.xSizeBox=d-u,0<a&&(e.xOffsetBox=u-a-.5*(l-a))):0<g&&(e.hasBox=!0,e.xSizeBox=e.xSize,0<a&&(e.xOffsetBox=e.xTexture-a-.5*(l-a))),0<g?(e.hasBox=!0,e.ySizeBox=p-g,0<h&&(e.yOffsetBox=g-h-.5*(f-h))):0<u&&(e.hasBox=!0,e.ySizeBox=e.ySize,0<h&&(e.yOffsetBox=e.yTexture-h-.5*(f-h))),r}function y(e,t,n){var i={};for(n+=1;T(i,e,t+=1,n),!b(i,f)&&!b(i,S););return t+1}function A(e,t,n){var i={};for(t+=1;T(i,e,t,n+=1),!b(i,f)&&!b(i,S););return n+1}function T(e,t,n,i){e.r=t.getRed(n,i),e.g=t.getGreen(n,i),e.b=t.getBlue(n,i),e.a=t.getAlpha(n,i)}function b(e,t){return e.r==t.r&&e.g==t.g&&e.b==t.b&&e.a==t.a}}(Game=Game||{}),function(e){var t,n,i,r,o,s,a,l;e.PATH_ROOT_RESOURCES="",e.addAction("pathconfigure",function(){t=e.PATH_ROOT_RESOURCES+"https://137205836-418472038857163927.preview.editmysite.com/uploads/b/146211889-771688149676829714/files/Assets/Audio/Theme.omw",n=e.PATH_ROOT_RESOURCES+"https://137205836-418472038857163927.preview.editmysite.com/uploads/b/146211889-771688149676829714/files/Assets/Audio/Event.wom",i=e.PATH_ROOT_RESOURCES+"https://137205836-418472038857163927.preview.editmysite.com/uploads/b/146211889-771688149676829714/files/Assets/Audio/Slide.wom",r=e.PATH_ROOT_RESOURCES+"https://137205836-418472038857163927.preview.editmysite.com/uploads/b/146211889-771688149676829714/files/Assets/Audio/Dead.wom",o=e.PATH_ROOT_RESOURCES+"https://137205836-418472038857163927.preview.editmysite.com/uploads/b/146211889-771688149676829714/files/Assets/Audio/Jump.wom",s=e.PATH_ROOT_RESOURCES+"https://137205836-418472038857163927.preview.editmysite.com/uploads/b/146211889-771688149676829714/files/Assets/Audio/GravityJump.wom",a=e.PATH_ROOT_RESOURCES+"https://137205836-418472038857163927.preview.editmysite.com/uploads/b/146211889-771688149676829714/files/Assets/Graphics/Main.png",l=e.PATH_ROOT_RESOURCES+"https://137205836-418472038857163927.preview.editmysite.com/uploads/b/146211889-771688149676829714/files/Assets/Graphics/google-play-badge.png",e.addPath("preload",u.PATH_FRAMES),e.addPath("preload",a),e.addPath("load",t),e.addPath("load",n),e.addPath("load",i),e.addPath("load",r),e.addPath("load",o),e.addPath("load",s)});var u=(d.playBGM=function(){d.bgmPlayed||(d.bgm.autoplay(),d.bgmPlayed=!0)},d.PATH_FRAMES="https://137205836-418472038857163927.preview.editmysite.com/uploads/b/146211889-771688149676829714/files/Assets/Graphics/frames.json",d.bgmPlayed=!1,d.bgmVolumeTracker=1,d);function d(){}e.Resources=u,e.addAction("preinit",function(){u.texture=new Engine.Texture(a,!0,!1),u.texture.preserved=!0,e.HAS_LINKS&&e.HAS_GOOGLE_PLAY_LOGOS&&e.addPath("load",l)}),e.addAction("configure",function(){e.HAS_LINKS&&e.HAS_GOOGLE_PLAY_LOGOS&&(u.textureGooglePlay=new Engine.Texture(l,!1,!0),u.textureGooglePlay.preserved=!0),u.bgm=new Engine.AudioPlayer(t),u.bgm.preserved=!0,u.bgm.volume=u.bgm.restoreVolume=1,Engine.AudioManager.mode==Engine.AudioManagerMode.HTML?u.bgm.loopEnd=130:Engine.AudioManager.mode==Engine.AudioManagerMode.WEB&&(u.bgm.loopStart=12.8,u.bgm.loopEnd=128),e.bgms.push(u.bgm),u.sfxEvent=new Engine.AudioPlayer(n),u.sfxEvent.preserved=!0,u.sfxEvent.volume=u.sfxEvent.restoreVolume=1,e.sfxs.push(u.sfxEvent),u.sfxSlide=new Engine.AudioPlayer(i),u.sfxSlide.preserved=!0,u.sfxSlide.volume=u.sfxSlide.restoreVolume=1,e.sfxs.push(u.sfxSlide),u.sfxDead=new Engine.AudioPlayer(r),u.sfxDead.preserved=!0,u.sfxDead.volume=u.sfxDead.restoreVolume=1,e.sfxs.push(u.sfxDead),u.sfxJump=new Engine.AudioPlayer(o),u.sfxJump.preserved=!0,u.sfxJump.volume=u.sfxJump.restoreVolume=1,e.sfxs.push(u.sfxJump),u.sfxGravityJump=new Engine.AudioPlayer(s),u.sfxGravityJump.preserved=!0,u.sfxGravityJump.volume=u.sfxGravityJump.restoreVolume=1,e.sfxs.push(u.sfxGravityJump),u.bgmVolumeTracker<1&&e.muteAll()})}(Game=Game||{}),function(t){var i=function(e,t,n){this.priority=0,this.state=e,this.condition=t,this.priority=n};t.StateLink=i;var e,n=(Object.defineProperty(r.prototype,"onEnter",{set:function(e){this._onEnter=e.bind(this.owner)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onMoveUpdate",{set:function(e){this._onMoveUpdate=e.bind(this.owner)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onOverlapUpdate",{set:function(e){this._onOverlapUpdate=e.bind(this.owner)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onStepUpdate",{set:function(e){this._onStepUpdate=e.bind(this.owner)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onTimeUpdate",{set:function(e){this._onTimeUpdate=e.bind(this.owner)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onExit",{set:function(e){this._onExit=e.bind(this.owner)},enumerable:!1,configurable:!0}),r.prototype.addLink=function(e,t,n){void 0===n&&(n=-1),this.links.push(new i(e,t.bind(this.owner),n)),-1!=n&&this.links.sort(function(e,t){return e.priority<0&&t.priority<0?0:e.priority<0||t.priority<0?-1:e.priority-t.priority})},r.prototype.checkLinks=function(e){for(var t=0,n=this.links;t<n.length;t++){var i=n[t];if(i.condition(e))return i.state}return null},r);function r(e,t){void 0===t&&(t=""),this.name="",this.transitional=!1,this.links=new Array,this.owner=e,this.name=t}function o(){return null!==e&&e.apply(this,arguments)||this}t.State=n,__extends(o,e=n);var s,a=(s=Engine.Entity,__extends(l,s),Object.defineProperty(l.prototype,"anyState",{get:function(){return this._anyState},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"startState",{get:function(){return this._startState},set:function(e){this._startState=e},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"oldState",{get:function(){return this._oldState},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"nextState",{get:function(){return this._nextState},enumerable:!1,configurable:!0}),l.prototype.triggerListener=function(e){null!=e&&e(this.owner)},l.prototype.onReset=function(){this._nextState=null,this._oldState=null,this._currentState=null,this._currentState=this._startState,this.triggerListener(this._anyState._onEnter),this.triggerListener(this._currentState._onEnter)},l.prototype.onMoveUpdate=function(){this.stoppable&&t.SceneFreezer.stoped||(this.triggerListener(this._anyState._onMoveUpdate),this.triggerListener(this._currentState._onMoveUpdate))},l.prototype.onOverlapUpdate=function(){this.stoppable&&t.SceneFreezer.stoped||(this.triggerListener(this._anyState._onOverlapUpdate),this.triggerListener(this._currentState._onOverlapUpdate))},l.prototype.onStepUpdate=function(){if(!this.stoppable||!t.SceneFreezer.stoped){this.triggerListener(this._anyState._onStepUpdate),this.triggerListener(this._currentState._onStepUpdate);for(var e;null!=(e=this._currentState.checkLinks(this.owner))&&(this._nextState=e,this.triggerListener(this._anyState._onExit),this.triggerListener(this._currentState._onExit),this._oldState=this._currentState,this._currentState=e,this._nextState=null,this.triggerListener(this._anyState._onEnter),this.triggerListener(this._currentState._onEnter)),null!=e&&e.transitional;);}},l.prototype.onTimeUpdate=function(){this.stoppable&&t.SceneFreezer.stoped||(this.triggerListener(this._anyState._onTimeUpdate),this.triggerListener(this._currentState._onTimeUpdate))},l);function l(e){var t=s.call(this)||this;return t.stoppable=!0,t.owner=e,t._anyState=new n(e),t}t.StateMachine=a}(Game=Game||{}),function(e){var t,n=(t=Engine.Entity,__extends(i,t),i.init=function(){new i},i.clearColor=function(e,t,n){Engine.Renderer.clearColor(e/255,t/255,n/255)},i.prototype.onDrawSceneFill=function(){},i.prototype.onClearScene=function(){},i);function i(){return t.call(this)||this}e.SceneColors=n}(Game=Game||{}),function(e){var t,n=(t=Engine.Entity,__extends(i,t),i.prototype.onViewUpdate=function(){this.sprite.xSize=Engine.Renderer.xSizeView,this.sprite.ySize=Engine.Renderer.ySizeView,this.sprite.x=.5*-Engine.Renderer.xSizeView,this.sprite.y=.5*-Engine.Renderer.ySizeView},i.prototype.onStepUpdateFade=function(){0!=this.direction&&(this.alpha+=this.speed*this.direction,this.direction<0&&this.alpha<=0?(this.direction=0,this.alpha=0,this.sprite.setRGBA(this.red,this.green,this.blue,0)):0<this.direction&&1<=this.alpha&&(this.direction=0,this.alpha=1,this.sprite.setRGBA(this.red,this.green,this.blue,1)))},i.prototype.onDrawFade=function(){var e;0!=this.direction&&(e=this.alpha+this.speed*this.direction*Engine.System.stepExtrapolation,this.direction<0&&e<0?e=0:0<this.direction&&1<e&&(e=1),this.sprite.setRGBA(this.red,this.green,this.blue,e)),this.sprite.render()},i);function i(){var e=t.call(this)||this;return e.speed=.0666666666666668,e.direction=-1,e.alpha=1,e.red=0,e.green=0,e.blue=0,e.sprite=new Engine.Sprite,e.sprite.enabled=!0,e.sprite.pinned=!0,e.sprite.setRGBA(e.red,e.green,e.blue,1),e.onViewUpdate(),e}e.Fade=n}(Utils=Utils||{}),function(e){var t,i=null,n=(t=Utils.Fade,__extends(r,t),Object.defineProperty(r,"speed",{set:function(e){i.speed=e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"filled",{get:function(){return 1==i.alpha},enumerable:!1,configurable:!0}),r.init=function(){(i=i||new r).preserved=!0,i.red=0,i.green=0,i.blue=0,i.speed=.062475},r.disable=function(){i.sprite.enabled=!1},r.setColor=function(e,t,n){i.red=e/255,i.green=t/255,i.blue=n/255},r.trigger=function(){i.direction=1},r.prototype.onReset=function(){this.direction=-1},r.prototype.onStepUpdate=function(){e.Scene.waiting||null==e.Scene.nextSceneClass||1==this.direction||(this.direction=1)},r);function r(){return t.call(this)||this}e.SceneFade=n}(Game=Game||{}),function(t){var n,e=null,i=(n=Engine.Entity,__extends(r,n),Object.defineProperty(r,"paused",{get:function(){return e.paused},enumerable:!1,configurable:!0}),Object.defineProperty(r,"stoped",{get:function(){return null!=t.Scene.nextSceneClass||e.paused||t.SceneOrientator.blocked},enumerable:!1,configurable:!0}),r.switchPause=function(){e.requirePauseSwitch=!e.requirePauseSwitch},r.init=function(){e=new r},r.prototype.onStepUpdate=function(){this.requirePauseSwitch&&(this.paused=!this.paused,this.requirePauseSwitch=!1)},r.prototype.onClearScene=function(){e=null},r);function r(){var e=n.call(this)||this;return e.requirePauseSwitch=!1,e.paused=!1,t.Scene.instance instanceof t.Level||(e.paused=!1,e.requirePauseSwitch=!1),e}t.SceneFreezer=i}(Game=Game||{}),function(t){var n,e=null,i=(n=Engine.Entity,__extends(r,n),Object.defineProperty(r,"blocked",{get:function(){return null!=e&&e.fill.enabled},enumerable:!1,configurable:!0}),r.init=function(){t.TRACK_ORIENTATION,0},r.prototype.onViewUpdate=function(){this.fill.enabled=Engine.Renderer.xSizeView<Engine.Renderer.ySizeView,this.device.enabled=this.fill.enabled,this.text0.enabled=this.fill.enabled,this.text1.enabled=this.fill.enabled,this.fill.x=.5*-Engine.Renderer.xSizeView,this.fill.y=.5*-Engine.Renderer.ySizeView,this.fill.xSize=Engine.Renderer.xSizeView,this.fill.ySize=Engine.Renderer.ySizeView},r.prototype.onDrawOrientationUI=function(){this.fill.render(),this.device.render()},r.prototype.onClearScene=function(){e=null},r);function r(){var e=n.call(this)||this;return e.text0=new Utils.Text,e.text0.font=t.FontManager.a,e.text0.scale=1,e.text0.enabled=!0,e.text0.pinned=!0,e.text0.str="PLEASE ROTATE",e.text0.xAlignBounds=Utils.AnchorAlignment.MIDDLE,e.text0.xAlignView=Utils.AnchorAlignment.MIDDLE,e.text0.yAlignBounds=Utils.AnchorAlignment.START,e.text0.yAlignView=Utils.AnchorAlignment.MIDDLE,e.text0.xAligned=0,e.text0.yAligned=18,e.text0.front=!0,e.text1=new Utils.Text,e.text1.font=t.FontManager.a,e.text1.scale=1,e.text1.enabled=!0,e.text1.pinned=!0,e.text1.str="YOUR DEVICE",e.text1.xAlignBounds=Utils.AnchorAlignment.MIDDLE,e.text1.xAlignView=Utils.AnchorAlignment.MIDDLE,e.text1.yAlignBounds=Utils.AnchorAlignment.START,e.text1.yAlignView=Utils.AnchorAlignment.MIDDLE,e.text1.xAligned=0,e.text1.yAligned=26,e.text1.front=!0,e.device=new Engine.Sprite,e.device.enabled=!0,e.device.pinned=!0,e.device.y=-6,o[0].applyToSprite(e.device),e.fill=new Engine.Sprite,e.fill.enabled=!0,e.fill.pinned=!0,e.fill.setRGBA(0,88/255,248/255,1),e.onViewUpdate(),e}t.SceneOrientator=i;var o=null;t.addAction("init",function(){})}(Game=Game||{}),function(s){var e=(a.createMiddleText=function(e,t,n,i){void 0===t&&(t=0),void 0===n&&(n=!0),void 0===i&&(i=0);var r=new Utils.Text;return r.font=s.FontManager.a,r.scale=1,r.enabled=n,r.pinned=!0,r.str=e,r.xAlignBounds=Utils.AnchorAlignment.MIDDLE,r.xAlignView=Utils.AnchorAlignment.MIDDLE,r.yAlignBounds=Utils.AnchorAlignment.MIDDLE,r.yAlignView=Utils.AnchorAlignment.MIDDLE,r.xAligned=0,r.yAligned=t+a.yOffsetText,r.front=!1,a.yOffsetText+=i,r},a.createMiddleStartText=function(e,t,n,i){void 0===t&&(t=0),void 0===n&&(n=!0),void 0===i&&(i=0);var r=new Utils.Text;return r.font=s.FontManager.a,r.scale=1,r.enabled=n,r.pinned=!0,r.str=e,r.xAlignBounds=Utils.AnchorAlignment.MIDDLE,r.xAlignView=Utils.AnchorAlignment.MIDDLE,r.yAlignBounds=Utils.AnchorAlignment.START,r.yAlignView=Utils.AnchorAlignment.START,r.xAligned=0,r.yAligned=t+a.yOffsetText,r.front=!1,a.yOffsetText+=i,r},a.createStartMiddleText=function(e,t,n,i,r){void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=!0),void 0===r&&(r=0);var o=new Utils.Text;return o.font=s.FontManager.a,o.scale=1,o.enabled=i,o.pinned=!0,o.str=e,o.xAlignBounds=Utils.AnchorAlignment.START,o.xAlignView=Utils.AnchorAlignment.MIDDLE,o.yAlignBounds=Utils.AnchorAlignment.MIDDLE,o.yAlignView=Utils.AnchorAlignment.MIDDLE,o.xAligned=t,o.yAligned=n+a.yOffsetText,o.front=!1,a.yOffsetText+=r,o},a.createEndMiddleText=function(e,t,n,i,r){void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=!0),void 0===r&&(r=0);var o=new Utils.Text;return o.font=s.FontManager.a,o.scale=1,o.enabled=i,o.pinned=!0,o.str=e,o.xAlignBounds=Utils.AnchorAlignment.END,o.xAlignView=Utils.AnchorAlignment.MIDDLE,o.yAlignBounds=Utils.AnchorAlignment.MIDDLE,o.yAlignView=Utils.AnchorAlignment.MIDDLE,o.xAligned=t,o.yAligned=n+a.yOffsetText,o.front=!1,a.yOffsetText+=r,o},a.yOffsetText=0,a);function a(){}s.SceneText=e}(Game=Game||{}),function(e){var t;(i=t=e.AnchorAlignment||(e.AnchorAlignment={}))[i.NONE=0]="NONE",i[i.START=1]="START",i[i.MIDDLE=2]="MIDDLE",i[i.END=3]="END";var n,i=(n=Engine.Entity,__extends(r,n),Object.defineProperty(r.prototype,"bounds",{get:function(){return this._bounds},set:function(e){this._bounds=e,this.fix()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"xAlignView",{get:function(){return this._xAlignView},set:function(e){this._xAlignView=e,this.fix()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"yAlignView",{get:function(){return this._yAlignView},set:function(e){this._yAlignView=e,this.fix()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"xAlignBounds",{get:function(){return this._xAlignBounds},set:function(e){this._xAlignBounds=e,this.fix()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"yAlignBounds",{get:function(){return this._yAlignBounds},set:function(e){this._yAlignBounds=e,this.fix()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"xAligned",{get:function(){return this._xAligned},set:function(e){this._xAligned=e,this.fix()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"yAligned",{get:function(){return this._yAligned},set:function(e){this._yAligned=e,this.fix()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"x",{get:function(){return this._bounds.x},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._bounds.y},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"ready",{get:function(){return null!=this._bounds&&this._xAlignView!=t.NONE&&this._xAlignBounds!=t.NONE&&this._yAlignView!=t.NONE&&this._yAlignBounds!=t.NONE},enumerable:!1,configurable:!0}),r.prototype.fix=function(){this.xFix(),this.yFix()},r.prototype.xFix=function(){if(null!=this._bounds&&this._xAlignView!=t.NONE&&this._xAlignBounds!=t.NONE){var e=0;switch(this._xAlignView){case t.START:switch(e=.5*-Engine.Renderer.xSizeView+this._xAligned,this._xAlignBounds){case t.START:break;case t.MIDDLE:e-=this._bounds.xSize*this._bounds.xScale*.5;break;case t.END:e-=this._bounds.xSize*this._bounds.xScale;break;default:console.log("ERROR")}break;case t.MIDDLE:switch(e=this._xAligned,this._xAlignBounds){case t.START:break;case t.MIDDLE:e-=this._bounds.xSize*this._bounds.xScale*.5;break;case t.END:e-=this._bounds.xSize*this._bounds.xScale;break;default:console.log("ERROR")}break;case t.END:switch(e=.5*Engine.Renderer.xSizeView+this._xAligned-this._bounds.xSize*this._bounds.xScale,this._xAlignBounds){case t.START:e+=this._bounds.xSize*this._bounds.xScale;break;case t.MIDDLE:e+=this._bounds.xSize*this._bounds.xScale*.5;break;case t.END:break;default:console.log("ERROR")}break;default:console.log("ERROR")}this._bounds.x=e}},r.prototype.yFix=function(){if(null!=this._bounds&&this._yAlignView!=t.NONE&&this._yAlignBounds!=t.NONE){var e=0;switch(this._yAlignView){case t.START:switch(e=.5*-Engine.Renderer.ySizeView+this._yAligned,this._yAlignBounds){case t.START:break;case t.MIDDLE:e-=this._bounds.ySize*this._bounds.yScale*.5;break;case t.END:e-=this._bounds.ySize*this._bounds.yScale;break;default:console.log("ERROR")}break;case t.MIDDLE:switch(e=this._yAligned,this._yAlignBounds){case t.START:break;case t.MIDDLE:e-=this._bounds.ySize*this._bounds.yScale*.5;break;case t.END:e-=this._bounds.ySize*this._bounds.yScale;break;default:console.log("ERROR")}break;case t.END:switch(e=.5*Engine.Renderer.ySizeView+this._yAligned-this._bounds.ySize*this._bounds.yScale,this._yAlignBounds){case t.START:e+=this._bounds.ySize*this._bounds.yScale;break;case t.MIDDLE:e+=this._bounds.ySize*this._bounds.yScale*.5;break;case t.END:break;default:console.log("ERROR")}break;default:console.log("ERROR")}this._bounds.y=e}},r.prototype.setFullPosition=function(e,t,n,i,r,o){return this._xAlignView=e,this._yAlignView=t,this._xAlignBounds=n,this._yAlignBounds=i,this._xAligned=r,this._yAligned=o,this.fix(),this},r.prototype.onViewUpdateAnchor=function(){this.fix()},r);function r(){var e=null!==n&&n.apply(this,arguments)||this;return e._xAlignView=t.NONE,e._yAlignView=t.NONE,e._xAlignBounds=t.NONE,e._yAlignBounds=t.NONE,e._xAligned=0,e._yAligned=0,e}e.Anchor=i}(Utils=Utils||{}),(Utils||(Utils={})).Animation=function(e,t,n,i,r,o){this.loop=!1,this.name=e,this.loop=t,this.frames=n,this.steps=i,this.indexArray=r,this.stepArray=o},function(e){var t=(n.prototype.applyToSprite=function(e){e.setFull(e.enabled,e.pinned,this.texture,this.xSize,this.ySize,this.xOffset,this.yOffset,this.xTexture,this.yTexture,this.xSize,this.ySize)},n.prototype.applyToBox=function(e){this.hasBox&&(e.xSize=this.xSizeBox,e.ySize=this.ySizeBox,e.xOffset=this.xOffsetBox,e.yOffset=this.yOffsetBox)},n.prototype.getGeneric=function(){var e={};return e.xTexture=this.xTexture,e.yTexture=this.yTexture,e.xSize=this.xSize,e.ySize=this.ySize,e.xOffset=this.xOffset,e.yOffset=this.yOffset,e.hasBox=this.hasBox,e.xSizeBox=this.xSizeBox,e.ySizeBox=this.ySizeBox,e.xOffsetBox=this.xOffsetBox,e.yOffsetBox=this.yOffsetBox,e},n);function n(e,t,n,i,r,o,s,a,l,u,d,c,h){void 0===e&&(e=null),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=null),void 0===l&&(l=!1),void 0===u&&(u=0),void 0===d&&(d=0),void 0===c&&(c=0),void 0===h&&(h=0),this.xTexture=0,this.yTexture=0,this.xSize=0,this.ySize=0,this.xOffset=0,this.yOffset=0,this.hasBox=!1,this.xSizeBox=0,this.ySizeBox=0,this.xOffsetBox=0,this.yOffsetBox=0,this.texture=e,this.xTexture=t,this.yTexture=n,this.xSize=i,this.ySize=r,this.xOffset=o,this.yOffset=s,this.data=a,this.hasBox=l,this.xSizeBox=u,this.ySizeBox=d,this.xOffsetBox=c,this.yOffsetBox=h}e.AnimationFrame=t}(Utils=Utils||{}),function(e){var t,n=(t=Engine.Entity,__extends(i,t),Object.defineProperty(i.prototype,"ended",{get:function(){return 0<this.cycles},enumerable:!1,configurable:!0}),i.prototype.setFrame=function(){var e=null!=this.animation.indexArray?this.animation.indexArray[this.indexFrame]:this.indexFrame,e=this.animation.frames[e];null!=this.listener&&this.listener.onSetFrame(this,this.animation,e)},i.prototype.setAnimation=function(e,t){void 0===t&&(t=!1),this.animation=e,t||(this.indexFrame=0,this.countSteps=0,this.cycles=0),this.setFrame()},i.prototype.onAnimationUpdate=function(){var e;!Game.SceneFreezer.stoped&&null!=this.animation&&(this.animation.loop||this.cycles<1)&&(e=null!=this.animation.indexArray?this.animation.indexArray[this.indexFrame]:this.indexFrame,e=null!=this.animation.stepArray?this.animation.stepArray[e]:this.animation.steps,this.countSteps>=e&&(this.countSteps=0,this.indexFrame+=1,e=(null!=this.animation.indexArray?this.animation.indexArray:this.animation.frames).length,this.indexFrame>=e&&(this.indexFrame=this.animation.loop?0:e-1,this.cycles+=1),this.setFrame()),this.countSteps+=1)},i);function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.indexFrame=0,e.countSteps=0,e.cycles=0,e}e.Animator=n}(Utils=Utils||{}),function(e){var o,t=(o=Engine.Entity,__extends(n,o),Object.defineProperty(n.prototype,"enabled",{set:function(e){this.up.enabled=e,this.left.enabled=e,this.down.enabled=e,this.right.enabled=e,this.fill.enabled=e,this.rightBand.enabled=e,this.downBand.enabled=e},enumerable:!1,configurable:!0}),n.prototype.setBorderColor=function(e,t,n,i){this.up.setRGBA(e,t,n,i),this.left.setRGBA(e,t,n,i),this.right.setRGBA(e,t,n,i),this.down.setRGBA(e,t,n,i)},n.prototype.setFillColor=function(e,t,n,i){this.fill.setRGBA(e,t,n,i)},n.prototype.setBandColor=function(e,t,n,i){this.rightBand.setRGBA(e,t,n,i),this.downBand.setRGBA(e,t,n,i)},n.prototype.onDrawDialogs=function(){this.up.render(),this.left.render(),this.right.render(),this.down.render(),this.fill.render(),this.rightBand.render(),this.downBand.render()},n);function n(e,t,n,i){var r=o.call(this)||this;return r.up=new Engine.Sprite,r.left=new Engine.Sprite,r.down=new Engine.Sprite,r.right=new Engine.Sprite,r.fill=new Engine.Sprite,r.rightBand=new Engine.Sprite,r.downBand=new Engine.Sprite,r.upAnchor=new Utils.Anchor,r.leftAnchor=new Utils.Anchor,r.rightAnchor=new Utils.Anchor,r.downAnchor=new Utils.Anchor,r.fillAnchor=new Utils.Anchor,r.rightBandAnchor=new Utils.Anchor,r.downBandAnchor=new Utils.Anchor,r.x=e,r.y=t,r.up.enabled=!0,r.up.pinned=!0,r.up.xSize=n-2,r.up.ySize=1,r.upAnchor.bounds=r.up,r.upAnchor.xAlignBounds=Utils.AnchorAlignment.START,r.upAnchor.xAlignView=Utils.AnchorAlignment.MIDDLE,r.upAnchor.yAlignBounds=Utils.AnchorAlignment.START,r.upAnchor.yAlignView=Utils.AnchorAlignment.MIDDLE,r.upAnchor.xAligned=e+1-.5*n,r.upAnchor.yAligned=t,r.left.enabled=!0,r.left.pinned=!0,r.left.xSize=1,r.left.ySize=i-2,r.leftAnchor.bounds=r.left,r.leftAnchor.xAlignBounds=Utils.AnchorAlignment.START,r.leftAnchor.xAlignView=Utils.AnchorAlignment.MIDDLE,r.leftAnchor.yAlignBounds=Utils.AnchorAlignment.START,r.leftAnchor.yAlignView=Utils.AnchorAlignment.MIDDLE,r.leftAnchor.xAligned=e-.5*n,r.leftAnchor.yAligned=t+1,r.down.enabled=!0,r.down.pinned=!0,r.down.xSize=n-2,r.down.ySize=1,r.downAnchor.bounds=r.down,r.downAnchor.xAlignBounds=Utils.AnchorAlignment.START,r.downAnchor.xAlignView=Utils.AnchorAlignment.MIDDLE,r.downAnchor.yAlignBounds=Utils.AnchorAlignment.START,r.downAnchor.yAlignView=Utils.AnchorAlignment.MIDDLE,r.downAnchor.xAligned=e+1-.5*n,r.downAnchor.yAligned=t+i-1,r.downBand.enabled=!0,r.downBand.pinned=!0,r.downBand.xSize=n-3,r.downBand.ySize=1,r.downBandAnchor.bounds=r.downBand,r.downBandAnchor.xAlignBounds=Utils.AnchorAlignment.START,r.downBandAnchor.xAlignView=Utils.AnchorAlignment.MIDDLE,r.downBandAnchor.yAlignBounds=Utils.AnchorAlignment.START,r.downBandAnchor.yAlignView=Utils.AnchorAlignment.MIDDLE,r.downBandAnchor.xAligned=e+2-.5*n,r.downBandAnchor.yAligned=t+i-2,r.right.enabled=!0,r.right.pinned=!0,r.right.xSize=1,r.right.ySize=i-2,r.rightAnchor.bounds=r.right,r.rightAnchor.xAlignBounds=Utils.AnchorAlignment.START,r.rightAnchor.xAlignView=Utils.AnchorAlignment.MIDDLE,r.rightAnchor.yAlignBounds=Utils.AnchorAlignment.START,r.rightAnchor.yAlignView=Utils.AnchorAlignment.MIDDLE,r.rightAnchor.xAligned=e+.5*n-1,r.rightAnchor.yAligned=t+1,r.rightBand.enabled=!0,r.rightBand.pinned=!0,r.rightBand.xSize=1,r.rightBand.ySize=i-3,r.rightBandAnchor.bounds=r.rightBand,r.rightBandAnchor.xAlignBounds=Utils.AnchorAlignment.START,r.rightBandAnchor.xAlignView=Utils.AnchorAlignment.MIDDLE,r.rightBandAnchor.yAlignBounds=Utils.AnchorAlignment.START,r.rightBandAnchor.yAlignView=Utils.AnchorAlignment.MIDDLE,r.rightBandAnchor.xAligned=e+.5*n-2,r.rightBandAnchor.yAligned=t+2,r.fill.enabled=!0,r.fill.pinned=!0,r.fill.xSize=n-2,r.fill.ySize=i-2,r.fillAnchor.bounds=r.fill,r.fillAnchor.xAlignBounds=Utils.AnchorAlignment.START,r.fillAnchor.xAlignView=Utils.AnchorAlignment.MIDDLE,r.fillAnchor.yAlignBounds=Utils.AnchorAlignment.START,r.fillAnchor.yAlignView=Utils.AnchorAlignment.MIDDLE,r.fillAnchor.xAligned=e-.5*n+1,r.fillAnchor.yAligned=t+1,r}e.Dialog=t;var s,t=(__extends(i,s=t),Object.defineProperty(i.prototype,"style",{get:function(){return this._style},set:function(e){switch(this._style=e){case"blue":this.setBorderColor(0,0,252/255,1),this.setFillColor(0,120/255,1,1),this.setBandColor(1,1,1,1);break;case"purple":this.setBorderColor(88/255,40/255,188/255,1),this.setFillColor(152/255,120/255,248/255,1),this.setBandColor(1,1,1,1);break;case"clearblue":this.setBorderColor(184/255,184/255,248/255,1),this.setFillColor(164/255,228/255,252/255,1),this.setBandColor(1,1,1,1)}},enumerable:!1,configurable:!0}),i);function i(e,t,n,i,r){r=s.call(this,t,n,i,r)||this;return r.style=e,r}e.ColorDialog=t}(Game=Game||{}),function(e){var t,n=(t=Engine.Entity,__extends(i,t),Object.defineProperty(i.prototype,"triggered",{get:function(){return this._triggered},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"inactive",{get:function(){return 0==this.position&&0==this.direction},enumerable:!1,configurable:!0}),i.prototype.start=function(e){this.position=0,this.countDistance=this.distance,this.direction=e,this._triggered=!0},i.prototype.stop=function(){this.position=0,this.direction=0,this._triggered=!1},i.prototype.onReset=function(){this.position=0,this.direction=0,this._triggered=!1},i.prototype.onStepUpdate=function(){var e;0==this.direction||Game.SceneFreezer.stoped||(this.position+=this.velocity*this.direction,e=!1,(0<this.direction&&this.position>this.countDistance||this.direction<0&&this.position<-this.countDistance)&&(e=!0),e&&(this.position=this.countDistance*this.direction,this.direction*=-1,this.countDistance*=this.reduction,this.countDistance<=this.minDistance&&(this.position=0,this.direction=0)))},i);function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._triggered=!1,e}e.Shake=n}(Utils=Utils||{}),function(e){var i,t=(i=e.Anchor,__extends(n,i),n.prototype.setEnabled=function(e){this._enabled=e,this._bounds.enabled=e;for(var t=0,n=this.sprites;t<n.length;t++)n[t].enabled=!1;if(null!=this._str)for(var i=0;i<this._str.length;i+=1)this.sprites[i].enabled=e;this._underlined&&(this.underline.enabled=e,this.underline2.enabled=e)},Object.defineProperty(n.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this.setEnabled(e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"pinned",{get:function(){return this._pinned},set:function(e){this._pinned=e,this._bounds.pinned=e;for(var t=0,n=this.sprites;t<n.length;t++)n[t].pinned=e;this._underlined&&(this.underline.pinned=e,this.underline2.pinned=e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"str",{get:function(){return this._str},set:function(e){this._str=e,this.fixStr()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"font",{get:function(){return this._font},set:function(e){this._font=e,this.fixStr()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"underlined",{get:function(){return this._underlined},set:function(e){this._underlined=e,this.fixStr()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"scale",{get:function(){return this._scale},set:function(e){this._scale=e,this.fixStr()},enumerable:!1,configurable:!0}),n.prototype.setUnderlineShadowColor=function(e,t,n,i){this.underline2.setRGBA(e,t,n,i)},n.prototype.fixStr=function(){if(null!=this._str&&null!=this._font){for(var e=this.sprites.length;e<this._str.length;e+=1)this.sprites.push(new Engine.Sprite);for(var t=0,n=this.sprites;t<n.length;t++)(i=n[t]).enabled=!1;for(var i,r=0,o=0;o<this._str.length;o+=1){(i=this.sprites[o]).enabled=this._enabled,i.pinned=this._pinned;var s=this._font.frames[this._str.charCodeAt(o)-" ".charCodeAt(0)];i.setFull(this._enabled,this._pinned,this._font.texture,s.xSize*this._scale,this._font.ySize*this._scale,0,0,s.xTexture,s.yTexture,s.xSize,this._font.ySize),r+=i.xSize+this._font.xOffset*this._scale}this._bounds.enabled=this._enabled,this._bounds.pinned=this._pinned,this._bounds.xSize=r-this._font.xOffset*this._scale,this._bounds.ySize=this._font.ySize*this._scale,this._underlined&&(this.underline.enabled=this._enabled,this.underline.pinned=this._pinned,this.underline.xSize=this._bounds.xSize,this.underline.ySize=this._scale,this.underline2.enabled=this._enabled,this.underline2.pinned=this._pinned,this.underline2.xSize=this._bounds.xSize,this.underline2.ySize=this._scale,this._bounds.ySize+=2*this._scale),this.fix()}},n.prototype.fix=function(){if(i.prototype.fix.call(this),null!=this._str&&null!=this._font&&this.ready){for(var e=this._bounds.x,t=0;t<this._str.length;t+=1){var n=this.sprites[t];n.x=e,n.y=this._bounds.y,e+=n.xSize+this._font.xOffset*this._scale}this._underlined&&(this.underline.x=this._bounds.x,this.underline.y=this._bounds.y+this._bounds.ySize-this.scale,this.underline2.x=this._bounds.x+this.scale,this.underline2.y=this._bounds.y+this._bounds.ySize)}},n.prototype.onViewUpdateText=function(){this.fix()},n.prototype.onDrawText=function(){if(!this.front){for(var e=0;e<this.sprites.length;e+=1)this.sprites[e].render();this._underlined&&(this.underline.render(),this.underline2.render())}},n.prototype.onDrawTextFront=function(){if(this.front){for(var e=0;e<this.sprites.length;e+=1)this.sprites[e].render();this._underlined&&(this.underline.render(),this.underline2.render())}},n);function n(){var e=i.call(this)||this;return e.sprites=new Array,e.front=!1,e._enabled=!1,e._pinned=!1,e._str=null,e._font=null,e._underlined=!1,e._scale=1,e._bounds=new Engine.Sprite,e.underline=new Engine.Sprite,e.underline2=new Engine.Sprite,e.underline2.setRGBA(0,0,0,1),e._bounds.setRGBA(1,1,1,.2),e}e.Text=t}(Utils=Utils||{}),function(l){var t=function(e){this.headerReceived=!1,this.size=0,this.downloadedSize=0,this.path=n.root+e},u=function(e,t,n,i,r,o,s){this.xSize=e,this.ySize=t,this.xSizeSource=n,this.ySizeSource=i,this.imageData=r,this.bytes=o,this.filterable=s};l.ImageAssetData=u;var n=(d.downloadNextAssetHeader=function(){d.currentAsset=d.assets[d.assetHeaderDownloadIndex];var e=new XMLHttpRequest;e.onloadstart=function(){this.responseType="arraybuffer"},e.open("GET",d.currentAsset.path,!0),e.onreadystatechange=function(){this.readyState==this.HEADERS_RECEIVED&&(d.currentAsset.headerReceived=!0,null!=this.getResponseHeader("Content-Length")?d.currentAsset.size=+this.getResponseHeader("Content-Length"):d.currentAsset.size=1,this.abort(),(d.assetHeaderDownloadIndex+=1)==d.assets.length?d.downloadNextAssetBlob():d.downloadNextAssetHeader())},e.onerror=function(){d.downloadNextAssetHeader()},e.send()},d.downloadNextAssetBlob=function(){d.currentAsset=d.assets[d.assetBlobDownloadIndex];var e=new XMLHttpRequest;e.onloadstart=function(){0<d.currentAsset.path.indexOf(".json")||0<d.currentAsset.path.indexOf(".txt")||0<d.currentAsset.path.indexOf(".glsl")?e.responseType="text":e.responseType="arraybuffer"},e.open("GET",d.currentAsset.path,!0),e.onprogress=function(e){d.currentAsset.downloadedSize=e.loaded,d.currentAsset.downloadedSize>d.currentAsset.size&&(d.currentAsset.downloadedSize=d.currentAsset.size)},e.onreadystatechange=function(){this.readyState==XMLHttpRequest.DONE&&(200==this.status||304==this.status||206==this.status||0==this.status&&this.response?(d.currentAsset.downloadedSize=d.currentAsset.size,0<d.currentAsset.path.indexOf(".png")||0<d.currentAsset.path.indexOf(".jpg")||0<d.currentAsset.path.indexOf(".jpeg")||0<d.currentAsset.path.indexOf(".jpe")?(d.currentAsset.blob=new Blob([new Uint8Array(this.response)]),d.prepareImageAsset()):0<d.currentAsset.path.indexOf(".m4a")||0<d.currentAsset.path.indexOf(".ogg")||0<d.currentAsset.path.indexOf(".wav")?(d.currentAsset.buffer=this.response,d.prepareSoundAsset()):(0<d.currentAsset.path.indexOf(".json")||0<d.currentAsset.path.indexOf(".txt")||0<d.currentAsset.path.indexOf(".glsl")?d.currentAsset.text=e.responseText:d.currentAsset.blob=this.response,d.stepAssetDownloadQueue())):d.downloadNextAssetBlob())},e.onerror=function(){d.downloadNextAssetBlob()},e.send()},d.stepAssetDownloadQueue=function(){(d.assetBlobDownloadIndex+=1)==d.assets.length?d.downloadingAssets=!1:d.downloadNextAssetBlob()},d.prepareImageAsset=function(){d.currentAsset.image=document.createElement("img"),d.currentAsset.image.onload=function(){d.currentAsset.blob=null,d.stepAssetDownloadQueue()},d.currentAsset.image.onerror=function(){d.prepareImageAsset()},d.currentAsset.image.src=URL.createObjectURL(d.currentAsset.blob)},d.prepareSoundAsset=function(){l.AudioManager.mode==l.AudioManagerMode.HTML?(d.currentAsset.blob=new Blob([new Uint8Array(d.currentAsset.buffer)]),d.currentAsset.audioURL=URL.createObjectURL(d.currentAsset.blob),d.stepAssetDownloadQueue()):l.AudioManager.mode==l.AudioManagerMode.WEB?l.AudioManager.context.decodeAudioData(d.currentAsset.buffer,function(e){d.currentAsset.audio=e,d.currentAsset.buffer=null,d.stepAssetDownloadQueue()},function(){d.prepareSoundAsset()}):d.stepAssetDownloadQueue()},d.queue=function(e){if(d.downloadingAssets)console.log("ERROR");else{if(0<e.indexOf(".ogg")||0<e.indexOf(".m4a")||0<e.indexOf(".wav"))console.log("ERROR");else if((0<e.indexOf(".omw")||0<e.indexOf(".owm")||0<e.indexOf(".mow")||0<e.indexOf(".mwo")||0<e.indexOf(".wom")||0<e.indexOf(".wmo"))&&""==(e=d.findAudioExtension(e)))return void console.log("ERROR");d.assets.push(new t(e))}},d.download=function(){d.downloadingAssets||d.assetHeaderDownloadIndex>=d.assets.length?console.log("ERROR"):(d.assetQueueStart=d.assetHeaderDownloadIndex,d.downloadingAssets=!0,d.downloadNextAssetHeader())},Object.defineProperty(d,"downloadSize",{get:function(){for(var e=0,t=d.assetQueueStart;t<d.assets.length;t+=1){if(!d.assets[t].headerReceived)return 0;e+=d.assets[t].size}return e},enumerable:!1,configurable:!0}),Object.defineProperty(d,"downloadedSize",{get:function(){for(var e=0,t=d.assetQueueStart;t<d.assets.length;t+=1)e+=d.assets[t].downloadedSize;return e},enumerable:!1,configurable:!0}),Object.defineProperty(d,"downloadedRatio",{get:function(){var e=d.downloadSize;return 0==e?0:d.downloadedSize/e},enumerable:!1,configurable:!0}),Object.defineProperty(d,"downloadComplete",{get:function(){var e=d.downloadSize;return 0!=e&&(d.downloadedSize==e&&!d.downloadingAssets)},enumerable:!1,configurable:!0}),d.findAsset=function(e){e=d.root+e;for(var t=0;t<d.assets.length;t+=1)if(d.assets[t].path==e)return d.assets[t];return console.log("error"),null},d.isPOW2=function(e){return 0!=e&&0==(e&e-1)},d.getNextPOW=function(e){for(var t=2;t<e;)t*=2;return t},d.loadImage=function(e){var t=d.findAsset(e);if(null==t||null==t.image)return console.log("ERROR"),null;if(l.Renderer.mode==l.RendererMode.CANVAS_2D){(s=document.createElement("canvas")).width=t.image.width,s.height=t.image.height,(a=s.getContext("2d")).drawImage(t.image,0,0);var n=a.getImageData(0,0,s.width,s.height);return new u(s.width,s.height,s.width,s.height,n,n.data,!1)}var i=t.image.width,r=t.image.height;if(this.isPOW2(i)&&this.isPOW2(r)){(s=document.createElement("canvas")).width=t.image.width,s.height=t.image.height,(a=s.getContext("2d")).drawImage(t.image,0,0);n=a.getImageData(0,0,s.width,s.height);return new u(s.width,s.height,s.width,s.height,n,n.data,!0)}var o=l.Renderer.gl.getParameter(l.Renderer.gl.MAX_TEXTURE_SIZE);if(i<=o&&r<=o){var s,a,e=d.getNextPOW(i),o=d.getNextPOW(r);(s=document.createElement("canvas")).width=e,s.height=o,(a=s.getContext("2d")).drawImage(t.image,0,0);n=a.getImageData(0,0,e,o);return new u(s.width,s.height,i,r,n,n.data,!0)}(s=document.createElement("canvas")).width=t.image.width,s.height=t.image.height,(a=s.getContext("2d")).drawImage(t.image,0,0);n=a.getImageData(0,0,s.width,s.height);return new u(s.width,s.height,s.width,s.height,n,n.data,!1)},d.loadText=function(e){e=d.findAsset(e);return null==e||null==e.text?(console.log("ERROR"),null):e.text},d.loadAudio=function(e){e=d.findAsset(d.findAudioExtension(e));return null==e||null==e.audio?(console.log("ERROR"),null):e.audio},d.root="",d.assets=new Array,d.assetQueueStart=0,d.assetHeaderDownloadIndex=0,d.assetBlobDownloadIndex=0,d.downloadingAssets=!1,d.findAudioExtension=function(e){var t="",n="";if(0<e.indexOf(".omw"))if(t=".omw",l.AudioManager.oggSupported)n=".ogg";else if(l.AudioManager.aacSupported)n=".m4a";else{if(!l.AudioManager.wavSupported)return"";n=".wav"}else if(0<e.indexOf(".owm"))if(t=".owm",l.AudioManager.oggSupported)n=".ogg";else if(l.AudioManager.wavSupported)n=".wav";else{if(!l.AudioManager.aacSupported)return"";n=".m4a"}else if(0<e.indexOf(".mow"))if(t=".mow",l.AudioManager.aacSupported)n=".m4a";else if(l.AudioManager.oggSupported)n=".ogg";else{if(!l.AudioManager.wavSupported)return"";n=".wav"}else if(0<e.indexOf(".mwo"))if(t=".mwo",l.AudioManager.aacSupported)n=".m4a";else if(l.AudioManager.wavSupported)n=".wav";else{if(!l.AudioManager.oggSupported)return"";n=".ogg"}else if(0<e.indexOf(".wom"))if(t=".wom",l.AudioManager.wavSupported)n=".wav";else if(l.AudioManager.oggSupported)n=".ogg";else{if(!l.AudioManager.aacSupported)return"";n=".m4a"}else{if(!(0<e.indexOf(".wmo")))return"";if(t=".wmo",l.AudioManager.wavSupported)n=".wav";else if(l.AudioManager.aacSupported)n=".m4a";else{if(!l.AudioManager.oggSupported)return"";n=".ogg"}}var i=".ogg"==n?"OGG/":".m4a"==n?"M4A/":"WAV/",r=e.lastIndexOf("/")+1;return(e=e.substr(0,r)+i+e.substr(r)).substr(0,e.indexOf(t))+n},d);function d(){}l.Assets=n}(Engine=Engine||{}),function(a){var e=(Object.defineProperty(t.prototype,"mouseOver",{get:function(){var e,t,n,i;return i=this.pinned?(e=a.Renderer.xViewToWindow(this.x+this.xOffset*this.xScale),t=a.Renderer.yViewToWindow(this.y+this.yOffset*this.yScale),n=a.Renderer.xViewToWindow(this.x+(this.xSize+this.xOffset)*this.xScale),a.Renderer.yViewToWindow(this.y+(this.ySize+this.yOffset)*this.yScale)):(e=a.Renderer.xViewToWindow(this.x+this.xOffset*this.xScale-a.Renderer.xCamera),t=a.Renderer.yViewToWindow(this.y+this.yOffset*this.yScale-a.Renderer.yCamera),n=a.Renderer.xViewToWindow(this.x+(this.xSize+this.xOffset)*this.xScale-a.Renderer.xCamera),a.Renderer.yViewToWindow(this.y+(this.ySize+this.yOffset)*this.yScale-a.Renderer.yCamera)),a.Mouse.in(e,t,n,i)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"touched",{get:function(){var e,t,n,i;return i=this.pinned?(e=a.Renderer.xViewToWindow(this.x+this.xOffset*this.xScale),t=a.Renderer.yViewToWindow(this.y+this.yOffset*this.yScale),n=a.Renderer.xViewToWindow(this.x+(this.xSize+this.xOffset)*this.xScale),a.Renderer.yViewToWindow(this.y+(this.ySize+this.yOffset)*this.yScale)):(e=a.Renderer.xViewToWindow(this.x+this.xOffset*this.xScale-a.Renderer.xCamera),t=a.Renderer.yViewToWindow(this.y+this.yOffset*this.yScale-a.Renderer.yCamera),n=a.Renderer.xViewToWindow(this.x+(this.xSize+this.xOffset)*this.xScale-a.Renderer.xCamera),a.Renderer.yViewToWindow(this.y+(this.ySize+this.yOffset)*this.yScale-a.Renderer.yCamera)),a.TouchInput.down(e,t,n,i,this.useTouchRadius)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pointed",{get:function(){var e,t,n,i;return i=this.pinned?(e=a.Renderer.xViewToWindow(this.x+this.xOffset*this.xScale),t=a.Renderer.yViewToWindow(this.y+this.yOffset*this.yScale),n=a.Renderer.xViewToWindow(this.x+(this.xSize+this.xOffset)*this.xScale),a.Renderer.yViewToWindow(this.y+(this.ySize+this.yOffset)*this.yScale)):(e=a.Renderer.xViewToWindow(this.x+this.xOffset*this.xScale-a.Renderer.xCamera),t=a.Renderer.yViewToWindow(this.y+this.yOffset*this.yScale-a.Renderer.yCamera),n=a.Renderer.xViewToWindow(this.x+(this.xSize+this.xOffset)*this.xScale-a.Renderer.xCamera),a.Renderer.yViewToWindow(this.y+(this.ySize+this.yOffset)*this.yScale-a.Renderer.yCamera)),a.TouchInput.pressed(e,t,n,i,this.useTouchRadius)},enumerable:!1,configurable:!0}),t.prototype.pointInside=function(e,t,n){var i,r,o,s;return s=this.pinned?(i=a.Renderer.xViewToWindow(this.x+this.xOffset*this.xScale),r=a.Renderer.yViewToWindow(this.y+this.yOffset*this.yScale),o=a.Renderer.xViewToWindow(this.x+(this.xSize+this.xOffset)*this.xScale),a.Renderer.yViewToWindow(this.y+(this.ySize+this.yOffset)*this.yScale)):(i=a.Renderer.xViewToWindow(this.x+this.xOffset*this.xScale-a.Renderer.xCamera),r=a.Renderer.yViewToWindow(this.y+this.yOffset*this.yScale-a.Renderer.yCamera),o=a.Renderer.xViewToWindow(this.x+(this.xSize+this.xOffset)*this.xScale-a.Renderer.xCamera),a.Renderer.yViewToWindow(this.y+(this.ySize+this.yOffset)*this.yScale-a.Renderer.yCamera)),null!=n&&null!=n||(n=1),t/=n=0==n?1:n,i/n<=(e/=n)&&e<=o/n&&r/n<=t&&t<=s/n},t.prototype.render=function(){},t.prototype.setRGBA=function(e,t,n,i){},t);function t(){this.enabled=!1,this.pinned=!1,this.x=0,this.y=0,this.xSize=8,this.ySize=8,this.xOffset=0,this.yOffset=0,this.xScale=1,this.yScale=1,this.xMirror=!1,this.yMirror=!1,this.angle=0,this.useTouchRadius=!0,this.data=null}a.InteractableBounds=e}(Engine=Engine||{}),function(c){var t,e=function(e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.context.drawImage(e.texture.canvas,e.xTexture,e.yTexture,e.xSizeTexture,e.ySizeTexture,0,0,e.xSizeTexture,e.ySizeTexture);for(var t=this.context.getImageData(0,0,e.xSizeTexture,e.ySizeTexture),n=t.data,i=0;i<e.xSizeTexture*e.ySizeTexture*4;i+=4)n[i+0]=n[i+0]*e.red,n[i+1]=n[i+1]*e.green,n[i+2]=n[i+2]*e.blue,n[i+3]=n[i+3]*e.alpha;this.context.clearRect(0,0,e.xSizeTexture,e.ySizeTexture),this.context.putImageData(t,0,0)},n=(t=c.InteractableBounds,__extends(i,t),i.prototype.setFull=function(e,t,n,i,r,o,s,a,l,u,d){null==n?console.log("error"):(this.enabled=e,this.pinned=t,this.xSize=i,this.ySize=r,this.xOffset=o,this.yOffset=s,this.texture=n,c.Renderer.mode==c.RendererMode.WEB_GL?(this.u0=a/n.assetData.xSize,this.v0=l/n.assetData.ySize,this.u1=(a+u)/n.assetData.xSize,this.v1=(l+d)/n.assetData.ySize):(this.xTexture=a,this.yTexture=l,this.xSizeTexture=u,this.ySizeTexture=d,this.dirty=!0))},i.prototype.setRGBA=function(e,t,n,i){c.Renderer.mode!=c.RendererMode.CANVAS_2D||this.red==e&&this.green==t&&this.blue==n&&this.alpha==i||(this.dirty=!0),this.red=e,this.green=t,this.blue=n,this.alpha=i},i.prototype.render=function(){t.prototype.render.call(this),this.enabled&&(c.Renderer.mode==c.RendererMode.CANVAS_2D&&this.dirty&&null!=this.texture&&((1!=this.red||1!=this.green||1!=this.blue||1!=this.alpha)&&0<this.xSizeTexture&&0<this.ySizeTexture?this.canvasTexture=new e(this):this.canvasTexture=null,this.dirty=!1),c.Renderer.renderSprite(this))},i);function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.red=1,e.green=1,e.blue=1,e.alpha=1,e.texture=null,e.xTexture=0,e.yTexture=0,e.xSizeTexture=0,e.ySizeTexture=0,e.dirty=!1,e.u0=0,e.v0=0,e.u1=0,e.v1=0,e.setHSVA=function(e,t,n,i){console.log("error")},e}c.Sprite=n}(Engine=Engine||{}),function(l){var s=function(e,t,n){this.box=e,this.other=t,this.distance=n};l.Contact=s;var a=function(e,t){this.box=e,this.other=t};l.Overlap=a;var u=function(e,t){this.x=e,this.y=t};l.Point=u;var e=(Object.defineProperty(d.prototype,"x",{get:function(){return this.position[0]/d.UNIT},set:function(e){this.position[0]=e*d.UNIT},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"y",{get:function(){return this.position[1]/d.UNIT},set:function(e){this.position[1]=e*d.UNIT},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"xOffset",{get:function(){return this.offset[0]/d.UNIT},set:function(e){this.offset[0]=e*d.UNIT},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"yOffset",{get:function(){return this.offset[1]/d.UNIT},set:function(e){this.offset[1]=e*d.UNIT},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"xSize",{get:function(){return this.size[0]/d.UNIT},set:function(e){this.size[0]=e*d.UNIT},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"ySize",{get:function(){return this.size[1]/d.UNIT},set:function(e){this.size[1]=e*d.UNIT},enumerable:!1,configurable:!0}),d.setInterval=function(e,t,n){n?(e.xMirror?(t[0]=e.position[0]-e.offset[0]-e.size[0],t[1]=e.position[0]-e.offset[0]):(t[0]=e.position[0]+e.offset[0],t[1]=e.position[0]+e.offset[0]+e.size[0]),e.yMirror?(t[2]=e.position[1]-e.offset[1]-e.size[1],t[3]=e.position[1]-e.offset[1]):(t[2]=e.position[1]+e.offset[1],t[3]=e.position[1]+e.offset[1]+e.size[1])):(e.xMirror?(t[0]=e.position[1]-e.offset[1]-e.size[1],t[1]=e.position[1]-e.offset[1]):(t[0]=e.position[1]+e.offset[1],t[1]=e.position[1]+e.offset[1]+e.size[1]),e.yMirror?(t[2]=e.position[0]-e.offset[0]-e.size[0],t[3]=e.position[0]-e.offset[0]):(t[2]=e.position[0]+e.offset[0],t[3]=e.position[0]+e.offset[0]+e.size[0]))},d.intervalExclusiveCollides=function(e,t,n,i){return e<=n&&n<t||n<=e&&e<i},d.intervalDifference=function(e,t,n,i){return e<n?t-n:e-i},d.prototype.castAgainst=function(e,t,n,i,r,o){if(void 0===r&&(r=!0),void 0===o&&(o=d.LAYER_ALL),0!=i){if(i*=r?d.UNIT:1,d.setInterval(this,d.intervalA,n),this==e||!e.enabled||o!=d.LAYER_ALL&&!(o&e.layer))return t;if(d.setInterval(e,d.intervalB,n),d.intervalExclusiveCollides(d.intervalB[0],d.intervalB[1],d.intervalA[0],d.intervalA[1]))return t;if(!d.intervalExclusiveCollides(d.intervalB[2],d.intervalB[3],d.intervalA[2],d.intervalA[3]))return t;if(d.intervalExclusiveCollides(d.intervalB[0]-(0<i?i:0),d.intervalB[1]-(i<0?i:0),d.intervalA[0],d.intervalA[1])){n=d.intervalDifference(d.intervalB[0],d.intervalB[1],d.intervalA[0],d.intervalA[1]);if(Math.abs(i)<Math.abs(n))return t;null==t||0==t.length||Math.abs(n)<Math.abs(t[0].distance)?(t=[])[0]=new s(this,e,n):Math.abs(n)==Math.abs(t[0].distance)&&(t=t||[]).push(new s(this,e,n))}}return t},d.prototype.cast=function(e,t,n,i,r,o){void 0===r&&(r=!0),void 0===o&&(o=d.LAYER_ALL);for(var s=0,a=e;s<a.length;s++){var l=a[s];t=this.castAgainst(l,t,n,i,r,o)}return t},d.prototype.collideAgainst=function(e,t,n,i,r,o){return void 0===t&&(t=null),void 0===n&&(n=!1),void 0===i&&(i=0),void 0===r&&(r=!0),void 0===o&&(o=d.LAYER_ALL),i*=r?d.UNIT:1,this!=e&&e.enabled&&(o==d.LAYER_ALL||o&e.layer)?(d.setInterval(this,d.intervalA,n),d.setInterval(e,d.intervalB,n),d.intervalExclusiveCollides(d.intervalB[2],d.intervalB[3],d.intervalA[2],d.intervalA[3])&&d.intervalExclusiveCollides(d.intervalB[0]-(0<i?i:0),d.intervalB[1]-(i<0?i:0),d.intervalA[0],d.intervalA[1])&&(t=t||[]).push(new a(this,e)),t):t},d.prototype.collide=function(e,t,n,i,r,o){void 0===t&&(t=null),void 0===n&&(n=!1),void 0===i&&(i=0),void 0===r&&(r=!0),void 0===o&&(o=d.LAYER_ALL);for(var s=0,a=e;s<a.length;s++){var l=a[s];t=this.collideAgainst(l,t,n,i,r,o)}return t},d.prototype.translate=function(e,t,n,i){void 0===i&&(i=!0),n*=i?d.UNIT:1,null==e||0==e.length?(this.position[0]+=t?n:0,this.position[1]+=t?0:n):(this.position[0]+=t?e[0].distance:0,this.position[1]+=t?0:e[0].distance)},d.prototype.getExtrapolation=function(e,t,n,i,r){void 0===i&&(i=!0),void 0===r&&(r=d.LAYER_ALL);var o,s=this.position[0],a=this.position[1];t*=l.System.stepExtrapolation,n*=l.System.stepExtrapolation,null==e?(this.position[0]+=t*(i?d.UNIT:1),this.position[1]+=n*(i?d.UNIT:1)):(o=this.cast(e,null,!0,t,i,r),this.translate(o,!0,t,i),o=this.cast(e,null,!1,n,i,r),this.translate(o,!1,n,i));i=new u(this.position[0]/d.UNIT,this.position[1]/d.UNIT);return this.position[0]=s,this.position[1]=a,i},d.renderBoxAt=function(e,t,n){d.debugRender&&e.enabled&&e.renderable&&(null==d.sprite&&((d.sprite=new l.Sprite).enabled=!0),d.sprite.x=t,d.sprite.y=n,d.sprite.xOffset=e.offset[0]/d.UNIT,d.sprite.yOffset=e.offset[1]/d.UNIT,d.sprite.xSize=e.size[0]/d.UNIT,d.sprite.ySize=e.size[1]/d.UNIT,d.sprite.xMirror=e.xMirror,d.sprite.yMirror=e.yMirror,d.sprite.setRGBA(e.red,e.green,e.blue,e.alpha),d.sprite.render())},d.prototype.render=function(){d.renderBoxAt(this,this.x,this.y)},d.prototype.renderExtrapolated=function(e,t,n,i,r){void 0===i&&(i=!0),void 0===r&&(r=d.LAYER_ALL);r=this.getExtrapolation(e,t,n,i,r);d.renderBoxAt(this,r.x,r.y)},d.UNIT=1e3,d.LAYER_NONE=0,d.LAYER_ALL=1,d.debugRender=!0,d.intervalA=new Int32Array(4),d.intervalB=new Int32Array(4),d);function d(){this.position=new Int32Array(2),this.offset=new Int32Array(2),this.size=new Int32Array([8e3,8e3]),this.enabled=!1,this.layer=d.LAYER_NONE,this.xMirror=!1,this.yMirror=!1,this.data=null,this.renderable=!1,this.red=0,this.green=1,this.blue=0,this.alpha=.5}l.Box=e}(Engine=Engine||{}),function(e){var t=(r.setID=function(e,t,n){r.idToken=(r.id=e+"."+t+"."+n)+"."},r.validateID=function(){""==r.id&&console.error("PLEASE SET A VALID DATA ID")},r.save=function(e,t,n){if(r.validateID(),e=r.idToken+e,r.useLocalStorage)localStorage.setItem(e,t+"");else try{var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3);i="expires="+i.toUTCString();document.cookie=e+"="+t+";"+i+";path=/; SameSite=None; Secure"}catch(e){console.log(e)}},r.load=function(e){if(r.validateID(),e=r.idToken+e,r.useLocalStorage)return localStorage.getItem(e);try{e+="=";for(var t=document.cookie.split(";"),n=0;n<t.length;n+=1){for(var i=t[n];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(e))return i.substring(e.length,i.length)}return null}catch(e){return console.log(e),null}},r.id="",r.idToken="",r.useLocalStorage=!1,r);function r(){}e.Data=t}(Engine=Engine||{}),function(e){var t=(r.hasDown=function(e,t){for(var n=0;n<(t?r.oldKeyPressEvents:r.keyPressEvents).length;n+=1)if(e==(t?r.oldKeyPressEvents:r.keyPressEvents)[n])return!0;return!1},r.down=function(e){return r.hasDown(e,!1)},r.onDown=function(e){if(null==e.key||null==e.key)return!1;for(var t=e.key.toLowerCase(),n=r.readedKeyPressEvents.length,i=0;i<r.readedKeyPressEvents.length;i+=1)if(""==r.readedKeyPressEvents[i])n=i;else if(r.readedKeyPressEvents[i]==t){n=-1;break}switch(0<=n&&(r.readedKeyPressEvents[n]=t),t){case r.UP:case"up":case"Up":case r.DOWN:case"down":case"Down":case r.LEFT:case"left":case"Left":case r.RIGHT:case"right":case"Right":case r.SPACE:case"space":case"Space":case" ":case"spacebar":case r.ESC:case"esc":case"Esc":case"ESC":return e.preventDefault(),"undefined"!==e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!0}return!1},r.onUp=function(e){if(null==e.key||null==e.key)return!1;for(var t=e.key.toLowerCase(),n=0;n<r.readedKeyPressEvents.length;n+=1)if(r.readedKeyPressEvents[n]==t){r.readedKeyPressEvents[n]="";break}return!1},r.update=function(){for(var e=0;e<r.keyPressEvents.length;e+=1)r.oldKeyPressEvents[e]=r.keyPressEvents[e];for(e=0;e<r.readedKeyPressEvents.length;e+=1)r.keyPressEvents[e]=r.readedKeyPressEvents[e]},r.A="a",r.B="b",r.C="c",r.D="d",r.E="e",r.F="f",r.G="g",r.H="h",r.I="i",r.J="j",r.K="k",r.L="l",r.M="m",r.N="n",r.O="o",r.P="p",r.Q="q",r.R="r",r.S="s",r.T="t",r.U="u",r.V="v",r.W="w",r.X="x",r.Y="y",r.Z="z",r.UP="arrowup",r.DOWN="arrowdown",r.LEFT="arrowleft",r.RIGHT="arrowright",r.SPACE=" ",r.ESC="escape",r.readedKeyPressEvents=[],r.oldKeyPressEvents=[],r.keyPressEvents=[],r.up=function(e){return!r.hasDown(e,!1)},r.pressed=function(e){return r.hasDown(e,!1)&&!r.hasDown(e,!0)},r.released=function(e){return!r.hasDown(e,!1)&&r.hasDown(e,!0)},r);function r(){}e.Keyboard=t,window.addEventListener("keydown",t.onDown,!1),window.addEventListener("keyup",t.onUp,!1)}(Engine=Engine||{}),function(e){var s=function(e,t){this.owner=e,this.url=t},t=(a.add=function(e,t){for(var n=null,i=0,r=a.links;i<r.length;i++){var o=r[i];o.owner==e&&o.url==t&&(n=o)}null==n&&a.links.push(new s(e,t))},a.remove=function(e,t){for(var n=new Array,i=0,r=a.links;i<r.length;i++){var o=r[i];o.owner==e&&o.url==t||n.push(o)}a.links=n},a.triggerMouse=function(e){for(var t=0,n=a.links;t<n.length;t++){var i=n[t];(null==i.owner.bounds||i.owner.bounds.enabled&&i.owner.bounds.pointInside(e.clientX,e.clientY,1)&&i.owner.linkCondition())&&(null!=i.owner&&null!=i.owner.onLinkTrigger?i.owner.onLinkTrigger():window.open(i.url,"_blank"))}},a.triggerTouch=function(e){for(var t=0,n=a.links;t<n.length;t++)for(var i=n[t],r=0;r<e.changedTouches.length;r+=1){var o=e.changedTouches.item(r),s=o.radiusX<o.radiusY?o.radiusX:o.radiusY;if(null!=s&&null!=s||(s=1),null==i.owner.bounds||i.owner.bounds.enabled&&i.owner.bounds.pointInside(o.clientX,o.clientY,s)&&i.owner.linkCondition()){null!=i.owner&&null!=i.owner.onLinkTrigger?i.owner.onLinkTrigger():window.open(i.url,"_blank");break}}},a.links=new Array,a);function a(){}e.LinkManager=t}(Engine=Engine||{}),function(e){var t=(Object.defineProperty(s,"x",{get:function(){return s._x},enumerable:!1,configurable:!0}),Object.defineProperty(s,"y",{get:function(){return s._y},enumerable:!1,configurable:!0}),s.hasDown=function(e,t){return e<(t?s.oldButtonPressEvents:s.buttonPressEvents).length&&(t?s.oldButtonPressEvents:s.buttonPressEvents)[e]},s.down=function(e){return s.hasDown(e,!1)},s.up=function(e){return!s.hasDown(e,!1)},s.pressed=function(e){return s.hasDown(e,!1)&&!s.hasDown(e,!0)},s.released=function(e){return!s.hasDown(e,!1)&&s.hasDown(e,!0)},s.in=function(e,t,n,i){return e<=s._x&&s._x<=n&&t<=s._y&&s._y<=i},s.clickedIn=function(e,t,n,i,r){if(s.released(e)){var o=s.pressPositionsX[e],e=s.pressPositionsY[e],e=t<=o&&o<=i&&n<=e&&e<=r,r=s.in(t,n,i,r);return e&&r}return!1},s.onDown=function(e){return s._x=e.clientX,s._y=e.clientY,s.readedButtonPressEvents[e.button]=!0,s.pressPositionsX[e.button]=s._x,s.pressPositionsY[e.button]=s._y,!1},s.onUp=function(e){return s._x=e.clientX,s._y=e.clientY,s.readedButtonPressEvents[e.button]=!1},s.onMove=function(e){return s._x=e.clientX,s._y=e.clientY,!1},s.update=function(){for(var e=0;e<s.buttonPressEvents.length;e+=1)s.oldButtonPressEvents[e]=s.buttonPressEvents[e];for(e=0;e<s.readedButtonPressEvents.length;e+=1)s.buttonPressEvents[e]=s.readedButtonPressEvents[e]},s._x=0,s._y=0,s.readedButtonPressEvents=new Array,s.oldButtonPressEvents=new Array,s.buttonPressEvents=new Array,s.pressPositionsX=new Array,s.pressPositionsY=new Array,s);function s(){}e.Mouse=t,window.addEventListener("mousedown",t.onDown,!1),window.addEventListener("mouseup",t.onUp,!1),window.addEventListener("mousemove",t.onMove,!1)}(Engine=Engine||{}),function(s){var e=(Object.defineProperty(a.prototype,"path",{get:function(){return this._path},enumerable:!1,configurable:!0}),a.recycleAll=function(){for(var e=new Array,t=0,n=a.textures;t<n.length;t++){for(var i,r=n[t],o=r;null!=o.owner;)o=o.owner;o.preserved&&(i=r.slot,r.slot=e.length,s.Renderer.mode==s.RendererMode.WEB_GL&&i!=r.slot&&s.Renderer.renderTexture(r),e.push(r))}a.textures=e},a.prototype.getRed=function(e,t){return this.assetData.bytes[4*(t*this.assetData.xSize+e)]},a.prototype.getGreen=function(e,t){return this.assetData.bytes[4*(t*this.assetData.xSize+e)+1]},a.prototype.getBlue=function(e,t){return this.assetData.bytes[4*(t*this.assetData.xSize+e)+2]},a.prototype.getAlpha=function(e,t){return this.assetData.bytes[4*(t*this.assetData.xSize+e)+3]},a.prototype.applyClearColor=function(){var e={};e.r=this.getRed(0,0),e.g=this.getGreen(0,0),e.b=this.getBlue(0,0),e.a=this.getAlpha(0,0);for(var t=0;t<this.assetData.ySize;t+=1)for(var n=0;n<this.assetData.xSize;n+=1)e.r==this.getRed(n,t)&&e.g==this.getGreen(n,t)&&e.b==this.getBlue(n,t)&&e.a==this.getAlpha(n,t)&&(this.assetData.bytes[4*(t*this.assetData.xSize+n)+0]=0,this.assetData.bytes[4*(t*this.assetData.xSize+n)+1]=0,this.assetData.bytes[4*(t*this.assetData.xSize+n)+2]=0,this.assetData.bytes[4*(t*this.assetData.xSize+n)+3]=0)},a.textures=new Array,a);function a(e,t,n){this._path="",this.slot=0,this.preserved=!1,s.System.creatingScene||console.error("error"),this._path=e,this.slot=a.textures.length,this.assetData=s.Assets.loadImage(e),this.filter=n,t&&this.applyClearColor(),s.Renderer.mode==s.RendererMode.CANVAS_2D?(this.canvas=document.createElement("canvas"),this.canvas.width=this.assetData.xSize,this.canvas.height=this.assetData.ySize,this.context=this.canvas.getContext("2d"),this.context.putImageData(this.assetData.imageData,0,0)):s.Renderer.renderTexture(this,this.filter),a.textures.push(this)}s.Texture=e}(Engine=Engine||{}),function(e){var c;function t(e){e.preventDefault();for(var t=0;t<e.changedTouches.length;t+=1)for(var n=e.changedTouches.item(t),i=0;i<h.length;i+=1){var r=h[i];if(null!=r&&r.start.identifier==n.identifier){r.next=n,r.state!=c.New&&r.state!=c.Pressed&&r.state!=c.Down||(r.state=c.Canceled);break}}}(n=c=c||{})[n.New=0]="New",n[n.Pressed=1]="Pressed",n[n.Down=2]="Down",n[n.Canceled=3]="Canceled",n[n.Released=4]="Released";var s=function(e,t){this.start=e,this.previous=e,this.current=e,this.next=null,this.state=t},h=new Array;window.addEventListener("touchstart",function(e){e.preventDefault();for(var t=0;t<e.changedTouches.length;t+=1){for(var n=e.changedTouches.item(t),i=!0,r=0;r<h.length;r+=1){var o=h[r];if(null==o){h[r]=new s(n,c.New),i=!1;break}if(n.identifier==o.current.identifier){o.state==c.Canceled||o.state==c.Released?h[r]=new s(n,c.New):h[r].next=n,i=!1;break}}i&&h.push(new s(n,c.New))}},{passive:!1}),window.addEventListener("touchmove",function(e){e.preventDefault();for(var t=0;t<e.changedTouches.length;t+=1)for(var n=e.changedTouches.item(t),i=0;i<h.length;i+=1){var r=h[i];if(null!=r&&r.start.identifier==n.identifier){r.next=n;break}}},{passive:!1}),window.addEventListener("touchcancel",t,{passive:!1}),window.addEventListener("touchend",function(e){t(e)},{passive:!1}),window.document.addEventListener("touchstart",function(e){e.preventDefault()},{passive:!1}),window.document.addEventListener("touchmove",function(e){e.preventDefault()},{passive:!1}),window.document.addEventListener("touchcancel",function(e){e.preventDefault()},{passive:!1}),window.document.addEventListener("touchend",function(e){e.preventDefault()},{passive:!1}),window.addEventListener("gesturestart",function(e){e.preventDefault()},{passive:!1}),window.addEventListener("gesturechange",function(e){e.preventDefault()},{passive:!1}),window.addEventListener("gestureend",function(e){e.preventDefault()},{passive:!1}),window.document.addEventListener("gesturestart",function(e){e.preventDefault()},{passive:!1}),window.document.addEventListener("gesturechange",function(e){e.preventDefault()},{passive:!1}),window.document.addEventListener("gestureend",function(e){e.preventDefault()},{passive:!1});var n=(o.findDown=function(e,t,n,i,r,o){for(var s=0,a=h;s<a.length;s++){var l=a[s];if(null!=l){var u=l.current;if(l.state==c.Pressed||!o&&l.state==c.Down){var d=u.radiusX<u.radiusY?u.radiusX:u.radiusY;null!=d&&null!=d||(d=1),r||(d=1),d=0==d?1:d;l=u.clientX/d,u=u.clientY/d;if(e/d<=l&&l<=n/d&&t/d<=u&&u<=i/d)return!0}}}return!1},o.down=function(e,t,n,i,r){return o.findDown(e,t,n,i,r,!1)},o.pressed=function(e,t,n,i,r){return o.findDown(e,t,n,i,r,!0)},o.update=function(){for(var e=0;e<h.length;e+=1){var t=h[e];if(null!=t)switch(null!=t.next&&(t.previous=t.current,t.current=t.next,t.next=null),t.state){case c.New:t.state=c.Pressed;break;case c.Pressed:t.state=c.Down;break;case c.Canceled:t.state=c.Released;break;case c.Released:h[e]=null}}},o);function o(){}e.TouchInput=n}(Engine=Engine||{});